cscope 15 W:\asteroids_game\src\game"               0000538640
	@asset_formats.h

1 
	eVERTEX_BUFFER
 {

2 
	mVERTEX_BUFFER_NOT_SET
,

3 
	mVERTEX_BUFFER_POSITION
,

4 
	mVERTEX_BUFFER_NORMAL
,

5 
	mVERTEX_BUFFER_TANGENT
,

6 
	mVERTEX_BUFFER_COLOR
,

7 
	mVERTEX_BUFFER_TEXCOORD
,

8 
	mVERTEX_BUFFER_TOTAL


11 
	sVîãxBuf„rD©a
 {

12 * 
	md©a
;

13 
VERTEX_BUFFER
 
	mty≥
;

16 
	sMeshD©a
 {

17 
VîãxBuf„rD©a
* 
	mvb_d©a
;

18 
u32
 
	mvb_d©a_cou¡
;

20 
u32
* 
	mödi˚s
;

21 
u32
 
	mvîti˚s_cou¡
;

22 
u32
 
	mödi˚s_cou¡
;

25 
	eTEXTURE_SLOT
 {

26 
	mTEXTURE_SLOT_DIFFUSE
,

27 
	mTEXTURE_SLOT_NORMAL
,

28 
	mTEXTURE_SLOT_TOTAL
,

31 
	sTextuªD©a
 {

32 
TEXTURE_SLOT
 
	mty≥
;

33 * 
	mpixñs
;

34 
u32
 
	mwidth
;

35 
u32
 
	mheight
;

36 
u8
 
	mnum_comp⁄íts
;

39 
	sM©îülD©a
 {

40 
TextuªD©a
* 
	mãxtuª_d©a
;

41 
u8
 
	mcou¡
;

42 * 
	m«me
;

	@asset_info.cpp

1 
TextuªD©a
*

2 
	$LﬂdTextuªD©a
(
TextuªF‹m©
* 
tf
, 
GameAs£ts
* 
as£ts
) {

3 
TextuªD©a
* 
ªsu…
 = 
	`PushSåu˘
(
as£ts
->
≥rm™ít_¨ía
, TextureData);

5 
ªsu…
->
pixñs
 = 
as£ts
->
d©a
 + 
tf
->
off£t_to_d©a
;

6 
ªsu…
->
width
 = 
tf
->width;

7 
ªsu…
->
height
 = 
tf
->height;

8 
ªsu…
->
num_comp⁄íts
 = 
tf
->num_components;

10  
ªsu…
;

11 
	}
}

13 
MeshAs£tInfo
*

14 
	$PushMeshAs£tInfo
(
GameAs£ts
* 
ga
) {

15 
MeshAs£tInfo
* 
ªsu…
 = 0;

17 if(!
ga
->
mesh_as£ts
) {

18 
ªsu…
 = 
ga
->
mesh_as£ts
 = 
	`PushSåu˘
(ga->
≥rm™ít_¨ía
, 
MeshAs£tInfo
);

21 
ªsu…
 = 
ga
->
mesh_as£ts
;

22 
ªsu…
->
√xt
)Ñesult =Ñesult->next;

23 
ªsu…
 =Ñesu…->
√xt
 = 
	`PushSåu˘
(
ga
->
≥rm™ít_¨ía
, 
MeshAs£tInfo
);

26  
ªsu…
;

27 
	}
}

29 
TextuªAs£tInfo
*

30 
	$PushTextuªAs£tInfo
(
GameAs£ts
* 
ga
) {

31 
TextuªAs£tInfo
* 
ªsu…
 = 0;

33 if(!
ga
->
ãxtuª_as£ts
) {

34 
ªsu…
 = 
ga
->
ãxtuª_as£ts
 = 
	`PushSåu˘
(ga->
≥rm™ít_¨ía
, 
TextuªAs£tInfo
);

37 
ªsu…
 = 
ga
->
ãxtuª_as£ts
;

38 
ªsu…
->
√xt
)Ñesult =Ñesult->next;

39 
ªsu…
 =Ñesu…->
√xt
 = 
	`PushSåu˘
(
ga
->
≥rm™ít_¨ía
, 
TextuªAs£tInfo
);

42  
ªsu…
;

43 
	}
}

45 
MeshAs£tInfo
*

46 
	$LﬂdMeshAs£t
(* 
«me
, 
GameAs£ts
* 
as£ts
) {

47 
MeshAs£tInfo
* 
mesh_öfo
 = 
	`PushMeshAs£tInfo
(
as£ts
);

49 
MeshF‹m©
* 
mf
 = 
	`GëMeshF‹m©
(
«me
, 
as£ts
);

50 
MeshD©a
* 
md
 = 
	`LﬂdMeshD©a
(
mf
, 
as£ts
);

52 
mesh_öfo
->
«me
 = 
mf
->name;

53 
mesh_öfo
->
d©a
 = 
md
;

55  
mesh_öfo
;

56 
	}
}

58 
TextuªAs£tInfo
*

59 
	$LﬂdTextuªAs£t
(* 
«me
, 
GameAs£ts
* 
as£ts
) {

60 
TextuªAs£tInfo
* 
ãxtuª_öfo
 = 
	`PushTextuªAs£tInfo
(
as£ts
);

62 
TextuªF‹m©
* 
tf
 = 
	`GëTextuªF‹m©
(
«me
, 
as£ts
);

63 
TextuªD©a
* 
td
 = 
	`LﬂdTextuªD©a
(
tf
, 
as£ts
);

65 
ãxtuª_öfo
->
«me
 = 
tf
->name;

66 
ãxtuª_öfo
->
d©a
 = 
td
;

68  
ãxtuª_öfo
;

69 
	}
}

72 
	$LﬂdAŒTextuªAs£ts
(
GameAs£ts
* 
as£ts
) {

73 
u32
 
cou¡
 = 0;

74 
TextuªF‹m©
* 
tf_¨øy
 = 
	`GëAŒTextuªF‹m©s
(
as£ts
, &
cou¡
);

76 
TextuªAs£tInfo
* 
ãxtuª_öfo
;

77 
TextuªF‹m©
* 
ãxtuª_f‹m©
;

78 
u32
 
i
=0; i<
cou¡
; i++) {

79 
ãxtuª_öfo
 = 
	`PushTextuªAs£tInfo
(
as£ts
);

80 
ãxtuª_f‹m©
 = 
tf_¨øy
+
i
;

81 
ãxtuª_öfo
->
«me
 = 
ãxtuª_f‹m©
->name;

82 
ãxtuª_öfo
->
d©a
 = 
	`LﬂdTextuªD©a
(
ãxtuª_f‹m©
, 
as£ts
);

84 
	}
}

87 
	$LﬂdAŒMeshAs£ts
(
GameAs£ts
* 
as£ts
) {

88 
u32
 
cou¡
 = 0;

89 
MeshF‹m©
* 
mf_¨øy
 = 
	`GëAŒMeshF‹m©s
(
as£ts
, &
cou¡
);

91 
MeshAs£tInfo
* 
mesh_öfo
;

92 
MeshF‹m©
* 
mesh_f‹m©
;

93 
u32
 
i
=0; i<
cou¡
; i++) {

94 
mesh_öfo
 = 
	`PushMeshAs£tInfo
(
as£ts
);

95 
mesh_f‹m©
 = 
mf_¨øy
+
i
;

96 
mesh_öfo
->
«me
 = 
mesh_f‹m©
->name;

97 
mesh_öfo
->
d©a
 = 
	`LﬂdMeshD©a
(
mesh_f‹m©
, 
as£ts
);

99 
	}
}

102 
	$U∂ﬂdAŒMeshAs£ts
(
GameAs£ts
* 
as£ts
, 
Rídîî
* 
ªndîî
) {

103 
MeshAs£tInfo
* 
öfo
 = 
as£ts
->
mesh_as£ts
;

104 if(
öfo
) {

105 
öfo
) {

106 
MeshD©a
* 
mesh_d©a
 = 
öfo
->
d©a
;

107 
Mesh
* 
mesh
 = 
	`PushSåu˘
(
ªndîî
->
≥rm™ít_¨ía
, Mesh);

109 if(
mesh_d©a
->
ödi˚s
)

110 
mesh
->
ödex_buf„r
 = 
	`U∂ﬂdIndexBuf„r
(
mesh_d©a
->
ödi˚s
, mesh_d©a->
ödi˚s_cou¡
, 
ªndîî
);

111 
mesh
->
ödi˚s_cou¡
 = 
mesh_d©a
->indices_count;

113 
u8
 
i
=0; i<
öfo
->
d©a
->
vb_d©a_cou¡
; i++) {

114 
u8
 
num_comp⁄íts
 = 0;

115 if(
mesh_d©a
->
vb_d©a
[
i
].
ty≥
 =
VERTEX_BUFFER_POSITION
Ë
num_comp⁄íts
 = 3;

116 if(
mesh_d©a
->
vb_d©a
[
i
].
ty≥
 =
VERTEX_BUFFER_NORMAL
Ë
num_comp⁄íts
 = 3;

118 
mesh
->
vîãx_buf„rs
[
i
] = 
	`U∂ﬂdVîãxBuf„r
(
mesh_d©a
->
vb_d©a
[i].
d©a
, mesh_d©a->
vîti˚s_cou¡
,

119 
num_comp⁄íts
, 
Ál£
, 
ªndîî
);

120 
mesh
->
vîti˚s_cou¡
 = 
mesh_d©a
->vertices_count;

121 
öfo
->
mesh
 = mesh;

123 
öfo
 = info->
√xt
;

126 
	}
}

129 
	$U∂ﬂdAŒTextuªAs£ts
(
GameAs£ts
* 
as£ts
, 
Rídîî
* 
ªndîî
) {

130 
TextuªAs£tInfo
* 
öfo
 = 
as£ts
->
ãxtuª_as£ts
;

131 if(
öfo
) {

132 
öfo
) {

133 
öfo
->
buf„r
 = 
	`U∂ﬂdTextuª
(öfo->
d©a
->
pixñs
, info->d©a->
width
,

134 
öfo
->
d©a
->
height
, info->d©a->
num_comp⁄íts
, 
Ál£
, fÆ£, 
ªndîî
);

135 
öfo
 = info->
√xt
;

138 
	}
}

141 
MeshAs£tInfo
*

142 
	$GëMeshAs£tInfo
(* 
«me
, 
GameAs£ts
* 
as£ts
) {

143 
MeshAs£tInfo
* 
ªsu…
 = 0;

145 
boﬁ
 
found
 = 
Ál£
;

147 
	`As£π
(
as£ts
->
mesh_as£ts
);

148 
MeshAs£tInfo
* 
öfo
 = 
as£ts
->
mesh_as£ts
;

149 
öfo
) {

150 if(
	`SåögCom∑ª
(
öfo
->
«me
,Çame)) {

151 
ªsu…
 = 
öfo
;

152 
found
 = 
åue
;

155 
öfo
 = info->
√xt
;

158 
	`As£π
(
found
);

159  
ªsu…
;

160 
	}
}

162 
TextuªAs£tInfo
*

163 
	$GëTextuªAs£tInfo
(* 
«me
, 
GameAs£ts
* 
as£ts
) {

164 
TextuªAs£tInfo
* 
ªsu…
 = 0;

166 
boﬁ
 
found
 = 
Ál£
;

168 
	`As£π
(
as£ts
->
ãxtuª_as£ts
);

169 
TextuªAs£tInfo
* 
öfo
 = 
as£ts
->
ãxtuª_as£ts
;

170 
öfo
) {

171 if(
	`SåögCom∑ª
(
öfo
->
«me
,Çame)) {

172 
ªsu…
 = 
öfo
;

173 
found
 = 
åue
;

176 
öfo
 = info->
√xt
;

179 
	`As£π
(
found
);

180  
ªsu…
;

181 
	}
}

	@asset_info.h

1 
	sTextuªAs£tInfo
 {

2 
TextuªD©a
* 
	md©a
;

3 
TextuªBuf„r
* 
	mbuf„r
;

4 * 
	m«me
;

6 
TextuªAs£tInfo
* 
	m√xt
;

9 
	sMeshAs£tInfo
 {

10 
MeshD©a
* 
	md©a
;

11 
Mesh
* 
	mmesh
;

12 * 
	m«me
;

14 
MeshAs£tInfo
* 
	m√xt
;

	@asset_loading.cpp

1 
	~"as£t_öfo.h
"

3 
	sGameAs£ts
 {

4 
Mem‹yAª«
* 
	m≥rm™ít_¨ía
;

5 
u32
 
	moff£ts
[
ASSET_BLOB_TOTAL
];

7 
u8
* 
	md©a
;

8 
u32
 
	msize
;

10 
TextuªAs£tInfo
* 
	mãxtuª_as£ts
;

11 
MeshAs£tInfo
* 
	mmesh_as£ts
;

15 
	$GëAs£tBlob
(
ASSET_BLOB
 
blob
, 
GameAs£ts
* 
as£ts
) {

16  
as£ts
->
d©a
 +ás£ts->
off£ts
[
blob
];

17 
	}
}

19 
GameAs£ts
*

20 
	$LﬂdGameAs£ts
(
Mem‹yAª«
* 
¨ía
) {

21 
GameAs£ts
* 
ga
 = {};

23 
Pœtf‹mFûeInfo
 
öfo
;

24 
u8
 
«me
[] = "data.gaf";

25 
öfo
.
«me
 =Çame;

26 
Pœtf‹mFûeH™dÀ
 
h™dÀ
 = 
∂©f‹m_≠i
.
	`›í_fûe
(&
öfo
);

27 
	`As£π
(!
h™dÀ
.
Áûed
);

29 
ga
 = 
	`PushSåu˘
(
¨ía
, 
GameAs£ts
);

30 
ga
->
≥rm™ít_¨ía
 = 
¨ía
;

32 
u8
* 
memblock
 = (u8*)
	`PushSize
(
¨ía
, 
öfo
.
size
);

33 
ga
->
d©a
 = 
memblock
;

34 
ga
->
size
 = 
öfo
.size;

36 
∂©f‹m_≠i
.
	`ªad_fûe
(&
h™dÀ
, 
öfo
.
size
, 
ga
->
d©a
);

37 
GameAs£tFûe
* 
gaf
 = (GameAs£tFûe*)
ga
->
d©a
;

38 
	`As£π
(
	`SåögCom∑ª
(
gaf
->
idítifiˇti⁄
, "gaff"));

40 
Dúe˘‹y
* 
dú
 = (Dúe˘‹y*)(
ga
->
d©a
 + 
gaf
->
off£t_to_blob_dúe˘‹õs
);

41 
u8
 
i
=0; i<
gaf
->
numbî_of_blobs
; i++)

42 
u8
 
j
=0; j<
ASSET_BLOB_TOTAL
; j++)

43 if(
	`SåögCom∑ª
(
blob_«mes
[
j
], 
dú
[
i
].
«me_of_blob
))

44 
ga
->
off£ts
[
j
] = 
dú
[
i
].
off£t_to_blob
;

46  
ga
;

47 
	}
}

49 
VîãxBuf„rD©a


50 
	$MakeVîãxBuf„rD©a
(
VîãxBuf„rF‹m©
* 
vbf
, 
GameAs£ts
* 
ga
) {

51 
VîãxBuf„rD©a
 
vbd
 = {};

53 
u8
 
i
=0; i<
VERTEX_BUFFER_TOTAL
; i++) {

54 if(
	`SåögCom∑ª
(
vbf
->
ty≥
, 
vîãx_buf„r_«mes
[
i
])) {

55 
vbd
.
ty≥
 = (
VERTEX_BUFFER
)
i
;

60 
vbd
.
d©a
 = (*)(
ga
->d©®+ 
vbf
->
off£t_to_d©a
);

62  
vbd
;

63 
	}
}

65 
MeshF‹m©
*

66 
	$GëMeshF‹m©
(* 
«me
, 
GameAs£ts
* 
ga
) {

67 
MeshF‹m©
* 
ªsu…
 = 0;

69 
MeshesBlob
* 
mb
 = (MeshesBlob*)(
ga
->
d©a
 + ga->
off£ts
[
ASSET_BLOB_MESHES
]);

70 
MeshF‹m©
* 
mf_¨r
 = (MeshF‹m©*)(
ga
->
d©a
 + 
mb
->
off£t_to_mesh_f‹m©s
);

72 
u32
 
i
=0;

73 !
	`SåögCom∑ª
(
mf_¨r
[
i
].
«me
,Çame)) i++;

74 
ªsu…
 = 
mf_¨r
 + 
i
;

76  
ªsu…
;

77 
	}
}

79 
MeshD©a
*

80 
	$LﬂdMeshD©a
(
MeshF‹m©
* 
mf
, 
GameAs£ts
* 
ga
) {

81 
MeshD©a
* 
md
 = 
	`PushSåu˘
(
ga
->
≥rm™ít_¨ía
, MeshData);

83 
md
->
vîti˚s_cou¡
 = 
mf
->vertices_count;

84 
md
->
ödi˚s_cou¡
 = 
mf
->indices_count;

85 
md
->
vb_d©a_cou¡
 = 
mf
->
vîãx_buf„r_cou¡
;

86 
md
->
ödi˚s
 = (
u32
*)(
ga
->
d©a
 + 
mf
->
off£t_to_ödi˚s
);

87 
md
->
vb_d©a
 = 
	`PushAºay
(
ga
->
≥rm™ít_¨ía
, 
VîãxBuf„rD©a
, 
mf
->
vîãx_buf„r_cou¡
);

89 
VîãxBuf„rF‹m©
* 
vbf_¨r
 = (VîãxBuf„rF‹m©*)(
ga
->
d©a
 + 
mf
->
off£t_to_vîãx_buf„rs
);

90 
u8
 
i
=0; i<
mf
->
vîãx_buf„r_cou¡
; i++)

91 
md
->
vb_d©a
[
i
] = 
	`MakeVîãxBuf„rD©a
(
vbf_¨r
 + i, 
ga
);

93  
md
;

94 
	}
}

96 
MeshF‹m©
*

97 
	$GëAŒMeshF‹m©s
(
GameAs£ts
* 
ga
, 
u32
* 
cou¡
) {

98 
MeshesBlob
* 
tb
 = (MeshesBlob*)(
ga
->
d©a
 + ga->
off£ts
[
ASSET_BLOB_MESHES
]);

99 
MeshF‹m©
* 
mf_¨r
 = (MeshF‹m©*)(
ga
->
d©a
 + 
tb
->
off£t_to_mesh_f‹m©s
);

101 *
cou¡
 = 
tb
->
meshes_cou¡
;

102  
mf_¨r
;

103 
	}
}

105 
TextuªF‹m©
*

106 
	$GëAŒTextuªF‹m©s
(
GameAs£ts
* 
ga
, 
u32
* 
cou¡
) {

107 
TextuªsBlob
* 
tb
 = (TextuªsBlob*)(
ga
->
d©a
 + ga->
off£ts
[
ASSET_BLOB_TEXTURES
]);

108 
TextuªF‹m©
* 
tf_¨r
 = (TextuªF‹m©*)(
ga
->
d©a
 + 
tb
->
off£t_to_ãxtuª_f‹m©s
);

110 *
cou¡
 = 
tb
->
ãxtuªs_cou¡
;

111  
tf_¨r
;

112 
	}
}

114 
F⁄tF‹m©
*

115 
	$GëAŒF⁄tF‹m©s
(
GameAs£ts
* 
ga
, 
u32
* 
cou¡
) {

116 
F⁄tsBlob
* 
fb
 = (F⁄tsBlob*)(
ga
->
d©a
 + ga->
off£ts
[
ASSET_BLOB_FONTS
]);

117 
F⁄tF‹m©
* 
ff_¨r
 = (F⁄tF‹m©*)(
ga
->
d©a
 + 
fb
->
off£t_to_f⁄t_f‹m©s
);

119 *
cou¡
 = 
fb
->
f⁄ts_cou¡
;

120  
ff_¨r
;

121 
	}
}

124 
TextuªF‹m©
*

125 
	$GëTextuªF‹m©
(* 
«me
, 
GameAs£ts
* 
ga
) {

126 
	`As£π
(
«me
);

127 
TextuªF‹m©
* 
tf
 = 0;

129 
u32
 
cou¡
 = 0;

130 
TextuªF‹m©
* 
tf_¨r
 = 
	`GëAŒTextuªF‹m©s
(
ga
, &
cou¡
);

132 
boﬁ
 
found
 = 
Ál£
;

133 
u32
 
i
=0;

134 
i
=0; i<
cou¡
; i++) {

135 if(
	`SåögCom∑ª
(
tf_¨r
[
i
].
«me
,Çame)) {

136 
found
 = 
åue
;

140 
	`As£π
(
found
);

142 
tf
 = 
tf_¨r
 + 
i
;

143  
tf
;

144 
	}
}

146 
F⁄tF‹m©
*

147 
	$GëF⁄tF‹m©
(* 
«me
, 
GameAs£ts
* 
ga
) {

148 
F⁄tF‹m©
* 
ff
 = 0;

150 
u32
 
cou¡
 = 0;

151 
F⁄tF‹m©
* 
ff_¨r
 = 
	`GëAŒF⁄tF‹m©s
(
ga
, &
cou¡
);

153 
boﬁ
 
found
 = 
Ál£
;

154 
u32
 
i
=0;

155 
i
=0; i<
cou¡
; i++) {

156 if(
	`SåögCom∑ª
(
ff_¨r
[
i
].
«me
,Çame)) {

157 
found
 = 
åue
;

161 
	`As£π
(
found
);

163 
ff
 = 
ff_¨r
 + 
i
;

165  
ff
;

166 
	}
}

169 
	$GëF⁄t
(* 
«me
, 
GameAs£ts
* 
ga
) {

170 
F⁄tF‹m©
* 
ff
 = 
	`GëF⁄tF‹m©
(
«me
, 
ga
);

171  
ga
->
d©a
 + 
ff
->
off£t_to_d©a
;

172 
	}
}

	@base_types.h

1 
	~<öåö.h
>

2 
	~<°döt.h
>

3 
	~<°ddef.h
>

4 
	~<limôs.h
>

5 
	~<Êﬂt.h
>

7 
	#globÆ
 

	)

9 
öt8_t
 
	ti8
;

10 
öt16_t
 
	ti16
;

11 
öt32_t
 
	ti32
;

12 
öt64_t
 
	ti64
;

14 
uöt8_t
 
	tu8
;

15 
uöt16_t
 
	tu16
;

16 
uöt32_t
 
	tu32
;

17 
uöt64_t
 
	tu64
;

19 
	#U8Max
 255

	)

20 
	#U16Max
 65535

	)

21 
	#I32Mö
 ((
i32
)0x80000000)

	)

22 
	#I32Max
 ((
i32
)0x7fffffff)

	)

23 
	#U32Mö
 0

	)

24 
	#U32Max
 ((
u32
)-1)

	)

25 
	#U64Max
 ((
u64
)-1)

	)

26 
	#F32Max
 
FLT_MAX


	)

27 
	#F32Mö
 -
FLT_MAX


	)

29 
	#PI32
 3.14159265359f

	)

31 
	#Kûobyãs
(
VÆue
Ë((VÆue)*1024LL)

	)

32 
	#Megabyãs
(
VÆue
Ë(
	`Kûobyãs
(VÆue)*1024LL)

	)

33 
	#Gigabyãs
(
VÆue
Ë(
	`Megabyãs
(VÆue)*1024LL)

	)

34 
	#Tîabyãs
(
VÆue
Ë(
	`Gigabyãs
(VÆue)*1024LL)

	)

36 
	#AºayCou¡
(
Aºay
Ë((AºayË/ ((Aºay)[0]))

	)

38 #i‡
INTERNAL


39 
	#As£π
(
Ex¥essi⁄
Ëif(!(Ex¥essi⁄)Ë{*(vﬁ©ûê*)0 = 0;}

	)

41 
	#As£π
(
Ex¥essi⁄
)

	)

44 
	#Max
(
a
, 
b
Ë((◊Ë> (b)Ë? (aË: (b))

	)

45 
	#Mö
(
a
, 
b
Ë((◊Ë< (b)Ë? (aË: (b))

	)

	@camera.cpp

1 
	sCamîa
 {

2 
Vec3
 
	mposôi⁄
;

3 
Qu©
 
	mrŸ©i⁄
;

4 
	m√¨_˛ù
;

5 
	mÁr_˛ù
;

6 
boﬁ
 
	m‹thogøphic
;

9 
	mfov
;

10 
	ma•e˘_øtio
;

13 
	mÀ·
;

14 
	mright
;

15 
	mbŸtom
;

16 
	mt›
;

21 
	sFPC⁄åﬁInfo
 {

22 
	mba£_£ns
;

23 
	må™s_£ns
;

24 
	mrŸ_£ns
;

26 
boﬁ
 
	mblock_yaw
;

27 
boﬁ
 
	mblock_pôch
;

30 
FPC⁄åﬁInfo


31 
	$DeÁu…FPC⁄åﬁInfo
() {

32 
FPC⁄åﬁInfo
 
ªsu…
 = {};

33 
ªsu…
.
ba£_£ns
 = 1.0f;

34 
ªsu…
.
å™s_£ns
 = 1.0f;

35 
ªsu…
.
rŸ_£ns
 = 1.0f;

36  
ªsu…
;

37 
	}
}

39 
Camîa
*

40 
	$DeÁu…Pî•e˘iveCamîa
(
WödowDimísi⁄s
 
wd
, 
Mem‹yAª«
* 
¨ía
) {

41 
Camîa
* 
ˇm
 = 
	`PushSåu˘
(
¨ía
, Camera);

42 
ˇm
->
posôi⁄
 = 
	`V3Z
();

43 
ˇm
->
rŸ©i⁄
 = 
	`Qu©I
();

44 
ˇm
->
fov
 = 90.0f;

45 
ˇm
->
√¨_˛ù
 = 0.1f;

46 
ˇm
->
Ár_˛ù
 = 1000.0f;

47 
ˇm
->
a•e˘_øtio
 = ()
wd
.
width
/()wd.
height
;

48 
ˇm
->
‹thogøphic
 = 
Ál£
;

49  
ˇm
;

50 
	}
}

52 
Camîa
*

53 
	$DeÁu…OπhoCamîa
(
WödowDimísi⁄s
 
wd
, 
Mem‹yAª«
* 
¨ía
) {

54 
Camîa
* 
ˇm
 = 
	`PushSåu˘
(
¨ía
, Camera);

55 
ˇm
->
posôi⁄
 = 
	`V3
(0.0f, 0.0f, 2000.0f);

56 
ˇm
->
rŸ©i⁄
 = 
	`Qu©I
();

57 
ˇm
->
fov
 = 90.0f;

58 
ˇm
->
√¨_˛ù
 = 0.1f;

59 
ˇm
->
Ár_˛ù
 = 1000.0f;

60 
ˇm
->
a•e˘_øtio
 = ()
wd
.
width
/()wd.
height
;

61 
ˇm
->
‹thogøphic
 = 
åue
;

62 
ˇm
->
À·
 = 1000.0f;

63 
ˇm
->
right
 = 1000.0f;

64 
ˇm
->
bŸtom
 = 1000.0f;

65 
ˇm
->
t›
 = 1000.0f;

66  
ˇm
;

67 
	}
}

70 
	$Fú°Pîs⁄C⁄åﬁ
(
Vec3
* 
posôi⁄
, 
Qu©
* 
rŸ©i⁄
, 
boﬁ
 
ˇmîa
, 
FPC⁄åﬁInfo
* 
ci
, 
I≈ut
* 
öput
) {

71 
ba£_£ns
 = 
ci
->base_sens;

72 
å™s_£ns
 = 
ci
->trans_sens;

73 
rŸ_£ns
 = 
ci
->rot_sens;

75 
tdñ
 = 
ba£_£ns
 * 
å™s_£ns
 * 0.00001f;

76 
rdñ
 = 
ba£_£ns
 * 
rŸ_£ns
 * 0.5f;

78 
boﬁ
 
f
 = 
öput
->
buâ⁄s
[
WIN32_BUTTON_W
].
hñd
;

79 
boﬁ
 
b
 = 
öput
->
buâ⁄s
[
WIN32_BUTTON_S
].
hñd
;

80 
boﬁ
 
l
 = 
öput
->
buâ⁄s
[
WIN32_BUTTON_A
].
hñd
;

81 
boﬁ
 
r
 = 
öput
->
buâ⁄s
[
WIN32_BUTTON_D
].
hñd
;

82 
boﬁ
 
u
 = 
öput
->
buâ⁄s
[
WIN32_BUTTON_Q
].
hñd
;

83 
boﬁ
 
d
 = 
öput
->
buâ⁄s
[
WIN32_BUTTON_E
].
hñd
;

85 
y
 = 
öput
->
axes
[
WIN32_AXIS_MOUSE_DEL
].
x
 * !
ci
->
block_yaw
;

86 
p
 = 
öput
->
axes
[
WIN32_AXIS_MOUSE_DEL
].
y
 * !
ci
->
block_pôch
;

88 
Vec3
 
pos
 = *
posôi⁄
;

89 
Qu©
 
rŸ
 = *
rŸ©i⁄
;

92 
Vec3
 
fv
 = 
ˇmîa
 ? 
	`V3Neg
(
	`GëF‹w¨dVe˘‹
(
rŸ
)) : GetForwardVector(rot);

93 
Vec3
 
fdi•
 = 
	`V3MulF
(
fv
, 
tdñ
);

95 
Vec3
 
rv
 = 
	`GëRightVe˘‹
(
rŸ
);

96 
Vec3
 
rdi•
 = 
	`V3MulF
(
rv
, 
tdñ
);

98 
Vec3
 
uv
 = 
	`V3Up
();

99 
Vec3
 
udi•
 = 
	`V3MulF
(
uv
, 
tdñ
);

101 
pos
 = 
	`V3Add
’os, 
	`V3MulF
(V3Add(
fv
, 
fdi•
), 
f
));

102 
pos
 = 
	`V3Sub
’os, 
	`V3MulF
(
	`V3Add
(
fv
, 
fdi•
), 
b
));

104 
pos
 = 
	`V3Add
’os, 
	`V3MulF
(V3Add(
rv
, 
rdi•
), 
r
));

105 
pos
 = 
	`V3Sub
’os, 
	`V3MulF
(
	`V3Add
(
rv
, 
rdi•
), 
l
));

107 
pos
 = 
	`V3Add
’os, 
	`V3MulF
(V3Add(
uv
, 
rdi•
), 
u
));

108 
pos
 = 
	`V3Sub
’os, 
	`V3MulF
(
	`V3Add
(
uv
, 
rdi•
), 
d
));

110 
Qu©
 
yrŸ
 = 
y
 ? 
	`Qu©FromAxisAngÀ
(
	`V3Up
(), -y * 
rdñ
Ë: 
	`Qu©I
();

111 
Qu©
 
xrŸ
 = 
p
 ? 
	`Qu©FromAxisAngÀ
(
rv
, -∞* 
rdñ
Ë: 
	`Qu©I
();

113 
rŸ
 = 
	`Qu©Mul
(Qu©Mul(
yrŸ
, 
xrŸ
),Ñot);

115 *
posôi⁄
 = 
pos
;

116 *
rŸ©i⁄
 = 
rŸ
;

117 
	}
}

152 
M©4


153 
	$MakeVõwPî•e˘ive
(
Camîa
* 
ˇmîa
) {

154 
M©4
 
ªsu…
 = 
	`M4I
();

155 
M©4
 
å™¶©i⁄
 = 
	`M4Tøn¶©e
(
	`V3Neg
(
ˇmîa
->
posôi⁄
));

165 
M©4
 
rŸ
 = 
	`M4FromQu©
(
ˇmîa
->
rŸ©i⁄
);

166 
M©4
 
võw
 = 
	`M4Mul
(
	`M4Tøn•o£
(
rŸ
), 
å™¶©i⁄
);

167 if(!
ˇmîa
->
‹thogøphic
) {

168 
M©4
 
≥r•e˘ive
 = 
	`M4Pî•e˘ive
(
ˇmîa
->
fov
, camîa->
a•e˘_øtio
, camîa->
√¨_˛ù
, camîa->
Ár_˛ù
);

169 
ªsu…
 = 
	`M4Mul
(
≥r•e˘ive
, 
võw
);

172 
M©4
 
‹thogøphic
 = 
	`M4Oπhogøphic
(
ˇmîa
->
À·
, camîa->
right
, camîa->
bŸtom
, camîa->
t›
,

173 
ˇmîa
->
√¨_˛ù
, camîa->
Ár_˛ù
);

174 
ªsu…
 = 
	`M4Mul
(
‹thogøphic
, 
võw
);

176  
ªsu…
;

177 
	}
}

180 
	$Fú°Pîs⁄Camîa
(
Camîa
* 
ˇmîa
, 
FPC⁄åﬁInfo
* 
Âci
, 
I≈ut
* 
öput
) {

181 
	`Fú°Pîs⁄C⁄åﬁ
(&
ˇmîa
->
posôi⁄
, &ˇmîa->
rŸ©i⁄
, 
åue
, 
Âci
, 
öput
);

182 
	}
}

	@easings.h

7 
	$Ea£Löór
(
t
, 
b
, 
c
, 
d
) {

8  
c
*
t
/
d
 + 
b
;

9 
	}
}

12 
	$Ea£SöeIn
(
t
, 
b
, 
c
, 
d
) {

13  (-
c
*
	`cosf
(
t
/
d
*(
PI32
/2.0f)Ë+ c + 
b
);

14 
	}
}

17 
	$Ea£SöeOut
(
t
, 
b
, 
c
, 
d
) {

18  (
c
*
	`söf
(
t
/
d
*(
PI32
/2.0f)Ë+ 
b
);

19 
	}
}

22 
	$Ea£SöeInOut
(
t
, 
b
, 
c
, 
d
) {

23  (-
c
/2.0f*(
	`cosf
(
PI32
*
t
/
d
Ë- 1.0fË+ 
b
);

24 
	}
}

	@file_formats.h

1 
	eSTRING_LENGTH
 {

2 
	mSTRING_LENGTH_BLOB
 = 12,

3 
	mSTRING_LENGTH_VERTEX_BUFFER
 = 12,

4 
	mSTRING_LENGTH_MESH
 = 12,

5 
	mSTRING_LENGTH_TEXTURE
 = 12,

6 
	mSTRING_LENGTH_TEXTURE_TYPE
 = 12,

7 
	mSTRING_LENGTH_FONT
 = 12,

10 
	eASSET_BLOB
 {

11 
	mASSET_BLOB_MESHES
,

12 
	mASSET_BLOB_TEXTURES
,

13 
	mASSET_BLOB_FONTS
,

14 
	mASSET_BLOB_TOTAL


17 * 
	gblob_«mes
[
ASSET_BLOB_TOTAL
] = {

23 * 
	gvîãx_buf„r_«mes
[
VERTEX_BUFFER_TOTAL
] = {

32 * 
	gãxtuª_ty≥_«mes
[
TEXTURE_SLOT_TOTAL
] = {

38 
	sGameAs£tFûe
 {

39 
	midítifiˇti⁄
[5];

40 
u8
 
	mnumbî_of_blobs
;

41 
u32
 
	moff£t_to_blob_dúe˘‹õs
;

44 
	sDúe˘‹y
 {

45 
u32
 
	moff£t_to_blob
;

46 
	m«me_of_blob
[
STRING_LENGTH_BLOB
];

49 
	sMeshesBlob
 {

50 
u32
 
	mmeshes_cou¡
;

51 
u32
 
	moff£t_to_mesh_f‹m©s
;

54 
	sTextuªsBlob
 {

55 
u32
 
	mãxtuªs_cou¡
;

56 
u32
 
	moff£t_to_ãxtuª_f‹m©s
;

59 
	sF⁄tsBlob
 {

60 
u32
 
	mf⁄ts_cou¡
;

61 
u32
 
	moff£t_to_f⁄t_f‹m©s
;

64 
	sVîãxBuf„rF‹m©
 {

65 
	mty≥
[
STRING_LENGTH_VERTEX_BUFFER
];

66 
u32
 
	moff£t_to_d©a
;

69 
	sMeshF‹m©
 {

70 
	m«me
[
STRING_LENGTH_MESH
];

71 
u8
 
	mvîãx_buf„r_cou¡
;

72 
u32
 
	mvîti˚s_cou¡
;

73 
u32
 
	mödi˚s_cou¡
;

74 
u32
 
	moff£t_to_ödi˚s
;

75 
u32
 
	moff£t_to_vîãx_buf„rs
;

78 
	sTextuªF‹m©
 {

79 
	m«me
[
STRING_LENGTH_TEXTURE
];

80 
	mty≥
[
STRING_LENGTH_TEXTURE_TYPE
];

81 
u32
 
	mwidth
;

82 
u32
 
	mheight
;

83 
u32
 
	mnum_comp⁄íts
;

84 
u32
 
	moff£t_to_d©a
;

87 
	sF⁄tF‹m©
 {

88 
	m«me
[
STRING_LENGTH_FONT
];

89 
u32
 
	moff£t_to_d©a
;

	@font_handling.cpp

1 
	#MAX_FONT_ATLAS_WIDTH
 250

	)

2 
	#MAX_FONT_ATLAS_HEIGHT
 250

	)

3 
	#MAX_GLYPHS_ON_SCREEN
 200

	)

7 
	sGlyph
 {

8 
	mx0
, 
	my0
, 
	mx1
, 
	my1
;

9 
	ms0
, 
	mt0
, 
	ms1
, 
	mt1
;

10 
Vec3
 
	mcﬁ‹
;

13 
	sF⁄tD©a
 {

14 
F⁄tD©a
* 
	m√xt
;

16 * 
	mpixñs
;

17 
	mf⁄t_size
;

18 
	mf⁄t_löe_width
;

19 
°bâ_∑ckedch¨
 
	m∑cked_ch¨s
[0x7E-0x20];

21 
Glyph
 
	mglyphs
[
MAX_GLYPHS_ON_SCREEN
];

22 
u32
 
	mglyph_cou¡î
;

25 
	sTextUI
 {

26 
Såu˘uªdBuf„r
* 
	m°ru˘uªd_buf„r
;

27 
VîãxShadî
* 
	mãxt_shadî
;

28 
PixñShadî
* 
	mm⁄ochrome_ps
;

30 * 
	mâf
;

31 
F⁄tD©a
* 
	mf⁄t_d©a
;

33 
	my_curs‹
;

34 
Vec2
 
	ms¸ìn_ªs
;

36 
Mem‹yAª«
* 
	m‰ame_¨ía
;

37 
Rídîî
* 
	mªndîî
;

40 
F⁄tD©a
*

41 
	$Gíî©eF⁄tD©a
(
size
, 
TextUI
* 
ãxt_ui
) {

42 
F⁄tD©a
* 
ªsu…
 = 
	`PushSåu˘
(
ãxt_ui
->
‰ame_¨ía
, FontData);

44 if(
ãxt_ui
->
f⁄t_d©a
) {

45 
ªsu…
->
√xt
 = 
ãxt_ui
->
f⁄t_d©a
;

46 
ãxt_ui
->
f⁄t_d©a
 = 
ªsu…
;

48 
ãxt_ui
->
f⁄t_d©a
 = 
ªsu…
;

50 
ªsu…
->
pixñs
 = 
	`PushSize
(
ãxt_ui
->
‰ame_¨ía
, 
MAX_FONT_ATLAS_WIDTH
 * 
MAX_FONT_ATLAS_HEIGHT
);

52 
°bâ_f⁄töfo
 
f⁄t_öfo
;

54 * 
âf
 = (*)
ãxt_ui
->ttf;

56 
	`°bâ_InôF⁄t
(&
f⁄t_öfo
, 
âf
, 
	`°bâ_GëF⁄tOff£tF‹Index
(ttf, 0));

57 
°bâ_∑ck_c⁄ãxt
 
c⁄ãxt
;

59 
as˚¡
, 
des˚¡
, 
löe_g≠
, 
ba£löe
;

60 
sˇÀ_Á˘‹
 = 
	`°bâ_SˇÀF‹PixñHeight
(&
f⁄t_öfo
, 
size
);

61 
	`°bâ_GëF⁄tVMërics
(&
f⁄t_öfo
, &
as˚¡
, &
des˚¡
, &
löe_g≠
);

62 
as˚¡
 = (as˚¡ * 
sˇÀ_Á˘‹
);

63 
des˚¡
 = (des˚¡ * 
sˇÀ_Á˘‹
);

64 
löe_g≠
 = (line_gap *Üine_gap);

65 
ba£löe
 = (
as˚¡
*
sˇÀ_Á˘‹
);

67 
	`°bâ_PackBegö
(&
c⁄ãxt
, (*)
ªsu…
->
pixñs
, 
MAX_FONT_ATLAS_WIDTH
, 
MAX_FONT_ATLAS_HEIGHT
, 0, 1, 0);

68 
	`°bâ_PackSëOvîßm∂ög
(&
c⁄ãxt
, 1, 1);

69 
	`°bâ_PackF⁄tR™ge
(&
c⁄ãxt
, 
âf
, 0, 
as˚¡
-
des˚¡
, 0x20, 0x7E-0x20, 
ªsu…
->
∑cked_ch¨s
);

70 
	`°bâ_PackEnd
(&
c⁄ãxt
);

72 
ªsu…
->
f⁄t_size
 = 
size
;

73 
ªsu…
->
f⁄t_löe_width
 = 
as˚¡
 - 
des˚¡
 + 
löe_g≠
 * 
size
;

75  
ªsu…
;

76 
	}
}

78 
F⁄tD©a
*

79 
	$GëF⁄tD©a
(
size
, 
TextUI
* 
ãxt_ui
) {

80 
F⁄tD©a
* 
f⁄t_d©a
 = 0;

81 
F⁄tD©a
* 
node
 = 
ãxt_ui
->
f⁄t_d©a
;

82 
node
) {

83 if(
node
->
f⁄t_size
 =
size
) {

84 
f⁄t_d©a
 = 
node
;

87 
node
 =Çode->
√xt
;

89  
f⁄t_d©a
;

90 
	}
}

92 
TextUI
*

93 
	$InôF⁄t
(* 
d©a
, 
WödowDimísi⁄s
 
wd
, 
Rídîî
* 
ªndîî
, 
Mem‹yAª«
* 
¨ía
, Mem‹yAª«* 
‰ame
) {

94 
TextUI
* 
ªsu…
 = 
	`PushSåu˘
(
¨ía
, TextUI);

95 
ªsu…
->
âf
 = 
d©a
;

96 
ªsu…
->
‰ame_¨ía
 = 
‰ame
;

97 
ªsu…
->
ªndîî
 =Ñenderer;

99 
	`Gíî©eF⁄tD©a
(40.0f, 
ªsu…
);

101 
ªsu…
->
ãxt_shadî
 = 
	`U∂ﬂdVîãxShadî
(
TextShadî
, (TextShader),

102 "vsf", 0, 0, 
ªndîî
);

103 
ªsu…
->
m⁄ochrome_ps
 = 
	`U∂ﬂdPixñShadî
(
M⁄ochromeShadî
, (MonochromeShader),

104 "psf", 
ªndîî
);

105 
ªsu…
->
°ru˘uªd_buf„r
 = 
	`U∂ﬂdSåu˘uªdBuf„r
((
Glyph
), 
MAX_GLYPHS_ON_SCREEN
, 
ªndîî
);

107 
ªsu…
->
s¸ìn_ªs
.
x
 = ()
wd
.
width
;

108 
ªsu…
->
s¸ìn_ªs
.
y
 = ()
wd
.
height
;

109 
ªsu…
->
y_curs‹
 +ªsu…->
f⁄t_d©a
->
f⁄t_löe_width
;

111  
ªsu…
;

112 
	}
}

115 
	$PushGlyphs
(* 
ãxt
, 
F⁄tD©a
* 
f⁄t_d©a
, * 
x
, * 
y
, 
Vec2
 
s¸ìn_ªs
) {

116 
u32
 
Àn
 = 
	`SåögLígth
(
ãxt
);

118 
u32
 
i
=0; i<
Àn
; i++) {

120 
ch¨_ödex
 = 
ãxt
[
i
] - 0x20;

121 
°bâ_Æig√d_quad
 
quad
;

123 
	`°bâ_GëPackedQuad
(
f⁄t_d©a
->
∑cked_ch¨s
, 
MAX_FONT_ATLAS_WIDTH
,

124 
MAX_FONT_ATLAS_HEIGHT
, 
ch¨_ödex
, 
x
, 
y
, &
quad
, 1);

126 
u32
 
ödex
 = 
f⁄t_d©a
->
glyph_cou¡î
;

127 
f⁄t_d©a
->
glyphs
[
ödex
].
x0
 = 
quad
.x0/
s¸ìn_ªs
.
x
;

128 
f⁄t_d©a
->
glyphs
[
ödex
].
y0
 = 
quad
.y0/
s¸ìn_ªs
.
y
;

129 
f⁄t_d©a
->
glyphs
[
ödex
].
x1
 = 
quad
.x1/
s¸ìn_ªs
.
x
;

130 
f⁄t_d©a
->
glyphs
[
ödex
].
y1
 = 
quad
.y1/
s¸ìn_ªs
.
y
;

131 
f⁄t_d©a
->
glyphs
[
ödex
].
s0
 = 
quad
.s0;

132 
f⁄t_d©a
->
glyphs
[
ödex
].
t0
 = 
quad
.t0;

133 
f⁄t_d©a
->
glyphs
[
ödex
].
s1
 = 
quad
.s1;

134 
f⁄t_d©a
->
glyphs
[
ödex
].
t1
 = 
quad
.t1;

136 
f⁄t_d©a
->
glyphs
[
ödex
].
cﬁ‹
 = 
WHITE
;

138 
f⁄t_d©a
->
glyph_cou¡î
++;

140 
	}
}

143 
	$PushTextS¸ìnS∑˚
(* 
ãxt
, 
size
, 
Vec2
 
ssc
, 
TextUI
* 
ãxt_ui
) {

144 
F⁄tD©a
* 
f⁄t_d©a
 = 
	`GëF⁄tD©a
(
size
, 
ãxt_ui
);

145 if(!
f⁄t_d©a
Ëf⁄t_d©®
	`Gíî©eF⁄tD©a
(
size
, 
ãxt_ui
);

147 
x
 = 
ssc
.x * 
ãxt_ui
->
s¸ìn_ªs
.x;

148 
y
 = 
ssc
.y * 
ãxt_ui
->
s¸ìn_ªs
.y;

149 
y
 +
f⁄t_d©a
->
f⁄t_löe_width
;

151 
	`PushGlyphs
(
ãxt
, 
f⁄t_d©a
, &
x
, &
y
, 
ãxt_ui
->
s¸ìn_ªs
);

152 
	}
}

155 
	$GëPixñWidthF‹Text
(* 
ãxt
, 
size
, 
TextUI
* 
ãxt_ui
) {

156 
F⁄tD©a
* 
f⁄t_d©a
 = 
	`GëF⁄tD©a
(
size
, 
ãxt_ui
);

157 if(!
f⁄t_d©a
Ëf⁄t_d©®
	`Gíî©eF⁄tD©a
(
size
, 
ãxt_ui
);

159 
u32
 
Àn
 = 
	`SåögLígth
(
ãxt
);

160 
x
, 
y
;

161 
x
=0;

162 
y
=0;

164 
u32
 
i
=0; i<
Àn
; i++) {

165 
ch¨_ödex
 = 
ãxt
[
i
] - 0x20;

166 
°bâ_Æig√d_quad
 
quad
;

168 
	`°bâ_GëPackedQuad
(
f⁄t_d©a
->
∑cked_ch¨s
, 
MAX_FONT_ATLAS_WIDTH
,

169 
MAX_FONT_ATLAS_HEIGHT
, 
ch¨_ödex
, &
x
, &
y
, &
quad
, 1);

171 
ch¨_ödex
 = ' ' - 0x20;

172 
°bâ_Æig√d_quad
 
quad
;

174 
	`°bâ_GëPackedQuad
(
f⁄t_d©a
->
∑cked_ch¨s
, 
MAX_FONT_ATLAS_WIDTH
,

175 
MAX_FONT_ATLAS_HEIGHT
, 
ch¨_ödex
, &
x
, &
y
, &
quad
, 1);

177  
x
;

178 
	}
}

181 
	$PushTextPixñS∑˚
(* 
ãxt
, 
f⁄t_size
, 
Vec2
 
psc
, 
TextUI
* 
ãxt_ui
) {

182 
F⁄tD©a
* 
f⁄t_d©a
 = 
	`GëF⁄tD©a
(
f⁄t_size
, 
ãxt_ui
);

183 if(!
f⁄t_d©a
Ëf⁄t_d©®
	`Gíî©eF⁄tD©a
(
f⁄t_size
, 
ãxt_ui
);

185 
x
 = 
psc
.x;

186 
y
 = 
psc
.y + 
f⁄t_d©a
->
f⁄t_löe_width
;

188 
	`PushGlyphs
(
ãxt
, 
f⁄t_d©a
, &
x
, &
y
, 
ãxt_ui
->
s¸ìn_ªs
);

189 
	}
}

192 
	$UITextFøme
(
TextUI
* 
ãxt_ui
, 
WödowDimísi⁄s
 
wd
, 
Rídîî
* 
ªndîî
) {

194 
SëRídîT¨gë
* 
£t_ªndî_èrgë
 = 
	`PushRídîComm™d
(
ªndîî
, SetRenderTarget);

195 
£t_ªndî_èrgë
->
ªndî_èrgë
 = &
ªndîî
->
backbuf„r
;

197 
SëBÀndSèã
* 
£t_bÀnd_°©e
 = 
	`PushRídîComm™d
(
ªndîî
, SetBlendState);

198 
£t_bÀnd_°©e
->
ty≥
 = 
BLEND_STATE_Reguœr
;

200 
SëRa°îizîSèã
* 
§s
 = 
	`PushRídîComm™d
(
ªndîî
, SetRasterizerState);

202 
SëPrimôiveT›ﬁogy
* 
£t_t›ﬁogy
 = 
	`PushRídîComm™d
(
ªndîî
, SetPrimitiveTopology);

203 
£t_t›ﬁogy
->
ty≥
 = 
PRIMITIVE_TOPOLOGY_TrüngÀLi°
;

205 
SëVîãxShadî
* 
£t_vîãx_shadî
 = 
	`PushRídîComm™d
(
ªndîî
, SetVertexShader);

206 
£t_vîãx_shadî
->
vîãx
 = 
ãxt_ui
->
ãxt_shadî
;

208 
SëPixñShadî
* 
£t_pixñ_shadî
 = 
	`PushRídîComm™d
(
ªndîî
, SetPixelShader);

209 
£t_pixñ_shadî
->
pixñ
 = 
ãxt_ui
->
m⁄ochrome_ps
;

211 
SëSåu˘uªdBuf„r
* 
£t_glyph_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
, SetStructuredBuffer);

212 
£t_glyph_buf„r
->
vîãx_shadî
 = 
åue
;

213 
£t_glyph_buf„r
->
°ru˘uªd
 = 
ãxt_ui
->
°ru˘uªd_buf„r
;

214 
£t_glyph_buf„r
->
¶Ÿ
 = 0;

216 
F⁄tD©a
* 
f⁄t_d©a
 = 
ãxt_ui
->font_data;

217 
f⁄t_d©a
) {

219 
TextuªBuf„r
* 
ãxtuª_buf„r
 = 
	`U∂ﬂdTextuª
(
f⁄t_d©a
->
pixñs
, 
MAX_FONT_ATLAS_WIDTH
, 
MAX_FONT_ATLAS_HEIGHT
,

220 1, 
Ál£
, 
åue
, 
ªndîî
);

222 
SëTextuªBuf„r
* 
£t_ãxtuª_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
, SetTextureBuffer);

223 
£t_ãxtuª_buf„r
->
ãxtuª
 = 
ãxtuª_buf„r
;

224 
£t_ãxtuª_buf„r
->
¶Ÿ
 = 0;

226 
PushRídîBuf„rD©a
* 
push_glyph_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
,PushRenderBufferData);

227 
push_glyph_buf„r
->
buf„r
 = 
ãxt_ui
->
°ru˘uªd_buf„r
->buffer;

228 
push_glyph_buf„r
->
size
 = 
f⁄t_d©a
->
glyph_cou¡î
 * (
Glyph
);

229 
push_glyph_buf„r
->
d©a
 = 
f⁄t_d©a
->
glyphs
;

231 
DøwVîti˚s
* 
døw_vîts
 = 
	`PushRídîComm™d
(
ªndîî
, DrawVertices);

232 
døw_vîts
->
vîti˚s_cou¡
 = 6*
f⁄t_d©a
->
glyph_cou¡î
;

233 
døw_vîts
->
off£t
 = 0;

235 
FªeRídîResour˚
* 
‰ì_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
, FreeRenderResource);

236 
‰ì_buf„r
->
buf„r
 = 
ãxtuª_buf„r
->buffer;

238 
FªeRídîResour˚
* 
‰ì_võw
 = 
	`PushRídîComm™d
(
ªndîî
, FreeRenderResource);

239 
‰ì_võw
->
buf„r
 = 
ãxtuª_buf„r
->
võw
;

241 
f⁄t_d©a
->
glyph_cou¡î
 = 0;

245 
f⁄t_d©a
 = f⁄t_d©a->
√xt
;

247 
ãxt_ui
->
f⁄t_d©a
 = 0;

249 
ãxt_ui
->
s¸ìn_ªs
 = 
	`V2
(()
wd
.
width
, ()wd.
height
);

250 
	}
}

	@font_handling.h

	@game.cpp

1 
	~<wödows.h
>

2 
	~<°dlib.h
>

3 
	~<d3d11_1.h
>

4 
	~<dxgi1_4.h
>

5 
	~<d3dcompûî.h
>

7 
	#As£πHR
(
ªsu…
Ë
	`As£π
(‘esu…Ë=0)

	)

9 
	~"ba£_ty≥s.h
"

10 
	~"∂©f‹m_≠i.h
"

11 
	~"mem‹y_m™agemít.h
"

12 
	~"m©h.h
"

13 
	~"ósögs.h
"

14 
	~"sh≠es.˝p
"

16 
	#STB_SPRINTF_IMPLEMENTATION


	)

17 
	#STB_IMAGE_IMPLEMENTATION


	)

18 
	#STB_RECT_PACK_IMPLEMENTATION


	)

19 
	#STB_TRUETYPE_IMPLEMENTATION


	)

21 
	~"ö˛ude/°b_•rötf.h
"

22 
	~"ö˛ude/°b_image.h
"

23 
	~"ö˛ude/°b_ª˘_∑ck.h
"

24 
	~"ö˛ude/°b_åuëy≥.h
"

26 
	~"game_œyî.h
"

27 
	~"as£t_f‹m©s.h
"

28 
	~"fûe_f‹m©s.h
"

29 
	~"shadî_code.h
"

30 
	~"ˇmîa.˝p
"

31 
	~"ªndîî.˝p
"

32 
	~"quad_ªndîî.˝p
"

33 
	~"mesh_ªndîî.˝p
"

34 
	~"po°_¥o˚ss_ªndîî.˝p
"

35 
	~"as£t_lﬂdög.˝p
"

36 
	~"as£t_öfo.˝p
"

37 
	~"f⁄t_h™dlög.˝p
"

38 
	~"ui_ªndîî.˝p
"

39 
	~"simuœti⁄.h
"

41 
	~"timî.h
"

42 
	~"game_mode.h
"

43 
	~"game.h
"

45 
	~"simuœti⁄.˝p
"

46 
	~"game_mode.˝p
"

48 
Pœtf‹mAPI
 
	g∂©f‹m_≠i
;

49 
boﬁ
 
	g¥es£d
 = 
Ál£
;

51 #ifde‡
INTERNAL


52 
boﬁ
 
	gexecuèbÀ_ªlﬂded
 = 
Ál£
;

55 "C" 
	$GAME_LOOP
(
game_lo›
) {

57 #ifde‡
INTERNAL


58 
execuèbÀ_ªlﬂded
 = 
game_œyî
->executable_reloaded;

61 
∂©f‹m_≠i
 = 
game_œyî
->platform_api;

62 
GameSèã
* 
game_°©e
 = 
game_œyî
->game_state;

64 if(!
game_œyî
->
game_°©e
) {

65 
game_°©e
 = 
game_œyî
->game_°©ê
	`BoŸ°øpPushSåu˘
(
GameSèã
, 
tŸÆ_¨ía
, 
	`Megabyãs
(20));

67 
game_°©e
->
‰ame_¨ía
 = (
Mem‹yAª«
*)
	`BoŸ°øpPushSize_
((MemoryArena), 0, 0);

68 
game_°©e
->
as£ts
 = 
	`LﬂdGameAs£ts
(&game_°©e->
tŸÆ_¨ía
);

69 
	`LﬂdAŒTextuªAs£ts
(
game_°©e
->
as£ts
);

70 
	`LﬂdAŒMeshAs£ts
(
game_°©e
->
as£ts
);

72 
game_°©e
->
ªndîî
 = 
	`InôRídîî
(
wödow
, &game_°©e->
tŸÆ_¨ía
, game_°©e->
‰ame_¨ía
);

74 
	`U∂ﬂdAŒTextuªAs£ts
(
game_°©e
->
as£ts
, game_°©e->
ªndîî
);

75 
	`U∂ﬂdAŒMeshAs£ts
(
game_°©e
->
as£ts
, game_°©e->
ªndîî
);

77 
game_°©e
->
quad_ªndîî
 = 
	`InôQuadRídîî
(game_°©e->
ªndîî
, &game_°©e->
tŸÆ_¨ía
);

78 
game_°©e
->
mesh_ªndîî
 = 
	`InôMeshRídîî
(game_°©e->
ªndîî
, &game_°©e->
tŸÆ_¨ía
);

79 
game_°©e
->
po°_¥o˚ss_ªndîî
 = 
	`InôPo°Pro˚ssRídîî
(game_°©e->
ªndîî
, &game_°©e->
tŸÆ_¨ía
);

82 * 
f⁄t
 = 
	`GëF⁄t
("JëBøösMo", 
game_°©e
->
as£ts
);

84 
game_°©e
->
ãxt_ui
 = 
	`InôF⁄t
(
f⁄t
, 
wödow
->
dim
, game_°©e->
ªndîî
, &game_°©e->
tŸÆ_¨ía
, game_°©e->
‰ame_¨ía
);

85 
game_°©e
->
ui_ªndîî
 = 
	`InôUIRídîî
(game_°©e->
ªndîî
, 
wödow
->
dim
, game_°©e->
ãxt_ui
, &game_°©e->
tŸÆ_¨ía
, game_°©e->
‰ame_¨ía
);

87 
game_°©e
->
ítôy_blob
.
≥rm™ít_¨ía
 = &game_°©e->
tŸÆ_¨ía
;

88 
game_°©e
->
ítôy_blob
.
‰ame_¨ía
 = game_state->frame_arena;

90 
game_°©e
->
game_mode
 = 
GAME_MODE_TEST
;

92 
game_°©e
->
‰ame_¨ía_ãmp
 = 
	`BegöTemp‹¨yMem‹y
(game_°©e->
‰ame_¨ía
);

95 
	`EndTemp‹¨yMem‹y
(&
game_°©e
->
‰ame_¨ía_ãmp
);

96 
game_°©e
->
‰ame_¨ía_ãmp
 = 
	`BegöTemp‹¨yMem‹y
(game_°©e->
‰ame_¨ía
);

98 
game_°©e
->
timî
.
‰ame_time
 = 
game_œyî
->timî - game_°©e->timî.
ªÆ_time
;

99 
game_°©e
->
timî
.
ªÆ_time
 = 
game_œyî
->timer;

101 
	`§™d
(
game_°©e
->
timî
.
ªÆ_time
);

103 
game_°©e
->
ˇmîa
 = 
	`DeÁu…Pî•e˘iveCamîa
(
wödow
->
dim
, &game_°©e->
tŸÆ_¨ía
);

105 
	`RídîîBegöFøme
(
game_°©e
->
ªndîî
, 
wödow
->
dim
, game_°©e->
‰ame_¨ía_ãmp
.
¨ía
);

107 if(
öput
->
buâ⁄s
[
WIN32_BUTTON_F1
].
¥es£d
) {

108 
game_œyî
->
debug_curs‹_ªque°
 = !game_layer->debug_cursor_request;

110 if(
öput
->
buâ⁄s
[
WIN32_BUTTON_F2
].
¥es£d
) {

111 
game_°©e
->
dev_mode
 =(
DEV_MODE
)(game_°©e->dev_modê^ 
DEV_MODE_PAUSED
);

114 if(
game_°©e
->
dev_mode
 & 
DEV_MODE_PAUSED
) {

115 
FPC⁄åﬁInfo
 
öfo
 = 
	`DeÁu…FPC⁄åﬁInfo
();

116 
öfo
.
ba£_£ns
 = 0.5f;

117 
öfo
.
å™s_£ns
 = 2500.0f;

118 
öfo
.
rŸ_£ns
 = 10.0f;

119 if(
öput
->
buâ⁄s
[
WIN32_BUTTON_LEFT_MOUSE
].
hñd
)

120 
	`Fú°Pîs⁄Camîa
(
game_°©e
->
ˇmîa
, &
öfo
, 
öput
);

124 if(
game_°©e
->
game_mode
 =
GAME_MODE_TEST
) {

125 
	`Upd©eTe°Mode
(
game_°©e
, 
öput
, 
wödow
->
dim
);

129 
game_°©e
->
ˇmîa
->
posôi⁄
 = 
	`V3
(0.0f, 0.0f, 300.0f);

131 
TextuªAs£tInfo
* 
ãxtuª_as£t
 = 
	`GëTextuªAs£tInfo
("BluêNebuœ", 
game_°©e
->
as£ts
);

132 
Quad
 
quad
 = {};

133 
quad
.
é
 = 
	`V3
(-500.0f, 500.0f, 50.0f);

134 
quad
.
å
 = 
	`V3
( 500.0f, 500.0f, 50.0f);

135 
quad
.
bl
 = 
	`V3
(-500.0f,-500.0f, 50.0f);

136 
quad
.
br
 = 
	`V3
( 500.0f,-500.0f, 50.0f);

138 
	`PushTextuªdQuad
(&
quad
, 
ãxtuª_as£t
->
buf„r
, 
game_°©e
->
quad_ªndîî
);

139 * 
ãxt
[] = { "Play" };

140 
buf„r
[100];

142 
ãxt1
[100];

143 
ãxt2
[100];

145 
	`°b•_•rötf
(
ãxt1
, "%.01f: FømêTime", 
game_°©e
->
timî
.
‰ame_time
);

146 
	`°b•_•rötf
(
ãxt2
, "%0.01f: GamêTimêms", 
game_°©e
->
timî
.
ªÆ_time
);

148 * 
öfo_ãxt
[] = { 
ãxt1
, 
ãxt2
 };

149 
	`PushUIOvîœy
(
öfo_ãxt
, 
	`AºayCou¡
(öfo_ãxt), 
	`V2Z
(), 
game_°©e
->
ui_ªndîî
);

151 if(
¥es£d
Ë
	`Upd©eTe°Mode
(
game_°©e
, 
öput
, 
wödow
->
dim
);

152 
¥es£d
 = 
	`PushUIBuâ⁄
(
ãxt
, 
	`V2
(0.5f, 0.5f), 
game_°©e
->
ui_ªndîî
);

154 
	`QuadRídîîFøme
(
game_°©e
->
quad_ªndîî
, game_°©e->
ˇmîa
, game_°©e->
ªndîî
);

155 
	`MeshRídîîFøme
(
game_°©e
->
mesh_ªndîî
, game_°©e->
ˇmîa
, game_°©e->
ªndîî
);

157 
Po°Pro˚ssPùñöe
 
c›y
;

158 
c›y
.
ty≥
 = 
POST_PROCESS_TYPE_C›y
;

159 
c›y
.
ö
 = 
game_°©e
->
ªndîî
->
ªadabÀ_ªndî_èrgë
.
shadî_ªsour˚
;

160 
c›y
.
out
 = 
game_°©e
->
ªndîî
->
backbuf„r
.
võw
;

162 
Vec2
 
mou£_pos
 = *(Vec2*)&
öput
->
axes
[
WIN32_AXIS_MOUSE
];

163 
	`°b•_•rötf
(
buf„r
, "%.02f: Mou£ x", 
mou£_pos
.
x
);

166 
	`°b•_•rötf
(
buf„r
, "%0.02f: Mou£ y", 
mou£_pos
.
y
);

169 
	`PushPo°Pro˚ssPùñöe
(&
c›y
, 
game_°©e
->
po°_¥o˚ss_ªndîî
, game_°©e->
ªndîî
);

170 
	`Po°Pro˚ssRídîîFøme
(
game_°©e
->
po°_¥o˚ss_ªndîî
, game_°©e->
ªndîî
);

171 
	`UIRídîîFøme
(
öput
, 
game_°©e
->
ui_ªndîî
, game_°©e->
ªndîî
);

172 
	`UITextFøme
(
game_°©e
->
ãxt_ui
, 
wödow
->
dim
, game_°©e->
ªndîî
);

173 
	`RídîîEndFøme
(
game_°©e
->
ªndîî
);

176 
	}
}

	@game.h

1 
	sGameSèã
 {

2 
Mem‹yAª«
 
	mtŸÆ_¨ía
;

3 
Mem‹yAª«
* 
	m‰ame_¨ía
;

4 
Temp‹¨yMem‹y
 
	m‰ame_¨ía_ãmp
;

6 
Timî
 
	mtimî
;

8 
GameAs£ts
* 
	mas£ts
;

9 
TextUI
* 
	mãxt_ui
;

10 
Rídîî
* 
	mªndîî
;

11 
QuadRídîî
* 
	mquad_ªndîî
;

12 
MeshRídîî
* 
	mmesh_ªndîî
;

13 
UIRídîî
* 
	mui_ªndîî
;

14 
Po°Pro˚ssRídîî
* 
	mpo°_¥o˚ss_ªndîî
;

15 
Camîa
* 
	mˇmîa
;

17 
E¡ôyBlob
 
	mítôy_blob
;

19 
GAME_MODE
 
	mgame_mode
;

20 
Te°Mode
 
	mã°_mode
;

22 
DEV_MODE
 
	mdev_mode
;

	@game_layer.h

1 
	sGameLayî
 {

2 
GameSèã
* 
	mgame_°©e
;

3 
Pœtf‹mAPI
 
	m∂©f‹m_≠i
;

4 
	mtimî
;

5 
boﬁ
 
	mquô_ªque°
;

7 
boﬁ
 
	mdebug_curs‹_ªque°
;

9 #ifde‡
INTERNAL


10 
boﬁ
 
	mexecuèbÀ_ªlﬂded
;

11 
	mms_≥r_‰ame
;

15 #ifde‡
INTERNAL


16 
boﬁ
 
execuèbÀ_ªlﬂded
;

19 
	#GAME_LOOP
(
«me
Ë
	`«me
(
GameLayî
* 
game_œyî
, 
Wö32Wödow
* 
wödow
, 
I≈ut
* 
öput
)

	)

20 
GAME_LOOP
(
	tGameLo›
);

	@game_mode.cpp

2 
	$InôTe°Mode
(
GameSèã
* 
game_°©e
, 
WödowDimísi⁄s
 
dim
) {

4 
Tønsf‹m
 
å™sf‹m
 = 
	`Tønsf‹mI
();

5 
å™sf‹m
.
posôi⁄
 = 
	`V3
(-400.0f, 0.0f, 0.0f);

6 
å™sf‹m
.
rŸ©i⁄
 = 
	`Qu©Mul
(
	`Qu©FromEuÀr
(0.0f, 0.0f, 
	`DegToRad
(180.0f)),Åransform.rotation);

7 
å™sf‹m
.
sˇÀ
 = 
	`V3
(0.01f, 0.01f, 0.01f);

9 
game_°©e
->
ˇmîa
 = 
	`DeÁu…Pî•e˘iveCamîa
(
dim
, &game_°©e->
tŸÆ_¨ía
);

10 
game_°©e
->
ˇmîa
->
posôi⁄
 = 
	`V3
(0.0f, 0.0f, 300.0f);

12 
	`S∑wnPœyî
(
å™sf‹m
, 
game_°©e
);

13 
BoundögBox
 
bb
 = { 
	`V3
(-600.0f, -600.0f, -50.0f), V3(600.0f, 600.0f, 50.0f) };

14 
	`S∑wnLevñBound¨y
(
bb
, 
game_°©e
);

16 
S∑w√rInfo
 
öfo
 = {};

17 
u32
 
mu…ùÀ
 = 1;

18 
i32
 
i
=-500; i<=500; i+=100) {

19 
öfo
.
å™sf‹ms
[öfo.
•awn_cou¡
] = 
	`Tønsf‹mI
();

20 
öfo
.
å™sf‹ms
[öfo.
•awn_cou¡
].
posôi⁄
 = 
	`V3
–500.0f, ()
i
, 0.0f);

21 
öfo
.
ítôy_ty≥s
[öfo.
•awn_cou¡
] = 
ENTITY_FAB_MINE
;

22 
öfo
.
dñè_times
[öfo.
•awn_cou¡
] = 1000 - 50*
mu…ùÀ
++;

23 
öfo
.
•awn_cou¡
++;

25 
	`S∑wnE¡ôyS∑w√r
(&
öfo
, 
game_°©e
);

27 
	`S∑wnMöe
(
	`Tønsf‹mI
(), 
game_°©e
);

29 
game_°©e
->
ã°_mode
.
öô_d⁄e
 = 
åue
;

30 
	}
}

33 
	$Upd©eTe°Mode
(
GameSèã
* 
game_°©e
, 
I≈ut
* 
öput
, 
WödowDimísi⁄s
 
wd
) {

34 if(!
game_°©e
->
ã°_mode
.
öô_d⁄e
Ë
	`InôTe°Mode
(game_°©e, 
wd
);

36 
LightInfo
 
light
 = { 
	`V3Z
(), 0.5f };

37 
game_°©e
->
mesh_ªndîî
->
light
 =Üight;

39 
	`Upd©eE¡ôõs
(
game_°©e
, 
öput
);

40 
	}
}

	@game_mode.h

1 
	eGAME_MODE
 {

2 
	mGAME_MODE_NONE
,

3 
	mGAME_MODE_TEST


7 
	sTe°Mode
 {

8 
boﬁ
 
	möô_d⁄e
;

	@include/stb_image.h

126 #i‚de‡
STBI_INCLUDE_STB_IMAGE_H


127 
	#STBI_INCLUDE_STB_IMAGE_H


	)

367 #i‚de‡
STBI_NO_STDIO


368 
	~<°dio.h
>

371 
	#STBI_VERSION
 1

	)

375 
	mSTBI_deÁu…
 = 0,

377 
	mSTBI_gªy
 = 1,

378 
	mSTBI_gªy_Æpha
 = 2,

379 
	mSTBI_rgb
 = 3,

380 
	mSTBI_rgb_Æpha
 = 4

383 
	~<°dlib.h
>

384 
	t°bi_uc
;

385 
	t°bi_us
;

387 #ifde‡
__˝lu•lus


391 #i‚de‡
STBIDEF


392 #ifde‡
STB_IMAGE_STATIC


393 
	#STBIDEF
 

	)

395 
	#STBIDEF
 

	)

410 (*
ªad
Ë(*
u£r
,*
d©a
,
size
);

411 (*
skù
Ë(*
u£r
,
n
);

412 (*
eof
Ë(*
u£r
);

413 } 
	t°bi_io_ˇŒbacks
;

420 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd_‰om_mem‹y
 (°bi_u¯c⁄° *
buf„r
, 
Àn
 , *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

421 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
 , *
u£r
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

423 #i‚de‡
STBI_NO_STDIO


424 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd
 (c⁄° *
fûíame
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

425 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd_‰om_fûe
 (
FILE
 *
f
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

429 #i‚de‡
STBI_NO_GIF


430 
STBIDEF
 
°bi_uc
 *
°bi_lﬂd_gif_‰om_mem‹y
(°bi_u¯c⁄° *
buf„r
, 
Àn
, **
dñays
, *
x
, *
y
, *
z
, *
comp
, 
ªq_comp
);

433 #ifde‡
STBI_WINDOWS_UTF8


434 
STBIDEF
 
°bi_c⁄vît_wch¨_to_utf8
(*
buf„r
, 
size_t
 
buf„æí
, c⁄° 
wch¨_t
* 
öput
);

442 
STBIDEF
 
°bi_us
 *
°bi_lﬂd_16_‰om_mem‹y
 (
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

443 
STBIDEF
 
°bi_us
 *
°bi_lﬂd_16_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

445 #i‚de‡
STBI_NO_STDIO


446 
STBIDEF
 
°bi_us
 *
°bi_lﬂd_16
 (c⁄° *
fûíame
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

447 
STBIDEF
 
°bi_us
 *
°bi_lﬂd_‰om_fûe_16
(
FILE
 *
f
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

454 #i‚de‡
STBI_NO_LINEAR


455 
STBIDEF
 *
°bi_lﬂdf_‰om_mem‹y
 (
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

456 
STBIDEF
 *
°bi_lﬂdf_‰om_ˇŒbacks
 (
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

458 #i‚de‡
STBI_NO_STDIO


459 
STBIDEF
 *
°bi_lﬂdf
 (c⁄° *
fûíame
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

460 
STBIDEF
 *
°bi_lﬂdf_‰om_fûe
 (
FILE
 *
f
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
);

464 #i‚de‡
STBI_NO_HDR


465 
STBIDEF
 
°bi_hdr_to_ldr_gamma
(
gamma
);

466 
STBIDEF
 
°bi_hdr_to_ldr_sˇÀ
(
sˇÀ
);

469 #i‚de‡
STBI_NO_LINEAR


470 
STBIDEF
 
°bi_ldr_to_hdr_gamma
(
gamma
);

471 
STBIDEF
 
°bi_ldr_to_hdr_sˇÀ
(
sˇÀ
);

475 
STBIDEF
 
°bi_is_hdr_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
);

476 
STBIDEF
 
°bi_is_hdr_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
);

477 #i‚de‡
STBI_NO_STDIO


478 
STBIDEF
 
°bi_is_hdr
 (c⁄° *
fûíame
);

479 
STBIDEF
 
°bi_is_hdr_‰om_fûe
(
FILE
 *
f
);

485 
STBIDEF
 c⁄° *
°bi_Áûuª_ªas⁄
 ();

488 
STBIDEF
 
°bi_image_‰ì
 (*
ªtvÆ_‰om_°bi_lﬂd
);

491 
STBIDEF
 
°bi_öfo_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
comp
);

492 
STBIDEF
 
°bi_öfo_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
comp
);

493 
STBIDEF
 
°bi_is_16_bô_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
);

494 
STBIDEF
 
°bi_is_16_bô_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
);

496 #i‚de‡
STBI_NO_STDIO


497 
STBIDEF
 
°bi_öfo
 (c⁄° *
fûíame
, *
x
, *
y
, *
comp
);

498 
STBIDEF
 
°bi_öfo_‰om_fûe
 (
FILE
 *
f
, *
x
, *
y
, *
comp
);

499 
STBIDEF
 
°bi_is_16_bô
 (c⁄° *
fûíame
);

500 
STBIDEF
 
°bi_is_16_bô_‰om_fûe
(
FILE
 *
f
);

508 
STBIDEF
 
°bi_£t_u≈ªmu…ùly_⁄_lﬂd
(
Êag_åue_if_should_u≈ªmu…ùly
);

512 
STBIDEF
 
°bi_c⁄vît_ùh⁄e_≤g_to_rgb
(
Êag_åue_if_should_c⁄vît
);

515 
STBIDEF
 
°bi_£t_Êù_vîtiˇŒy_⁄_lﬂd
(
Êag_åue_if_should_Êù
);

520 
STBIDEF
 
°bi_£t_u≈ªmu…ùly_⁄_lﬂd_thªad
(
Êag_åue_if_should_u≈ªmu…ùly
);

521 
STBIDEF
 
°bi_c⁄vît_ùh⁄e_≤g_to_rgb_thªad
(
Êag_åue_if_should_c⁄vît
);

522 
STBIDEF
 
°bi_£t_Êù_vîtiˇŒy_⁄_lﬂd_thªad
(
Êag_åue_if_should_Êù
);

526 
STBIDEF
 *
°bi_zlib_decode_mÆloc_guesssize
(c⁄° *
buf„r
, 
Àn
, 
öôül_size
, *
ouéí
);

527 
STBIDEF
 *
°bi_zlib_decode_mÆloc_guesssize_hódîÊag
(c⁄° *
buf„r
, 
Àn
, 
öôül_size
, *
ouéí
, 
∑r£_hódî
);

528 
STBIDEF
 *
°bi_zlib_decode_mÆloc
(c⁄° *
buf„r
, 
Àn
, *
ouéí
);

529 
STBIDEF
 
°bi_zlib_decode_buf„r
(*
obuf„r
, 
ﬁí
, c⁄° *
ibuf„r
, 
ûí
);

531 
STBIDEF
 *
°bi_zlib_decode_nohódî_mÆloc
(c⁄° *
buf„r
, 
Àn
, *
ouéí
);

532 
STBIDEF
 
°bi_zlib_decode_nohódî_buf„r
(*
obuf„r
, 
ﬁí
, c⁄° *
ibuf„r
, 
ûí
);

535 #ifde‡
__˝lu•lus


544 #ifde‡
STB_IMAGE_IMPLEMENTATION


546 #i‡
deföed
(
STBI_ONLY_JPEG
Ë|| deföed(
STBI_ONLY_PNG
Ë|| deföed(
STBI_ONLY_BMP
) \

547 || 
deföed
(
STBI_ONLY_TGA
Ë|| deföed(
STBI_ONLY_GIF
Ë|| deföed(
STBI_ONLY_PSD
) \

548 || 
deföed
(
STBI_ONLY_HDR
Ë|| deföed(
STBI_ONLY_PIC
Ë|| deföed(
STBI_ONLY_PNM
) \

549 || 
	$deföed
(
STBI_ONLY_ZLIB
)

550 #i‚de‡
STBI_ONLY_JPEG


551 
	#STBI_NO_JPEG


	)

553 #i‚de‡
STBI_ONLY_PNG


554 
	#STBI_NO_PNG


	)

556 #i‚de‡
STBI_ONLY_BMP


557 
	#STBI_NO_BMP


	)

559 #i‚de‡
STBI_ONLY_PSD


560 
	#STBI_NO_PSD


	)

562 #i‚de‡
STBI_ONLY_TGA


563 
	#STBI_NO_TGA


	)

565 #i‚de‡
STBI_ONLY_GIF


566 
	#STBI_NO_GIF


	)

568 #i‚de‡
STBI_ONLY_HDR


569 
	#STBI_NO_HDR


	)

571 #i‚de‡
STBI_ONLY_PIC


572 
	#STBI_NO_PIC


	)

574 #i‚de‡
STBI_ONLY_PNM


575 
	#STBI_NO_PNM


	)

579 #i‡
	`deföed
(
STBI_NO_PNG
Ë&& !deföed(
STBI_SUPPORT_ZLIB
Ë&& !deföed(
STBI_NO_ZLIB
)

580 
	#STBI_NO_ZLIB


	)

584 
	~<°d¨g.h
>

585 
	~<°ddef.h
>

586 
	~<°dlib.h
>

587 
	~<°rög.h
>

588 
	~<limôs.h
>

590 #i‡!
	`deföed
(
STBI_NO_LINEAR
Ë|| !deföed(
STBI_NO_HDR
)

591 
	~<m©h.h
>

594 #i‚de‡
STBI_NO_STDIO


595 
	~<°dio.h
>

598 #i‚de‡
STBI_ASSERT


599 
	~<as£π.h
>

600 
	#STBI_ASSERT
(
x
Ë
	`as£π
(x)

	)

603 #ifde‡
__˝lu•lus


604 
	#STBI_EXTERN
 "C"

	)

606 
	#STBI_EXTERN
 

	)

610 #i‚de‡
_MSC_VER


611 #ifde‡
__˝lu•lus


612 
	#°bi_ölöe
 
ölöe


	)

614 
	#°bi_ölöe


	)

617 
	#°bi_ölöe
 
__f‹˚ölöe


	)

620 #i‚de‡
STBI_NO_THREAD_LOCALS


621 #i‡
	`deföed
(
__˝lu•lus
) && __cplusplus >= 201103L

622 
	#STBI_THREAD_LOCAL
 
thªad_loˇl


	)

623 #ñi‡
	`deföed
(
__GNUC__
) && __GNUC__ < 5

624 
	#STBI_THREAD_LOCAL
 
__thªad


	)

625 #ñi‡
	`deföed
(
_MSC_VER
)

626 
	#STBI_THREAD_LOCAL
 
	`__de˛•ec
(
thªad
)

	)

627 #ñi‡
	`deföed
 (
__STDC_VERSION__
Ë&& __STDC_VERSION__ >201112L && !deföed(
__STDC_NO_THREADS__
)

628 
	#STBI_THREAD_LOCAL
 
_Thªad_loˇl


	)

631 #i‚de‡
STBI_THREAD_LOCAL


632 #i‡
	`deföed
(
__GNUC__
)

633 
	#STBI_THREAD_LOCAL
 
__thªad


	)

638 #ifde‡
_MSC_VER


639 
	t°bi__uöt16
;

640 sig√d 
	t°bi__öt16
;

641 
	t°bi__uöt32
;

642 sig√d 
	t°bi__öt32
;

644 
	~<°döt.h
>

645 
uöt16_t
 
	t°bi__uöt16
;

646 
öt16_t
 
	t°bi__öt16
;

647 
uöt32_t
 
	t°bi__uöt32
;

648 
öt32_t
 
	t°bi__öt32
;

652 
	tvÆid©e_uöt32
[(
°bi__uöt32
)==4 ? 1 : -1];

654 #ifde‡
_MSC_VER


655 
	#STBI_NOTUSED
(
v
Ë()(v)

	)

657 
	#STBI_NOTUSED
(
v
Ë()(v)

	)

660 #ifde‡
_MSC_VER


661 
	#STBI_HAS_LROTL


	)

664 #ifde‡
STBI_HAS_LROTL


665 
	#°bi_ÃŸ
(
x
,
y
Ë
	`_ÃŸl
(x,y)

	)

667 
	#°bi_ÃŸ
(
x
,
y
Ë(((xË<< (y)Ë| ((xË>> (-(yË& 31)))

	)

670 #i‡
	`deföed
(
STBI_MALLOC
Ë&& deföed(
STBI_FREE
Ë&& (deföed(
STBI_REALLOC
Ë|| deföed(
STBI_REALLOC_SIZED
))

672 #ñi‡!
	`deföed
(
STBI_MALLOC
Ë&& !deföed(
STBI_FREE
Ë&& !deföed(
STBI_REALLOC
Ë&& !deföed(
STBI_REALLOC_SIZED
)

678 #i‚de‡
STBI_MALLOC


679 
	#STBI_MALLOC
(
sz
Ë
	`mÆloc
(sz)

	)

680 
	#STBI_REALLOC
(
p
,
√wsz
Ë
	`ªÆloc
’,√wsz)

	)

681 
	#STBI_FREE
(
p
Ë
	`‰ì
’)

	)

684 #i‚de‡
STBI_REALLOC_SIZED


685 
	#STBI_REALLOC_SIZED
(
p
,
ﬁdsz
,
√wsz
Ë
	`STBI_REALLOC
’,√wsz)

	)

689 #i‡
	`deföed
(
__x86_64__
Ë|| deföed(
_M_X64
)

690 
	#STBI__X64_TARGET


	)

691 #ñi‡
	`deföed
(
__i386
Ë|| deföed(
_M_IX86
)

692 
	#STBI__X86_TARGET


	)

695 #i‡
	`deföed
(
__GNUC__
Ë&& deföed(
STBI__X86_TARGET
Ë&& !deföed(
__SSE2__
Ë&& !deföed(
STBI_NO_SIMD
)

703 
	#STBI_NO_SIMD


	)

706 #i‡
	`deföed
(
__MINGW32__
Ë&& deföed(
STBI__X86_TARGET
Ë&& !deföed(
STBI_MINGW_ENABLE_SSE2
Ë&& !deföed(
STBI_NO_SIMD
)

718 
	#STBI_NO_SIMD


	)

721 #i‡!
	`deföed
(
STBI_NO_SIMD
Ë&& (deföed(
STBI__X86_TARGET
Ë|| deföed(
STBI__X64_TARGET
))

722 
	#STBI_SSE2


	)

723 
	~<emmöåö.h
>

725 #ifde‡
_MSC_VER


727 #i‡
_MSC_VER
 >= 1400

728 
	~<öåö.h
>

729 
	$°bi__˝uid3
()

731 
öfo
[4];

732 
	`__˝uid
(
öfo
,1);

733  
öfo
[3];

734 
	}
}

736 
	$°bi__˝uid3
()

738 
ªs
;

739 
__asm
 {

740 
mov
 
óx
,1

741 
˝uid


742 
mov
 
ªs
,
edx


744  
ªs
;

745 
	}
}

748 
	#STBI_SIMD_ALIGN
(
ty≥
, 
«me
Ë
	`__de˛•ec
(
	`Æign
(16)Ëty≥ 
	)
name

750 #i‡!
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_SSE2
)

751 
	$°bi__s£2_avaûabÀ
()

753 
öfo3
 = 
	`°bi__˝uid3
();

754  ((
öfo3
 >> 26) & 1) != 0;

755 
	}
}

759 
	#STBI_SIMD_ALIGN
(
ty≥
, 
«me
Ëty≥Çamê
	`__©åibuã__
((
	`Æig√d
(16)))

	)

761 #i‡!
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_SSE2
)

762 
	$°bi__s£2_avaûabÀ
()

768 
	}
}

775 #i‡
deföed
(
STBI_NO_SIMD
Ë&& deföed(
STBI_NEON
)

776 #unde‡
STBI_NEON


779 #ifde‡
STBI_NEON


780 
	~<¨m_√⁄.h
>

781 #ifde‡
_MSC_VER


782 
	#STBI_SIMD_ALIGN
(
ty≥
, 
«me
Ë
	`__de˛•ec
(
	`Æign
(16)Ëty≥ 
	)
name

784 
	#STBI_SIMD_ALIGN
(
ty≥
, 
«me
Ëty≥Çamê
	`__©åibuã__
((
	`Æig√d
(16)))

	)

788 #i‚de‡
STBI_SIMD_ALIGN


789 
	#STBI_SIMD_ALIGN
(
ty≥
, 
«me
Ëty≥ 
	)
name

792 #i‚de‡
STBI_MAX_DIMENSIONS


793 
	#STBI_MAX_DIMENSIONS
 (1 << 24)

	)

804 
°bi__uöt32
 
	mimg_x
, 
	mimg_y
;

805 
	mimg_n
, 
	mimg_out_n
;

807 
°bi_io_ˇŒbacks
 
	mio
;

808 *
	mio_u£r_d©a
;

810 
	mªad_‰om_ˇŒbacks
;

811 
	mbuÊí
;

812 
°bi_uc
 
	mbuf„r_°¨t
[128];

813 
	mˇŒback_Æªady_ªad
;

815 
°bi_uc
 *
	mimg_buf„r
, *
	mimg_buf„r_íd
;

816 
°bi_uc
 *
	mimg_buf„r_‹igöÆ
, *
	mimg_buf„r_‹igöÆ_íd
;

817 } 
	t°bi__c⁄ãxt
;

820 
°bi__ªfûl_buf„r
(
°bi__c⁄ãxt
 *
s
);

823 
	$°bi__°¨t_mem
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
 c⁄° *
buf„r
, 
Àn
)

825 
s
->
io
.
ªad
 = 
NULL
;

826 
s
->
ªad_‰om_ˇŒbacks
 = 0;

827 
s
->
ˇŒback_Æªady_ªad
 = 0;

828 
s
->
img_buf„r
 = s->
img_buf„r_‹igöÆ
 = (
°bi_uc
 *Ë
buf„r
;

829 
s
->
img_buf„r_íd
 = s->
img_buf„r_‹igöÆ_íd
 = (
°bi_uc
 *Ë
buf„r
+
Àn
;

830 
	}
}

833 
	$°bi__°¨t_ˇŒbacks
(
°bi__c⁄ãxt
 *
s
, 
°bi_io_ˇŒbacks
 *
c
, *
u£r
)

835 
s
->
io
 = *
c
;

836 
s
->
io_u£r_d©a
 = 
u£r
;

837 
s
->
buÊí
 = (s->
buf„r_°¨t
);

838 
s
->
ªad_‰om_ˇŒbacks
 = 1;

839 
s
->
ˇŒback_Æªady_ªad
 = 0;

840 
s
->
img_buf„r
 = s->
img_buf„r_‹igöÆ
 = s->
buf„r_°¨t
;

841 
	`°bi__ªfûl_buf„r
(
s
);

842 
s
->
img_buf„r_‹igöÆ_íd
 = s->
img_buf„r_íd
;

843 
	}
}

845 #i‚de‡
STBI_NO_STDIO


847 
	$°bi__°dio_ªad
(*
u£r
, *
d©a
, 
size
)

849  (Ë
	`‰ód
(
d©a
,1,
size
,(
FILE
*Ë
u£r
);

850 
	}
}

852 
	$°bi__°dio_skù
(*
u£r
, 
n
)

854 
ch
;

855 
	`f£ek
((
FILE
*Ë
u£r
, 
n
, 
SEEK_CUR
);

856 
ch
 = 
	`fgëc
((
FILE
*Ë
u£r
);

857 i‡(
ch
 !
EOF
) {

858 
	`ungëc
(
ch
, (
FILE
 *Ë
u£r
);

860 
	}
}

862 
	$°bi__°dio_eof
(*
u£r
)

864  
	`„of
((
FILE
*Ë
u£r
Ë|| 
	`„º‹
((FILE *) user);

865 
	}
}

867 
°bi_io_ˇŒbacks
 
	g°bi__°dio_ˇŒbacks
 =

869 
°bi__°dio_ªad
,

870 
°bi__°dio_skù
,

871 
°bi__°dio_eof
,

874 
	$°bi__°¨t_fûe
(
°bi__c⁄ãxt
 *
s
, 
FILE
 *
f
)

876 
	`°bi__°¨t_ˇŒbacks
(
s
, &
°bi__°dio_ˇŒbacks
, (*Ë
f
);

877 
	}
}

883 
	$°bi__ªwöd
(
°bi__c⁄ãxt
 *
s
)

888 
s
->
img_buf„r
 = s->
img_buf„r_‹igöÆ
;

889 
s
->
img_buf„r_íd
 = s->
img_buf„r_‹igöÆ_íd
;

890 
	}
}

894 
	mSTBI_ORDER_RGB
,

895 
	mSTBI_ORDER_BGR


900 
	mbôs_≥r_ch™√l
;

901 
	mnum_ch™√ls
;

902 
	mch™√l_‹dî
;

903 } 
	t°bi__ªsu…_öfo
;

905 #i‚de‡
STBI_NO_JPEG


906 
°bi__j≥g_ã°
(
°bi__c⁄ãxt
 *
s
);

907 *
°bi__j≥g_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

908 
°bi__j≥g_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

911 #i‚de‡
STBI_NO_PNG


912 
°bi__≤g_ã°
(
°bi__c⁄ãxt
 *
s
);

913 *
°bi__≤g_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

914 
°bi__≤g_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

915 
°bi__≤g_is16
(
°bi__c⁄ãxt
 *
s
);

918 #i‚de‡
STBI_NO_BMP


919 
°bi__bmp_ã°
(
°bi__c⁄ãxt
 *
s
);

920 *
°bi__bmp_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

921 
°bi__bmp_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

924 #i‚de‡
STBI_NO_TGA


925 
°bi__tga_ã°
(
°bi__c⁄ãxt
 *
s
);

926 *
°bi__tga_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

927 
°bi__tga_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

930 #i‚de‡
STBI_NO_PSD


931 
°bi__psd_ã°
(
°bi__c⁄ãxt
 *
s
);

932 *
°bi__psd_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
, 
bpc
);

933 
°bi__psd_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

934 
°bi__psd_is16
(
°bi__c⁄ãxt
 *
s
);

937 #i‚de‡
STBI_NO_HDR


938 
°bi__hdr_ã°
(
°bi__c⁄ãxt
 *
s
);

939 *
°bi__hdr_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

940 
°bi__hdr_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

943 #i‚de‡
STBI_NO_PIC


944 
°bi__pic_ã°
(
°bi__c⁄ãxt
 *
s
);

945 *
°bi__pic_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

946 
°bi__pic_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

949 #i‚de‡
STBI_NO_GIF


950 
°bi__gif_ã°
(
°bi__c⁄ãxt
 *
s
);

951 *
°bi__gif_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

952 *
°bi__lﬂd_gif_maö
(
°bi__c⁄ãxt
 *
s
, **
dñays
, *
x
, *
y
, *
z
, *
comp
, 
ªq_comp
);

953 
°bi__gif_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

956 #i‚de‡
STBI_NO_PNM


957 
°bi__≤m_ã°
(
°bi__c⁄ãxt
 *
s
);

958 *
°bi__≤m_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
);

959 
°bi__≤m_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
);

960 
°bi__≤m_is16
(
°bi__c⁄ãxt
 *
s
);

964 #ifde‡
STBI_THREAD_LOCAL


965 
	gSTBI_THREAD_LOCAL


967 c⁄° *
	g°bi__g_Áûuª_ªas⁄
;

969 
STBIDEF
 c⁄° *
	$°bi_Áûuª_ªas⁄
()

971  
°bi__g_Áûuª_ªas⁄
;

972 
	}
}

974 #i‚de‡
STBI_NO_FAILURE_STRINGS


975 
	$°bi__îr
(c⁄° *
°r
)

977 
°bi__g_Áûuª_ªas⁄
 = 
°r
;

979 
	}
}

982 *
	$°bi__mÆloc
(
size_t
 
size
)

984  
	`STBI_MALLOC
(
size
);

985 
	}
}

999 
	$°bi__addsizes_vÆid
(
a
, 
b
)

1001 i‡(
b
 < 0)  0;

1006  
a
 <
INT_MAX
 - 
b
;

1007 
	}
}

1011 
	$°bi__mul2sizes_vÆid
(
a
, 
b
)

1013 i‡(
a
 < 0 || 
b
 < 0)  0;

1014 i‡(
b
 == 0)  1;

1016  
a
 <
INT_MAX
/
b
;

1017 
	}
}

1019 #i‡!
deföed
(
STBI_NO_JPEG
Ë|| !deföed(
STBI_NO_PNG
Ë|| !deföed(
STBI_NO_TGA
Ë|| !deföed(
STBI_NO_HDR
)

1021 
	$°bi__mad2sizes_vÆid
(
a
, 
b
, 
add
)

1023  
	`°bi__mul2sizes_vÆid
(
a
, 
b
Ë&& 
	`°bi__addsizes_vÆid
◊*b, 
add
);

1024 
	}
}

1028 
	$°bi__mad3sizes_vÆid
(
a
, 
b
, 
c
, 
add
)

1030  
	`°bi__mul2sizes_vÆid
(
a
, 
b
Ë&& stbi__mul2sizes_vÆid◊*b, 
c
) &&

1031 
	`°bi__addsizes_vÆid
(
a
*
b
*
c
, 
add
);

1032 
	}
}

1035 #i‡!
deföed
(
STBI_NO_LINEAR
Ë|| !deföed(
STBI_NO_HDR
Ë|| !deföed(
STBI_NO_PNM
)

1036 
	$°bi__mad4sizes_vÆid
(
a
, 
b
, 
c
, 
d
, 
add
)

1038  
	`°bi__mul2sizes_vÆid
(
a
, 
b
Ë&& stbi__mul2sizes_vÆid◊*b, 
c
) &&

1039 
	`°bi__mul2sizes_vÆid
(
a
*
b
*
c
, 
d
Ë&& 
	`°bi__addsizes_vÆid
◊*b*c*d, 
add
);

1040 
	}
}

1043 #i‡!
deföed
(
STBI_NO_JPEG
Ë|| !deföed(
STBI_NO_PNG
Ë|| !deföed(
STBI_NO_TGA
Ë|| !deföed(
STBI_NO_HDR
)

1045 *
	$°bi__mÆloc_mad2
(
a
, 
b
, 
add
)

1047 i‡(!
	`°bi__mad2sizes_vÆid
(
a
, 
b
, 
add
)Ë 
NULL
;

1048  
	`°bi__mÆloc
(
a
*
b
 + 
add
);

1049 
	}
}

1052 *
	$°bi__mÆloc_mad3
(
a
, 
b
, 
c
, 
add
)

1054 i‡(!
	`°bi__mad3sizes_vÆid
(
a
, 
b
, 
c
, 
add
)Ë 
NULL
;

1055  
	`°bi__mÆloc
(
a
*
b
*
c
 + 
add
);

1056 
	}
}

1058 #i‡!
deföed
(
STBI_NO_LINEAR
Ë|| !deföed(
STBI_NO_HDR
Ë|| !deföed(
STBI_NO_PNM
)

1059 *
	$°bi__mÆloc_mad4
(
a
, 
b
, 
c
, 
d
, 
add
)

1061 i‡(!
	`°bi__mad4sizes_vÆid
(
a
, 
b
, 
c
, 
d
, 
add
)Ë 
NULL
;

1062  
	`°bi__mÆloc
(
a
*
b
*
c
*
d
 + 
add
);

1063 
	}
}

1070 #ifde‡
STBI_NO_FAILURE_STRINGS


1071 
	#°bi__îr
(
x
,
y
Ë0

	)

1072 #ñi‡
deföed
(
STBI_FAILURE_USERMSG
)

1073 
	#°bi__îr
(
x
,
y
Ë
	`°bi__îr
(y)

	)

1075 
	#°bi__îr
(
x
,
y
Ë
	`°bi__îr
(x)

	)

1078 
	#°bi__îΩf
(
x
,
y
Ë((*)(
size_t
Ë(
	`°bi__îr
(x,y)?
NULL
:NULL))

	)

1079 
	#°bi__îΩuc
(
x
,
y
Ë((*)(
size_t
Ë(
	`°bi__îr
(x,y)?
NULL
:NULL))

	)

1081 
STBIDEF
 
	$°bi_image_‰ì
(*
ªtvÆ_‰om_°bi_lﬂd
)

1083 
	`STBI_FREE
(
ªtvÆ_‰om_°bi_lﬂd
);

1084 
	}
}

1086 #i‚de‡
STBI_NO_LINEAR


1087 *
°bi__ldr_to_hdr
(
°bi_uc
 *
d©a
, 
x
, 
y
, 
comp
);

1090 #i‚de‡
STBI_NO_HDR


1091 
°bi_uc
 *
°bi__hdr_to_ldr
(*
d©a
, 
x
, 
y
, 
comp
);

1094 
	g°bi__vîtiˇŒy_Êù_⁄_lﬂd_globÆ
 = 0;

1096 
STBIDEF
 
	$°bi_£t_Êù_vîtiˇŒy_⁄_lﬂd
(
Êag_åue_if_should_Êù
)

1098 
°bi__vîtiˇŒy_Êù_⁄_lﬂd_globÆ
 = 
Êag_åue_if_should_Êù
;

1099 
	}
}

1101 #i‚de‡
STBI_THREAD_LOCAL


1102 
	#°bi__vîtiˇŒy_Êù_⁄_lﬂd
 
°bi__vîtiˇŒy_Êù_⁄_lﬂd_globÆ


	)

1104 
STBI_THREAD_LOCAL
 
	g°bi__vîtiˇŒy_Êù_⁄_lﬂd_loˇl
, 
	g°bi__vîtiˇŒy_Êù_⁄_lﬂd_£t
;

1106 
STBIDEF
 
	$°bi_£t_Êù_vîtiˇŒy_⁄_lﬂd_thªad
(
Êag_åue_if_should_Êù
)

1108 
°bi__vîtiˇŒy_Êù_⁄_lﬂd_loˇl
 = 
Êag_åue_if_should_Êù
;

1109 
°bi__vîtiˇŒy_Êù_⁄_lﬂd_£t
 = 1;

1110 
	}
}

1112 
	#°bi__vîtiˇŒy_Êù_⁄_lﬂd
 (
°bi__vîtiˇŒy_Êù_⁄_lﬂd_£t
 \

1113 ? 
°bi__vîtiˇŒy_Êù_⁄_lﬂd_loˇl
 \

1114 : 
°bi__vîtiˇŒy_Êù_⁄_lﬂd_globÆ
)

	)

1117 *
	$°bi__lﬂd_maö
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
, 
bpc
)

1119 
	`mem£t
(
ri
, 0, (*ri));

1120 
ri
->
bôs_≥r_ch™√l
 = 8;

1121 
ri
->
ch™√l_‹dî
 = 
STBI_ORDER_RGB
;

1122 
ri
->
num_ch™√ls
 = 0;

1126 #i‚de‡
STBI_NO_PNG


1127 i‡(
	`°bi__≤g_ã°
(
s
)Ë 
	`°bi__≤g_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1129 #i‚de‡
STBI_NO_BMP


1130 i‡(
	`°bi__bmp_ã°
(
s
)Ë 
	`°bi__bmp_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1132 #i‚de‡
STBI_NO_GIF


1133 i‡(
	`°bi__gif_ã°
(
s
)Ë 
	`°bi__gif_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1135 #i‚de‡
STBI_NO_PSD


1136 i‡(
	`°bi__psd_ã°
(
s
)Ë 
	`°bi__psd_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
, 
bpc
);

1138 
	`STBI_NOTUSED
(
bpc
);

1140 #i‚de‡
STBI_NO_PIC


1141 i‡(
	`°bi__pic_ã°
(
s
)Ë 
	`°bi__pic_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1147 #i‚de‡
STBI_NO_JPEG


1148 i‡(
	`°bi__j≥g_ã°
(
s
)Ë 
	`°bi__j≥g_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1150 #i‚de‡
STBI_NO_PNM


1151 i‡(
	`°bi__≤m_ã°
(
s
)Ë 
	`°bi__≤m_lﬂd
(s,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1154 #i‚de‡
STBI_NO_HDR


1155 i‡(
	`°bi__hdr_ã°
(
s
)) {

1156 *
hdr
 = 
	`°bi__hdr_lﬂd
(
s
, 
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1157  
	`°bi__hdr_to_ldr
(
hdr
, *
x
, *
y
, 
ªq_comp
 ?Ñeq_com∞: *
comp
);

1161 #i‚de‡
STBI_NO_TGA


1163 i‡(
	`°bi__tga_ã°
(
s
))

1164  
	`°bi__tga_lﬂd
(
s
,
x
,
y
,
comp
,
ªq_comp
, 
ri
);

1167  
	`°bi__îΩuc
("unknown imageÅype", "ImageÇot ofány knownÅype, or corrupt");

1168 
	}
}

1170 
°bi_uc
 *
	$°bi__c⁄vît_16_to_8
(
°bi__uöt16
 *
‹ig
, 
w
, 
h
, 
ch™√ls
)

1172 
i
;

1173 
img_Àn
 = 
w
 * 
h
 * 
ch™√ls
;

1174 
°bi_uc
 *
ªdu˚d
;

1176 
ªdu˚d
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(
img_Àn
);

1177 i‡(
ªdu˚d
 =
NULL
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

1179 
i
 = 0; i < 
img_Àn
; ++i)

1180 
ªdu˚d
[
i
] = (
°bi_uc
)((
‹ig
[i] >> 8) & 0xFF);

1182 
	`STBI_FREE
(
‹ig
);

1183  
ªdu˚d
;

1184 
	}
}

1186 
°bi__uöt16
 *
	$°bi__c⁄vît_8_to_16
(
°bi_uc
 *
‹ig
, 
w
, 
h
, 
ch™√ls
)

1188 
i
;

1189 
img_Àn
 = 
w
 * 
h
 * 
ch™√ls
;

1190 
°bi__uöt16
 *
íœrged
;

1192 
íœrged
 = (
°bi__uöt16
 *Ë
	`°bi__mÆloc
(
img_Àn
*2);

1193 i‡(
íœrged
 =
NULL
Ë (
°bi__uöt16
 *Ë
	`°bi__îΩuc
("outofmem", "Out of memory");

1195 
i
 = 0; i < 
img_Àn
; ++i)

1196 
íœrged
[
i
] = (
°bi__uöt16
)((
‹ig
[i] << 8) + orig[i]);

1198 
	`STBI_FREE
(
‹ig
);

1199  
íœrged
;

1200 
	}
}

1202 
	$°bi__vîtiˇl_Êù
(*
image
, 
w
, 
h
, 
byãs_≥r_pixñ
)

1204 
row
;

1205 
size_t
 
byãs_≥r_row
 = (size_t)
w
 * 
byãs_≥r_pixñ
;

1206 
°bi_uc
 
ãmp
[2048];

1207 
°bi_uc
 *
byãs
 = (°bi_u¯*)
image
;

1209 
row
 = 0;Ñow < (
h
>>1);Ñow++) {

1210 
°bi_uc
 *
row0
 = 
byãs
 + 
row
*
byãs_≥r_row
;

1211 
°bi_uc
 *
row1
 = 
byãs
 + (
h
 - 
row
 - 1)*
byãs_≥r_row
;

1213 
size_t
 
byãs_À·
 = 
byãs_≥r_row
;

1214 
byãs_À·
) {

1215 
size_t
 
byãs_c›y
 = (
byãs_À·
 < (
ãmp
)) ? bytes_left : (temp);

1216 
	`mem˝y
(
ãmp
, 
row0
, 
byãs_c›y
);

1217 
	`mem˝y
(
row0
, 
row1
, 
byãs_c›y
);

1218 
	`mem˝y
(
row1
, 
ãmp
, 
byãs_c›y
);

1219 
row0
 +
byãs_c›y
;

1220 
row1
 +
byãs_c›y
;

1221 
byãs_À·
 -
byãs_c›y
;

1224 
	}
}

1226 #i‚de‡
STBI_NO_GIF


1227 
	$°bi__vîtiˇl_Êù_¶i˚s
(*
image
, 
w
, 
h
, 
z
, 
byãs_≥r_pixñ
)

1229 
¶i˚
;

1230 
¶i˚_size
 = 
w
 * 
h
 * 
byãs_≥r_pixñ
;

1232 
°bi_uc
 *
byãs
 = (°bi_u¯*)
image
;

1233 
¶i˚
 = 0; sli˚ < 
z
; ++slice) {

1234 
	`°bi__vîtiˇl_Êù
(
byãs
, 
w
, 
h
, 
byãs_≥r_pixñ
);

1235 
byãs
 +
¶i˚_size
;

1237 
	}
}

1240 *
	$°bi__lﬂd_™d_po°¥o˚ss_8bô
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1242 
°bi__ªsu…_öfo
 
ri
;

1243 *
ªsu…
 = 
	`°bi__lﬂd_maö
(
s
, 
x
, 
y
, 
comp
, 
ªq_comp
, &
ri
, 8);

1245 i‡(
ªsu…
 =
NULL
)

1246  
NULL
;

1249 
	`STBI_ASSERT
(
ri
.
bôs_≥r_ch™√l
 == 8 ||Ñi.bits_per_channel == 16);

1251 i‡(
ri
.
bôs_≥r_ch™√l
 != 8) {

1252 
ªsu…
 = 
	`°bi__c⁄vît_16_to_8
((
°bi__uöt16
 *Ëªsu…, *
x
, *
y
, 
ªq_comp
 =0 ? *
comp
 :Ñeq_comp);

1253 
ri
.
bôs_≥r_ch™√l
 = 8;

1258 i‡(
°bi__vîtiˇŒy_Êù_⁄_lﬂd
) {

1259 
ch™√ls
 = 
ªq_comp
 ?Ñeq_com∞: *
comp
;

1260 
	`°bi__vîtiˇl_Êù
(
ªsu…
, *
x
, *
y
, 
ch™√ls
 * (
°bi_uc
));

1263  (*Ë
ªsu…
;

1264 
	}
}

1266 
°bi__uöt16
 *
	$°bi__lﬂd_™d_po°¥o˚ss_16bô
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1268 
°bi__ªsu…_öfo
 
ri
;

1269 *
ªsu…
 = 
	`°bi__lﬂd_maö
(
s
, 
x
, 
y
, 
comp
, 
ªq_comp
, &
ri
, 16);

1271 i‡(
ªsu…
 =
NULL
)

1272  
NULL
;

1275 
	`STBI_ASSERT
(
ri
.
bôs_≥r_ch™√l
 == 8 ||Ñi.bits_per_channel == 16);

1277 i‡(
ri
.
bôs_≥r_ch™√l
 != 16) {

1278 
ªsu…
 = 
	`°bi__c⁄vît_8_to_16
((
°bi_uc
 *Ëªsu…, *
x
, *
y
, 
ªq_comp
 =0 ? *
comp
 :Ñeq_comp);

1279 
ri
.
bôs_≥r_ch™√l
 = 16;

1285 i‡(
°bi__vîtiˇŒy_Êù_⁄_lﬂd
) {

1286 
ch™√ls
 = 
ªq_comp
 ?Ñeq_com∞: *
comp
;

1287 
	`°bi__vîtiˇl_Êù
(
ªsu…
, *
x
, *
y
, 
ch™√ls
 * (
°bi__uöt16
));

1290  (
°bi__uöt16
 *Ë
ªsu…
;

1291 
	}
}

1293 #i‡!
deföed
(
STBI_NO_HDR
Ë&& !deföed(
STBI_NO_LINEAR
)

1294 
	$°bi__Êﬂt_po°¥o˚ss
(*
ªsu…
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1296 i‡(
°bi__vîtiˇŒy_Êù_⁄_lﬂd
 && 
ªsu…
 !
NULL
) {

1297 
ch™√ls
 = 
ªq_comp
 ?Ñeq_com∞: *
comp
;

1298 
	`°bi__vîtiˇl_Êù
(
ªsu…
, *
x
, *
y
, 
ch™√ls
 * ());

1300 
	}
}

1303 #i‚de‡
STBI_NO_STDIO


1305 #i‡
deföed
(
_WIN32
Ë&& deföed(
STBI_WINDOWS_UTF8
)

1306 
STBI_EXTERN
 
	$__de˛•ec
(
dŒimp‹t
Ë
__°dˇŒ
 
	`Mu…iByãToWideCh¨
(
˝
, 
Êags
, c⁄° *
°r
, 
cbmb
, 
wch¨_t
 *
wide°r
, 
cchwide
);

1307 
STBI_EXTERN
 
	$__de˛•ec
(
dŒimp‹t
Ë
__°dˇŒ
 
	`WideCh¨ToMu…iByã
(
˝
, 
Êags
, c⁄° 
wch¨_t
 *
wide°r
, 
cchwide
, *
°r
, 
cbmb
, c⁄° *
defch¨
, *
u£d_deÁu…
);

1310 #i‡
	`deföed
(
_WIN32
Ë&& deföed(
STBI_WINDOWS_UTF8
)

1311 
STBIDEF
 
	$°bi_c⁄vît_wch¨_to_utf8
(*
buf„r
, 
size_t
 
buf„æí
, c⁄° 
wch¨_t
* 
öput
)

1313  
	`WideCh¨ToMu…iByã
(65001 , 0, 
öput
, -1, 
buf„r
, (Ë
buf„æí
, 
NULL
, NULL);

1314 
	}
}

1317 
FILE
 *
	$°bi__f›í
(c⁄° *
fûíame
, c⁄° *
mode
)

1319 
FILE
 *
f
;

1320 #i‡
	`deföed
(
_WIN32
Ë&& deföed(
STBI_WINDOWS_UTF8
)

1321 
wch¨_t
 
wMode
[64];

1322 
wch¨_t
 
wFûíame
[1024];

1323 i‡(0 =
	`Mu…iByãToWideCh¨
(65001 , 0, 
fûíame
, -1, 
wFûíame
, (wFilename)/(*wFilename)))

1326 i‡(0 =
	`Mu…iByãToWideCh¨
(65001 , 0, 
mode
, -1, 
wMode
, (wMode)/(*wMode)))

1329 #i‡
	`deföed
(
_MSC_VER
) && _MSC_VER >= 1400

1330 i‡(0 !
	`_wf›í_s
(&
f
, 
wFûíame
, 
wMode
))

1331 
f
 = 0;

1333 
f
 = 
	`_wf›í
(
wFûíame
, 
wMode
);

1336 #ñi‡
	`deföed
(
_MSC_VER
) && _MSC_VER >= 1400

1337 i‡(0 !
	`f›í_s
(&
f
, 
fûíame
, 
mode
))

1338 
f
=0;

1340 
f
 = 
	`f›í
(
fûíame
, 
mode
);

1342  
f
;

1343 
	}
}

1346 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd
(c⁄° *
fûíame
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1348 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

1349 *
ªsu…
;

1350 i‡(!
f
Ë 
	`°bi__îΩuc
("can't fopen", "UnableÅo open file");

1351 
ªsu…
 = 
	`°bi_lﬂd_‰om_fûe
(
f
,
x
,
y
,
comp
,
ªq_comp
);

1352 
	`f˛o£
(
f
);

1353  
ªsu…
;

1354 
	}
}

1356 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd_‰om_fûe
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1358 *
ªsu…
;

1359 
°bi__c⁄ãxt
 
s
;

1360 
	`°bi__°¨t_fûe
(&
s
,
f
);

1361 
ªsu…
 = 
	`°bi__lﬂd_™d_po°¥o˚ss_8bô
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1362 i‡(
ªsu…
) {

1364 
	`f£ek
(
f
, - (Ë(
s
.
img_buf„r_íd
 - s.
img_buf„r
), 
SEEK_CUR
);

1366  
ªsu…
;

1367 
	}
}

1369 
STBIDEF
 
°bi__uöt16
 *
	$°bi_lﬂd_‰om_fûe_16
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1371 
°bi__uöt16
 *
ªsu…
;

1372 
°bi__c⁄ãxt
 
s
;

1373 
	`°bi__°¨t_fûe
(&
s
,
f
);

1374 
ªsu…
 = 
	`°bi__lﬂd_™d_po°¥o˚ss_16bô
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1375 i‡(
ªsu…
) {

1377 
	`f£ek
(
f
, - (Ë(
s
.
img_buf„r_íd
 - s.
img_buf„r
), 
SEEK_CUR
);

1379  
ªsu…
;

1380 
	}
}

1382 
STBIDEF
 
°bi_us
 *
	$°bi_lﬂd_16
(c⁄° *
fûíame
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1384 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

1385 
°bi__uöt16
 *
ªsu…
;

1386 i‡(!
f
Ë (
°bi_us
 *Ë
	`°bi__îΩuc
("can't fopen", "UnableÅo open file");

1387 
ªsu…
 = 
	`°bi_lﬂd_‰om_fûe_16
(
f
,
x
,
y
,
comp
,
ªq_comp
);

1388 
	`f˛o£
(
f
);

1389  
ªsu…
;

1390 
	}
}

1395 
STBIDEF
 
°bi_us
 *
	$°bi_lﬂd_16_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
)

1397 
°bi__c⁄ãxt
 
s
;

1398 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1399  
	`°bi__lﬂd_™d_po°¥o˚ss_16bô
(&
s
,
x
,
y
,
ch™√ls_ö_fûe
,
desúed_ch™√ls
);

1400 
	}
}

1402 
STBIDEF
 
°bi_us
 *
	$°bi_lﬂd_16_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
ch™√ls_ö_fûe
, 
desúed_ch™√ls
)

1404 
°bi__c⁄ãxt
 
s
;

1405 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *)
˛bk
, 
u£r
);

1406  
	`°bi__lﬂd_™d_po°¥o˚ss_16bô
(&
s
,
x
,
y
,
ch™√ls_ö_fûe
,
desúed_ch™√ls
);

1407 
	}
}

1409 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1411 
°bi__c⁄ãxt
 
s
;

1412 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1413  
	`°bi__lﬂd_™d_po°¥o˚ss_8bô
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1414 
	}
}

1416 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1418 
°bi__c⁄ãxt
 
s
;

1419 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
˛bk
, 
u£r
);

1420  
	`°bi__lﬂd_™d_po°¥o˚ss_8bô
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1421 
	}
}

1423 #i‚de‡
STBI_NO_GIF


1424 
STBIDEF
 
°bi_uc
 *
	$°bi_lﬂd_gif_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, **
dñays
, *
x
, *
y
, *
z
, *
comp
, 
ªq_comp
)

1426 *
ªsu…
;

1427 
°bi__c⁄ãxt
 
s
;

1428 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1430 
ªsu…
 = (*Ë
	`°bi__lﬂd_gif_maö
(&
s
, 
dñays
, 
x
, 
y
, 
z
, 
comp
, 
ªq_comp
);

1431 i‡(
°bi__vîtiˇŒy_Êù_⁄_lﬂd
) {

1432 
	`°bi__vîtiˇl_Êù_¶i˚s
–
ªsu…
, *
x
, *
y
, *
z
, *
comp
 );

1435  
ªsu…
;

1436 
	}
}

1439 #i‚de‡
STBI_NO_LINEAR


1440 *
	$°bi__lﬂdf_maö
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1442 *
d©a
;

1443 #i‚de‡
STBI_NO_HDR


1444 i‡(
	`°bi__hdr_ã°
(
s
)) {

1445 
°bi__ªsu…_öfo
 
ri
;

1446 *
hdr_d©a
 = 
	`°bi__hdr_lﬂd
(
s
,
x
,
y
,
comp
,
ªq_comp
, &
ri
);

1447 i‡(
hdr_d©a
)

1448 
	`°bi__Êﬂt_po°¥o˚ss
(
hdr_d©a
,
x
,
y
,
comp
,
ªq_comp
);

1449  
hdr_d©a
;

1452 
d©a
 = 
	`°bi__lﬂd_™d_po°¥o˚ss_8bô
(
s
, 
x
, 
y
, 
comp
, 
ªq_comp
);

1453 i‡(
d©a
)

1454  
	`°bi__ldr_to_hdr
(
d©a
, *
x
, *
y
, 
ªq_comp
 ?Ñeq_com∞: *
comp
);

1455  
	`°bi__îΩf
("unknown imageÅype", "ImageÇot ofány knownÅype, or corrupt");

1456 
	}
}

1458 
STBIDEF
 *
	$°bi_lﬂdf_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1460 
°bi__c⁄ãxt
 
s
;

1461 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1462  
	`°bi__lﬂdf_maö
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1463 
	}
}

1465 
STBIDEF
 *
	$°bi_lﬂdf_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1467 
°bi__c⁄ãxt
 
s
;

1468 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
˛bk
, 
u£r
);

1469  
	`°bi__lﬂdf_maö
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1470 
	}
}

1472 #i‚de‡
STBI_NO_STDIO


1473 
STBIDEF
 *
	$°bi_lﬂdf
(c⁄° *
fûíame
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1475 *
ªsu…
;

1476 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

1477 i‡(!
f
Ë 
	`°bi__îΩf
("can't fopen", "UnableÅo open file");

1478 
ªsu…
 = 
	`°bi_lﬂdf_‰om_fûe
(
f
,
x
,
y
,
comp
,
ªq_comp
);

1479 
	`f˛o£
(
f
);

1480  
ªsu…
;

1481 
	}
}

1483 
STBIDEF
 *
	$°bi_lﬂdf_‰om_fûe
(
FILE
 *
f
, *
x
, *
y
, *
comp
, 
ªq_comp
)

1485 
°bi__c⁄ãxt
 
s
;

1486 
	`°bi__°¨t_fûe
(&
s
,
f
);

1487  
	`°bi__lﬂdf_maö
(&
s
,
x
,
y
,
comp
,
ªq_comp
);

1488 
	}
}

1497 
STBIDEF
 
	$°bi_is_hdr_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
)

1499 #i‚de‡
STBI_NO_HDR


1500 
°bi__c⁄ãxt
 
s
;

1501 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

1502  
	`°bi__hdr_ã°
(&
s
);

1504 
	`STBI_NOTUSED
(
buf„r
);

1505 
	`STBI_NOTUSED
(
Àn
);

1508 
	}
}

1510 #i‚de‡
STBI_NO_STDIO


1511 
STBIDEF
 
	$°bi_is_hdr
 (c⁄° *
fûíame
)

1513 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

1514 
ªsu…
=0;

1515 i‡(
f
) {

1516 
ªsu…
 = 
	`°bi_is_hdr_‰om_fûe
(
f
);

1517 
	`f˛o£
(
f
);

1519  
ªsu…
;

1520 
	}
}

1522 
STBIDEF
 
	$°bi_is_hdr_‰om_fûe
(
FILE
 *
f
)

1524 #i‚de‡
STBI_NO_HDR


1525 
pos
 = 
	`·ñl
(
f
);

1526 
ªs
;

1527 
°bi__c⁄ãxt
 
s
;

1528 
	`°bi__°¨t_fûe
(&
s
,
f
);

1529 
ªs
 = 
	`°bi__hdr_ã°
(&
s
);

1530 
	`f£ek
(
f
, 
pos
, 
SEEK_SET
);

1531  
ªs
;

1533 
	`STBI_NOTUSED
(
f
);

1536 
	}
}

1539 
STBIDEF
 
	$°bi_is_hdr_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
˛bk
, *
u£r
)

1541 #i‚de‡
STBI_NO_HDR


1542 
°bi__c⁄ãxt
 
s
;

1543 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
˛bk
, 
u£r
);

1544  
	`°bi__hdr_ã°
(&
s
);

1546 
	`STBI_NOTUSED
(
˛bk
);

1547 
	`STBI_NOTUSED
(
u£r
);

1550 
	}
}

1552 #i‚de‡
STBI_NO_LINEAR


1553 
	g°bi__l2h_gamma
=2.2f, 
	g°bi__l2h_sˇÀ
=1.0f;

1555 
STBIDEF
 
	$°bi_ldr_to_hdr_gamma
(
gamma
Ë{ 
°bi__l2h_gamma
 = gamma; 
	}
}

1556 
STBIDEF
 
	$°bi_ldr_to_hdr_sˇÀ
(
sˇÀ
Ë{ 
°bi__l2h_sˇÀ
 = sˇÀ; 
	}
}

1559 
	g°bi__h2l_gamma_i
=1.0f/2.2f, 
	g°bi__h2l_sˇÀ_i
=1.0f;

1561 
STBIDEF
 
	$°bi_hdr_to_ldr_gamma
(
gamma
Ë{ 
°bi__h2l_gamma_i
 = 1/gamma; 
	}
}

1562 
STBIDEF
 
	$°bi_hdr_to_ldr_sˇÀ
(
sˇÀ
Ë{ 
°bi__h2l_sˇÀ_i
 = 1/sˇÀ; 
	}
}

1572 
	mSTBI__SCAN_lﬂd
=0,

1573 
	mSTBI__SCAN_ty≥
,

1574 
	mSTBI__SCAN_hódî


1577 
	$°bi__ªfûl_buf„r
(
°bi__c⁄ãxt
 *
s
)

1579 
n
 = (
s
->
io
.
ªad
)(s->
io_u£r_d©a
,(*)s->
buf„r_°¨t
,s->
buÊí
);

1580 
s
->
ˇŒback_Æªady_ªad
 +(Ë(s->
img_buf„r
 - s->
img_buf„r_‹igöÆ
);

1581 i‡(
n
 == 0) {

1584 
s
->
ªad_‰om_ˇŒbacks
 = 0;

1585 
s
->
img_buf„r
 = s->
buf„r_°¨t
;

1586 
s
->
img_buf„r_íd
 = s->
buf„r_°¨t
+1;

1587 *
s
->
img_buf„r
 = 0;

1589 
s
->
img_buf„r
 = s->
buf„r_°¨t
;

1590 
s
->
img_buf„r_íd
 = s->
buf„r_°¨t
 + 
n
;

1592 
	}
}

1594 
°bi_ölöe
 
°bi_uc
 
	$°bi__gë8
(
°bi__c⁄ãxt
 *
s
)

1596 i‡(
s
->
img_buf„r
 < s->
img_buf„r_íd
)

1597  *
s
->
img_buf„r
++;

1598 i‡(
s
->
ªad_‰om_ˇŒbacks
) {

1599 
	`°bi__ªfûl_buf„r
(
s
);

1600  *
s
->
img_buf„r
++;

1603 
	}
}

1605 #i‡
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_NO_HDR
Ë&& deföed(
STBI_NO_PIC
Ë&& deföed(
STBI_NO_PNM
)

1608 
°bi_ölöe
 
	$°bi__©_eof
(
°bi__c⁄ãxt
 *
s
)

1610 i‡(
s
->
io
.
ªad
) {

1611 i‡(!(
s
->
io
.
eof
)(s->
io_u£r_d©a
))  0;

1614 i‡(
s
->
ªad_‰om_ˇŒbacks
 == 0)  1;

1617  
s
->
img_buf„r
 >s->
img_buf„r_íd
;

1618 
	}
}

1621 #i‡
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_BMP
Ë&& deföed(
STBI_NO_PSD
Ë&& deföed(
STBI_NO_TGA
Ë&& deföed(
STBI_NO_GIF
Ë&& deföed(
STBI_NO_PIC
)

1624 
	$°bi__skù
(
°bi__c⁄ãxt
 *
s
, 
n
)

1626 i‡(
n
 == 0) ;

1627 i‡(
n
 < 0) {

1628 
s
->
img_buf„r
 = s->
img_buf„r_íd
;

1631 i‡(
s
->
io
.
ªad
) {

1632 
bÀn
 = (Ë(
s
->
img_buf„r_íd
 - s->
img_buf„r
);

1633 i‡(
bÀn
 < 
n
) {

1634 
s
->
img_buf„r
 = s->
img_buf„r_íd
;

1635 (
s
->
io
.
skù
)(s->
io_u£r_d©a
, 
n
 - 
bÀn
);

1639 
s
->
img_buf„r
 +
n
;

1640 
	}
}

1643 #i‡
deföed
(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_TGA
Ë&& deföed(
STBI_NO_HDR
Ë&& deföed(
STBI_NO_PNM
)

1646 
	$°bi__gën
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
 *
buf„r
, 
n
)

1648 i‡(
s
->
io
.
ªad
) {

1649 
bÀn
 = (Ë(
s
->
img_buf„r_íd
 - s->
img_buf„r
);

1650 i‡(
bÀn
 < 
n
) {

1651 
ªs
, 
cou¡
;

1653 
	`mem˝y
(
buf„r
, 
s
->
img_buf„r
, 
bÀn
);

1655 
cou¡
 = (
s
->
io
.
ªad
)(s->
io_u£r_d©a
, (*Ë
buf„r
 + 
bÀn
, 
n
 - blen);

1656 
ªs
 = (
cou¡
 =(
n
-
bÀn
));

1657 
s
->
img_buf„r
 = s->
img_buf„r_íd
;

1658  
ªs
;

1662 i‡(
s
->
img_buf„r
+
n
 <s->
img_buf„r_íd
) {

1663 
	`mem˝y
(
buf„r
, 
s
->
img_buf„r
, 
n
);

1664 
s
->
img_buf„r
 +
n
;

1668 
	}
}

1671 #i‡
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_PSD
Ë&& deföed(
STBI_NO_PIC
)

1674 
	$°bi__gë16be
(
°bi__c⁄ãxt
 *
s
)

1676 
z
 = 
	`°bi__gë8
(
s
);

1677  (
z
 << 8Ë+ 
	`°bi__gë8
(
s
);

1678 
	}
}

1681 #i‡
deföed
(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_PSD
Ë&& deföed(
STBI_NO_PIC
)

1684 
°bi__uöt32
 
	$°bi__gë32be
(
°bi__c⁄ãxt
 *
s
)

1686 
°bi__uöt32
 
z
 = 
	`°bi__gë16be
(
s
);

1687  (
z
 << 16Ë+ 
	`°bi__gë16be
(
s
);

1688 
	}
}

1691 #i‡
deföed
(
STBI_NO_BMP
Ë&& deföed(
STBI_NO_TGA
Ë&& deföed(
STBI_NO_GIF
)

1694 
	$°bi__gë16À
(
°bi__c⁄ãxt
 *
s
)

1696 
z
 = 
	`°bi__gë8
(
s
);

1697  
z
 + (
	`°bi__gë8
(
s
) << 8);

1698 
	}
}

1701 #i‚de‡
STBI_NO_BMP


1702 
°bi__uöt32
 
	$°bi__gë32À
(
°bi__c⁄ãxt
 *
s
)

1704 
°bi__uöt32
 
z
 = 
	`°bi__gë16À
(
s
);

1705 
z
 +(
°bi__uöt32
)
	`°bi__gë16À
(
s
) << 16;

1706  
z
;

1707 
	}
}

1710 
	#STBI__BYTECAST
(
x
Ë((
°bi_uc
) ((x) & 255))

1711 

	)

1712 #i‡
deföed
(
STBI_NO_JPEG
Ë&& deföed(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_BMP
Ë&& deföed(
STBI_NO_PSD
Ë&& deföed(
STBI_NO_TGA
Ë&& deföed(
STBI_NO_GIF
Ë&& deföed(
STBI_NO_PIC
Ë&& deföed(
STBI_NO_PNM
)

1726 
°bi_uc
 
	$°bi__compuã_y
(
r
, 
g
, 
b
)

1728  (
°bi_uc
Ë(((
r
*77Ë+ (
g
*150Ë+ (29*
b
)) >> 8);

1729 
	}
}

1732 #i‡
deföed
(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_BMP
Ë&& deföed(
STBI_NO_PSD
Ë&& deföed(
STBI_NO_TGA
Ë&& deföed(
STBI_NO_GIF
Ë&& deföed(
STBI_NO_PIC
Ë&& deföed(
STBI_NO_PNM
)

1735 *
	$°bi__c⁄vît_f‹m©
(*
d©a
, 
img_n
, 
ªq_comp
, 
x
, 
y
)

1737 
i
,
j
;

1738 *
good
;

1740 i‡(
ªq_comp
 =
img_n
Ë 
d©a
;

1741 
	`STBI_ASSERT
(
ªq_comp
 >= 1 &&Ñeq_comp <= 4);

1743 
good
 = (*Ë
	`°bi__mÆloc_mad3
(
ªq_comp
, 
x
, 
y
, 0);

1744 i‡(
good
 =
NULL
) {

1745 
	`STBI_FREE
(
d©a
);

1746  
	`°bi__îΩuc
("outofmem", "Out of memory");

1749 
j
=0; j < (Ë
y
; ++j) {

1750 *
§c
 = 
d©a
 + 
j
 * 
x
 * 
img_n
 ;

1751 *
de°
 = 
good
 + 
j
 * 
x
 * 
ªq_comp
;

1753 
	#STBI__COMBO
(
a
,
b
Ë(◊)*8+(b))

	)

1754 
	#STBI__CASE
(
a
,
b
Ë
	`STBI__COMBO
◊,b): 
i
=
x
-1; i >0; --i, 
§c
 +a, 
de°
 +b)

	)

1757 
	`STBI__COMBO
(
img_n
, 
ªq_comp
)) {

1758 
	`STBI__CASE
(1,2Ë{ 
de°
[0]=
§c
[0]; dest[1]=255; } ;

1759 
	`STBI__CASE
(1,3Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; } ;

1760 
	`STBI__CASE
(1,4Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; dest[3]=255; } ;

1761 
	`STBI__CASE
(2,1Ë{ 
de°
[0]=
§c
[0]; } ;

1762 
	`STBI__CASE
(2,3Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; } ;

1763 
	`STBI__CASE
(2,4Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; dest[3]=src[1]; } ;

1764 
	`STBI__CASE
(3,4Ë{ 
de°
[0]=
§c
[0];dest[1]=src[1];dest[2]=src[2];dest[3]=255; } ;

1765 
	`STBI__CASE
(3,1Ë{ 
de°
[0]=
	`°bi__compuã_y
(
§c
[0],src[1],src[2]); } ;

1766 
	`STBI__CASE
(3,2Ë{ 
de°
[0]=
	`°bi__compuã_y
(
§c
[0],src[1],src[2]); dest[1] = 255; } ;

1767 
	`STBI__CASE
(4,1Ë{ 
de°
[0]=
	`°bi__compuã_y
(
§c
[0],src[1],src[2]); } ;

1768 
	`STBI__CASE
(4,2Ë{ 
de°
[0]=
	`°bi__compuã_y
(
§c
[0],src[1],src[2]); dest[1] = src[3]; } ;

1769 
	`STBI__CASE
(4,3Ë{ 
de°
[0]=
§c
[0];dest[1]=src[1];dest[2]=src[2]; } ;

1770 : 
	`STBI_ASSERT
(0); 
	`STBI_FREE
(
d©a
); STBI_FREE(
good
);  
	`°bi__îΩuc
("unsupported", "Unsupported format conversion");

1772 #unde‡
STBI__CASE


1775 
	`STBI_FREE
(
d©a
);

1776  
good
;

1777 
	}
}

1780 #i‡
deföed
(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_PSD
)

1783 
°bi__uöt16
 
	$°bi__compuã_y_16
(
r
, 
g
, 
b
)

1785  (
°bi__uöt16
Ë(((
r
*77Ë+ (
g
*150Ë+ (29*
b
)) >> 8);

1786 
	}
}

1789 #i‡
deföed
(
STBI_NO_PNG
Ë&& deföed(
STBI_NO_PSD
)

1792 
°bi__uöt16
 *
	$°bi__c⁄vît_f‹m©16
(
°bi__uöt16
 *
d©a
, 
img_n
, 
ªq_comp
, 
x
, 
y
)

1794 
i
,
j
;

1795 
°bi__uöt16
 *
good
;

1797 i‡(
ªq_comp
 =
img_n
Ë 
d©a
;

1798 
	`STBI_ASSERT
(
ªq_comp
 >= 1 &&Ñeq_comp <= 4);

1800 
good
 = (
°bi__uöt16
 *Ë
	`°bi__mÆloc
(
ªq_comp
 * 
x
 * 
y
 * 2);

1801 i‡(
good
 =
NULL
) {

1802 
	`STBI_FREE
(
d©a
);

1803  (
°bi__uöt16
 *Ë
	`°bi__îΩuc
("outofmem", "Out of memory");

1806 
j
=0; j < (Ë
y
; ++j) {

1807 
°bi__uöt16
 *
§c
 = 
d©a
 + 
j
 * 
x
 * 
img_n
 ;

1808 
°bi__uöt16
 *
de°
 = 
good
 + 
j
 * 
x
 * 
ªq_comp
;

1810 
	#STBI__COMBO
(
a
,
b
Ë(◊)*8+(b))

	)

1811 
	#STBI__CASE
(
a
,
b
Ë
	`STBI__COMBO
◊,b): 
i
=
x
-1; i >0; --i, 
§c
 +a, 
de°
 +b)

	)

1814 
	`STBI__COMBO
(
img_n
, 
ªq_comp
)) {

1815 
	`STBI__CASE
(1,2Ë{ 
de°
[0]=
§c
[0]; dest[1]=0xffff; } ;

1816 
	`STBI__CASE
(1,3Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; } ;

1817 
	`STBI__CASE
(1,4Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; dest[3]=0xffff; } ;

1818 
	`STBI__CASE
(2,1Ë{ 
de°
[0]=
§c
[0]; } ;

1819 
	`STBI__CASE
(2,3Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; } ;

1820 
	`STBI__CASE
(2,4Ë{ 
de°
[0]=de°[1]=de°[2]=
§c
[0]; dest[3]=src[1]; } ;

1821 
	`STBI__CASE
(3,4Ë{ 
de°
[0]=
§c
[0];dest[1]=src[1];dest[2]=src[2];dest[3]=0xffff; } ;

1822 
	`STBI__CASE
(3,1Ë{ 
de°
[0]=
	`°bi__compuã_y_16
(
§c
[0],src[1],src[2]); } ;

1823 
	`STBI__CASE
(3,2Ë{ 
de°
[0]=
	`°bi__compuã_y_16
(
§c
[0],src[1],src[2]); dest[1] = 0xffff; } ;

1824 
	`STBI__CASE
(4,1Ë{ 
de°
[0]=
	`°bi__compuã_y_16
(
§c
[0],src[1],src[2]); } ;

1825 
	`STBI__CASE
(4,2Ë{ 
de°
[0]=
	`°bi__compuã_y_16
(
§c
[0],src[1],src[2]); dest[1] = src[3]; } ;

1826 
	`STBI__CASE
(4,3Ë{ 
de°
[0]=
§c
[0];dest[1]=src[1];dest[2]=src[2]; } ;

1827 : 
	`STBI_ASSERT
(0); 
	`STBI_FREE
(
d©a
); STBI_FREE(
good
);  (
°bi__uöt16
*Ë
	`°bi__îΩuc
("unsupported", "Unsupported format conversion");

1829 #unde‡
STBI__CASE


1832 
	`STBI_FREE
(
d©a
);

1833  
good
;

1834 
	}
}

1837 #i‚de‡
STBI_NO_LINEAR


1838 *
	$°bi__ldr_to_hdr
(
°bi_uc
 *
d©a
, 
x
, 
y
, 
comp
)

1840 
i
,
k
,
n
;

1841 *
ouçut
;

1842 i‡(!
d©a
Ë 
NULL
;

1843 
ouçut
 = (*Ë
	`°bi__mÆloc_mad4
(
x
, 
y
, 
comp
, (), 0);

1844 i‡(
ouçut
 =
NULL
Ë{ 
	`STBI_FREE
(
d©a
);  
	`°bi__îΩf
("outofmem", "Out of memory"); }

1846 i‡(
comp
 & 1Ë
n
 = comp; n = comp-1;

1847 
i
=0; i < 
x
*
y
; ++i) {

1848 
k
=0; k < 
n
; ++k) {

1849 
ouçut
[
i
*
comp
 + 
k
] = (Ë(
	`pow
(
d©a
[i*comp+k]/255.0f, 
°bi__l2h_gamma
Ë* 
°bi__l2h_sˇÀ
);

1852 i‡(
n
 < 
comp
) {

1853 
i
=0; i < 
x
*
y
; ++i) {

1854 
ouçut
[
i
*
comp
 + 
n
] = 
d©a
[i*comp +Ç]/255.0f;

1857 
	`STBI_FREE
(
d©a
);

1858  
ouçut
;

1859 
	}
}

1862 #i‚de‡
STBI_NO_HDR


1863 
	#°bi__Êﬂt2öt
(
x
Ë((Ë(x))

	)

1864 
°bi_uc
 *
	$°bi__hdr_to_ldr
(*
d©a
, 
x
, 
y
, 
comp
)

1866 
i
,
k
,
n
;

1867 
°bi_uc
 *
ouçut
;

1868 i‡(!
d©a
Ë 
NULL
;

1869 
ouçut
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
x
, 
y
, 
comp
, 0);

1870 i‡(
ouçut
 =
NULL
Ë{ 
	`STBI_FREE
(
d©a
);  
	`°bi__îΩuc
("outofmem", "Out of memory"); }

1872 i‡(
comp
 & 1Ë
n
 = comp; n = comp-1;

1873 
i
=0; i < 
x
*
y
; ++i) {

1874 
k
=0; k < 
n
; ++k) {

1875 
z
 = (Ë
	`pow
(
d©a
[
i
*
comp
+
k
]*
°bi__h2l_sˇÀ_i
, 
°bi__h2l_gamma_i
) * 255 + 0.5f;

1876 i‡(
z
 < 0) z = 0;

1877 i‡(
z
 > 255) z = 255;

1878 
ouçut
[
i
*
comp
 + 
k
] = (
°bi_uc
Ë
	`°bi__Êﬂt2öt
(
z
);

1880 i‡(
k
 < 
comp
) {

1881 
z
 = 
d©a
[
i
*
comp
+
k
] * 255 + 0.5f;

1882 i‡(
z
 < 0) z = 0;

1883 i‡(
z
 > 255) z = 255;

1884 
ouçut
[
i
*
comp
 + 
k
] = (
°bi_uc
Ë
	`°bi__Êﬂt2öt
(
z
);

1887 
	`STBI_FREE
(
d©a
);

1888  
ouçut
;

1889 
	}
}

1913 #i‚de‡
STBI_NO_JPEG


1916 
	#FAST_BITS
 9

1917 

	)

1920 
°bi_uc
 
	mÁ°
[1 << 
FAST_BITS
];

1922 
°bi__uöt16
 
	mcode
[256];

1923 
°bi_uc
 
	mvÆues
[256];

1924 
°bi_uc
 
	msize
[257];

1925 
	mmaxcode
[18];

1926 
	mdñè
[17];

1927 } 
	t°bi__huffm™
;

1931 
°bi__c⁄ãxt
 *
	ms
;

1932 
°bi__huffm™
 
	mhuff_dc
[4];

1933 
°bi__huffm™
 
	mhuff_ac
[4];

1934 
°bi__uöt16
 
	mdequ™t
[4][64];

1935 
°bi__öt16
 
	mÁ°_ac
[4][1 << 
FAST_BITS
];

1938 
	mimg_h_max
, 
	mimg_v_max
;

1939 
	mimg_mcu_x
, 
	mimg_mcu_y
;

1940 
	mimg_mcu_w
, 
	mimg_mcu_h
;

1945 
	mid
;

1946 
	mh
,
	mv
;

1947 
	mtq
;

1948 
	mhd
,
	mha
;

1949 
	mdc_¥ed
;

1951 
	mx
,
	my
,
	mw2
,
	mh2
;

1952 
°bi_uc
 *
	md©a
;

1953 *
	møw_d©a
, *
	møw_c€ff
;

1954 
°bi_uc
 *
	mlöebuf
;

1955 *
	mc€ff
;

1956 
	mc€ff_w
, 
	mc€ff_h
;

1957 } 
	mimg_comp
[4];

1959 
°bi__uöt32
 
	mcode_buf„r
;

1960 
	mcode_bôs
;

1961 
	mm¨kî
;

1962 
	mnom‹e
;

1964 
	m¥ogªssive
;

1965 
	m•ec_°¨t
;

1966 
	m•ec_íd
;

1967 
	msucc_high
;

1968 
	msucc_low
;

1969 
	meob_run
;

1970 
	mjfif
;

1971 
	m≠p14_cﬁ‹_å™sf‹m
;

1972 
	mrgb
;

1974 
	msˇn_n
, 
	m‹dî
[4];

1975 
	mª°¨t_öãrvÆ
, 
	mtodo
;

1978 (*
	mid˘_block_kî√l
)(
°bi_uc
 *
	mout
, 
	mout_°ride
, 
	md©a
[64]);

1979 (*
	mYCbCr_to_RGB_kî√l
)(
°bi_uc
 *
	mout
, c⁄° stbi_u¯*
	my
, c⁄° stbi_u¯*
	mpcb
, c⁄° stbi_u¯*
	mp¸
, 
	mcou¡
, 
	m°ï
);

1980 
	m°bi_uc
 *(*
	mªßm∂e_row_hv_2_kî√l
)(
°bi_uc
 *
	mout
, stbi_u¯*
	mö_√¨
, stbi_u¯*
	mö_Ár
, 
	mw
, 
	mhs
);

1981 } 
	t°bi__j≥g
;

1983 
	$°bi__buûd_huffm™
(
°bi__huffm™
 *
h
, *
cou¡
)

1985 
i
,
j
,
k
=0;

1986 
code
;

1988 
i
=0; i < 16; ++i)

1989 
j
=0; j < 
cou¡
[
i
]; ++j)

1990 
h
->
size
[
k
++] = (
°bi_uc
Ë(
i
+1);

1991 
h
->
size
[
k
] = 0;

1994 
code
 = 0;

1995 
k
 = 0;

1996 
j
=1; j <= 16; ++j) {

1998 
h
->
dñè
[
j
] = 
k
 - 
code
;

1999 i‡(
h
->
size
[
k
] =
j
) {

2000 
h
->
size
[
k
] =
j
)

2001 
h
->
code
[
k
++] = (
°bi__uöt16
) (code++);

2002 i‡(
code
-1 >(1u << 
j
)Ë 
	`°bi__îr
("bad codeÜengths","Corrupt JPEG");

2005 
h
->
maxcode
[
j
] = 
code
 << (16-j);

2006 
code
 <<= 1;

2008 
h
->
maxcode
[
j
] = 0xffffffff;

2011 
	`mem£t
(
h
->
Á°
, 255, 1 << 
FAST_BITS
);

2012 
i
=0; i < 
k
; ++i) {

2013 
s
 = 
h
->
size
[
i
];

2014 i‡(
s
 <
FAST_BITS
) {

2015 
c
 = 
h
->
code
[
i
] << (
FAST_BITS
-
s
);

2016 
m
 = 1 << (
FAST_BITS
-
s
);

2017 
j
=0; j < 
m
; ++j) {

2018 
h
->
Á°
[
c
+
j
] = (
°bi_uc
Ë
i
;

2023 
	}
}

2027 
	$°bi__buûd_Á°_ac
(
°bi__öt16
 *
Á°_ac
, 
°bi__huffm™
 *
h
)

2029 
i
;

2030 
i
=0; i < (1 << 
FAST_BITS
); ++i) {

2031 
°bi_uc
 
Á°
 = 
h
->Á°[
i
];

2032 
Á°_ac
[
i
] = 0;

2033 i‡(
Á°
 < 255) {

2034 
rs
 = 
h
->
vÆues
[
Á°
];

2035 
run
 = (
rs
 >> 4) & 15;

2036 
magbôs
 = 
rs
 & 15;

2037 
Àn
 = 
h
->
size
[
Á°
];

2039 i‡(
magbôs
 && 
Àn
 + magbô†<
FAST_BITS
) {

2041 
k
 = ((
i
 << 
Àn
Ë& ((1 << 
FAST_BITS
Ë- 1)Ë>> (FAST_BITS - 
magbôs
);

2042 
m
 = 1 << (
magbôs
 - 1);

2043 i‡(
k
 < 
m
Ëk +(~0U << 
magbôs
) + 1;

2045 i‡(
k
 >= -128 && k <= 127)

2046 
Á°_ac
[
i
] = (
°bi__öt16
Ë((
k
 * 256Ë+ (
run
 * 16Ë+ (
Àn
 + 
magbôs
));

2050 
	}
}

2052 
	$°bi__grow_buf„r_unß„
(
°bi__j≥g
 *
j
)

2055 
b
 = 
j
->
nom‹e
 ? 0 : 
	`°bi__gë8
(j->
s
);

2056 i‡(
b
 == 0xff) {

2057 
c
 = 
	`°bi__gë8
(
j
->
s
);

2058 
c
 =0xffË¯
	`°bi__gë8
(
j
->
s
);

2059 i‡(
c
 != 0) {

2060 
j
->
m¨kî
 = (Ë
c
;

2061 
j
->
nom‹e
 = 1;

2065 
j
->
code_buf„r
 |
b
 << (24 - j->
code_bôs
);

2066 
j
->
code_bôs
 += 8;

2067 } 
j
->
code_bôs
 <= 24);

2068 
	}
}

2071 c⁄° 
°bi__uöt32
 
	g°bi__bmask
[17]={0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535};

2074 
°bi_ölöe
 
	$°bi__j≥g_huff_decode
(
°bi__j≥g
 *
j
, 
°bi__huffm™
 *
h
)

2076 
ãmp
;

2077 
c
,
k
;

2079 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2083 
c
 = (
j
->
code_buf„r
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

2084 
k
 = 
h
->
Á°
[
c
];

2085 i‡(
k
 < 255) {

2086 
s
 = 
h
->
size
[
k
];

2087 i‡(
s
 > 
j
->
code_bôs
)

2089 
j
->
code_buf„r
 <<
s
;

2090 
j
->
code_bôs
 -
s
;

2091  
h
->
vÆues
[
k
];

2100 
ãmp
 = 
j
->
code_buf„r
 >> 16;

2101 
k
=
FAST_BITS
+1 ; ; ++k)

2102 i‡(
ãmp
 < 
h
->
maxcode
[
k
])

2104 i‡(
k
 == 17) {

2106 
j
->
code_bôs
 -= 16;

2110 i‡(
k
 > 
j
->
code_bôs
)

2114 
c
 = ((
j
->
code_buf„r
 >> (32 - 
k
)Ë& 
°bi__bmask
[k]Ë+ 
h
->
dñè
[k];

2115 
	`STBI_ASSERT
((((
j
->
code_buf„r
Ë>> (32 - 
h
->
size
[
c
])Ë& 
°bi__bmask
[h->size[c]]Ë=h->
code
[c]);

2118 
j
->
code_bôs
 -
k
;

2119 
j
->
code_buf„r
 <<
k
;

2120  
h
->
vÆues
[
c
];

2121 
	}
}

2124 c⁄° 
	g°bi__jbüs
[16] = {0,-1,-3,-7,-15,-31,-63,-127,-255,-511,-1023,-2047,-4095,-8191,-16383,-32767};

2128 
°bi_ölöe
 
	$°bi__exãnd_ª˚ive
(
°bi__j≥g
 *
j
, 
n
)

2130 
k
;

2131 
sgn
;

2132 i‡(
j
->
code_bôs
 < 
n
Ë
	`°bi__grow_buf„r_unß„
(j);

2134 
sgn
 = 
j
->
code_buf„r
 >> 31;

2135 
k
 = 
	`°bi_ÃŸ
(
j
->
code_buf„r
, 
n
);

2136 
j
->
code_buf„r
 = 
k
 & ~
°bi__bmask
[
n
];

2137 
k
 &
°bi__bmask
[
n
];

2138 
j
->
code_bôs
 -
n
;

2139  
k
 + (
°bi__jbüs
[
n
] & (
sgn
 - 1));

2140 
	}
}

2143 
°bi_ölöe
 
	$°bi__j≥g_gë_bôs
(
°bi__j≥g
 *
j
, 
n
)

2145 
k
;

2146 i‡(
j
->
code_bôs
 < 
n
Ë
	`°bi__grow_buf„r_unß„
(j);

2147 
k
 = 
	`°bi_ÃŸ
(
j
->
code_buf„r
, 
n
);

2148 
j
->
code_buf„r
 = 
k
 & ~
°bi__bmask
[
n
];

2149 
k
 &
°bi__bmask
[
n
];

2150 
j
->
code_bôs
 -
n
;

2151  
k
;

2152 
	}
}

2154 
°bi_ölöe
 
	$°bi__j≥g_gë_bô
(
°bi__j≥g
 *
j
)

2156 
k
;

2157 i‡(
j
->
code_bôs
 < 1Ë
	`°bi__grow_buf„r_unß„
(j);

2158 
k
 = 
j
->
code_buf„r
;

2159 
j
->
code_buf„r
 <<= 1;

2160 --
j
->
code_bôs
;

2161  
k
 & 0x80000000;

2162 
	}
}

2166 c⁄° 
°bi_uc
 
	g°bi__j≥g_dezigzag
[64+15] =

2182 
	$°bi__j≥g_decode_block
(
°bi__j≥g
 *
j
, 
d©a
[64], 
°bi__huffm™
 *
hdc
, stbi__huffm™ *
hac
, 
°bi__öt16
 *
Ác
, 
b
, 
°bi__uöt16
 *
dequ™t
)

2184 
diff
,
dc
,
k
;

2185 
t
;

2187 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2188 
t
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hdc
);

2189 i‡(
t
 < 0 ||Å > 15Ë 
	`°bi__îr
("bad huffman code","Corrupt JPEG");

2192 
	`mem£t
(
d©a
,0,64*(data[0]));

2194 
diff
 = 
t
 ? 
	`°bi__exãnd_ª˚ive
(
j
,Å) : 0;

2195 
dc
 = 
j
->
img_comp
[
b
].
dc_¥ed
 + 
diff
;

2196 
j
->
img_comp
[
b
].
dc_¥ed
 = 
dc
;

2197 
d©a
[0] = (Ë(
dc
 * 
dequ™t
[0]);

2200 
k
 = 1;

2202 
zig
;

2203 
c
,
r
,
s
;

2204 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2205 
c
 = (
j
->
code_buf„r
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

2206 
r
 = 
Ác
[
c
];

2207 i‡(
r
) {

2208 
k
 +(
r
 >> 4) & 15;

2209 
s
 = 
r
 & 15;

2210 
j
->
code_buf„r
 <<
s
;

2211 
j
->
code_bôs
 -
s
;

2213 
zig
 = 
°bi__j≥g_dezigzag
[
k
++];

2214 
d©a
[
zig
] = (Ë((
r
 >> 8Ë* 
dequ™t
[zig]);

2216 
rs
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hac
);

2217 i‡(
rs
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt JPEG");

2218 
s
 = 
rs
 & 15;

2219 
r
 = 
rs
 >> 4;

2220 i‡(
s
 == 0) {

2221 i‡(
rs
 != 0xf0) ;

2222 
k
 += 16;

2224 
k
 +
r
;

2226 
zig
 = 
°bi__j≥g_dezigzag
[
k
++];

2227 
d©a
[
zig
] = (Ë(
	`°bi__exãnd_ª˚ive
(
j
,
s
Ë* 
dequ™t
[zig]);

2230 } 
k
 < 64);

2232 
	}
}

2234 
	$°bi__j≥g_decode_block_¥og_dc
(
°bi__j≥g
 *
j
, 
d©a
[64], 
°bi__huffm™
 *
hdc
, 
b
)

2236 
diff
,
dc
;

2237 
t
;

2238 i‡(
j
->
•ec_íd
 !0Ë 
	`°bi__îr
("can't merge dcándác", "Corrupt JPEG");

2240 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2242 i‡(
j
->
succ_high
 == 0) {

2244 
	`mem£t
(
d©a
,0,64*(data[0]));

2245 
t
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hdc
);

2246 i‡(
t
 < 0 ||Å > 15Ë 
	`°bi__îr
("can't merge dcándác", "Corrupt JPEG");

2247 
diff
 = 
t
 ? 
	`°bi__exãnd_ª˚ive
(
j
,Å) : 0;

2249 
dc
 = 
j
->
img_comp
[
b
].
dc_¥ed
 + 
diff
;

2250 
j
->
img_comp
[
b
].
dc_¥ed
 = 
dc
;

2251 
d©a
[0] = (Ë(
dc
 * (1 << 
j
->
succ_low
));

2254 i‡(
	`°bi__j≥g_gë_bô
(
j
))

2255 
d©a
[0] +(Ë(1 << 
j
->
succ_low
);

2258 
	}
}

2262 
	$°bi__j≥g_decode_block_¥og_ac
(
°bi__j≥g
 *
j
, 
d©a
[64], 
°bi__huffm™
 *
hac
, 
°bi__öt16
 *
Ác
)

2264 
k
;

2265 i‡(
j
->
•ec_°¨t
 =0Ë 
	`°bi__îr
("can't merge dcándác", "Corrupt JPEG");

2267 i‡(
j
->
succ_high
 == 0) {

2268 
shi·
 = 
j
->
succ_low
;

2270 i‡(
j
->
eob_run
) {

2271 --
j
->
eob_run
;

2275 
k
 = 
j
->
•ec_°¨t
;

2277 
zig
;

2278 
c
,
r
,
s
;

2279 i‡(
j
->
code_bôs
 < 16Ë
	`°bi__grow_buf„r_unß„
(j);

2280 
c
 = (
j
->
code_buf„r
 >> (32 - 
FAST_BITS
)) & ((1 << FAST_BITS)-1);

2281 
r
 = 
Ác
[
c
];

2282 i‡(
r
) {

2283 
k
 +(
r
 >> 4) & 15;

2284 
s
 = 
r
 & 15;

2285 
j
->
code_buf„r
 <<
s
;

2286 
j
->
code_bôs
 -
s
;

2287 
zig
 = 
°bi__j≥g_dezigzag
[
k
++];

2288 
d©a
[
zig
] = (Ë((
r
 >> 8Ë* (1 << 
shi·
));

2290 
rs
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hac
);

2291 i‡(
rs
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt JPEG");

2292 
s
 = 
rs
 & 15;

2293 
r
 = 
rs
 >> 4;

2294 i‡(
s
 == 0) {

2295 i‡(
r
 < 15) {

2296 
j
->
eob_run
 = (1 << 
r
);

2297 i‡(
r
)

2298 
j
->
eob_run
 +
	`°bi__j≥g_gë_bôs
(j, 
r
);

2299 --
j
->
eob_run
;

2302 
k
 += 16;

2304 
k
 +
r
;

2305 
zig
 = 
°bi__j≥g_dezigzag
[
k
++];

2306 
d©a
[
zig
] = (Ë(
	`°bi__exãnd_ª˚ive
(
j
,
s
Ë* (1 << 
shi·
));

2309 } 
k
 <
j
->
•ec_íd
);

2313 
bô
 = (Ë(1 << 
j
->
succ_low
);

2315 i‡(
j
->
eob_run
) {

2316 --
j
->
eob_run
;

2317 
k
 = 
j
->
•ec_°¨t
; k <j->
•ec_íd
; ++k) {

2318 *
p
 = &
d©a
[
°bi__j≥g_dezigzag
[
k
]];

2319 i‡(*
p
 != 0)

2320 i‡(
	`°bi__j≥g_gë_bô
(
j
))

2321 i‡((*
p
 & 
bô
)==0) {

2322 i‡(*
p
 > 0)

2323 *
p
 +
bô
;

2325 *
p
 -
bô
;

2329 
k
 = 
j
->
•ec_°¨t
;

2331 
r
,
s
;

2332 
rs
 = 
	`°bi__j≥g_huff_decode
(
j
, 
hac
);

2333 i‡(
rs
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt JPEG");

2334 
s
 = 
rs
 & 15;

2335 
r
 = 
rs
 >> 4;

2336 i‡(
s
 == 0) {

2337 i‡(
r
 < 15) {

2338 
j
->
eob_run
 = (1 << 
r
) - 1;

2339 i‡(
r
)

2340 
j
->
eob_run
 +
	`°bi__j≥g_gë_bôs
(j, 
r
);

2341 
r
 = 64;

2348 i‡(
s
 !1Ë 
	`°bi__îr
("bad huffman code", "Corrupt JPEG");

2350 i‡(
	`°bi__j≥g_gë_bô
(
j
))

2351 
s
 = 
bô
;

2353 
s
 = -
bô
;

2357 
k
 <
j
->
•ec_íd
) {

2358 *
p
 = &
d©a
[
°bi__j≥g_dezigzag
[
k
++]];

2359 i‡(*
p
 != 0) {

2360 i‡(
	`°bi__j≥g_gë_bô
(
j
))

2361 i‡((*
p
 & 
bô
)==0) {

2362 i‡(*
p
 > 0)

2363 *
p
 +
bô
;

2365 *
p
 -
bô
;

2368 i‡(
r
 == 0) {

2369 *
p
 = (Ë
s
;

2372 --
r
;

2375 } 
k
 <
j
->
•ec_íd
);

2379 
	}
}

2382 
°bi_ölöe
 
°bi_uc
 
	$°bi__˛amp
(
x
)

2385 i‡((Ë
x
 > 255) {

2386 i‡(
x
 < 0)  0;

2387 i‡(
x
 > 255)  255;

2389  (
°bi_uc
Ë
x
;

2390 
	}
}

2392 
	#°bi__f2f
(
x
Ë((Ë(((xË* 4096 + 0.5)))

	)

2393 
	#°bi__fsh
(
x
Ë((xË* 4096)

	)

2396 
	#STBI__IDCT_1D
(
s0
,
s1
,
s2
,
s3
,
s4
,
s5
,
s6
,
s7
) \

2397 
t0
,
t1
,
t2
,
t3
,
p1
,
p2
,
p3
,
p4
,
p5
,
x0
,
x1
,
x2
,
x3
; \

2398 
p2
 = 
s2
; \

2399 
p3
 = 
s6
; \

2400 
p1
 = (
p2
+
p3
Ë* 
	`°bi__f2f
(0.5411961f); \

2401 
t2
 = 
p1
 + 
p3
*
	`°bi__f2f
(-1.847759065f); \

2402 
t3
 = 
p1
 + 
p2
*
	`°bi__f2f
( 0.765366865f); \

2403 
p2
 = 
s0
; \

2404 
p3
 = 
s4
; \

2405 
t0
 = 
	`°bi__fsh
(
p2
+
p3
); \

2406 
t1
 = 
	`°bi__fsh
(
p2
-
p3
); \

2407 
x0
 = 
t0
+
t3
; \

2408 
x3
 = 
t0
-
t3
; \

2409 
x1
 = 
t1
+
t2
; \

2410 
x2
 = 
t1
-
t2
; \

2411 
t0
 = 
s7
; \

2412 
t1
 = 
s5
; \

2413 
t2
 = 
s3
; \

2414 
t3
 = 
s1
; \

2415 
p3
 = 
t0
+
t2
; \

2416 
p4
 = 
t1
+
t3
; \

2417 
p1
 = 
t0
+
t3
; \

2418 
p2
 = 
t1
+
t2
; \

2419 
p5
 = (
p3
+
p4
)*
	`°bi__f2f
( 1.175875602f); \

2420 
t0
 =Å0*
	`°bi__f2f
( 0.298631336f); \

2421 
t1
 =Å1*
	`°bi__f2f
( 2.053119869f); \

2422 
t2
 =Å2*
	`°bi__f2f
( 3.072711026f); \

2423 
t3
 =Å3*
	`°bi__f2f
( 1.501321110f); \

2424 
p1
 = 
p5
 +Ö1*
	`°bi__f2f
(-0.899976223f); \

2425 
p2
 = 
p5
 +Ö2*
	`°bi__f2f
(-2.562915447f); \

2426 
p3
 =Ö3*
	`°bi__f2f
(-1.961570560f); \

2427 
p4
 =Ö4*
	`°bi__f2f
(-0.390180644f); \

2428 
t3
 +
p1
+
p4
; \

2429 
t2
 +
p2
+
p3
; \

2430 
t1
 +
p2
+
p4
; \

2431 
t0
 +
p1
+
p3
;

	)

2433 
	$°bi__id˘_block
(
°bi_uc
 *
out
, 
out_°ride
, 
d©a
[64])

2435 
i
,
vÆ
[64],*
v
=val;

2436 
°bi_uc
 *
o
;

2437 *
d
 = 
d©a
;

2440 
i
=0; i < 8; ++i,++
d
, ++
v
) {

2442 i‡(
d
[ 8]==0 && d[16]==0 && d[24]==0 && d[32]==0

2443 && 
d
[40]==0 && d[48]==0 && d[56]==0) {

2448 
d˘îm
 = 
d
[0]*4;

2449 
v
[0] = v[8] = v[16] = v[24] = v[32] = v[40] = v[48] = v[56] = 
d˘îm
;

2451 
	`STBI__IDCT_1D
(
d
[ 0],d[ 8],d[16],d[24],d[32],d[40],d[48],d[56])

2454 
x0
 +512; 
x1
 +512; 
x2
 +512; 
x3
 += 512;

2455 
v
[ 0] = (
x0
+
t3
) >> 10;

2456 
v
[56] = (
x0
-
t3
) >> 10;

2457 
v
[ 8] = (
x1
+
t2
) >> 10;

2458 
v
[48] = (
x1
-
t2
) >> 10;

2459 
v
[16] = (
x2
+
t1
) >> 10;

2460 
v
[40] = (
x2
-
t1
) >> 10;

2461 
v
[24] = (
x3
+
t0
) >> 10;

2462 
v
[32] = (
x3
-
t0
) >> 10;

2466 
i
=0, 
v
=
vÆ
, 
o
=
out
; i < 8; ++i,v+=8,o+=
out_°ride
) {

2468 
	`STBI__IDCT_1D
(
v
[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7])

2475 
x0
 += 65536 + (128<<17);

2476 
x1
 += 65536 + (128<<17);

2477 
x2
 += 65536 + (128<<17);

2478 
x3
 += 65536 + (128<<17);

2481 
o
[0] = 
	`°bi__˛amp
((
x0
+
t3
) >> 17);

2482 
o
[7] = 
	`°bi__˛amp
((
x0
-
t3
) >> 17);

2483 
o
[1] = 
	`°bi__˛amp
((
x1
+
t2
) >> 17);

2484 
o
[6] = 
	`°bi__˛amp
((
x1
-
t2
) >> 17);

2485 
o
[2] = 
	`°bi__˛amp
((
x2
+
t1
) >> 17);

2486 
o
[5] = 
	`°bi__˛amp
((
x2
-
t1
) >> 17);

2487 
o
[3] = 
	`°bi__˛amp
((
x3
+
t0
) >> 17);

2488 
o
[4] = 
	`°bi__˛amp
((
x3
-
t0
) >> 17);

2490 
	}
}

2492 #ifde‡
STBI_SSE2


2496 
	$°bi__id˘_simd
(
°bi_uc
 *
out
, 
out_°ride
, 
d©a
[64])

2499 
__m128i
 
row0
, 
row1
, 
row2
, 
row3
, 
row4
, 
row5
, 
row6
, 
row7
;

2500 
__m128i
 
tmp
;

2503 
	#d˘_c⁄°
(
x
,
y
Ë
	`_mm_£å_ïi16
((x),(y),(x),(y),(x),(y),(x),(y))

	)

2507 
	#d˘_rŸ
(
out0
,
out1
, 
x
,
y
,
c0
,
c1
) \

2508 
__m128i
 
c0
##
lo
 = 
	`_mm_u≈acklo_ïi16
((
x
),(
y
)); \

2509 
__m128i
 
c0
##
hi
 = 
	`_mm_u≈ackhi_ïi16
((
x
),(
y
)); \

2510 
__m128i
 
out0
##
_l
 = 
	`_mm_madd_ïi16
(
c0
##
lo
, c0); \

2511 
__m128i
 
out0
##
_h
 = 
	`_mm_madd_ïi16
(
c0
##
hi
, c0); \

2512 
__m128i
 
out1
##
_l
 = 
	`_mm_madd_ïi16
(
c0
##
lo
, 
c1
); \

2513 
__m128i
 
out1
##
_h
 = 
	`_mm_madd_ïi16
(
c0
##
hi
, 
c1
)

	)

2516 
	#d˘_widí
(
out
, 
ö
) \

2517 
__m128i
 
out
##
_l
 = 
	`_mm_§ai_ïi32
(
	`_mm_u≈acklo_ïi16
(
	`_mm_£tzîo_si128
(), (
ö
)), 4); \

2518 
__m128i
 
out
##
_h
 = 
	`_mm_§ai_ïi32
(
	`_mm_u≈ackhi_ïi16
(
	`_mm_£tzîo_si128
(), (
ö
)), 4)

	)

2521 
	#d˘_wadd
(
out
, 
a
, 
b
) \

2522 
__m128i
 
out
##
_l
 = 
	`_mm_add_ïi32
(
a
##_l, 
b
##_l); \

2523 
__m128i
 
out
##
_h
 = 
	`_mm_add_ïi32
(
a
##_h, 
b
##_h)

	)

2526 
	#d˘_wsub
(
out
, 
a
, 
b
) \

2527 
__m128i
 
out
##
_l
 = 
	`_mm_sub_ïi32
(
a
##_l, 
b
##_l); \

2528 
__m128i
 
out
##
_h
 = 
	`_mm_sub_ïi32
(
a
##_h, 
b
##_h)

	)

2531 
	#d˘_bÊy32o
(
out0
, 
out1
, 
a
,
b
,
büs
,
s
) \

2533 
__m128i
 
abü£d_l
 = 
	`_mm_add_ïi32
(
a
##
_l
, 
büs
); \

2534 
__m128i
 
abü£d_h
 = 
	`_mm_add_ïi32
(
a
##
_h
, 
büs
); \

2535 
	`d˘_wadd
(
sum
, 
abü£d
, 
b
); \

2536 
	`d˘_wsub
(
dif
, 
abü£d
, 
b
); \

2537 
out0
 = 
	`_mm_∑cks_ïi32
(
	`_mm_§ai_ïi32
(
sum_l
, 
s
), _mm_§ai_ïi32(
sum_h
, s)); \

2538 
out1
 = 
	`_mm_∑cks_ïi32
(
	`_mm_§ai_ïi32
(
dif_l
, 
s
), _mm_§ai_ïi32(
dif_h
, s)); \

2539 }

	)

2542 
	#d˘_öãæóve8
(
a
, 
b
) \

2543 
tmp
 = 
a
; \

2544 
a
 = 
	`_mm_u≈acklo_ïi8
◊, 
b
); \

2545 
b
 = 
	`_mm_u≈ackhi_ïi8
(
tmp
, b)

	)

2548 
	#d˘_öãæóve16
(
a
, 
b
) \

2549 
tmp
 = 
a
; \

2550 
a
 = 
	`_mm_u≈acklo_ïi16
◊, 
b
); \

2551 
b
 = 
	`_mm_u≈ackhi_ïi16
(
tmp
, b)

	)

2553 
	#d˘_∑ss
(
büs
,
shi·
) \

2556 
	`d˘_rŸ
(
t2e
,
t3e
, 
row2
,
row6
, 
rŸ0_0
,
rŸ0_1
); \

2557 
__m128i
 
sum04
 = 
	`_mm_add_ïi16
(
row0
, 
row4
); \

2558 
__m128i
 
dif04
 = 
	`_mm_sub_ïi16
(
row0
, 
row4
); \

2559 
	`d˘_widí
(
t0e
, 
sum04
); \

2560 
	`d˘_widí
(
t1e
, 
dif04
); \

2561 
	`d˘_wadd
(
x0
, 
t0e
, 
t3e
); \

2562 
	`d˘_wsub
(
x3
, 
t0e
, 
t3e
); \

2563 
	`d˘_wadd
(
x1
, 
t1e
, 
t2e
); \

2564 
	`d˘_wsub
(
x2
, 
t1e
, 
t2e
); \

2566 
	`d˘_rŸ
(
y0o
,
y2o
, 
row7
,
row3
, 
rŸ2_0
,
rŸ2_1
); \

2567 
	`d˘_rŸ
(
y1o
,
y3o
, 
row5
,
row1
, 
rŸ3_0
,
rŸ3_1
); \

2568 
__m128i
 
sum17
 = 
	`_mm_add_ïi16
(
row1
, 
row7
); \

2569 
__m128i
 
sum35
 = 
	`_mm_add_ïi16
(
row3
, 
row5
); \

2570 
	`d˘_rŸ
(
y4o
,
y5o
, 
sum17
,
sum35
, 
rŸ1_0
,
rŸ1_1
); \

2571 
	`d˘_wadd
(
x4
, 
y0o
, 
y4o
); \

2572 
	`d˘_wadd
(
x5
, 
y1o
, 
y5o
); \

2573 
	`d˘_wadd
(
x6
, 
y2o
, 
y5o
); \

2574 
	`d˘_wadd
(
x7
, 
y3o
, 
y4o
); \

2575 
	`d˘_bÊy32o
(
row0
,
row7
, 
x0
,
x7
,
büs
,
shi·
); \

2576 
	`d˘_bÊy32o
(
row1
,
row6
, 
x1
,
x6
,
büs
,
shi·
); \

2577 
	`d˘_bÊy32o
(
row2
,
row5
, 
x2
,
x5
,
büs
,
shi·
); \

2578 
	`d˘_bÊy32o
(
row3
,
row4
, 
x3
,
x4
,
büs
,
shi·
); \

2579 }

	)

2581 
__m128i
 
rŸ0_0
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(0.5411961f), stbi__f2f(0.5411961f) + stbi__f2f(-1.847759065f));

2582 
__m128i
 
rŸ0_1
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(0.5411961f) + stbi__f2f( 0.765366865f), stbi__f2f(0.5411961f));

2583 
__m128i
 
rŸ1_0
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(1.175875602f) + stbi__f2f(-0.899976223f), stbi__f2f(1.175875602f));

2584 
__m128i
 
rŸ1_1
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(1.175875602f), stbi__f2f(1.175875602f) + stbi__f2f(-2.562915447f));

2585 
__m128i
 
rŸ2_0
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(-1.961570560f) + stbi__f2f( 0.298631336f), stbi__f2f(-1.961570560f));

2586 
__m128i
 
rŸ2_1
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(-1.961570560f), stbi__f2f(-1.961570560f) + stbi__f2f( 3.072711026f));

2587 
__m128i
 
rŸ3_0
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(-0.390180644f) + stbi__f2f( 2.053119869f), stbi__f2f(-0.390180644f));

2588 
__m128i
 
rŸ3_1
 = 
	`d˘_c⁄°
(
	`°bi__f2f
(-0.390180644f), stbi__f2f(-0.390180644f) + stbi__f2f( 1.501321110f));

2591 
__m128i
 
büs_0
 = 
	`_mm_£t1_ïi32
(512);

2592 
__m128i
 
büs_1
 = 
	`_mm_£t1_ïi32
(65536 + (128<<17));

2595 
row0
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 0*8));

2596 
row1
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 1*8));

2597 
row2
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 2*8));

2598 
row3
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 3*8));

2599 
row4
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 4*8));

2600 
row5
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 5*8));

2601 
row6
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 6*8));

2602 
row7
 = 
	`_mm_lﬂd_si128
((c⁄° 
__m128i
 *Ë(
d©a
 + 7*8));

2605 
	`d˘_∑ss
(
büs_0
, 10);

2609 
	`d˘_öãæóve16
(
row0
, 
row4
);

2610 
	`d˘_öãæóve16
(
row1
, 
row5
);

2611 
	`d˘_öãæóve16
(
row2
, 
row6
);

2612 
	`d˘_öãæóve16
(
row3
, 
row7
);

2615 
	`d˘_öãæóve16
(
row0
, 
row2
);

2616 
	`d˘_öãæóve16
(
row1
, 
row3
);

2617 
	`d˘_öãæóve16
(
row4
, 
row6
);

2618 
	`d˘_öãæóve16
(
row5
, 
row7
);

2621 
	`d˘_öãæóve16
(
row0
, 
row1
);

2622 
	`d˘_öãæóve16
(
row2
, 
row3
);

2623 
	`d˘_öãæóve16
(
row4
, 
row5
);

2624 
	`d˘_öãæóve16
(
row6
, 
row7
);

2628 
	`d˘_∑ss
(
büs_1
, 17);

2632 
__m128i
 
p0
 = 
	`_mm_∑ckus_ïi16
(
row0
, 
row1
);

2633 
__m128i
 
p1
 = 
	`_mm_∑ckus_ïi16
(
row2
, 
row3
);

2634 
__m128i
 
p2
 = 
	`_mm_∑ckus_ïi16
(
row4
, 
row5
);

2635 
__m128i
 
p3
 = 
	`_mm_∑ckus_ïi16
(
row6
, 
row7
);

2638 
	`d˘_öãæóve8
(
p0
, 
p2
);

2639 
	`d˘_öãæóve8
(
p1
, 
p3
);

2642 
	`d˘_öãæóve8
(
p0
, 
p1
);

2643 
	`d˘_öãæóve8
(
p2
, 
p3
);

2646 
	`d˘_öãæóve8
(
p0
, 
p2
);

2647 
	`d˘_öãæóve8
(
p1
, 
p3
);

2650 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
p0
); ouà+
out_°ride
;

2651 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
	`_mm_shufÊe_ïi32
(
p0
, 0x4e)); ouà+
out_°ride
;

2652 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
p2
); ouà+
out_°ride
;

2653 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
	`_mm_shufÊe_ïi32
(
p2
, 0x4e)); ouà+
out_°ride
;

2654 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
p1
); ouà+
out_°ride
;

2655 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
	`_mm_shufÊe_ïi32
(
p1
, 0x4e)); ouà+
out_°ride
;

2656 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
p3
); ouà+
out_°ride
;

2657 
	`_mm_°‹ñ_ïi64
((
__m128i
 *Ë
out
, 
	`_mm_shufÊe_ïi32
(
p3
, 0x4e));

2660 #unde‡
d˘_c⁄°


2661 #unde‡
d˘_rŸ


2662 #unde‡
d˘_widí


2663 #unde‡
d˘_wadd


2664 #unde‡
d˘_wsub


2665 #unde‡
d˘_bÊy32o


2666 #unde‡
d˘_öãæóve8


2667 #unde‡
d˘_öãæóve16


2668 #unde‡
d˘_∑ss


2669 
	}
}

2673 #ifde‡
STBI_NEON


2677 
	$°bi__id˘_simd
(
°bi_uc
 *
out
, 
out_°ride
, 
d©a
[64])

2679 
öt16x8_t
 
row0
, 
row1
, 
row2
, 
row3
, 
row4
, 
row5
, 
row6
, 
row7
;

2681 
öt16x4_t
 
rŸ0_0
 = 
	`vdup_n_s16
(
	`°bi__f2f
(0.5411961f));

2682 
öt16x4_t
 
rŸ0_1
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-1.847759065f));

2683 
öt16x4_t
 
rŸ0_2
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 0.765366865f));

2684 
öt16x4_t
 
rŸ1_0
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 1.175875602f));

2685 
öt16x4_t
 
rŸ1_1
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-0.899976223f));

2686 
öt16x4_t
 
rŸ1_2
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-2.562915447f));

2687 
öt16x4_t
 
rŸ2_0
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-1.961570560f));

2688 
öt16x4_t
 
rŸ2_1
 = 
	`vdup_n_s16
(
	`°bi__f2f
(-0.390180644f));

2689 
öt16x4_t
 
rŸ3_0
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 0.298631336f));

2690 
öt16x4_t
 
rŸ3_1
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 2.053119869f));

2691 
öt16x4_t
 
rŸ3_2
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 3.072711026f));

2692 
öt16x4_t
 
rŸ3_3
 = 
	`vdup_n_s16
(
	`°bi__f2f
( 1.501321110f));

2694 
	#d˘_l⁄g_mul
(
out
, 
öq
, 
c€ff
) \

2695 
öt32x4_t
 
out
##
_l
 = 
	`vmuŒ_s16
(
	`vgë_low_s16
(
öq
), 
c€ff
); \

2696 
öt32x4_t
 
out
##
_h
 = 
	`vmuŒ_s16
(
	`vgë_high_s16
(
öq
), 
c€ff
)

	)

2698 
	#d˘_l⁄g_mac
(
out
, 
acc
, 
öq
, 
c€ff
) \

2699 
öt32x4_t
 
out
##
_l
 = 
	`vmœl_s16
(
acc
##_l, 
	`vgë_low_s16
(
öq
), 
c€ff
); \

2700 
öt32x4_t
 
out
##
_h
 = 
	`vmœl_s16
(
acc
##_h, 
	`vgë_high_s16
(
öq
), 
c€ff
)

	)

2702 
	#d˘_widí
(
out
, 
öq
) \

2703 
öt32x4_t
 
out
##
_l
 = 
	`vshŒ_n_s16
(
	`vgë_low_s16
(
öq
), 12); \

2704 
öt32x4_t
 
out
##
_h
 = 
	`vshŒ_n_s16
(
	`vgë_high_s16
(
öq
), 12)

	)

2707 
	#d˘_wadd
(
out
, 
a
, 
b
) \

2708 
öt32x4_t
 
out
##
_l
 = 
	`vaddq_s32
(
a
##_l, 
b
##_l); \

2709 
öt32x4_t
 
out
##
_h
 = 
	`vaddq_s32
(
a
##_h, 
b
##_h)

	)

2712 
	#d˘_wsub
(
out
, 
a
, 
b
) \

2713 
öt32x4_t
 
out
##
_l
 = 
	`vsubq_s32
(
a
##_l, 
b
##_l); \

2714 
öt32x4_t
 
out
##
_h
 = 
	`vsubq_s32
(
a
##_h, 
b
##_h)

	)

2717 
	#d˘_bÊy32o
(
out0
,
out1
, 
a
,
b
,
shi·›
,
s
) \

2719 
	`d˘_wadd
(
sum
, 
a
, 
b
); \

2720 
	`d˘_wsub
(
dif
, 
a
, 
b
); \

2721 
out0
 = 
	`vcomböe_s16
(
	`shi·›
(
sum_l
, 
s
), shi·›(
sum_h
, s)); \

2722 
out1
 = 
	`vcomböe_s16
(
	`shi·›
(
dif_l
, 
s
), shi·›(
dif_h
, s)); \

2723 }

	)

2725 
	#d˘_∑ss
(
shi·›
, 
shi·
) \

2728 
öt16x8_t
 
sum26
 = 
	`vaddq_s16
(
row2
, 
row6
); \

2729 
	`d˘_l⁄g_mul
(
p1e
, 
sum26
, 
rŸ0_0
); \

2730 
	`d˘_l⁄g_mac
(
t2e
, 
p1e
, 
row6
, 
rŸ0_1
); \

2731 
	`d˘_l⁄g_mac
(
t3e
, 
p1e
, 
row2
, 
rŸ0_2
); \

2732 
öt16x8_t
 
sum04
 = 
	`vaddq_s16
(
row0
, 
row4
); \

2733 
öt16x8_t
 
dif04
 = 
	`vsubq_s16
(
row0
, 
row4
); \

2734 
	`d˘_widí
(
t0e
, 
sum04
); \

2735 
	`d˘_widí
(
t1e
, 
dif04
); \

2736 
	`d˘_wadd
(
x0
, 
t0e
, 
t3e
); \

2737 
	`d˘_wsub
(
x3
, 
t0e
, 
t3e
); \

2738 
	`d˘_wadd
(
x1
, 
t1e
, 
t2e
); \

2739 
	`d˘_wsub
(
x2
, 
t1e
, 
t2e
); \

2741 
öt16x8_t
 
sum15
 = 
	`vaddq_s16
(
row1
, 
row5
); \

2742 
öt16x8_t
 
sum17
 = 
	`vaddq_s16
(
row1
, 
row7
); \

2743 
öt16x8_t
 
sum35
 = 
	`vaddq_s16
(
row3
, 
row5
); \

2744 
öt16x8_t
 
sum37
 = 
	`vaddq_s16
(
row3
, 
row7
); \

2745 
öt16x8_t
 
sumodd
 = 
	`vaddq_s16
(
sum17
, 
sum35
); \

2746 
	`d˘_l⁄g_mul
(
p5o
, 
sumodd
, 
rŸ1_0
); \

2747 
	`d˘_l⁄g_mac
(
p1o
, 
p5o
, 
sum17
, 
rŸ1_1
); \

2748 
	`d˘_l⁄g_mac
(
p2o
, 
p5o
, 
sum35
, 
rŸ1_2
); \

2749 
	`d˘_l⁄g_mul
(
p3o
, 
sum37
, 
rŸ2_0
); \

2750 
	`d˘_l⁄g_mul
(
p4o
, 
sum15
, 
rŸ2_1
); \

2751 
	`d˘_wadd
(
sump13o
, 
p1o
, 
p3o
); \

2752 
	`d˘_wadd
(
sump24o
, 
p2o
, 
p4o
); \

2753 
	`d˘_wadd
(
sump23o
, 
p2o
, 
p3o
); \

2754 
	`d˘_wadd
(
sump14o
, 
p1o
, 
p4o
); \

2755 
	`d˘_l⁄g_mac
(
x4
, 
sump13o
, 
row7
, 
rŸ3_0
); \

2756 
	`d˘_l⁄g_mac
(
x5
, 
sump24o
, 
row5
, 
rŸ3_1
); \

2757 
	`d˘_l⁄g_mac
(
x6
, 
sump23o
, 
row3
, 
rŸ3_2
); \

2758 
	`d˘_l⁄g_mac
(
x7
, 
sump14o
, 
row1
, 
rŸ3_3
); \

2759 
	`d˘_bÊy32o
(
row0
,
row7
, 
x0
,
x7
,
shi·›
,
shi·
); \

2760 
	`d˘_bÊy32o
(
row1
,
row6
, 
x1
,
x6
,
shi·›
,
shi·
); \

2761 
	`d˘_bÊy32o
(
row2
,
row5
, 
x2
,
x5
,
shi·›
,
shi·
); \

2762 
	`d˘_bÊy32o
(
row3
,
row4
, 
x3
,
x4
,
shi·›
,
shi·
); \

2763 }

	)

2766 
row0
 = 
	`vld1q_s16
(
d©a
 + 0*8);

2767 
row1
 = 
	`vld1q_s16
(
d©a
 + 1*8);

2768 
row2
 = 
	`vld1q_s16
(
d©a
 + 2*8);

2769 
row3
 = 
	`vld1q_s16
(
d©a
 + 3*8);

2770 
row4
 = 
	`vld1q_s16
(
d©a
 + 4*8);

2771 
row5
 = 
	`vld1q_s16
(
d©a
 + 5*8);

2772 
row6
 = 
	`vld1q_s16
(
d©a
 + 6*8);

2773 
row7
 = 
	`vld1q_s16
(
d©a
 + 7*8);

2776 
row0
 = 
	`vaddq_s16
‘ow0, 
	`v£tq_œ√_s16
(1024, 
	`vdupq_n_s16
(0), 0));

2779 
	`d˘_∑ss
(
vrsh∫_n_s32
, 10);

2785 
	#d˘_ån16
(
x
, 
y
Ë{ 
öt16x8x2_t
 
t
 = 
	`vånq_s16
(x, y); x =Å.
vÆ
[0]; y =Å.vÆ[1]; }

	)

2786 
	#d˘_ån32
(
x
, 
y
Ë{ 
öt32x4x2_t
 
t
 = 
	`vånq_s32
(
	`vªöãΩªtq_s32_s16
(x), vªöãΩªtq_s32_s16(y)); x = 
	`vªöãΩªtq_s16_s32
—.
vÆ
[0]); y = vªöãΩªtq_s16_s32—.vÆ[1]); }

	)

2787 
	#d˘_ån64
(
x
, 
y
Ë{ 
öt16x8_t
 
x0
 = x; i¡16x8_à
y0
 = y; x = 
	`vcomböe_s16
(
	`vgë_low_s16
(x0), vgë_low_s16(y0)); y = vcomböe_s16(
	`vgë_high_s16
(x0), vgë_high_s16(y0)); }

	)

2790 
	`d˘_ån16
(
row0
, 
row1
);

2791 
	`d˘_ån16
(
row2
, 
row3
);

2792 
	`d˘_ån16
(
row4
, 
row5
);

2793 
	`d˘_ån16
(
row6
, 
row7
);

2796 
	`d˘_ån32
(
row0
, 
row2
);

2797 
	`d˘_ån32
(
row1
, 
row3
);

2798 
	`d˘_ån32
(
row4
, 
row6
);

2799 
	`d˘_ån32
(
row5
, 
row7
);

2802 
	`d˘_ån64
(
row0
, 
row4
);

2803 
	`d˘_ån64
(
row1
, 
row5
);

2804 
	`d˘_ån64
(
row2
, 
row6
);

2805 
	`d˘_ån64
(
row3
, 
row7
);

2807 #unde‡
d˘_ån16


2808 #unde‡
d˘_ån32


2809 #unde‡
d˘_ån64


2816 
	`d˘_∑ss
(
vsh∫_n_s32
, 16);

2820 
uöt8x8_t
 
p0
 = 
	`vqrshrun_n_s16
(
row0
, 1);

2821 
uöt8x8_t
 
p1
 = 
	`vqrshrun_n_s16
(
row1
, 1);

2822 
uöt8x8_t
 
p2
 = 
	`vqrshrun_n_s16
(
row2
, 1);

2823 
uöt8x8_t
 
p3
 = 
	`vqrshrun_n_s16
(
row3
, 1);

2824 
uöt8x8_t
 
p4
 = 
	`vqrshrun_n_s16
(
row4
, 1);

2825 
uöt8x8_t
 
p5
 = 
	`vqrshrun_n_s16
(
row5
, 1);

2826 
uöt8x8_t
 
p6
 = 
	`vqrshrun_n_s16
(
row6
, 1);

2827 
uöt8x8_t
 
p7
 = 
	`vqrshrun_n_s16
(
row7
, 1);

2830 
	#d˘_ån8_8
(
x
, 
y
Ë{ 
uöt8x8x2_t
 
t
 = 
	`vån_u8
(x, y); x =Å.
vÆ
[0]; y =Å.vÆ[1]; }

	)

2831 
	#d˘_ån8_16
(
x
, 
y
Ë{ 
uöt16x4x2_t
 
t
 = 
	`vån_u16
(
	`vªöãΩªt_u16_u8
(x), vªöãΩªt_u16_u8(y)); x = 
	`vªöãΩªt_u8_u16
—.
vÆ
[0]); y = vªöãΩªt_u8_u16—.vÆ[1]); }

	)

2832 
	#d˘_ån8_32
(
x
, 
y
Ë{ 
uöt32x2x2_t
 
t
 = 
	`vån_u32
(
	`vªöãΩªt_u32_u8
(x), vªöãΩªt_u32_u8(y)); x = 
	`vªöãΩªt_u8_u32
—.
vÆ
[0]); y = vªöãΩªt_u8_u32—.vÆ[1]); }

	)

2838 
	`d˘_ån8_8
(
p0
, 
p1
);

2839 
	`d˘_ån8_8
(
p2
, 
p3
);

2840 
	`d˘_ån8_8
(
p4
, 
p5
);

2841 
	`d˘_ån8_8
(
p6
, 
p7
);

2844 
	`d˘_ån8_16
(
p0
, 
p2
);

2845 
	`d˘_ån8_16
(
p1
, 
p3
);

2846 
	`d˘_ån8_16
(
p4
, 
p6
);

2847 
	`d˘_ån8_16
(
p5
, 
p7
);

2850 
	`d˘_ån8_32
(
p0
, 
p4
);

2851 
	`d˘_ån8_32
(
p1
, 
p5
);

2852 
	`d˘_ån8_32
(
p2
, 
p6
);

2853 
	`d˘_ån8_32
(
p3
, 
p7
);

2856 
	`v°1_u8
(
out
, 
p0
); ouà+
out_°ride
;

2857 
	`v°1_u8
(
out
, 
p1
); ouà+
out_°ride
;

2858 
	`v°1_u8
(
out
, 
p2
); ouà+
out_°ride
;

2859 
	`v°1_u8
(
out
, 
p3
); ouà+
out_°ride
;

2860 
	`v°1_u8
(
out
, 
p4
); ouà+
out_°ride
;

2861 
	`v°1_u8
(
out
, 
p5
); ouà+
out_°ride
;

2862 
	`v°1_u8
(
out
, 
p6
); ouà+
out_°ride
;

2863 
	`v°1_u8
(
out
, 
p7
);

2865 #unde‡
d˘_ån8_8


2866 #unde‡
d˘_ån8_16


2867 #unde‡
d˘_ån8_32


2870 #unde‡
d˘_l⁄g_mul


2871 #unde‡
d˘_l⁄g_mac


2872 #unde‡
d˘_widí


2873 #unde‡
d˘_wadd


2874 #unde‡
d˘_wsub


2875 #unde‡
d˘_bÊy32o


2876 #unde‡
d˘_∑ss


2877 
	}
}

2881 
	#STBI__MARKER_n⁄e
 0xff

	)

2885 
°bi_uc
 
	$°bi__gë_m¨kî
(
°bi__j≥g
 *
j
)

2887 
°bi_uc
 
x
;

2888 i‡(
j
->
m¨kî
 !
STBI__MARKER_n⁄e
Ë{ 
x
 = j->marker; j->marker = STBI__MARKER_none;  x; }

2889 
x
 = 
	`°bi__gë8
(
j
->
s
);

2890 i‡(
x
 !0xffË 
STBI__MARKER_n⁄e
;

2891 
x
 == 0xff)

2892 
x
 = 
	`°bi__gë8
(
j
->
s
);

2893  
x
;

2894 
	}
}

2898 
	#STBI__RESTART
(
x
Ë((xË>0xd0 && (xË<0xd7)

	)

2902 
	$°bi__j≥g_ª£t
(
°bi__j≥g
 *
j
)

2904 
j
->
code_bôs
 = 0;

2905 
j
->
code_buf„r
 = 0;

2906 
j
->
nom‹e
 = 0;

2907 
j
->
img_comp
[0].
dc_¥ed
 = j->img_comp[1].dc_pred = j->img_comp[2].dc_pred = j->img_comp[3].dc_pred = 0;

2908 
j
->
m¨kî
 = 
STBI__MARKER_n⁄e
;

2909 
j
->
todo
 = j->
ª°¨t_öãrvÆ
 ? j->restart_interval : 0x7fffffff;

2910 
j
->
eob_run
 = 0;

2913 
	}
}

2915 
	$°bi__∑r£_íå›y_coded_d©a
(
°bi__j≥g
 *
z
)

2917 
	`°bi__j≥g_ª£t
(
z
);

2918 i‡(!
z
->
¥ogªssive
) {

2919 i‡(
z
->
sˇn_n
 == 1) {

2920 
i
,
j
;

2921 
	`STBI_SIMD_ALIGN
(, 
d©a
[64]);

2922 
n
 = 
z
->
‹dî
[0];

2927 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2928 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2929 
j
=0; j < 
h
; ++j) {

2930 
i
=0; i < 
w
; ++i) {

2931 
ha
 = 
z
->
img_comp
[
n
].ha;

2932 i‡(!
	`°bi__j≥g_decode_block
(
z
, 
d©a
, z->
huff_dc
+z->
img_comp
[
n
].
hd
, z->
huff_ac
+
ha
, z->
Á°_ac
[ha],Ç, z->
dequ™t
[z->img_comp[n].
tq
]))  0;

2933 
z
->
	`id˘_block_kî√l
(z->
img_comp
[
n
].
d©a
+z->img_comp[n].
w2
*
j
*8+
i
*8, z->img_comp[n].w2, data);

2935 i‡(--
z
->
todo
 <= 0) {

2936 i‡(
z
->
code_bôs
 < 24Ë
	`°bi__grow_buf„r_unß„
(z);

2939 i‡(!
	`STBI__RESTART
(
z
->
m¨kî
))  1;

2940 
	`°bi__j≥g_ª£t
(
z
);

2946 
i
,
j
,
k
,
x
,
y
;

2947 
	`STBI_SIMD_ALIGN
(, 
d©a
[64]);

2948 
j
=0; j < 
z
->
img_mcu_y
; ++j) {

2949 
i
=0; i < 
z
->
img_mcu_x
; ++i) {

2951 
k
=0; k < 
z
->
sˇn_n
; ++k) {

2952 
n
 = 
z
->
‹dî
[
k
];

2955 
y
=0; y < 
z
->
img_comp
[
n
].
v
; ++y) {

2956 
x
=0; x < 
z
->
img_comp
[
n
].
h
; ++x) {

2957 
x2
 = (
i
*
z
->
img_comp
[
n
].
h
 + 
x
)*8;

2958 
y2
 = (
j
*
z
->
img_comp
[
n
].
v
 + 
y
)*8;

2959 
ha
 = 
z
->
img_comp
[
n
].ha;

2960 i‡(!
	`°bi__j≥g_decode_block
(
z
, 
d©a
, z->
huff_dc
+z->
img_comp
[
n
].
hd
, z->
huff_ac
+
ha
, z->
Á°_ac
[ha],Ç, z->
dequ™t
[z->img_comp[n].
tq
]))  0;

2961 
z
->
	`id˘_block_kî√l
(z->
img_comp
[
n
].
d©a
+z->img_comp[n].
w2
*
y2
+
x2
, z->img_comp[n].w2, data);

2967 i‡(--
z
->
todo
 <= 0) {

2968 i‡(
z
->
code_bôs
 < 24Ë
	`°bi__grow_buf„r_unß„
(z);

2969 i‡(!
	`STBI__RESTART
(
z
->
m¨kî
))  1;

2970 
	`°bi__j≥g_ª£t
(
z
);

2977 i‡(
z
->
sˇn_n
 == 1) {

2978 
i
,
j
;

2979 
n
 = 
z
->
‹dî
[0];

2984 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

2985 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

2986 
j
=0; j < 
h
; ++j) {

2987 
i
=0; i < 
w
; ++i) {

2988 *
d©a
 = 
z
->
img_comp
[
n
].
c€ff
 + 64 * (
i
 + 
j
 * z->img_comp[n].
c€ff_w
);

2989 i‡(
z
->
•ec_°¨t
 == 0) {

2990 i‡(!
	`°bi__j≥g_decode_block_¥og_dc
(
z
, 
d©a
, &z->
huff_dc
[z->
img_comp
[
n
].
hd
],Ç))

2993 
ha
 = 
z
->
img_comp
[
n
].ha;

2994 i‡(!
	`°bi__j≥g_decode_block_¥og_ac
(
z
, 
d©a
, &z->
huff_ac
[
ha
], z->
Á°_ac
[ha]))

2998 i‡(--
z
->
todo
 <= 0) {

2999 i‡(
z
->
code_bôs
 < 24Ë
	`°bi__grow_buf„r_unß„
(z);

3000 i‡(!
	`STBI__RESTART
(
z
->
m¨kî
))  1;

3001 
	`°bi__j≥g_ª£t
(
z
);

3007 
i
,
j
,
k
,
x
,
y
;

3008 
j
=0; j < 
z
->
img_mcu_y
; ++j) {

3009 
i
=0; i < 
z
->
img_mcu_x
; ++i) {

3011 
k
=0; k < 
z
->
sˇn_n
; ++k) {

3012 
n
 = 
z
->
‹dî
[
k
];

3015 
y
=0; y < 
z
->
img_comp
[
n
].
v
; ++y) {

3016 
x
=0; x < 
z
->
img_comp
[
n
].
h
; ++x) {

3017 
x2
 = (
i
*
z
->
img_comp
[
n
].
h
 + 
x
);

3018 
y2
 = (
j
*
z
->
img_comp
[
n
].
v
 + 
y
);

3019 *
d©a
 = 
z
->
img_comp
[
n
].
c€ff
 + 64 * (
x2
 + 
y2
 * z->img_comp[n].
c€ff_w
);

3020 i‡(!
	`°bi__j≥g_decode_block_¥og_dc
(
z
, 
d©a
, &z->
huff_dc
[z->
img_comp
[
n
].
hd
],Ç))

3027 i‡(--
z
->
todo
 <= 0) {

3028 i‡(
z
->
code_bôs
 < 24Ë
	`°bi__grow_buf„r_unß„
(z);

3029 i‡(!
	`STBI__RESTART
(
z
->
m¨kî
))  1;

3030 
	`°bi__j≥g_ª£t
(
z
);

3037 
	}
}

3039 
	$°bi__j≥g_dequ™tize
(*
d©a
, 
°bi__uöt16
 *
dequ™t
)

3041 
i
;

3042 
i
=0; i < 64; ++i)

3043 
d©a
[
i
] *
dequ™t
[i];

3044 
	}
}

3046 
	$°bi__j≥g_föish
(
°bi__j≥g
 *
z
)

3048 i‡(
z
->
¥ogªssive
) {

3050 
i
,
j
,
n
;

3051 
n
=0;Ç < 
z
->
s
->
img_n
; ++n) {

3052 
w
 = (
z
->
img_comp
[
n
].
x
+7) >> 3;

3053 
h
 = (
z
->
img_comp
[
n
].
y
+7) >> 3;

3054 
j
=0; j < 
h
; ++j) {

3055 
i
=0; i < 
w
; ++i) {

3056 *
d©a
 = 
z
->
img_comp
[
n
].
c€ff
 + 64 * (
i
 + 
j
 * z->img_comp[n].
c€ff_w
);

3057 
	`°bi__j≥g_dequ™tize
(
d©a
, 
z
->
dequ™t
[z->
img_comp
[
n
].
tq
]);

3058 
z
->
	`id˘_block_kî√l
(z->
img_comp
[
n
].
d©a
+z->img_comp[n].
w2
*
j
*8+
i
*8, z->img_comp[n].w2, data);

3063 
	}
}

3065 
	$°bi__¥o˚ss_m¨kî
(
°bi__j≥g
 *
z
, 
m
)

3067 
L
;

3068 
m
) {

3069 
STBI__MARKER_n⁄e
:

3070  
	`°bi__îr
("expected marker","Corrupt JPEG");

3073 i‡(
	`°bi__gë16be
(
z
->
s
Ë!4Ë 
	`°bi__îr
("bad DRIÜen","Corrupt JPEG");

3074 
z
->
ª°¨t_öãrvÆ
 = 
	`°bi__gë16be
(z->
s
);

3078 
L
 = 
	`°bi__gë16be
(
z
->
s
)-2;

3079 
L
 > 0) {

3080 
q
 = 
	`°bi__gë8
(
z
->
s
);

3081 
p
 = 
q
 >> 4, 
sixãí
 = (p != 0);

3082 
t
 = 
q
 & 15,
i
;

3083 i‡(
p
 !0 &&Ö !1Ë 
	`°bi__îr
("bad DQTÅype","Corrupt JPEG");

3084 i‡(
t
 > 3Ë 
	`°bi__îr
("bad DQTÅable","Corrupt JPEG");

3086 
i
=0; i < 64; ++i)

3087 
z
->
dequ™t
[
t
][
°bi__j≥g_dezigzag
[
i
]] = (
°bi__uöt16
)(
sixãí
 ? 
	`°bi__gë16be
(z->
s
Ë: 
	`°bi__gë8
(z->s));

3088 
L
 -(
sixãí
 ? 129 : 65);

3090  
L
==0;

3093 
L
 = 
	`°bi__gë16be
(
z
->
s
)-2;

3094 
L
 > 0) {

3095 
°bi_uc
 *
v
;

3096 
sizes
[16],
i
,
n
=0;

3097 
q
 = 
	`°bi__gë8
(
z
->
s
);

3098 
tc
 = 
q
 >> 4;

3099 
th
 = 
q
 & 15;

3100 i‡(
tc
 > 1 || 
th
 > 3Ë 
	`°bi__îr
("bad DHT header","Corrupt JPEG");

3101 
i
=0; i < 16; ++i) {

3102 
sizes
[
i
] = 
	`°bi__gë8
(
z
->
s
);

3103 
n
 +
sizes
[
i
];

3105 
L
 -= 17;

3106 i‡(
tc
 == 0) {

3107 i‡(!
	`°bi__buûd_huffm™
(
z
->
huff_dc
+
th
, 
sizes
))  0;

3108 
v
 = 
z
->
huff_dc
[
th
].
vÆues
;

3110 i‡(!
	`°bi__buûd_huffm™
(
z
->
huff_ac
+
th
, 
sizes
))  0;

3111 
v
 = 
z
->
huff_ac
[
th
].
vÆues
;

3113 
i
=0; i < 
n
; ++i)

3114 
v
[
i
] = 
	`°bi__gë8
(
z
->
s
);

3115 i‡(
tc
 != 0)

3116 
	`°bi__buûd_Á°_ac
(
z
->
Á°_ac
[
th
], z->
huff_ac
 +Åh);

3117 
L
 -
n
;

3119  
L
==0;

3123 i‡((
m
 >= 0xE0 && m <= 0xEF) || m == 0xFE) {

3124 
L
 = 
	`°bi__gë16be
(
z
->
s
);

3125 i‡(
L
 < 2) {

3126 i‡(
m
 == 0xFE)

3127  
	`°bi__îr
("bad COMÜen","Corrupt JPEG");

3129  
	`°bi__îr
("bad APPÜen","Corrupt JPEG");

3131 
L
 -= 2;

3133 i‡(
m
 =0xE0 && 
L
 >= 5) {

3134 c⁄° 
èg
[5] = {'J','F','I','F','\0'};

3135 
ok
 = 1;

3136 
i
;

3137 
i
=0; i < 5; ++i)

3138 i‡(
	`°bi__gë8
(
z
->
s
Ë!
èg
[
i
])

3139 
ok
 = 0;

3140 
L
 -= 5;

3141 i‡(
ok
)

3142 
z
->
jfif
 = 1;

3143 } i‡(
m
 =0xEE && 
L
 >= 12) {

3144 c⁄° 
èg
[6] = {'A','d','o','b','e','\0'};

3145 
ok
 = 1;

3146 
i
;

3147 
i
=0; i < 6; ++i)

3148 i‡(
	`°bi__gë8
(
z
->
s
Ë!
èg
[
i
])

3149 
ok
 = 0;

3150 
L
 -= 6;

3151 i‡(
ok
) {

3152 
	`°bi__gë8
(
z
->
s
);

3153 
	`°bi__gë16be
(
z
->
s
);

3154 
	`°bi__gë16be
(
z
->
s
);

3155 
z
->
≠p14_cﬁ‹_å™sf‹m
 = 
	`°bi__gë8
(z->
s
);

3156 
L
 -= 6;

3160 
	`°bi__skù
(
z
->
s
, 
L
);

3164  
	`°bi__îr
("unknown marker","Corrupt JPEG");

3165 
	}
}

3168 
	$°bi__¥o˚ss_sˇn_hódî
(
°bi__j≥g
 *
z
)

3170 
i
;

3171 
Ls
 = 
	`°bi__gë16be
(
z
->
s
);

3172 
z
->
sˇn_n
 = 
	`°bi__gë8
(z->
s
);

3173 i‡(
z
->
sˇn_n
 < 1 || z->sˇn_¿> 4 || z->sˇn_¿> (Ëz->
s
->
img_n
Ë 
	`°bi__îr
("bad SOS component count","Corrupt JPEG");

3174 i‡(
Ls
 !6+2*
z
->
sˇn_n
Ë 
	`°bi__îr
("bad SOSÜen","Corrupt JPEG");

3175 
i
=0; i < 
z
->
sˇn_n
; ++i) {

3176 
id
 = 
	`°bi__gë8
(
z
->
s
), 
which
;

3177 
q
 = 
	`°bi__gë8
(
z
->
s
);

3178 
which
 = 0; which < 
z
->
s
->
img_n
; ++which)

3179 i‡(
z
->
img_comp
[
which
].
id
 == id)

3181 i‡(
which
 =
z
->
s
->
img_n
)  0;

3182 
z
->
img_comp
[
which
].
hd
 = 
q
 >> 4; i‡(z->img_comp[which].hd > 3Ë 
	`°bi__îr
("bad DC huff","Corrupt JPEG");

3183 
z
->
img_comp
[
which
].
ha
 = 
q
 & 15; i‡(z->img_comp[which].h®> 3Ë 
	`°bi__îr
("bad AC huff","Corrupt JPEG");

3184 
z
->
‹dî
[
i
] = 
which
;

3188 
Ø
;

3189 
z
->
•ec_°¨t
 = 
	`°bi__gë8
(z->
s
);

3190 
z
->
•ec_íd
 = 
	`°bi__gë8
(z->
s
);

3191 
Ø
 = 
	`°bi__gë8
(
z
->
s
);

3192 
z
->
succ_high
 = (
Ø
 >> 4);

3193 
z
->
succ_low
 = (
Ø
 & 15);

3194 i‡(
z
->
¥ogªssive
) {

3195 i‡(
z
->
•ec_°¨t
 > 63 || z->
•ec_íd
 > 63 || z->•ec_°¨à> z->•ec_íd || z->
succ_high
 > 13 || z->
succ_low
 > 13)

3196  
	`°bi__îr
("bad SOS", "Corrupt JPEG");

3198 i‡(
z
->
•ec_°¨t
 !0Ë 
	`°bi__îr
("bad SOS","Corrupt JPEG");

3199 i‡(
z
->
succ_high
 !0 || z->
succ_low
 !0Ë 
	`°bi__îr
("bad SOS","Corrupt JPEG");

3200 
z
->
•ec_íd
 = 63;

3205 
	}
}

3207 
	$°bi__‰ì_j≥g_comp⁄íts
(
°bi__j≥g
 *
z
, 
ncomp
, 
why
)

3209 
i
;

3210 
i
=0; i < 
ncomp
; ++i) {

3211 i‡(
z
->
img_comp
[
i
].
øw_d©a
) {

3212 
	`STBI_FREE
(
z
->
img_comp
[
i
].
øw_d©a
);

3213 
z
->
img_comp
[
i
].
øw_d©a
 = 
NULL
;

3214 
z
->
img_comp
[
i
].
d©a
 = 
NULL
;

3216 i‡(
z
->
img_comp
[
i
].
øw_c€ff
) {

3217 
	`STBI_FREE
(
z
->
img_comp
[
i
].
øw_c€ff
);

3218 
z
->
img_comp
[
i
].
øw_c€ff
 = 0;

3219 
z
->
img_comp
[
i
].
c€ff
 = 0;

3221 i‡(
z
->
img_comp
[
i
].
löebuf
) {

3222 
	`STBI_FREE
(
z
->
img_comp
[
i
].
löebuf
);

3223 
z
->
img_comp
[
i
].
löebuf
 = 
NULL
;

3226  
why
;

3227 
	}
}

3229 
	$°bi__¥o˚ss_‰ame_hódî
(
°bi__j≥g
 *
z
, 
sˇn
)

3231 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

3232 
Lf
,
p
,
i
,
q
, 
h_max
=1,
v_max
=1,
c
;

3233 
Lf
 = 
	`°bi__gë16be
(
s
); i‡(L‡< 11Ë 
	`°bi__îr
("bad SOFÜen","Corrupt JPEG");

3234 
p
 = 
	`°bi__gë8
(
s
); i‡’ !8Ë 
	`°bi__îr
("only 8-bit","JPEG formatÇot supported: 8-bit only");

3235 
s
->
img_y
 = 
	`°bi__gë16be
(s); i‡(s->img_y =0Ë 
	`°bi__îr
("no header height", "JPEG formatÇot supported: delayed height");

3236 
s
->
img_x
 = 
	`°bi__gë16be
(s); i‡(s->img_x =0Ë 
	`°bi__îr
("0 width","Corrupt JPEG");

3237 i‡(
s
->
img_y
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îr
("tooÜarge","VeryÜarge image (corrupt?)");

3238 i‡(
s
->
img_x
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îr
("tooÜarge","VeryÜarge image (corrupt?)");

3239 
c
 = 
	`°bi__gë8
(
s
);

3240 i‡(
c
 !3 && c !1 && c !4Ë 
	`°bi__îr
("bad component count","Corrupt JPEG");

3241 
s
->
img_n
 = 
c
;

3242 
i
=0; i < 
c
; ++i) {

3243 
z
->
img_comp
[
i
].
d©a
 = 
NULL
;

3244 
z
->
img_comp
[
i
].
löebuf
 = 
NULL
;

3247 i‡(
Lf
 !8+3*
s
->
img_n
Ë 
	`°bi__îr
("bad SOFÜen","Corrupt JPEG");

3249 
z
->
rgb
 = 0;

3250 
i
=0; i < 
s
->
img_n
; ++i) {

3251 c⁄° 
rgb
[3] = { 'R', 'G', 'B' };

3252 
z
->
img_comp
[
i
].
id
 = 
	`°bi__gë8
(
s
);

3253 i‡(
s
->
img_n
 =3 && 
z
->
img_comp
[
i
].
id
 =
rgb
[i])

3254 ++
z
->
rgb
;

3255 
q
 = 
	`°bi__gë8
(
s
);

3256 
z
->
img_comp
[
i
].
h
 = (
q
 >> 4); i‡(!z->img_comp[i].h || z->img_comp[i].h > 4Ë 
	`°bi__îr
("bad H","Corrupt JPEG");

3257 
z
->
img_comp
[
i
].
v
 = 
q
 & 15; i‡(!z->img_comp[i].v || z->img_comp[i].v > 4Ë 
	`°bi__îr
("bad V","Corrupt JPEG");

3258 
z
->
img_comp
[
i
].
tq
 = 
	`°bi__gë8
(
s
); i‡(z->img_comp[i].tq > 3Ë 
	`°bi__îr
("bad TQ","Corrupt JPEG");

3261 i‡(
sˇn
 !
STBI__SCAN_lﬂd
)  1;

3263 i‡(!
	`°bi__mad3sizes_vÆid
(
s
->
img_x
, s->
img_y
, s->
img_n
, 0)Ë 
	`°bi__îr
("tooÜarge", "ImageÅooÜargeÅo decode");

3265 
i
=0; i < 
s
->
img_n
; ++i) {

3266 i‡(
z
->
img_comp
[
i
].
h
 > 
h_max
) h_max = z->img_comp[i].h;

3267 i‡(
z
->
img_comp
[
i
].
v
 > 
v_max
) v_max = z->img_comp[i].v;

3272 
i
=0; i < 
s
->
img_n
; ++i) {

3273 i‡(
h_max
 % 
z
->
img_comp
[
i
].
h
 !0Ë 
	`°bi__îr
("bad H","Corrupt JPEG");

3274 i‡(
v_max
 % 
z
->
img_comp
[
i
].
v
 !0Ë 
	`°bi__îr
("bad V","Corrupt JPEG");

3278 
z
->
img_h_max
 = 
h_max
;

3279 
z
->
img_v_max
 = 
v_max
;

3280 
z
->
img_mcu_w
 = 
h_max
 * 8;

3281 
z
->
img_mcu_h
 = 
v_max
 * 8;

3283 
z
->
img_mcu_x
 = (
s
->
img_x
 + z->
img_mcu_w
-1) / z->img_mcu_w;

3284 
z
->
img_mcu_y
 = (
s
->
img_y
 + z->
img_mcu_h
-1) / z->img_mcu_h;

3286 
i
=0; i < 
s
->
img_n
; ++i) {

3288 
z
->
img_comp
[
i
].
x
 = (
s
->
img_x
 * z->img_comp[i].
h
 + 
h_max
-1) / h_max;

3289 
z
->
img_comp
[
i
].
y
 = (
s
->
img_y
 * z->img_comp[i].
v
 + 
v_max
-1) / v_max;

3297 
z
->
img_comp
[
i
].
w2
 = z->
img_mcu_x
 * z->img_comp[i].
h
 * 8;

3298 
z
->
img_comp
[
i
].
h2
 = z->
img_mcu_y
 * z->img_comp[i].
v
 * 8;

3299 
z
->
img_comp
[
i
].
c€ff
 = 0;

3300 
z
->
img_comp
[
i
].
øw_c€ff
 = 0;

3301 
z
->
img_comp
[
i
].
löebuf
 = 
NULL
;

3302 
z
->
img_comp
[
i
].
øw_d©a
 = 
	`°bi__mÆloc_mad2
(z->img_comp[i].
w2
, z->img_comp[i].
h2
, 15);

3303 i‡(
z
->
img_comp
[
i
].
øw_d©a
 =
NULL
)

3304  
	`°bi__‰ì_j≥g_comp⁄íts
(
z
, 
i
+1, 
	`°bi__îr
("outofmem", "Out of memory"));

3306 
z
->
img_comp
[
i
].
d©a
 = (
°bi_uc
*Ë(((
size_t
Ëz->img_comp[i].
øw_d©a
 + 15) & ~15);

3307 i‡(
z
->
¥ogªssive
) {

3309 
z
->
img_comp
[
i
].
c€ff_w
 = z->img_comp[i].
w2
 / 8;

3310 
z
->
img_comp
[
i
].
c€ff_h
 = z->img_comp[i].
h2
 / 8;

3311 
z
->
img_comp
[
i
].
øw_c€ff
 = 
	`°bi__mÆloc_mad3
(z->img_comp[i].
w2
, z->img_comp[i].
h2
, (), 15);

3312 i‡(
z
->
img_comp
[
i
].
øw_c€ff
 =
NULL
)

3313  
	`°bi__‰ì_j≥g_comp⁄íts
(
z
, 
i
+1, 
	`°bi__îr
("outofmem", "Out of memory"));

3314 
z
->
img_comp
[
i
].
c€ff
 = (*Ë(((
size_t
Ëz->img_comp[i].
øw_c€ff
 + 15) & ~15);

3319 
	}
}

3322 
	#°bi__DNL
(
x
Ë((xË=0xdc)

	)

3323 
	#°bi__SOI
(
x
Ë((xË=0xd8)

	)

3324 
	#°bi__EOI
(
x
Ë((xË=0xd9)

	)

3325 
	#°bi__SOF
(
x
Ë((xË=0xc0 || (xË=0xc1 || (xË=0xc2)

	)

3326 
	#°bi__SOS
(
x
Ë((xË=0xda)

	)

3328 
	#°bi__SOF_¥ogªssive
(
x
Ë((xË=0xc2)

	)

3330 
	$°bi__decode_j≥g_hódî
(
°bi__j≥g
 *
z
, 
sˇn
)

3332 
m
;

3333 
z
->
jfif
 = 0;

3334 
z
->
≠p14_cﬁ‹_å™sf‹m
 = -1;

3335 
z
->
m¨kî
 = 
STBI__MARKER_n⁄e
;

3336 
m
 = 
	`°bi__gë_m¨kî
(
z
);

3337 i‡(!
	`°bi__SOI
(
m
)Ë 
	`°bi__îr
("no SOI","Corrupt JPEG");

3338 i‡(
sˇn
 =
STBI__SCAN_ty≥
)  1;

3339 
m
 = 
	`°bi__gë_m¨kî
(
z
);

3340 !
	`°bi__SOF
(
m
)) {

3341 i‡(!
	`°bi__¥o˚ss_m¨kî
(
z
,
m
))  0;

3342 
m
 = 
	`°bi__gë_m¨kî
(
z
);

3343 
m
 =
STBI__MARKER_n⁄e
) {

3345 i‡(
	`°bi__©_eof
(
z
->
s
)Ë 
	`°bi__îr
("no SOF", "Corrupt JPEG");

3346 
m
 = 
	`°bi__gë_m¨kî
(
z
);

3349 
z
->
¥ogªssive
 = 
	`°bi__SOF_¥ogªssive
(
m
);

3350 i‡(!
	`°bi__¥o˚ss_‰ame_hódî
(
z
, 
sˇn
))  0;

3352 
	}
}

3355 
	$°bi__decode_j≥g_image
(
°bi__j≥g
 *
j
)

3357 
m
;

3358 
m
 = 0; m < 4; m++) {

3359 
j
->
img_comp
[
m
].
øw_d©a
 = 
NULL
;

3360 
j
->
img_comp
[
m
].
øw_c€ff
 = 
NULL
;

3362 
j
->
ª°¨t_öãrvÆ
 = 0;

3363 i‡(!
	`°bi__decode_j≥g_hódî
(
j
, 
STBI__SCAN_lﬂd
))  0;

3364 
m
 = 
	`°bi__gë_m¨kî
(
j
);

3365 !
	`°bi__EOI
(
m
)) {

3366 i‡(
	`°bi__SOS
(
m
)) {

3367 i‡(!
	`°bi__¥o˚ss_sˇn_hódî
(
j
))  0;

3368 i‡(!
	`°bi__∑r£_íå›y_coded_d©a
(
j
))  0;

3369 i‡(
j
->
m¨kî
 =
STBI__MARKER_n⁄e
 ) {

3371 !
	`°bi__©_eof
(
j
->
s
)) {

3372 
x
 = 
	`°bi__gë8
(
j
->
s
);

3373 i‡(
x
 == 255) {

3374 
j
->
m¨kî
 = 
	`°bi__gë8
(j->
s
);

3380 } i‡(
	`°bi__DNL
(
m
)) {

3381 
Ld
 = 
	`°bi__gë16be
(
j
->
s
);

3382 
°bi__uöt32
 
NL
 = 
	`°bi__gë16be
(
j
->
s
);

3383 i‡(
Ld
 !4Ë 
	`°bi__îr
("bad DNLÜen", "Corrupt JPEG");

3384 i‡(
NL
 !
j
->
s
->
img_y
Ë 
	`°bi__îr
("bad DNL height", "Corrupt JPEG");

3386 i‡(!
	`°bi__¥o˚ss_m¨kî
(
j
, 
m
))  0;

3388 
m
 = 
	`°bi__gë_m¨kî
(
j
);

3390 i‡(
j
->
¥ogªssive
)

3391 
	`°bi__j≥g_föish
(
j
);

3393 
	}
}

3397 
	g°bi_uc
 *(*
	tªßm∂e_row_func
)(
	t°bi_uc
 *
	tout
, stbi_u¯*
	tö0
, stbi_u¯*
	tö1
,

3398 
	tw
, 
	ths
);

3400 
	#°bi__div4
(
x
Ë((
°bi_uc
Ë((xË>> 2))

	)

3402 
°bi_uc
 *
	$ªßm∂e_row_1
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3404 
	`STBI_NOTUSED
(
out
);

3405 
	`STBI_NOTUSED
(
ö_Ár
);

3406 
	`STBI_NOTUSED
(
w
);

3407 
	`STBI_NOTUSED
(
hs
);

3408  
ö_√¨
;

3409 
	}
}

3411 
°bi_uc
* 
	$°bi__ªßm∂e_row_v_2
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3414 
i
;

3415 
	`STBI_NOTUSED
(
hs
);

3416 
i
=0; i < 
w
; ++i)

3417 
out
[
i
] = 
	`°bi__div4
(3*
ö_√¨
[i] + 
ö_Ár
[i] + 2);

3418  
out
;

3419 
	}
}

3421 
°bi_uc
* 
	$°bi__ªßm∂e_row_h_2
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3424 
i
;

3425 
°bi_uc
 *
öput
 = 
ö_√¨
;

3427 i‡(
w
 == 1) {

3429 
out
[0] = out[1] = 
öput
[0];

3430  
out
;

3433 
out
[0] = 
öput
[0];

3434 
out
[1] = 
	`°bi__div4
(
öput
[0]*3 + input[1] + 2);

3435 
i
=1; i < 
w
-1; ++i) {

3436 
n
 = 3*
öput
[
i
]+2;

3437 
out
[
i
*2+0] = 
	`°bi__div4
(
n
+
öput
[i-1]);

3438 
out
[
i
*2+1] = 
	`°bi__div4
(
n
+
öput
[i+1]);

3440 
out
[
i
*2+0] = 
	`°bi__div4
(
öput
[
w
-2]*3 + input[w-1] + 2);

3441 
out
[
i
*2+1] = 
öput
[
w
-1];

3443 
	`STBI_NOTUSED
(
ö_Ár
);

3444 
	`STBI_NOTUSED
(
hs
);

3446  
out
;

3447 
	}
}

3449 
	#°bi__div16
(
x
Ë((
°bi_uc
Ë((xË>> 4))

	)

3451 
°bi_uc
 *
	$°bi__ªßm∂e_row_hv_2
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3454 
i
,
t0
,
t1
;

3455 i‡(
w
 == 1) {

3456 
out
[0] = out[1] = 
	`°bi__div4
(3*
ö_√¨
[0] + 
ö_Ár
[0] + 2);

3457  
out
;

3460 
t1
 = 3*
ö_√¨
[0] + 
ö_Ár
[0];

3461 
out
[0] = 
	`°bi__div4
(
t1
+2);

3462 
i
=1; i < 
w
; ++i) {

3463 
t0
 = 
t1
;

3464 
t1
 = 3*
ö_√¨
[
i
]+
ö_Ár
[i];

3465 
out
[
i
*2-1] = 
	`°bi__div16
(3*
t0
 + 
t1
 + 8);

3466 
out
[
i
*2 ] = 
	`°bi__div16
(3*
t1
 + 
t0
 + 8);

3468 
out
[
w
*2-1] = 
	`°bi__div4
(
t1
+2);

3470 
	`STBI_NOTUSED
(
hs
);

3472  
out
;

3473 
	}
}

3475 #i‡
deföed
(
STBI_SSE2
Ë|| deföed(
STBI_NEON
)

3476 
°bi_uc
 *
	$°bi__ªßm∂e_row_hv_2_simd
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3479 
i
=0,
t0
,
t1
;

3481 i‡(
w
 == 1) {

3482 
out
[0] = out[1] = 
	`°bi__div4
(3*
ö_√¨
[0] + 
ö_Ár
[0] + 2);

3483  
out
;

3486 
t1
 = 3*
ö_√¨
[0] + 
ö_Ár
[0];

3490 ; 
i
 < ((
w
-1) & ~7); i += 8) {

3491 #i‡
	`deföed
(
STBI_SSE2
)

3494 
__m128i
 
zîo
 = 
	`_mm_£tzîo_si128
();

3495 
__m128i
 
Árb
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
ö_Ár
 + 
i
));

3496 
__m128i
 
√¨b
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
ö_√¨
 + 
i
));

3497 
__m128i
 
Árw
 = 
	`_mm_u≈acklo_ïi8
(
Árb
, 
zîo
);

3498 
__m128i
 
√¨w
 = 
	`_mm_u≈acklo_ïi8
(
√¨b
, 
zîo
);

3499 
__m128i
 
diff
 = 
	`_mm_sub_ïi16
(
Árw
, 
√¨w
);

3500 
__m128i
 
√¨s
 = 
	`_mm_¶li_ïi16
(
√¨w
, 2);

3501 
__m128i
 
cuº
 = 
	`_mm_add_ïi16
(
√¨s
, 
diff
);

3508 
__m128i
 
¥v0
 = 
	`_mm_¶li_si128
(
cuº
, 2);

3509 
__m128i
 
nxt0
 = 
	`_mm_§li_si128
(
cuº
, 2);

3510 
__m128i
 
¥ev
 = 
	`_mm_ö£π_ïi16
(
¥v0
, 
t1
, 0);

3511 
__m128i
 
√xt
 = 
	`_mm_ö£π_ïi16
(
nxt0
, 3*
ö_√¨
[
i
+8] + 
ö_Ár
[i+8], 7);

3517 
__m128i
 
büs
 = 
	`_mm_£t1_ïi16
(8);

3518 
__m128i
 
curs
 = 
	`_mm_¶li_ïi16
(
cuº
, 2);

3519 
__m128i
 
¥vd
 = 
	`_mm_sub_ïi16
(
¥ev
, 
cuº
);

3520 
__m128i
 
nxtd
 = 
	`_mm_sub_ïi16
(
√xt
, 
cuº
);

3521 
__m128i
 
curb
 = 
	`_mm_add_ïi16
(
curs
, 
büs
);

3522 
__m128i
 
eví
 = 
	`_mm_add_ïi16
(
¥vd
, 
curb
);

3523 
__m128i
 
odd
 = 
	`_mm_add_ïi16
(
nxtd
, 
curb
);

3526 
__m128i
 
öt0
 = 
	`_mm_u≈acklo_ïi16
(
eví
, 
odd
);

3527 
__m128i
 
öt1
 = 
	`_mm_u≈ackhi_ïi16
(
eví
, 
odd
);

3528 
__m128i
 
de0
 = 
	`_mm_§li_ïi16
(
öt0
, 4);

3529 
__m128i
 
de1
 = 
	`_mm_§li_ïi16
(
öt1
, 4);

3532 
__m128i
 
outv
 = 
	`_mm_∑ckus_ïi16
(
de0
, 
de1
);

3533 
	`_mm_°‹eu_si128
((
__m128i
 *Ë(
out
 + 
i
*2), 
outv
);

3534 #ñi‡
	`deföed
(
STBI_NEON
)

3537 
uöt8x8_t
 
Árb
 = 
	`vld1_u8
(
ö_Ár
 + 
i
);

3538 
uöt8x8_t
 
√¨b
 = 
	`vld1_u8
(
ö_√¨
 + 
i
);

3539 
öt16x8_t
 
diff
 = 
	`vªöãΩªtq_s16_u16
(
	`vsubl_u8
(
Árb
, 
√¨b
));

3540 
öt16x8_t
 
√¨s
 = 
	`vªöãΩªtq_s16_u16
(
	`vshŒ_n_u8
(
√¨b
, 2));

3541 
öt16x8_t
 
cuº
 = 
	`vaddq_s16
(
√¨s
, 
diff
);

3548 
öt16x8_t
 
¥v0
 = 
	`vextq_s16
(
cuº
, curr, 7);

3549 
öt16x8_t
 
nxt0
 = 
	`vextq_s16
(
cuº
, curr, 1);

3550 
öt16x8_t
 
¥ev
 = 
	`v£tq_œ√_s16
(
t1
, 
¥v0
, 0);

3551 
öt16x8_t
 
√xt
 = 
	`v£tq_œ√_s16
(3*
ö_√¨
[
i
+8] + 
ö_Ár
[i+8], 
nxt0
, 7);

3557 
öt16x8_t
 
curs
 = 
	`vshlq_n_s16
(
cuº
, 2);

3558 
öt16x8_t
 
¥vd
 = 
	`vsubq_s16
(
¥ev
, 
cuº
);

3559 
öt16x8_t
 
nxtd
 = 
	`vsubq_s16
(
√xt
, 
cuº
);

3560 
öt16x8_t
 
eví
 = 
	`vaddq_s16
(
curs
, 
¥vd
);

3561 
öt16x8_t
 
odd
 = 
	`vaddq_s16
(
curs
, 
nxtd
);

3564 
uöt8x8x2_t
 
o
;

3565 
o
.
vÆ
[0] = 
	`vqrshrun_n_s16
(
eví
, 4);

3566 
o
.
vÆ
[1] = 
	`vqrshrun_n_s16
(
odd
, 4);

3567 
	`v°2_u8
(
out
 + 
i
*2, 
o
);

3571 
t1
 = 3*
ö_√¨
[
i
+7] + 
ö_Ár
[i+7];

3574 
t0
 = 
t1
;

3575 
t1
 = 3*
ö_√¨
[
i
] + 
ö_Ár
[i];

3576 
out
[
i
*2] = 
	`°bi__div16
(3*
t1
 + 
t0
 + 8);

3578 ++
i
; i < 
w
; ++i) {

3579 
t0
 = 
t1
;

3580 
t1
 = 3*
ö_√¨
[
i
]+
ö_Ár
[i];

3581 
out
[
i
*2-1] = 
	`°bi__div16
(3*
t0
 + 
t1
 + 8);

3582 
out
[
i
*2 ] = 
	`°bi__div16
(3*
t1
 + 
t0
 + 8);

3584 
out
[
w
*2-1] = 
	`°bi__div4
(
t1
+2);

3586 
	`STBI_NOTUSED
(
hs
);

3588  
out
;

3589 
	}
}

3592 
°bi_uc
 *
	$°bi__ªßm∂e_row_gíîic
(
°bi_uc
 *
out
, stbi_u¯*
ö_√¨
, stbi_u¯*
ö_Ár
, 
w
, 
hs
)

3595 
i
,
j
;

3596 
	`STBI_NOTUSED
(
ö_Ár
);

3597 
i
=0; i < 
w
; ++i)

3598 
j
=0; j < 
hs
; ++j)

3599 
out
[
i
*
hs
+
j
] = 
ö_√¨
[i];

3600  
out
;

3601 
	}
}

3605 
	#°bi__Êﬂt2fixed
(
x
Ë(((Ë((xË* 4096.0‡+ 0.5f)Ë<< 8)

	)

3606 
	$°bi__YCbCr_to_RGB_row
(
°bi_uc
 *
out
, c⁄° stbi_u¯*
y
, c⁄° stbi_u¯*
pcb
, c⁄° stbi_u¯*
p¸
, 
cou¡
, 
°ï
)

3608 
i
;

3609 
i
=0; i < 
cou¡
; ++i) {

3610 
y_fixed
 = (
y
[
i
] << 20) + (1<<19);

3611 
r
,
g
,
b
;

3612 
¸
 = 
p¸
[
i
] - 128;

3613 
cb
 = 
pcb
[
i
] - 128;

3614 
r
 = 
y_fixed
 + 
¸
* 
	`°bi__Êﬂt2fixed
(1.40200f);

3615 
g
 = 
y_fixed
 + (
¸
*-
	`°bi__Êﬂt2fixed
(0.71414f)Ë+ ((
cb
*-stbi__float2fixed(0.34414f)) & 0xffff0000);

3616 
b
 = 
y_fixed
 + 
cb
* 
	`°bi__Êﬂt2fixed
(1.77200f);

3617 
r
 >>= 20;

3618 
g
 >>= 20;

3619 
b
 >>= 20;

3620 i‡((Ë
r
 > 255) { if (r < 0)Ñ = 0; r = 255; }

3621 i‡((Ë
g
 > 255) { if (g < 0) g = 0; g = 255; }

3622 i‡((Ë
b
 > 255) { if (b < 0) b = 0; b = 255; }

3623 
out
[0] = (
°bi_uc
)
r
;

3624 
out
[1] = (
°bi_uc
)
g
;

3625 
out
[2] = (
°bi_uc
)
b
;

3626 
out
[3] = 255;

3627 
out
 +
°ï
;

3629 
	}
}

3631 #i‡
deföed
(
STBI_SSE2
Ë|| deföed(
STBI_NEON
)

3632 
	$°bi__YCbCr_to_RGB_simd
(
°bi_uc
 *
out
, stbi_u¯c⁄° *
y
, stbi_u¯c⁄° *
pcb
, stbi_u¯c⁄° *
p¸
, 
cou¡
, 
°ï
)

3634 
i
 = 0;

3636 #ifde‡
STBI_SSE2


3640 i‡(
°ï
 == 4) {

3642 
__m128i
 
signÊù
 = 
	`_mm_£t1_ïi8
(-0x80);

3643 
__m128i
 
¸_c⁄°0
 = 
	`_mm_£t1_ïi16
( () ( 1.40200f*4096.0f+0.5f));

3644 
__m128i
 
¸_c⁄°1
 = 
	`_mm_£t1_ïi16
( - () ( 0.71414f*4096.0f+0.5f));

3645 
__m128i
 
cb_c⁄°0
 = 
	`_mm_£t1_ïi16
( - () ( 0.34414f*4096.0f+0.5f));

3646 
__m128i
 
cb_c⁄°1
 = 
	`_mm_£t1_ïi16
( () ( 1.77200f*4096.0f+0.5f));

3647 
__m128i
 
y_büs
 = 
	`_mm_£t1_ïi8
(() () 128);

3648 
__m128i
 
xw
 = 
	`_mm_£t1_ïi16
(255);

3650 ; 
i
+7 < 
cou¡
; i += 8) {

3652 
__m128i
 
y_byãs
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
y
+
i
));

3653 
__m128i
 
¸_byãs
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
p¸
+
i
));

3654 
__m128i
 
cb_byãs
 = 
	`_mm_lﬂdl_ïi64
((__m128ò*Ë(
pcb
+
i
));

3655 
__m128i
 
¸_bü£d
 = 
	`_mm_x‹_si128
(
¸_byãs
, 
signÊù
);

3656 
__m128i
 
cb_bü£d
 = 
	`_mm_x‹_si128
(
cb_byãs
, 
signÊù
);

3659 
__m128i
 
yw
 = 
	`_mm_u≈acklo_ïi8
(
y_büs
, 
y_byãs
);

3660 
__m128i
 
¸w
 = 
	`_mm_u≈acklo_ïi8
(
	`_mm_£tzîo_si128
(), 
¸_bü£d
);

3661 
__m128i
 
cbw
 = 
	`_mm_u≈acklo_ïi8
(
	`_mm_£tzîo_si128
(), 
cb_bü£d
);

3664 
__m128i
 
yws
 = 
	`_mm_§li_ïi16
(
yw
, 4);

3665 
__m128i
 
¸0
 = 
	`_mm_mulhi_ïi16
(
¸_c⁄°0
, 
¸w
);

3666 
__m128i
 
cb0
 = 
	`_mm_mulhi_ïi16
(
cb_c⁄°0
, 
cbw
);

3667 
__m128i
 
cb1
 = 
	`_mm_mulhi_ïi16
(
cbw
, 
cb_c⁄°1
);

3668 
__m128i
 
¸1
 = 
	`_mm_mulhi_ïi16
(
¸w
, 
¸_c⁄°1
);

3669 
__m128i
 
rws
 = 
	`_mm_add_ïi16
(
¸0
, 
yws
);

3670 
__m128i
 
gwt
 = 
	`_mm_add_ïi16
(
cb0
, 
yws
);

3671 
__m128i
 
bws
 = 
	`_mm_add_ïi16
(
yws
, 
cb1
);

3672 
__m128i
 
gws
 = 
	`_mm_add_ïi16
(
gwt
, 
¸1
);

3675 
__m128i
 
rw
 = 
	`_mm_§ai_ïi16
(
rws
, 4);

3676 
__m128i
 
bw
 = 
	`_mm_§ai_ïi16
(
bws
, 4);

3677 
__m128i
 
gw
 = 
	`_mm_§ai_ïi16
(
gws
, 4);

3680 
__m128i
 
brb
 = 
	`_mm_∑ckus_ïi16
(
rw
, 
bw
);

3681 
__m128i
 
gxb
 = 
	`_mm_∑ckus_ïi16
(
gw
, 
xw
);

3684 
__m128i
 
t0
 = 
	`_mm_u≈acklo_ïi8
(
brb
, 
gxb
);

3685 
__m128i
 
t1
 = 
	`_mm_u≈ackhi_ïi8
(
brb
, 
gxb
);

3686 
__m128i
 
o0
 = 
	`_mm_u≈acklo_ïi16
(
t0
, 
t1
);

3687 
__m128i
 
o1
 = 
	`_mm_u≈ackhi_ïi16
(
t0
, 
t1
);

3690 
	`_mm_°‹eu_si128
((
__m128i
 *Ë(
out
 + 0), 
o0
);

3691 
	`_mm_°‹eu_si128
((
__m128i
 *Ë(
out
 + 16), 
o1
);

3692 
out
 += 32;

3697 #ifde‡
STBI_NEON


3699 i‡(
°ï
 == 4) {

3701 
uöt8x8_t
 
signÊù
 = 
	`vdup_n_u8
(0x80);

3702 
öt16x8_t
 
¸_c⁄°0
 = 
	`vdupq_n_s16
( () ( 1.40200f*4096.0f+0.5f));

3703 
öt16x8_t
 
¸_c⁄°1
 = 
	`vdupq_n_s16
( - () ( 0.71414f*4096.0f+0.5f));

3704 
öt16x8_t
 
cb_c⁄°0
 = 
	`vdupq_n_s16
( - () ( 0.34414f*4096.0f+0.5f));

3705 
öt16x8_t
 
cb_c⁄°1
 = 
	`vdupq_n_s16
( () ( 1.77200f*4096.0f+0.5f));

3707 ; 
i
+7 < 
cou¡
; i += 8) {

3709 
uöt8x8_t
 
y_byãs
 = 
	`vld1_u8
(
y
 + 
i
);

3710 
uöt8x8_t
 
¸_byãs
 = 
	`vld1_u8
(
p¸
 + 
i
);

3711 
uöt8x8_t
 
cb_byãs
 = 
	`vld1_u8
(
pcb
 + 
i
);

3712 
öt8x8_t
 
¸_bü£d
 = 
	`vªöãΩªt_s8_u8
(
	`vsub_u8
(
¸_byãs
, 
signÊù
));

3713 
öt8x8_t
 
cb_bü£d
 = 
	`vªöãΩªt_s8_u8
(
	`vsub_u8
(
cb_byãs
, 
signÊù
));

3716 
öt16x8_t
 
yws
 = 
	`vªöãΩªtq_s16_u16
(
	`vshŒ_n_u8
(
y_byãs
, 4));

3717 
öt16x8_t
 
¸w
 = 
	`vshŒ_n_s8
(
¸_bü£d
, 7);

3718 
öt16x8_t
 
cbw
 = 
	`vshŒ_n_s8
(
cb_bü£d
, 7);

3721 
öt16x8_t
 
¸0
 = 
	`vqdmulhq_s16
(
¸w
, 
¸_c⁄°0
);

3722 
öt16x8_t
 
cb0
 = 
	`vqdmulhq_s16
(
cbw
, 
cb_c⁄°0
);

3723 
öt16x8_t
 
¸1
 = 
	`vqdmulhq_s16
(
¸w
, 
¸_c⁄°1
);

3724 
öt16x8_t
 
cb1
 = 
	`vqdmulhq_s16
(
cbw
, 
cb_c⁄°1
);

3725 
öt16x8_t
 
rws
 = 
	`vaddq_s16
(
yws
, 
¸0
);

3726 
öt16x8_t
 
gws
 = 
	`vaddq_s16
(vaddq_s16(
yws
, 
cb0
), 
¸1
);

3727 
öt16x8_t
 
bws
 = 
	`vaddq_s16
(
yws
, 
cb1
);

3730 
uöt8x8x4_t
 
o
;

3731 
o
.
vÆ
[0] = 
	`vqrshrun_n_s16
(
rws
, 4);

3732 
o
.
vÆ
[1] = 
	`vqrshrun_n_s16
(
gws
, 4);

3733 
o
.
vÆ
[2] = 
	`vqrshrun_n_s16
(
bws
, 4);

3734 
o
.
vÆ
[3] = 
	`vdup_n_u8
(255);

3737 
	`v°4_u8
(
out
, 
o
);

3738 
out
 += 8*4;

3743 ; 
i
 < 
cou¡
; ++i) {

3744 
y_fixed
 = (
y
[
i
] << 20) + (1<<19);

3745 
r
,
g
,
b
;

3746 
¸
 = 
p¸
[
i
] - 128;

3747 
cb
 = 
pcb
[
i
] - 128;

3748 
r
 = 
y_fixed
 + 
¸
* 
	`°bi__Êﬂt2fixed
(1.40200f);

3749 
g
 = 
y_fixed
 + 
¸
*-
	`°bi__Êﬂt2fixed
(0.71414fË+ ((
cb
*-stbi__float2fixed(0.34414f)) & 0xffff0000);

3750 
b
 = 
y_fixed
 + 
cb
* 
	`°bi__Êﬂt2fixed
(1.77200f);

3751 
r
 >>= 20;

3752 
g
 >>= 20;

3753 
b
 >>= 20;

3754 i‡((Ë
r
 > 255) { if (r < 0)Ñ = 0; r = 255; }

3755 i‡((Ë
g
 > 255) { if (g < 0) g = 0; g = 255; }

3756 i‡((Ë
b
 > 255) { if (b < 0) b = 0; b = 255; }

3757 
out
[0] = (
°bi_uc
)
r
;

3758 
out
[1] = (
°bi_uc
)
g
;

3759 
out
[2] = (
°bi_uc
)
b
;

3760 
out
[3] = 255;

3761 
out
 +
°ï
;

3763 
	}
}

3767 
	$°bi__£tup_j≥g
(
°bi__j≥g
 *
j
)

3769 
j
->
id˘_block_kî√l
 = 
°bi__id˘_block
;

3770 
j
->
YCbCr_to_RGB_kî√l
 = 
°bi__YCbCr_to_RGB_row
;

3771 
j
->
ªßm∂e_row_hv_2_kî√l
 = 
°bi__ªßm∂e_row_hv_2
;

3773 #ifde‡
STBI_SSE2


3774 i‡(
	`°bi__s£2_avaûabÀ
()) {

3775 
j
->
id˘_block_kî√l
 = 
°bi__id˘_simd
;

3776 
j
->
YCbCr_to_RGB_kî√l
 = 
°bi__YCbCr_to_RGB_simd
;

3777 
j
->
ªßm∂e_row_hv_2_kî√l
 = 
°bi__ªßm∂e_row_hv_2_simd
;

3781 #ifde‡
STBI_NEON


3782 
j
->
id˘_block_kî√l
 = 
°bi__id˘_simd
;

3783 
j
->
YCbCr_to_RGB_kî√l
 = 
°bi__YCbCr_to_RGB_simd
;

3784 
j
->
ªßm∂e_row_hv_2_kî√l
 = 
°bi__ªßm∂e_row_hv_2_simd
;

3786 
	}
}

3789 
	$°bi__˛ónup_j≥g
(
°bi__j≥g
 *
j
)

3791 
	`°bi__‰ì_j≥g_comp⁄íts
(
j
, j->
s
->
img_n
, 0);

3792 
	}
}

3796 
ªßm∂e_row_func
 
	mªßm∂e
;

3797 
°bi_uc
 *
	mlöe0
,*
	mlöe1
;

3798 
	mhs
,
	mvs
;

3799 
	mw_l‹es
;

3800 
	my°ï
;

3801 
	mypos
;

3802 } 
	t°bi__ªßm∂e
;

3805 
°bi_uc
 
	$°bi__blön_8x8
(
°bi_uc
 
x
, stbi_u¯
y
)

3807 
t
 = 
x
*
y
 + 128;

3808  (
°bi_uc
Ë((
t
 + (t >>8)) >> 8);

3809 
	}
}

3811 
°bi_uc
 *
	$lﬂd_j≥g_image
(
°bi__j≥g
 *
z
, *
out_x
, *
out_y
, *
comp
, 
ªq_comp
)

3813 
n
, 
decode_n
, 
is_rgb
;

3814 
z
->
s
->
img_n
 = 0;

3817 i‡(
ªq_comp
 < 0 ||Ñeq_com∞> 4Ë 
	`°bi__îΩuc
("badÑeq_comp", "InternalÉrror");

3820 i‡(!
	`°bi__decode_j≥g_image
(
z
)Ë{ 
	`°bi__˛ónup_j≥g
(z);  
NULL
; }

3823 
n
 = 
ªq_comp
 ?Ñeq_com∞: 
z
->
s
->
img_n
 >= 3 ? 3 : 1;

3825 
is_rgb
 = 
z
->
s
->
img_n
 =3 && (z->
rgb
 =3 || (z->
≠p14_cﬁ‹_å™sf‹m
 =0 && !z->
jfif
));

3827 i‡(
z
->
s
->
img_n
 =3 && 
n
 < 3 && !
is_rgb
)

3828 
decode_n
 = 1;

3830 
decode_n
 = 
z
->
s
->
img_n
;

3834 i‡(
decode_n
 <0Ë{ 
	`°bi__˛ónup_j≥g
(
z
);  
NULL
; }

3838 
k
;

3839 
i
,
j
;

3840 
°bi_uc
 *
ouçut
;

3841 
°bi_uc
 *
couçut
[4] = { 
NULL
, NULL, NULL, NULL };

3843 
°bi__ªßm∂e
 
ªs_comp
[4];

3845 
k
=0; k < 
decode_n
; ++k) {

3846 
°bi__ªßm∂e
 *
r
 = &
ªs_comp
[
k
];

3850 
z
->
img_comp
[
k
].
löebuf
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(z->
s
->
img_x
 + 3);

3851 i‡(!
z
->
img_comp
[
k
].
löebuf
Ë{ 
	`°bi__˛ónup_j≥g
(z);  
	`°bi__îΩuc
("outofmem", "Out of memory"); }

3853 
r
->
hs
 = 
z
->
img_h_max
 / z->
img_comp
[
k
].
h
;

3854 
r
->
vs
 = 
z
->
img_v_max
 / z->
img_comp
[
k
].
v
;

3855 
r
->
y°ï
 =Ñ->
vs
 >> 1;

3856 
r
->
w_l‹es
 = (
z
->
s
->
img_x
 +Ñ->
hs
-1) /Ñ->hs;

3857 
r
->
ypos
 = 0;

3858 
r
->
löe0
 =Ñ->
löe1
 = 
z
->
img_comp
[
k
].
d©a
;

3860 i‡(
r
->
hs
 =1 &&Ñ->
vs
 =1Ër->
ªßm∂e
 = 
ªßm∂e_row_1
;

3861 i‡(
r
->
hs
 =1 &&Ñ->
vs
 =2Ër->
ªßm∂e
 = 
°bi__ªßm∂e_row_v_2
;

3862 i‡(
r
->
hs
 =2 &&Ñ->
vs
 =1Ër->
ªßm∂e
 = 
°bi__ªßm∂e_row_h_2
;

3863 i‡(
r
->
hs
 =2 &&Ñ->
vs
 =2Ër->
ªßm∂e
 = 
z
->
ªßm∂e_row_hv_2_kî√l
;

3864 
r
->
ªßm∂e
 = 
°bi__ªßm∂e_row_gíîic
;

3868 
ouçut
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
n
, 
z
->
s
->
img_x
, z->s->
img_y
, 1);

3869 i‡(!
ouçut
Ë{ 
	`°bi__˛ónup_j≥g
(
z
);  
	`°bi__îΩuc
("outofmem", "Out of memory"); }

3872 
j
=0; j < 
z
->
s
->
img_y
; ++j) {

3873 
°bi_uc
 *
out
 = 
ouçut
 + 
n
 * 
z
->
s
->
img_x
 * 
j
;

3874 
k
=0; k < 
decode_n
; ++k) {

3875 
°bi__ªßm∂e
 *
r
 = &
ªs_comp
[
k
];

3876 
y_bŸ
 = 
r
->
y°ï
 >‘->
vs
 >> 1);

3877 
couçut
[
k
] = 
r
->
	`ªßm∂e
(
z
->
img_comp
[k].
löebuf
,

3878 
y_bŸ
 ? 
r
->
löe1
 :Ñ->
löe0
,

3879 
y_bŸ
 ? 
r
->
löe0
 :Ñ->
löe1
,

3880 
r
->
w_l‹es
,Ñ->
hs
);

3881 i‡(++
r
->
y°ï
 >r->
vs
) {

3882 
r
->
y°ï
 = 0;

3883 
r
->
löe0
 =Ñ->
löe1
;

3884 i‡(++
r
->
ypos
 < 
z
->
img_comp
[
k
].
y
)

3885 
r
->
löe1
 +
z
->
img_comp
[
k
].
w2
;

3888 i‡(
n
 >= 3) {

3889 
°bi_uc
 *
y
 = 
couçut
[0];

3890 i‡(
z
->
s
->
img_n
 == 3) {

3891 i‡(
is_rgb
) {

3892 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3893 
out
[0] = 
y
[
i
];

3894 
out
[1] = 
couçut
[1][
i
];

3895 
out
[2] = 
couçut
[2][
i
];

3896 
out
[3] = 255;

3897 
out
 +
n
;

3900 
z
->
	`YCbCr_to_RGB_kî√l
(
out
, 
y
, 
couçut
[1], couçut[2], z->
s
->
img_x
, 
n
);

3902 } i‡(
z
->
s
->
img_n
 == 4) {

3903 i‡(
z
->
≠p14_cﬁ‹_å™sf‹m
 == 0) {

3904 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3905 
°bi_uc
 
m
 = 
couçut
[3][
i
];

3906 
out
[0] = 
	`°bi__blön_8x8
(
couçut
[0][
i
], 
m
);

3907 
out
[1] = 
	`°bi__blön_8x8
(
couçut
[1][
i
], 
m
);

3908 
out
[2] = 
	`°bi__blön_8x8
(
couçut
[2][
i
], 
m
);

3909 
out
[3] = 255;

3910 
out
 +
n
;

3912 } i‡(
z
->
≠p14_cﬁ‹_å™sf‹m
 == 2) {

3913 
z
->
	`YCbCr_to_RGB_kî√l
(
out
, 
y
, 
couçut
[1], couçut[2], z->
s
->
img_x
, 
n
);

3914 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3915 
°bi_uc
 
m
 = 
couçut
[3][
i
];

3916 
out
[0] = 
	`°bi__blön_8x8
(255 - out[0], 
m
);

3917 
out
[1] = 
	`°bi__blön_8x8
(255 - out[1], 
m
);

3918 
out
[2] = 
	`°bi__blön_8x8
(255 - out[2], 
m
);

3919 
out
 +
n
;

3922 
z
->
	`YCbCr_to_RGB_kî√l
(
out
, 
y
, 
couçut
[1], couçut[2], z->
s
->
img_x
, 
n
);

3925 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3926 
out
[0] = out[1] = out[2] = 
y
[
i
];

3927 
out
[3] = 255;

3928 
out
 +
n
;

3931 i‡(
is_rgb
) {

3932 i‡(
n
 == 1)

3933 
i
=0; i < 
z
->
s
->
img_x
; ++i)

3934 *
out
++ = 
	`°bi__compuã_y
(
couçut
[0][
i
], coutput[1][i], coutput[2][i]);

3936 
i
=0; i < 
z
->
s
->
img_x
; ++i, 
out
 += 2) {

3937 
out
[0] = 
	`°bi__compuã_y
(
couçut
[0][
i
], coutput[1][i], coutput[2][i]);

3938 
out
[1] = 255;

3941 } i‡(
z
->
s
->
img_n
 =4 && z->
≠p14_cﬁ‹_å™sf‹m
 == 0) {

3942 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3943 
°bi_uc
 
m
 = 
couçut
[3][
i
];

3944 
°bi_uc
 
r
 = 
	`°bi__blön_8x8
(
couçut
[0][
i
], 
m
);

3945 
°bi_uc
 
g
 = 
	`°bi__blön_8x8
(
couçut
[1][
i
], 
m
);

3946 
°bi_uc
 
b
 = 
	`°bi__blön_8x8
(
couçut
[2][
i
], 
m
);

3947 
out
[0] = 
	`°bi__compuã_y
(
r
, 
g
, 
b
);

3948 
out
[1] = 255;

3949 
out
 +
n
;

3951 } i‡(
z
->
s
->
img_n
 =4 && z->
≠p14_cﬁ‹_å™sf‹m
 == 2) {

3952 
i
=0; i < 
z
->
s
->
img_x
; ++i) {

3953 
out
[0] = 
	`°bi__blön_8x8
(255 - 
couçut
[0][
i
], coutput[3][i]);

3954 
out
[1] = 255;

3955 
out
 +
n
;

3958 
°bi_uc
 *
y
 = 
couçut
[0];

3959 i‡(
n
 == 1)

3960 
i
=0; i < 
z
->
s
->
img_x
; ++iË
out
[i] = 
y
[i];

3962 
i
=0; i < 
z
->
s
->
img_x
; ++iË{ *
out
++ = 
y
[i]; *out++ = 255; }

3966 
	`°bi__˛ónup_j≥g
(
z
);

3967 *
out_x
 = 
z
->
s
->
img_x
;

3968 *
out_y
 = 
z
->
s
->
img_y
;

3969 i‡(
comp
Ë*com∞
z
->
s
->
img_n
 >= 3 ? 3 : 1;

3970  
ouçut
;

3972 
	}
}

3974 *
	$°bi__j≥g_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

3976 * 
ªsu…
;

3977 
°bi__j≥g
* 
j
 = (°bi__j≥g*Ë
	`°bi__mÆloc
((stbi__jpeg));

3978 i‡(!
j
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

3979 
	`STBI_NOTUSED
(
ri
);

3980 
j
->
s
 = s;

3981 
	`°bi__£tup_j≥g
(
j
);

3982 
ªsu…
 = 
	`lﬂd_j≥g_image
(
j
, 
x
,
y
,
comp
,
ªq_comp
);

3983 
	`STBI_FREE
(
j
);

3984  
ªsu…
;

3985 
	}
}

3987 
	$°bi__j≥g_ã°
(
°bi__c⁄ãxt
 *
s
)

3989 
r
;

3990 
°bi__j≥g
* 
j
 = (°bi__j≥g*)
	`°bi__mÆloc
((stbi__jpeg));

3991 i‡(!
j
Ë 
	`°bi__îr
("outofmem", "Out of memory");

3992 
j
->
s
 = s;

3993 
	`°bi__£tup_j≥g
(
j
);

3994 
r
 = 
	`°bi__decode_j≥g_hódî
(
j
, 
STBI__SCAN_ty≥
);

3995 
	`°bi__ªwöd
(
s
);

3996 
	`STBI_FREE
(
j
);

3997  
r
;

3998 
	}
}

4000 
	$°bi__j≥g_öfo_øw
(
°bi__j≥g
 *
j
, *
x
, *
y
, *
comp
)

4002 i‡(!
	`°bi__decode_j≥g_hódî
(
j
, 
STBI__SCAN_hódî
)) {

4003 
	`°bi__ªwöd
–
j
->
s
 );

4006 i‡(
x
Ë*x = 
j
->
s
->
img_x
;

4007 i‡(
y
Ë*y = 
j
->
s
->
img_y
;

4008 i‡(
comp
Ë*com∞
j
->
s
->
img_n
 >= 3 ? 3 : 1;

4010 
	}
}

4012 
	$°bi__j≥g_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

4014 
ªsu…
;

4015 
°bi__j≥g
* 
j
 = (°bi__j≥g*Ë(
	`°bi__mÆloc
((stbi__jpeg)));

4016 i‡(!
j
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4017 
j
->
s
 = s;

4018 
ªsu…
 = 
	`°bi__j≥g_öfo_øw
(
j
, 
x
, 
y
, 
comp
);

4019 
	`STBI_FREE
(
j
);

4020  
ªsu…
;

4021 
	}
}

4031 #i‚de‡
STBI_NO_ZLIB


4034 
	#STBI__ZFAST_BITS
 9

4035 
	#STBI__ZFAST_MASK
 ((1 << 
STBI__ZFAST_BITS
Ë- 1)

	)

4036 
	#STBI__ZNSYMS
 288

4037 

	)

4042 
°bi__uöt16
 
	mÁ°
[1 << 
STBI__ZFAST_BITS
];

4043 
°bi__uöt16
 
	mfú°code
[16];

4044 
	mmaxcode
[17];

4045 
°bi__uöt16
 
	mfú°symbﬁ
[16];

4046 
°bi_uc
 
	msize
[
STBI__ZNSYMS
];

4047 
°bi__uöt16
 
	mvÆue
[
STBI__ZNSYMS
];

4048 } 
	t°bi__zhuffm™
;

4050 
°bi_ölöe
 
	$°bi__bôªvî£16
(
n
)

4052 
n
 = ((n & 0xAAAA) >> 1) | ((n & 0x5555) << 1);

4053 
n
 = ((n & 0xCCCC) >> 2) | ((n & 0x3333) << 2);

4054 
n
 = ((n & 0xF0F0) >> 4) | ((n & 0x0F0F) << 4);

4055 
n
 = ((n & 0xFF00) >> 8) | ((n & 0x00FF) << 8);

4056  
n
;

4057 
	}
}

4059 
°bi_ölöe
 
	$°bi__bô_ªvî£
(
v
, 
bôs
)

4061 
	`STBI_ASSERT
(
bôs
 <= 16);

4064  
	`°bi__bôªvî£16
(
v
Ë>> (16-
bôs
);

4065 
	}
}

4067 
	$°bi__zbuûd_huffm™
(
°bi__zhuffm™
 *
z
, c⁄° 
°bi_uc
 *
sizñi°
, 
num
)

4069 
i
,
k
=0;

4070 
code
, 
√xt_code
[16], 
sizes
[17];

4073 
	`mem£t
(
sizes
, 0, (sizes));

4074 
	`mem£t
(
z
->
Á°
, 0, (z->fast));

4075 
i
=0; i < 
num
; ++i)

4076 ++
sizes
[
sizñi°
[
i
]];

4077 
sizes
[0] = 0;

4078 
i
=1; i < 16; ++i)

4079 i‡(
sizes
[
i
] > (1 << i))

4080  
	`°bi__îr
("bad sizes", "Corrupt PNG");

4081 
code
 = 0;

4082 
i
=1; i < 16; ++i) {

4083 
√xt_code
[
i
] = 
code
;

4084 
z
->
fú°code
[
i
] = (
°bi__uöt16
Ë
code
;

4085 
z
->
fú°symbﬁ
[
i
] = (
°bi__uöt16
Ë
k
;

4086 
code
 = (codê+ 
sizes
[
i
]);

4087 i‡(
sizes
[
i
])

4088 i‡(
code
-1 >(1 << 
i
)Ë 
	`°bi__îr
("bad codelengths","Corrupt PNG");

4089 
z
->
maxcode
[
i
] = 
code
 << (16-i);

4090 
code
 <<= 1;

4091 
k
 +
sizes
[
i
];

4093 
z
->
maxcode
[16] = 0x10000;

4094 
i
=0; i < 
num
; ++i) {

4095 
s
 = 
sizñi°
[
i
];

4096 i‡(
s
) {

4097 
c
 = 
√xt_code
[
s
] - 
z
->
fú°code
[s] + z->
fú°symbﬁ
[s];

4098 
°bi__uöt16
 
Á°v
 = (°bi__uöt16Ë((
s
 << 9Ë| 
i
);

4099 
z
->
size
 [
c
] = (
°bi_uc
 ) 
s
;

4100 
z
->
vÆue
[
c
] = (
°bi__uöt16
Ë
i
;

4101 i‡(
s
 <
STBI__ZFAST_BITS
) {

4102 
j
 = 
	`°bi__bô_ªvî£
(
√xt_code
[
s
],s);

4103 
j
 < (1 << 
STBI__ZFAST_BITS
)) {

4104 
z
->
Á°
[
j
] = 
Á°v
;

4105 
j
 +(1 << 
s
);

4108 ++
√xt_code
[
s
];

4112 
	}
}

4122 
°bi_uc
 *
	mzbuf„r
, *
	mzbuf„r_íd
;

4123 
	mnum_bôs
;

4124 
°bi__uöt32
 
	mcode_buf„r
;

4126 *
	mzout
;

4127 *
	mzout_°¨t
;

4128 *
	mzout_íd
;

4129 
	mz_ex∑ndabÀ
;

4131 
°bi__zhuffm™
 
	mz_Àngth
, 
	mz_di°™˚
;

4132 } 
	t°bi__zbuf
;

4134 
°bi_ölöe
 
	$°bi__zeof
(
°bi__zbuf
 *
z
)

4136  (
z
->
zbuf„r
 >z->
zbuf„r_íd
);

4137 
	}
}

4139 
°bi_ölöe
 
°bi_uc
 
	$°bi__zgë8
(
°bi__zbuf
 *
z
)

4141  
	`°bi__zeof
(
z
Ë? 0 : *z->
zbuf„r
++;

4142 
	}
}

4144 
	$°bi__fûl_bôs
(
°bi__zbuf
 *
z
)

4147 i‡(
z
->
code_buf„r
 >(1U << z->
num_bôs
)) {

4148 
z
->
zbuf„r
 = z->
zbuf„r_íd
;

4151 
z
->
code_buf„r
 |(Ë
	`°bi__zgë8
(zË<< z->
num_bôs
;

4152 
z
->
num_bôs
 += 8;

4153 } 
z
->
num_bôs
 <= 24);

4154 
	}
}

4156 
°bi_ölöe
 
	$°bi__zª˚ive
(
°bi__zbuf
 *
z
, 
n
)

4158 
k
;

4159 i‡(
z
->
num_bôs
 < 
n
Ë
	`°bi__fûl_bôs
(z);

4160 
k
 = 
z
->
code_buf„r
 & ((1 << 
n
) - 1);

4161 
z
->
code_buf„r
 >>
n
;

4162 
z
->
num_bôs
 -
n
;

4163  
k
;

4164 
	}
}

4166 
	$°bi__zhuffm™_decode_¶ow∑th
(
°bi__zbuf
 *
a
, 
°bi__zhuffm™
 *
z
)

4168 
b
,
s
,
k
;

4171 
k
 = 
	`°bi__bô_ªvî£
(
a
->
code_buf„r
, 16);

4172 
s
=
STBI__ZFAST_BITS
+1; ; ++s)

4173 i‡(
k
 < 
z
->
maxcode
[
s
])

4175 i‡(
s
 >= 16)  -1;

4177 
b
 = (
k
 >> (16-
s
)Ë- 
z
->
fú°code
[s] + z->
fú°symbﬁ
[s];

4178 i‡(
b
 >
STBI__ZNSYMS
)  -1;

4179 i‡(
z
->
size
[
b
] !
s
)  -1;

4180 
a
->
code_buf„r
 >>
s
;

4181 
a
->
num_bôs
 -
s
;

4182  
z
->
vÆue
[
b
];

4183 
	}
}

4185 
°bi_ölöe
 
	$°bi__zhuffm™_decode
(
°bi__zbuf
 *
a
, 
°bi__zhuffm™
 *
z
)

4187 
b
,
s
;

4188 i‡(
a
->
num_bôs
 < 16) {

4189 i‡(
	`°bi__zeof
(
a
)) {

4192 
	`°bi__fûl_bôs
(
a
);

4194 
b
 = 
z
->
Á°
[
a
->
code_buf„r
 & 
STBI__ZFAST_MASK
];

4195 i‡(
b
) {

4196 
s
 = 
b
 >> 9;

4197 
a
->
code_buf„r
 >>
s
;

4198 
a
->
num_bôs
 -
s
;

4199  
b
 & 511;

4201  
	`°bi__zhuffm™_decode_¶ow∑th
(
a
, 
z
);

4202 
	}
}

4204 
	$°bi__zex∑nd
(
°bi__zbuf
 *
z
, *
zout
, 
n
)

4206 *
q
;

4207 
cur
, 
limô
, 
ﬁd_limô
;

4208 
z
->
zout
 = zout;

4209 i‡(!
z
->
z_ex∑ndabÀ
Ë 
	`°bi__îr
("output bufferÜimit","Corrupt PNG");

4210 
cur
 = (Ë(
z
->
zout
 - z->
zout_°¨t
);

4211 
limô
 = 
ﬁd_limô
 = (Ë(
z
->
zout_íd
 - z->
zout_°¨t
);

4212 i‡(
UINT_MAX
 - 
cur
 < (Ë
n
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4213 
cur
 + 
n
 > 
limô
) {

4214 if(
limô
 > 
UINT_MAX
 / 2Ë 
	`°bi__îr
("outofmem", "Out of memory");

4215 
limô
 *= 2;

4217 
q
 = (*Ë
	`STBI_REALLOC_SIZED
(
z
->
zout_°¨t
, 
ﬁd_limô
, 
limô
);

4218 
	`STBI_NOTUSED
(
ﬁd_limô
);

4219 i‡(
q
 =
NULL
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4220 
z
->
zout_°¨t
 = 
q
;

4221 
z
->
zout
 = 
q
 + 
cur
;

4222 
z
->
zout_íd
 = 
q
 + 
limô
;

4224 
	}
}

4226 c⁄° 
	g°bi__zÀngth_ba£
[31] = {

4231 c⁄° 
	g°bi__zÀngth_exåa
[31]=

4234 c⁄° 
	g°bi__zdi°_ba£
[32] = { 1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,

4237 c⁄° 
	g°bi__zdi°_exåa
[32] =

4240 
	$°bi__∑r£_huffm™_block
(
°bi__zbuf
 *
a
)

4242 *
zout
 = 
a
->zout;

4244 
z
 = 
	`°bi__zhuffm™_decode
(
a
, &a->
z_Àngth
);

4245 i‡(
z
 < 256) {

4246 i‡(
z
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt PNG");

4247 i‡(
zout
 >
a
->
zout_íd
) {

4248 i‡(!
	`°bi__zex∑nd
(
a
, 
zout
, 1))  0;

4249 
zout
 = 
a
->zout;

4251 *
zout
++ = (Ë
z
;

4253 
°bi_uc
 *
p
;

4254 
Àn
,
di°
;

4255 i‡(
z
 == 256) {

4256 
a
->
zout
 = zout;

4259 
z
 -= 257;

4260 
Àn
 = 
°bi__zÀngth_ba£
[
z
];

4261 i‡(
°bi__zÀngth_exåa
[
z
]Ë
Àn
 +
	`°bi__zª˚ive
(
a
, stbi__zlength_extra[z]);

4262 
z
 = 
	`°bi__zhuffm™_decode
(
a
, &a->
z_di°™˚
);

4263 i‡(
z
 < 0Ë 
	`°bi__îr
("bad huffman code","Corrupt PNG");

4264 
di°
 = 
°bi__zdi°_ba£
[
z
];

4265 i‡(
°bi__zdi°_exåa
[
z
]Ë
di°
 +
	`°bi__zª˚ive
(
a
, stbi__zdist_extra[z]);

4266 i‡(
zout
 - 
a
->
zout_°¨t
 < 
di°
Ë 
	`°bi__îr
("bad dist","Corrupt PNG");

4267 i‡(
zout
 + 
Àn
 > 
a
->
zout_íd
) {

4268 i‡(!
	`°bi__zex∑nd
(
a
, 
zout
, 
Àn
))  0;

4269 
zout
 = 
a
->zout;

4271 
p
 = (
°bi_uc
 *Ë(
zout
 - 
di°
);

4272 i‡(
di°
 == 1) {

4273 
°bi_uc
 
v
 = *
p
;

4274 i‡(
Àn
Ë{ dÿ*
zout
++ = 
v
; --len); }

4276 i‡(
Àn
Ë{ dÿ*
zout
++ = *
p
++; --len); }

4280 
	}
}

4282 
	$°bi__compuã_huffm™_codes
(
°bi__zbuf
 *
a
)

4284 c⁄° 
°bi_uc
 
Àngth_dezigzag
[19] = { 16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15 };

4285 
°bi__zhuffm™
 
z_codñígth
;

4286 
°bi_uc
 
Àncodes
[286+32+137];

4287 
°bi_uc
 
codñígth_sizes
[19];

4288 
i
,
n
;

4290 
hlô
 = 
	`°bi__zª˚ive
(
a
,5) + 257;

4291 
hdi°
 = 
	`°bi__zª˚ive
(
a
,5) + 1;

4292 
h˛í
 = 
	`°bi__zª˚ive
(
a
,4) + 4;

4293 
¡Ÿ
 = 
hlô
 + 
hdi°
;

4295 
	`mem£t
(
codñígth_sizes
, 0, (codelength_sizes));

4296 
i
=0; i < 
h˛í
; ++i) {

4297 
s
 = 
	`°bi__zª˚ive
(
a
,3);

4298 
codñígth_sizes
[
Àngth_dezigzag
[
i
]] = (
°bi_uc
Ë
s
;

4300 i‡(!
	`°bi__zbuûd_huffm™
(&
z_codñígth
, 
codñígth_sizes
, 19))  0;

4302 
n
 = 0;

4303 
n
 < 
¡Ÿ
) {

4304 
c
 = 
	`°bi__zhuffm™_decode
(
a
, &
z_codñígth
);

4305 i‡(
c
 < 0 || c >19Ë 
	`°bi__îr
("bad codelengths", "Corrupt PNG");

4306 i‡(
c
 < 16)

4307 
Àncodes
[
n
++] = (
°bi_uc
Ë
c
;

4309 
°bi_uc
 
fûl
 = 0;

4310 i‡(
c
 == 16) {

4311 
c
 = 
	`°bi__zª˚ive
(
a
,2)+3;

4312 i‡(
n
 =0Ë 
	`°bi__îr
("bad codelengths", "Corrupt PNG");

4313 
fûl
 = 
Àncodes
[
n
-1];

4314 } i‡(
c
 == 17) {

4315 
c
 = 
	`°bi__zª˚ive
(
a
,3)+3;

4316 } i‡(
c
 == 18) {

4317 
c
 = 
	`°bi__zª˚ive
(
a
,7)+11;

4319  
	`°bi__îr
("bad codelengths", "Corrupt PNG");

4321 i‡(
¡Ÿ
 - 
n
 < 
c
Ë 
	`°bi__îr
("bad codelengths", "Corrupt PNG");

4322 
	`mem£t
(
Àncodes
+
n
, 
fûl
, 
c
);

4323 
n
 +
c
;

4326 i‡(
n
 !
¡Ÿ
Ë 
	`°bi__îr
("bad codelengths","Corrupt PNG");

4327 i‡(!
	`°bi__zbuûd_huffm™
(&
a
->
z_Àngth
, 
Àncodes
, 
hlô
))  0;

4328 i‡(!
	`°bi__zbuûd_huffm™
(&
a
->
z_di°™˚
, 
Àncodes
+
hlô
, 
hdi°
))  0;

4330 
	}
}

4332 
	$°bi__∑r£_uncom¥es£d_block
(
°bi__zbuf
 *
a
)

4334 
°bi_uc
 
hódî
[4];

4335 
Àn
,
∆í
,
k
;

4336 i‡(
a
->
num_bôs
 & 7)

4337 
	`°bi__zª˚ive
(
a
,á->
num_bôs
 & 7);

4339 
k
 = 0;

4340 
a
->
num_bôs
 > 0) {

4341 
hódî
[
k
++] = (
°bi_uc
Ë(
a
->
code_buf„r
 & 255);

4342 
a
->
code_buf„r
 >>= 8;

4343 
a
->
num_bôs
 -= 8;

4345 i‡(
a
->
num_bôs
 < 0Ë 
	`°bi__îr
("zlib corrupt","Corrupt PNG");

4347 
k
 < 4)

4348 
hódî
[
k
++] = 
	`°bi__zgë8
(
a
);

4349 
Àn
 = 
hódî
[1] * 256 + header[0];

4350 
∆í
 = 
hódî
[3] * 256 + header[2];

4351 i‡(
∆í
 !(
Àn
 ^ 0xffff)Ë 
	`°bi__îr
("zlib corrupt","Corrupt PNG");

4352 i‡(
a
->
zbuf„r
 + 
Àn
 >á->
zbuf„r_íd
Ë 
	`°bi__îr
("readÖast buffer","Corrupt PNG");

4353 i‡(
a
->
zout
 + 
Àn
 >á->
zout_íd
)

4354 i‡(!
	`°bi__zex∑nd
(
a
,á->
zout
, 
Àn
))  0;

4355 
	`mem˝y
(
a
->
zout
,á->
zbuf„r
, 
Àn
);

4356 
a
->
zbuf„r
 +
Àn
;

4357 
a
->
zout
 +
Àn
;

4359 
	}
}

4361 
	$°bi__∑r£_zlib_hódî
(
°bi__zbuf
 *
a
)

4363 
cmf
 = 
	`°bi__zgë8
(
a
);

4364 
cm
 = 
cmf
 & 15;

4366 
Êg
 = 
	`°bi__zgë8
(
a
);

4367 i‡(
	`°bi__zeof
(
a
)Ë 
	`°bi__îr
("bad zlib header","Corrupt PNG");

4368 i‡((
cmf
*256+
Êg
Ë% 31 !0Ë 
	`°bi__îr
("bad zlib header","Corrupt PNG");

4369 i‡(
Êg
 & 32Ë 
	`°bi__îr
("noÖreset dict","Corrupt PNG");

4370 i‡(
cm
 !8Ë 
	`°bi__îr
("bad compression","Corrupt PNG");

4373 
	}
}

4375 c⁄° 
°bi_uc
 
	g°bi__zdeÁu…_Àngth
[
STBI__ZNSYMS
] =

4387 c⁄° 
°bi_uc
 
	g°bi__zdeÁu…_di°™˚
[32] =

4404 
	$°bi__∑r£_zlib
(
°bi__zbuf
 *
a
, 
∑r£_hódî
)

4406 
föÆ
, 
ty≥
;

4407 i‡(
∑r£_hódî
)

4408 i‡(!
	`°bi__∑r£_zlib_hódî
(
a
))  0;

4409 
a
->
num_bôs
 = 0;

4410 
a
->
code_buf„r
 = 0;

4412 
föÆ
 = 
	`°bi__zª˚ive
(
a
,1);

4413 
ty≥
 = 
	`°bi__zª˚ive
(
a
,2);

4414 i‡(
ty≥
 == 0) {

4415 i‡(!
	`°bi__∑r£_uncom¥es£d_block
(
a
))  0;

4416 } i‡(
ty≥
 == 3) {

4419 i‡(
ty≥
 == 1) {

4421 i‡(!
	`°bi__zbuûd_huffm™
(&
a
->
z_Àngth
 , 
°bi__zdeÁu…_Àngth
 , 
STBI__ZNSYMS
))  0;

4422 i‡(!
	`°bi__zbuûd_huffm™
(&
a
->
z_di°™˚
, 
°bi__zdeÁu…_di°™˚
, 32))  0;

4424 i‡(!
	`°bi__compuã_huffm™_codes
(
a
))  0;

4426 i‡(!
	`°bi__∑r£_huffm™_block
(
a
))  0;

4428 } !
föÆ
);

4430 
	}
}

4432 
	$°bi__do_zlib
(
°bi__zbuf
 *
a
, *
obuf
, 
ﬁí
, 
exp
, 
∑r£_hódî
)

4434 
a
->
zout_°¨t
 = 
obuf
;

4435 
a
->
zout
 = 
obuf
;

4436 
a
->
zout_íd
 = 
obuf
 + 
ﬁí
;

4437 
a
->
z_ex∑ndabÀ
 = 
exp
;

4439  
	`°bi__∑r£_zlib
(
a
, 
∑r£_hódî
);

4440 
	}
}

4442 
STBIDEF
 *
	$°bi_zlib_decode_mÆloc_guesssize
(c⁄° *
buf„r
, 
Àn
, 
öôül_size
, *
ouéí
)

4444 
°bi__zbuf
 
a
;

4445 *
p
 = (*Ë
	`°bi__mÆloc
(
öôül_size
);

4446 i‡(
p
 =
NULL
)  NULL;

4447 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
buf„r
;

4448 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
buf„r
 + 
Àn
;

4449 i‡(
	`°bi__do_zlib
(&
a
, 
p
, 
öôül_size
, 1, 1)) {

4450 i‡(
ouéí
Ë*ouéí = (Ë(
a
.
zout
 -á.
zout_°¨t
);

4451  
a
.
zout_°¨t
;

4453 
	`STBI_FREE
(
a
.
zout_°¨t
);

4454  
NULL
;

4456 
	}
}

4458 
STBIDEF
 *
	$°bi_zlib_decode_mÆloc
(c⁄° *
buf„r
, 
Àn
, *
ouéí
)

4460  
	`°bi_zlib_decode_mÆloc_guesssize
(
buf„r
, 
Àn
, 16384, 
ouéí
);

4461 
	}
}

4463 
STBIDEF
 *
	$°bi_zlib_decode_mÆloc_guesssize_hódîÊag
(c⁄° *
buf„r
, 
Àn
, 
öôül_size
, *
ouéí
, 
∑r£_hódî
)

4465 
°bi__zbuf
 
a
;

4466 *
p
 = (*Ë
	`°bi__mÆloc
(
öôül_size
);

4467 i‡(
p
 =
NULL
)  NULL;

4468 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
buf„r
;

4469 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
buf„r
 + 
Àn
;

4470 i‡(
	`°bi__do_zlib
(&
a
, 
p
, 
öôül_size
, 1, 
∑r£_hódî
)) {

4471 i‡(
ouéí
Ë*ouéí = (Ë(
a
.
zout
 -á.
zout_°¨t
);

4472  
a
.
zout_°¨t
;

4474 
	`STBI_FREE
(
a
.
zout_°¨t
);

4475  
NULL
;

4477 
	}
}

4479 
STBIDEF
 
	$°bi_zlib_decode_buf„r
(*
obuf„r
, 
ﬁí
, c⁄° *
ibuf„r
, 
ûí
)

4481 
°bi__zbuf
 
a
;

4482 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
ibuf„r
;

4483 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
ibuf„r
 + 
ûí
;

4484 i‡(
	`°bi__do_zlib
(&
a
, 
obuf„r
, 
ﬁí
, 0, 1))

4485  (Ë(
a
.
zout
 -á.
zout_°¨t
);

4488 
	}
}

4490 
STBIDEF
 *
	$°bi_zlib_decode_nohódî_mÆloc
(c⁄° *
buf„r
, 
Àn
, *
ouéí
)

4492 
°bi__zbuf
 
a
;

4493 *
p
 = (*Ë
	`°bi__mÆloc
(16384);

4494 i‡(
p
 =
NULL
)  NULL;

4495 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
buf„r
;

4496 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
buf„r
+
Àn
;

4497 i‡(
	`°bi__do_zlib
(&
a
, 
p
, 16384, 1, 0)) {

4498 i‡(
ouéí
Ë*ouéí = (Ë(
a
.
zout
 -á.
zout_°¨t
);

4499  
a
.
zout_°¨t
;

4501 
	`STBI_FREE
(
a
.
zout_°¨t
);

4502  
NULL
;

4504 
	}
}

4506 
STBIDEF
 
	$°bi_zlib_decode_nohódî_buf„r
(*
obuf„r
, 
ﬁí
, c⁄° *
ibuf„r
, 
ûí
)

4508 
°bi__zbuf
 
a
;

4509 
a
.
zbuf„r
 = (
°bi_uc
 *Ë
ibuf„r
;

4510 
a
.
zbuf„r_íd
 = (
°bi_uc
 *Ë
ibuf„r
 + 
ûí
;

4511 i‡(
	`°bi__do_zlib
(&
a
, 
obuf„r
, 
ﬁí
, 0, 0))

4512  (Ë(
a
.
zout
 -á.
zout_°¨t
);

4515 
	}
}

4528 #i‚de‡
STBI_NO_PNG


4531 
°bi__uöt32
 
	mÀngth
;

4532 
°bi__uöt32
 
	mty≥
;

4533 } 
	t°bi__≤gchunk
;

4535 
°bi__≤gchunk
 
	$°bi__gë_chunk_hódî
(
°bi__c⁄ãxt
 *
s
)

4537 
°bi__≤gchunk
 
c
;

4538 
c
.
Àngth
 = 
	`°bi__gë32be
(
s
);

4539 
c
.
ty≥
 = 
	`°bi__gë32be
(
s
);

4540  
c
;

4541 
	}
}

4543 
	$°bi__check_≤g_hódî
(
°bi__c⁄ãxt
 *
s
)

4545 c⁄° 
°bi_uc
 
≤g_sig
[8] = { 137,80,78,71,13,10,26,10 };

4546 
i
;

4547 
i
=0; i < 8; ++i)

4548 i‡(
	`°bi__gë8
(
s
Ë!
≤g_sig
[
i
]Ë 
	`°bi__îr
("badÖng sig","Notá PNG");

4550 
	}
}

4554 
°bi__c⁄ãxt
 *
	ms
;

4555 
°bi_uc
 *
	mid©a
, *
	mex∑nded
, *
	mout
;

4556 
	mdïth
;

4557 } 
	t°bi__≤g
;

4561 
	mSTBI__F_n⁄e
=0,

4562 
	mSTBI__F_sub
=1,

4563 
	mSTBI__F_up
=2,

4564 
	mSTBI__F_avg
=3,

4565 
	mSTBI__F_∑ëh
=4,

4567 
	mSTBI__F_avg_fú°
,

4568 
	mSTBI__F_∑ëh_fú°


4571 
°bi_uc
 
	gfú°_row_fûãr
[5] =

4573 
STBI__F_n⁄e
,

4574 
STBI__F_sub
,

4575 
STBI__F_n⁄e
,

4576 
STBI__F_avg_fú°
,

4577 
STBI__F_∑ëh_fú°


4580 
	$°bi__∑ëh
(
a
, 
b
, 
c
)

4582 
p
 = 
a
 + 
b
 - 
c
;

4583 
∑
 = 
	`abs
(
p
-
a
);

4584 
pb
 = 
	`abs
(
p
-
b
);

4585 
pc
 = 
	`abs
(
p
-
c
);

4586 i‡(
∑
 <
pb
 &&Ö®<
pc
Ë 
a
;

4587 i‡(
pb
 <
pc
Ë 
b
;

4588  
c
;

4589 
	}
}

4591 c⁄° 
°bi_uc
 
	g°bi__dïth_sˇÀ_èbÀ
[9] = { 0, 0xff, 0x55, 0, 0x11, 0,0,0, 0x01 };

4594 
	$°bi__¸óã_≤g_image_øw
(
°bi__≤g
 *
a
, 
°bi_uc
 *
øw
, 
°bi__uöt32
 
øw_Àn
, 
out_n
, stbi__uöt32 
x
, stbi__uöt32 
y
, 
dïth
, 
cﬁ‹
)

4596 
byãs
 = (
dïth
 == 16? 2 : 1);

4597 
°bi__c⁄ãxt
 *
s
 = 
a
->s;

4598 
°bi__uöt32
 
i
,
j
,
°ride
 = 
x
*
out_n
*
byãs
;

4599 
°bi__uöt32
 
img_Àn
, 
img_width_byãs
;

4600 
k
;

4601 
img_n
 = 
s
->img_n;

4603 
ouçut_byãs
 = 
out_n
*
byãs
;

4604 
fûãr_byãs
 = 
img_n
*
byãs
;

4605 
width
 = 
x
;

4607 
	`STBI_ASSERT
(
out_n
 =
s
->
img_n
 || out_n == s->img_n+1);

4608 
a
->
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
x
, 
y
, 
ouçut_byãs
, 0);

4609 i‡(!
a
->
out
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4611 i‡(!
	`°bi__mad3sizes_vÆid
(
img_n
, 
x
, 
dïth
, 7)Ë 
	`°bi__îr
("tooÜarge", "Corrupt PNG");

4612 
img_width_byãs
 = (((
img_n
 * 
x
 * 
dïth
) + 7) >> 3);

4613 
img_Àn
 = (
img_width_byãs
 + 1Ë* 
y
;

4618 i‡(
øw_Àn
 < 
img_Àn
Ë 
	`°bi__îr
("notÉnoughÖixels","Corrupt PNG");

4620 
j
=0; j < 
y
; ++j) {

4621 
°bi_uc
 *
cur
 = 
a
->
out
 + 
°ride
*
j
;

4622 
°bi_uc
 *
¥i‹
;

4623 
fûãr
 = *
øw
++;

4625 i‡(
fûãr
 > 4)

4626  
	`°bi__îr
("invalid filter","Corrupt PNG");

4628 i‡(
dïth
 < 8) {

4629 i‡(
img_width_byãs
 > 
x
Ë 
	`°bi__îr
("invalid width","Corrupt PNG");

4630 
cur
 +
x
*
out_n
 - 
img_width_byãs
;

4631 
fûãr_byãs
 = 1;

4632 
width
 = 
img_width_byãs
;

4634 
¥i‹
 = 
cur
 - 
°ride
;

4637 i‡(
j
 =0Ë
fûãr
 = 
fú°_row_fûãr
[filter];

4640 
k
=0; k < 
fûãr_byãs
; ++k) {

4641 
fûãr
) {

4642 
STBI__F_n⁄e
 : 
cur
[
k
] = 
øw
[k]; ;

4643 
STBI__F_sub
 : 
cur
[
k
] = 
øw
[k]; ;

4644 
STBI__F_up
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
¥i‹
[k]); ;

4645 
STBI__F_avg
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + (
¥i‹
[k]>>1)); ;

4646 
STBI__F_∑ëh
 : 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(0,
¥i‹
[k],0)); ;

4647 
STBI__F_avg_fú°
 : 
cur
[
k
] = 
øw
[k]; ;

4648 
STBI__F_∑ëh_fú°
: 
cur
[
k
] = 
øw
[k]; ;

4652 i‡(
dïth
 == 8) {

4653 i‡(
img_n
 !
out_n
)

4654 
cur
[
img_n
] = 255;

4655 
øw
 +
img_n
;

4656 
cur
 +
out_n
;

4657 
¥i‹
 +
out_n
;

4658 } i‡(
dïth
 == 16) {

4659 i‡(
img_n
 !
out_n
) {

4660 
cur
[
fûãr_byãs
] = 255;

4661 
cur
[
fûãr_byãs
+1] = 255;

4663 
øw
 +
fûãr_byãs
;

4664 
cur
 +
ouçut_byãs
;

4665 
¥i‹
 +
ouçut_byãs
;

4667 
øw
 += 1;

4668 
cur
 += 1;

4669 
¥i‹
 += 1;

4673 i‡(
dïth
 < 8 || 
img_n
 =
out_n
) {

4674 
nk
 = (
width
 - 1)*
fûãr_byãs
;

4675 
	#STBI__CASE
(
f
) \

4676 
f
: \

4677 
k
=0; k < 
nk
; ++k)

	)

4678 
fûãr
) {

4680 
STBI__F_n⁄e
: 
	`mem˝y
(
cur
, 
øw
, 
nk
); ;

4681 
	`STBI__CASE
(
STBI__F_sub
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + cur[k-
fûãr_byãs
]); } ;

4682 
	`STBI__CASE
(
STBI__F_up
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
¥i‹
[k]); } ;

4683 
	`STBI__CASE
(
STBI__F_avg
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + ((
¥i‹
[k] + cur[k-
fûãr_byãs
])>>1)); } ;

4684 
	`STBI__CASE
(
STBI__F_∑ëh
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(cur[k-
fûãr_byãs
],
¥i‹
[k],prior[k-filter_bytes])); } ;

4685 
	`STBI__CASE
(
STBI__F_avg_fú°
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + (cur[k-
fûãr_byãs
] >> 1)); } ;

4686 
	`STBI__CASE
(
STBI__F_∑ëh_fú°
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(cur[k-
fûãr_byãs
],0,0)); } ;

4688 #unde‡
STBI__CASE


4689 
øw
 +
nk
;

4691 
	`STBI_ASSERT
(
img_n
+1 =
out_n
);

4692 
	#STBI__CASE
(
f
) \

4693 
f
: \

4694 
i
=
x
-1; i >1; --i, 
cur
[
fûãr_byãs
]=255,
øw
+=fûãr_byãs,cur+=
ouçut_byãs
,
¥i‹
+=output_bytes) \

4695 
k
=0; k < 
fûãr_byãs
; ++k)

	)

4696 
fûãr
) {

4697 
	`STBI__CASE
(
STBI__F_n⁄e
Ë{ 
cur
[
k
] = 
øw
[k]; } ;

4698 
	`STBI__CASE
(
STBI__F_sub
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + cur[k- 
ouçut_byãs
]); } ;

4699 
	`STBI__CASE
(
STBI__F_up
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
¥i‹
[k]); } ;

4700 
	`STBI__CASE
(
STBI__F_avg
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + ((
¥i‹
[k] + cur[k- 
ouçut_byãs
])>>1)); } ;

4701 
	`STBI__CASE
(
STBI__F_∑ëh
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(cur[k- 
ouçut_byãs
],
¥i‹
[k],prior[k- output_bytes])); } ;

4702 
	`STBI__CASE
(
STBI__F_avg_fú°
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + (cur[k- 
ouçut_byãs
] >> 1)); } ;

4703 
	`STBI__CASE
(
STBI__F_∑ëh_fú°
Ë{ 
cur
[
k
] = 
	`STBI__BYTECAST
(
øw
[k] + 
	`°bi__∑ëh
(cur[k- 
ouçut_byãs
],0,0)); } ;

4705 #unde‡
STBI__CASE


4709 i‡(
dïth
 == 16) {

4710 
cur
 = 
a
->
out
 + 
°ride
*
j
;

4711 
i
=0; i < 
x
; ++i,
cur
+=
ouçut_byãs
) {

4712 
cur
[
fûãr_byãs
+1] = 255;

4721 i‡(
dïth
 < 8) {

4722 
j
=0; j < 
y
; ++j) {

4723 
°bi_uc
 *
cur
 = 
a
->
out
 + 
°ride
*
j
;

4724 
°bi_uc
 *
ö
 = 
a
->
out
 + 
°ride
*
j
 + 
x
*
out_n
 - 
img_width_byãs
;

4727 
°bi_uc
 
sˇÀ
 = (
cﬁ‹
 =0Ë? 
°bi__dïth_sˇÀ_èbÀ
[
dïth
] : 1;

4735 i‡(
dïth
 == 4) {

4736 
k
=
x
*
img_n
; k >2; k-=2, ++
ö
) {

4737 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) );

4738 *
cur
++ = 
sˇÀ
 * ((*
ö
 ) & 0x0f);

4740 i‡(
k
 > 0Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) );

4741 } i‡(
dïth
 == 2) {

4742 
k
=
x
*
img_n
; k >4; k-=4, ++
ö
) {

4743 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 6) );

4744 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) & 0x03);

4745 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 2) & 0x03);

4746 *
cur
++ = 
sˇÀ
 * ((*
ö
 ) & 0x03);

4748 i‡(
k
 > 0Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 6) );

4749 i‡(
k
 > 1Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) & 0x03);

4750 i‡(
k
 > 2Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 2) & 0x03);

4751 } i‡(
dïth
 == 1) {

4752 
k
=
x
*
img_n
; k >8; k-=8, ++
ö
) {

4753 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 7) );

4754 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 6) & 0x01);

4755 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 5) & 0x01);

4756 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) & 0x01);

4757 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 3) & 0x01);

4758 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 2) & 0x01);

4759 *
cur
++ = 
sˇÀ
 * ((*
ö
 >> 1) & 0x01);

4760 *
cur
++ = 
sˇÀ
 * ((*
ö
 ) & 0x01);

4762 i‡(
k
 > 0Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 7) );

4763 i‡(
k
 > 1Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 6) & 0x01);

4764 i‡(
k
 > 2Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 5) & 0x01);

4765 i‡(
k
 > 3Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 4) & 0x01);

4766 i‡(
k
 > 4Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 3) & 0x01);

4767 i‡(
k
 > 5Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 2) & 0x01);

4768 i‡(
k
 > 6Ë*
cur
++ = 
sˇÀ
 * ((*
ö
 >> 1) & 0x01);

4770 i‡(
img_n
 !
out_n
) {

4771 
q
;

4773 
cur
 = 
a
->
out
 + 
°ride
*
j
;

4774 i‡(
img_n
 == 1) {

4775 
q
=
x
-1; q >= 0; --q) {

4776 
cur
[
q
*2+1] = 255;

4777 
cur
[
q
*2+0] = cur[q];

4780 
	`STBI_ASSERT
(
img_n
 == 3);

4781 
q
=
x
-1; q >= 0; --q) {

4782 
cur
[
q
*4+3] = 255;

4783 
cur
[
q
*4+2] = cur[q*3+2];

4784 
cur
[
q
*4+1] = cur[q*3+1];

4785 
cur
[
q
*4+0] = cur[q*3+0];

4790 } i‡(
dïth
 == 16) {

4795 
°bi_uc
 *
cur
 = 
a
->
out
;

4796 
°bi__uöt16
 *
cur16
 = (°bi__uöt16*)
cur
;

4798 
i
=0; i < 
x
*
y
*
out_n
; ++i,
cur16
++,
cur
+=2) {

4799 *
cur16
 = (
cur
[0] << 8) | cur[1];

4804 
	}
}

4806 
	$°bi__¸óã_≤g_image
(
°bi__≤g
 *
a
, 
°bi_uc
 *
image_d©a
, 
°bi__uöt32
 
image_d©a_Àn
, 
out_n
, 
dïth
, 
cﬁ‹
, 
öãæa˚d
)

4808 
byãs
 = (
dïth
 == 16 ? 2 : 1);

4809 
out_byãs
 = 
out_n
 * 
byãs
;

4810 
°bi_uc
 *
föÆ
;

4811 
p
;

4812 i‡(!
öãæa˚d
)

4813  
	`°bi__¸óã_≤g_image_øw
(
a
, 
image_d©a
, 
image_d©a_Àn
, 
out_n
,á->
s
->
img_x
,á->s->
img_y
, 
dïth
, 
cﬁ‹
);

4816 
föÆ
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
a
->
s
->
img_x
,á->s->
img_y
, 
out_byãs
, 0);

4817 i‡(!
föÆ
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4818 
p
=0;Ö < 7; ++p) {

4819 
x‹ig
[] = { 0,4,0,2,0,1,0 };

4820 
y‹ig
[] = { 0,0,4,0,2,0,1 };

4821 
x•c
[] = { 8,8,4,4,2,2,1 };

4822 
y•c
[] = { 8,8,8,4,4,2,2 };

4823 
i
,
j
,
x
,
y
;

4825 
x
 = (
a
->
s
->
img_x
 - 
x‹ig
[
p
] + 
x•c
[p]-1) / xspc[p];

4826 
y
 = (
a
->
s
->
img_y
 - 
y‹ig
[
p
] + 
y•c
[p]-1) / yspc[p];

4827 i‡(
x
 && 
y
) {

4828 
°bi__uöt32
 
img_Àn
 = ((((
a
->
s
->
img_n
 * 
x
 * 
dïth
Ë+ 7Ë>> 3Ë+ 1Ë* 
y
;

4829 i‡(!
	`°bi__¸óã_≤g_image_øw
(
a
, 
image_d©a
, 
image_d©a_Àn
, 
out_n
, 
x
, 
y
, 
dïth
, 
cﬁ‹
)) {

4830 
	`STBI_FREE
(
föÆ
);

4833 
j
=0; j < 
y
; ++j) {

4834 
i
=0; i < 
x
; ++i) {

4835 
out_y
 = 
j
*
y•c
[
p
]+
y‹ig
[p];

4836 
out_x
 = 
i
*
x•c
[
p
]+
x‹ig
[p];

4837 
	`mem˝y
(
föÆ
 + 
out_y
*
a
->
s
->
img_x
*
out_byãs
 + 
out_x
*out_bytes,

4838 
a
->
out
 + (
j
*
x
+
i
)*
out_byãs
, out_bytes);

4841 
	`STBI_FREE
(
a
->
out
);

4842 
image_d©a
 +
img_Àn
;

4843 
image_d©a_Àn
 -
img_Àn
;

4846 
a
->
out
 = 
föÆ
;

4849 
	}
}

4851 
	$°bi__compuã_å™•¨ícy
(
°bi__≤g
 *
z
, 
°bi_uc
 
tc
[3], 
out_n
)

4853 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

4854 
°bi__uöt32
 
i
, 
pixñ_cou¡
 = 
s
->
img_x
 * s->
img_y
;

4855 
°bi_uc
 *
p
 = 
z
->
out
;

4859 
	`STBI_ASSERT
(
out_n
 == 2 || out_n == 4);

4861 i‡(
out_n
 == 2) {

4862 
i
=0; i < 
pixñ_cou¡
; ++i) {

4863 
p
[1] = (p[0] =
tc
[0] ? 0 : 255);

4864 
p
 += 2;

4867 
i
=0; i < 
pixñ_cou¡
; ++i) {

4868 i‡(
p
[0] =
tc
[0] &&Ö[1] ==Åc[1] &&Ö[2] ==Åc[2])

4869 
p
[3] = 0;

4870 
p
 += 4;

4874 
	}
}

4876 
	$°bi__compuã_å™•¨ícy16
(
°bi__≤g
 *
z
, 
°bi__uöt16
 
tc
[3], 
out_n
)

4878 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

4879 
°bi__uöt32
 
i
, 
pixñ_cou¡
 = 
s
->
img_x
 * s->
img_y
;

4880 
°bi__uöt16
 *
p
 = (°bi__uöt16*Ë
z
->
out
;

4884 
	`STBI_ASSERT
(
out_n
 == 2 || out_n == 4);

4886 i‡(
out_n
 == 2) {

4887 
i
 = 0; i < 
pixñ_cou¡
; ++i) {

4888 
p
[1] = (p[0] =
tc
[0] ? 0 : 65535);

4889 
p
 += 2;

4892 
i
 = 0; i < 
pixñ_cou¡
; ++i) {

4893 i‡(
p
[0] =
tc
[0] &&Ö[1] ==Åc[1] &&Ö[2] ==Åc[2])

4894 
p
[3] = 0;

4895 
p
 += 4;

4899 
	}
}

4901 
	$°bi__ex∑nd_≤g_∑Àâe
(
°bi__≤g
 *
a
, 
°bi_uc
 *
∑Àâe
, 
Àn
, 
∑l_img_n
)

4903 
°bi__uöt32
 
i
, 
pixñ_cou¡
 = 
a
->
s
->
img_x
 *á->s->
img_y
;

4904 
°bi_uc
 *
p
, *
ãmp_out
, *
‹ig
 = 
a
->
out
;

4906 
p
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad2
(
pixñ_cou¡
, 
∑l_img_n
, 0);

4907 i‡(
p
 =
NULL
Ë 
	`°bi__îr
("outofmem", "Out of memory");

4910 
ãmp_out
 = 
p
;

4912 i‡(
∑l_img_n
 == 3) {

4913 
i
=0; i < 
pixñ_cou¡
; ++i) {

4914 
n
 = 
‹ig
[
i
]*4;

4915 
p
[0] = 
∑Àâe
[
n
 ];

4916 
p
[1] = 
∑Àâe
[
n
+1];

4917 
p
[2] = 
∑Àâe
[
n
+2];

4918 
p
 += 3;

4921 
i
=0; i < 
pixñ_cou¡
; ++i) {

4922 
n
 = 
‹ig
[
i
]*4;

4923 
p
[0] = 
∑Àâe
[
n
 ];

4924 
p
[1] = 
∑Àâe
[
n
+1];

4925 
p
[2] = 
∑Àâe
[
n
+2];

4926 
p
[3] = 
∑Àâe
[
n
+3];

4927 
p
 += 4;

4930 
	`STBI_FREE
(
a
->
out
);

4931 
a
->
out
 = 
ãmp_out
;

4933 
	`STBI_NOTUSED
(
Àn
);

4936 
	}
}

4938 
	g°bi__u≈ªmu…ùly_⁄_lﬂd_globÆ
 = 0;

4939 
	g°bi__de_ùh⁄e_Êag_globÆ
 = 0;

4941 
STBIDEF
 
	$°bi_£t_u≈ªmu…ùly_⁄_lﬂd
(
Êag_åue_if_should_u≈ªmu…ùly
)

4943 
°bi__u≈ªmu…ùly_⁄_lﬂd_globÆ
 = 
Êag_åue_if_should_u≈ªmu…ùly
;

4944 
	}
}

4946 
STBIDEF
 
	$°bi_c⁄vît_ùh⁄e_≤g_to_rgb
(
Êag_åue_if_should_c⁄vît
)

4948 
°bi__de_ùh⁄e_Êag_globÆ
 = 
Êag_åue_if_should_c⁄vît
;

4949 
	}
}

4951 #i‚de‡
STBI_THREAD_LOCAL


4952 
	#°bi__u≈ªmu…ùly_⁄_lﬂd
 
°bi__u≈ªmu…ùly_⁄_lﬂd_globÆ


	)

4953 
	#°bi__de_ùh⁄e_Êag
 
°bi__de_ùh⁄e_Êag_globÆ


	)

4955 
STBI_THREAD_LOCAL
 
	g°bi__u≈ªmu…ùly_⁄_lﬂd_loˇl
, 
	g°bi__u≈ªmu…ùly_⁄_lﬂd_£t
;

4956 
STBI_THREAD_LOCAL
 
	g°bi__de_ùh⁄e_Êag_loˇl
, 
	g°bi__de_ùh⁄e_Êag_£t
;

4958 
STBIDEF
 
	$°bi__u≈ªmu…ùly_⁄_lﬂd_thªad
(
Êag_åue_if_should_u≈ªmu…ùly
)

4960 
°bi__u≈ªmu…ùly_⁄_lﬂd_loˇl
 = 
Êag_åue_if_should_u≈ªmu…ùly
;

4961 
°bi__u≈ªmu…ùly_⁄_lﬂd_£t
 = 1;

4962 
	}
}

4964 
STBIDEF
 
	$°bi_c⁄vît_ùh⁄e_≤g_to_rgb_thªad
(
Êag_åue_if_should_c⁄vît
)

4966 
°bi__de_ùh⁄e_Êag_loˇl
 = 
Êag_åue_if_should_c⁄vît
;

4967 
°bi__de_ùh⁄e_Êag_£t
 = 1;

4968 
	}
}

4970 
	#°bi__u≈ªmu…ùly_⁄_lﬂd
 (
°bi__u≈ªmu…ùly_⁄_lﬂd_£t
 \

4971 ? 
°bi__u≈ªmu…ùly_⁄_lﬂd_loˇl
 \

4972 : 
°bi__u≈ªmu…ùly_⁄_lﬂd_globÆ
)

	)

4973 
	#°bi__de_ùh⁄e_Êag
 (
°bi__de_ùh⁄e_Êag_£t
 \

4974 ? 
°bi__de_ùh⁄e_Êag_loˇl
 \

4975 : 
°bi__de_ùh⁄e_Êag_globÆ
)

	)

4978 
	$°bi__de_ùh⁄e
(
°bi__≤g
 *
z
)

4980 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

4981 
°bi__uöt32
 
i
, 
pixñ_cou¡
 = 
s
->
img_x
 * s->
img_y
;

4982 
°bi_uc
 *
p
 = 
z
->
out
;

4984 i‡(
s
->
img_out_n
 == 3) {

4985 
i
=0; i < 
pixñ_cou¡
; ++i) {

4986 
°bi_uc
 
t
 = 
p
[0];

4987 
p
[0] =Ö[2];

4988 
p
[2] = 
t
;

4989 
p
 += 3;

4992 
	`STBI_ASSERT
(
s
->
img_out_n
 == 4);

4993 i‡(
°bi__u≈ªmu…ùly_⁄_lﬂd
) {

4995 
i
=0; i < 
pixñ_cou¡
; ++i) {

4996 
°bi_uc
 
a
 = 
p
[3];

4997 
°bi_uc
 
t
 = 
p
[0];

4998 i‡(
a
) {

4999 
°bi_uc
 
hÆf
 = 
a
 / 2;

5000 
p
[0] = (p[2] * 255 + 
hÆf
Ë/ 
a
;

5001 
p
[1] = (p[1] * 255 + 
hÆf
Ë/ 
a
;

5002 
p
[2] = ( 
t
 * 255 + 
hÆf
Ë/ 
a
;

5004 
p
[0] =Ö[2];

5005 
p
[2] = 
t
;

5007 
p
 += 4;

5011 
i
=0; i < 
pixñ_cou¡
; ++i) {

5012 
°bi_uc
 
t
 = 
p
[0];

5013 
p
[0] =Ö[2];

5014 
p
[2] = 
t
;

5015 
p
 += 4;

5019 
	}
}

5021 
	#STBI__PNG_TYPE
(
a
,
b
,
c
,
d
Ë(((Ë◊Ë<< 24Ë+ ((Ë(bË<< 16Ë+ ((Ë(cË<< 8Ë+ (Ë(d))

	)

5023 
	$°bi__∑r£_≤g_fûe
(
°bi__≤g
 *
z
, 
sˇn
, 
ªq_comp
)

5025 
°bi_uc
 
∑Àâe
[1024], 
∑l_img_n
=0;

5026 
°bi_uc
 
has_å™s
=0, 
tc
[3]={0};

5027 
°bi__uöt16
 
tc16
[3];

5028 
°bi__uöt32
 
ioff
=0, 
id©a_limô
=0, 
i
, 
∑l_Àn
=0;

5029 
fú°
=1,
k
,
öãæa˚
=0, 
cﬁ‹
=0, 
is_ùh⁄e
=0;

5030 
°bi__c⁄ãxt
 *
s
 = 
z
->s;

5032 
z
->
ex∑nded
 = 
NULL
;

5033 
z
->
id©a
 = 
NULL
;

5034 
z
->
out
 = 
NULL
;

5036 i‡(!
	`°bi__check_≤g_hódî
(
s
))  0;

5038 i‡(
sˇn
 =
STBI__SCAN_ty≥
)  1;

5041 
°bi__≤gchunk
 
c
 = 
	`°bi__gë_chunk_hódî
(
s
);

5042 
c
.
ty≥
) {

5043 
	`STBI__PNG_TYPE
('C','g','B','I'):

5044 
is_ùh⁄e
 = 1;

5045 
	`°bi__skù
(
s
, 
c
.
Àngth
);

5047 
	`STBI__PNG_TYPE
('I','H','D','R'): {

5048 
comp
,
fûãr
;

5049 i‡(!
fú°
Ë 
	`°bi__îr
("multiple IHDR","Corrupt PNG");

5050 
fú°
 = 0;

5051 i‡(
c
.
Àngth
 !13Ë 
	`°bi__îr
("bad IHDRÜen","Corrupt PNG");

5052 
s
->
img_x
 = 
	`°bi__gë32be
(s);

5053 
s
->
img_y
 = 
	`°bi__gë32be
(s);

5054 i‡(
s
->
img_y
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îr
("tooÜarge","VeryÜarge image (corrupt?)");

5055 i‡(
s
->
img_x
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îr
("tooÜarge","VeryÜarge image (corrupt?)");

5056 
z
->
dïth
 = 
	`°bi__gë8
(
s
); i‡(z->dïth !1 && z->dïth !2 && z->dïth !4 && z->dïth !8 && z->dïth !16Ë 
	`°bi__îr
("1/2/4/8/16-bit only","PNGÇot supported: 1/2/4/8/16-bit only");

5057 
cﬁ‹
 = 
	`°bi__gë8
(
s
); i‡(cﬁ‹ > 6Ë 
	`°bi__îr
("bad ctype","Corrupt PNG");

5058 i‡(
cﬁ‹
 =3 && 
z
->
dïth
 =16Ë 
	`°bi__îr
("bad ctype","Corrupt PNG");

5059 i‡(
cﬁ‹
 =3Ë
∑l_img_n
 = 3; i‡(cﬁ‹ & 1Ë 
	`°bi__îr
("bad ctype","Corrupt PNG");

5060 
comp
 = 
	`°bi__gë8
(
s
); i‡(compË 
	`°bi__îr
("bad comp method","Corrupt PNG");

5061 
fûãr

	`°bi__gë8
(
s
); i‡(fûãrË 
	`°bi__îr
("bad filter method","Corrupt PNG");

5062 
öãæa˚
 = 
	`°bi__gë8
(
s
); i‡(öãæa˚>1Ë 
	`°bi__îr
("bad interlace method","Corrupt PNG");

5063 i‡(!
s
->
img_x
 || !s->
img_y
Ë 
	`°bi__îr
("0-pixel image","Corrupt PNG");

5064 i‡(!
∑l_img_n
) {

5065 
s
->
img_n
 = (
cﬁ‹
 & 2 ? 3 : 1) + (color & 4 ? 1 : 0);

5066 i‡((1 << 30Ë/ 
s
->
img_x
 / s->
img_n
 < s->
img_y
Ë 
	`°bi__îr
("tooÜarge", "ImageÅooÜargeÅo decode");

5067 i‡(
sˇn
 =
STBI__SCAN_hódî
)  1;

5071 
s
->
img_n
 = 1;

5072 i‡((1 << 30Ë/ 
s
->
img_x
 / 4 < s->
img_y
Ë 
	`°bi__îr
("tooÜarge","Corrupt PNG");

5078 
	`STBI__PNG_TYPE
('P','L','T','E'): {

5079 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

5080 i‡(
c
.
Àngth
 > 256*3Ë 
	`°bi__îr
("invalid PLTE","Corrupt PNG");

5081 
∑l_Àn
 = 
c
.
Àngth
 / 3;

5082 i‡(
∑l_Àn
 * 3 !
c
.
Àngth
Ë 
	`°bi__îr
("invalid PLTE","Corrupt PNG");

5083 
i
=0; i < 
∑l_Àn
; ++i) {

5084 
∑Àâe
[
i
*4+0] = 
	`°bi__gë8
(
s
);

5085 
∑Àâe
[
i
*4+1] = 
	`°bi__gë8
(
s
);

5086 
∑Àâe
[
i
*4+2] = 
	`°bi__gë8
(
s
);

5087 
∑Àâe
[
i
*4+3] = 255;

5092 
	`STBI__PNG_TYPE
('t','R','N','S'): {

5093 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

5094 i‡(
z
->
id©a
Ë 
	`°bi__îr
("tRNSáfter IDAT","Corrupt PNG");

5095 i‡(
∑l_img_n
) {

5096 i‡(
sˇn
 =
STBI__SCAN_hódî
Ë{ 
s
->
img_n
 = 4;  1; }

5097 i‡(
∑l_Àn
 =0Ë 
	`°bi__îr
("tRNS before PLTE","Corrupt PNG");

5098 i‡(
c
.
Àngth
 > 
∑l_Àn
Ë 
	`°bi__îr
("badÅRNSÜen","Corrupt PNG");

5099 
∑l_img_n
 = 4;

5100 
i
=0; i < 
c
.
Àngth
; ++i)

5101 
∑Àâe
[
i
*4+3] = 
	`°bi__gë8
(
s
);

5103 i‡(!(
s
->
img_n
 & 1)Ë 
	`°bi__îr
("tRNS withálpha","Corrupt PNG");

5104 i‡(
c
.
Àngth
 !(
°bi__uöt32
Ë
s
->
img_n
*2Ë 
	`°bi__îr
("badÅRNSÜen","Corrupt PNG");

5105 
has_å™s
 = 1;

5106 i‡(
z
->
dïth
 == 16) {

5107 
k
 = 0; k < 
s
->
img_n
; ++kË
tc16
[k] = (
°bi__uöt16
)
	`°bi__gë16be
(s);

5109 
k
 = 0; k < 
s
->
img_n
; ++kË
tc
[k] = (
°bi_uc
)(
	`°bi__gë16be
(sË& 255Ë* 
°bi__dïth_sˇÀ_èbÀ
[
z
->
dïth
];

5115 
	`STBI__PNG_TYPE
('I','D','A','T'): {

5116 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

5117 i‡(
∑l_img_n
 && !
∑l_Àn
Ë 
	`°bi__îr
("no PLTE","Corrupt PNG");

5118 i‡(
sˇn
 =
STBI__SCAN_hódî
Ë{ 
s
->
img_n
 = 
∑l_img_n
;  1; }

5119 i‡(()(
ioff
 + 
c
.
Àngth
) < ()ioff)  0;

5120 i‡(
ioff
 + 
c
.
Àngth
 > 
id©a_limô
) {

5121 
°bi__uöt32
 
id©a_limô_ﬁd
 = 
id©a_limô
;

5122 
°bi_uc
 *
p
;

5123 i‡(
id©a_limô
 =0Ëid©a_limô = 
c
.
Àngth
 > 4096 ? c.length : 4096;

5124 
ioff
 + 
c
.
Àngth
 > 
id©a_limô
)

5125 
id©a_limô
 *= 2;

5126 
	`STBI_NOTUSED
(
id©a_limô_ﬁd
);

5127 
p
 = (
°bi_uc
 *Ë
	`STBI_REALLOC_SIZED
(
z
->
id©a
, 
id©a_limô_ﬁd
, 
id©a_limô
); i‡’ =
NULL
Ë 
	`°bi__îr
("outofmem", "Out of memory");

5128 
z
->
id©a
 = 
p
;

5130 i‡(!
	`°bi__gën
(
s
, 
z
->
id©a
+
ioff
,
c
.
Àngth
)Ë 
	`°bi__îr
("outofdata","Corrupt PNG");

5131 
ioff
 +
c
.
Àngth
;

5135 
	`STBI__PNG_TYPE
('I','E','N','D'): {

5136 
°bi__uöt32
 
øw_Àn
, 
b∂
;

5137 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

5138 i‡(
sˇn
 !
STBI__SCAN_lﬂd
)  1;

5139 i‡(
z
->
id©a
 =
NULL
Ë 
	`°bi__îr
("no IDAT","Corrupt PNG");

5141 
b∂
 = (
s
->
img_x
 * 
z
->
dïth
 + 7) / 8;

5142 
øw_Àn
 = 
b∂
 * 
s
->
img_y
 * s->
img_n
 + s->img_y ;

5143 
z
->
ex∑nded
 = (
°bi_uc
 *Ë
	`°bi_zlib_decode_mÆloc_guesssize_hódîÊag
((*Ëz->
id©a
, 
ioff
, 
øw_Àn
, (*Ë&øw_Àn, !
is_ùh⁄e
);

5144 i‡(
z
->
ex∑nded
 =
NULL
)  0;

5145 
	`STBI_FREE
(
z
->
id©a
); z->id©®
NULL
;

5146 i‡((
ªq_comp
 =
s
->
img_n
+1 &&Ñeq_com∞!3 && !
∑l_img_n
Ë|| 
has_å™s
)

5147 
s
->
img_out_n
 = s->
img_n
+1;

5149 
s
->
img_out_n
 = s->
img_n
;

5150 i‡(!
	`°bi__¸óã_≤g_image
(
z
, z->
ex∑nded
, 
øw_Àn
, 
s
->
img_out_n
, z->
dïth
, 
cﬁ‹
, 
öãæa˚
))  0;

5151 i‡(
has_å™s
) {

5152 i‡(
z
->
dïth
 == 16) {

5153 i‡(!
	`°bi__compuã_å™•¨ícy16
(
z
, 
tc16
, 
s
->
img_out_n
))  0;

5155 i‡(!
	`°bi__compuã_å™•¨ícy
(
z
, 
tc
, 
s
->
img_out_n
))  0;

5158 i‡(
is_ùh⁄e
 && 
°bi__de_ùh⁄e_Êag
 && 
s
->
img_out_n
 > 2)

5159 
	`°bi__de_ùh⁄e
(
z
);

5160 i‡(
∑l_img_n
) {

5162 
s
->
img_n
 = 
∑l_img_n
;

5163 
s
->
img_out_n
 = 
∑l_img_n
;

5164 i‡(
ªq_comp
 >3Ë
s
->
img_out_n
 =Ñeq_comp;

5165 i‡(!
	`°bi__ex∑nd_≤g_∑Àâe
(
z
, 
∑Àâe
, 
∑l_Àn
, 
s
->
img_out_n
))

5167 } i‡(
has_å™s
) {

5169 ++
s
->
img_n
;

5171 
	`STBI_FREE
(
z
->
ex∑nded
); z->ex∑nded = 
NULL
;

5173 
	`°bi__gë32be
(
s
);

5179 i‡(
fú°
Ë 
	`°bi__îr
("firstÇot IHDR", "Corrupt PNG");

5180 i‡((
c
.
ty≥
 & (1 << 29)) == 0) {

5181 #i‚de‡
STBI_NO_FAILURE_STRINGS


5183 
övÆid_chunk
[] = "XXXX PNG chunkÇot known";

5184 
övÆid_chunk
[0] = 
	`STBI__BYTECAST
(
c
.
ty≥
 >> 24);

5185 
övÆid_chunk
[1] = 
	`STBI__BYTECAST
(
c
.
ty≥
 >> 16);

5186 
övÆid_chunk
[2] = 
	`STBI__BYTECAST
(
c
.
ty≥
 >> 8);

5187 
övÆid_chunk
[3] = 
	`STBI__BYTECAST
(
c
.
ty≥
 >> 0);

5189  
	`°bi__îr
(
övÆid_chunk
, "PNGÇot supported: unknown PNG chunkÅype");

5191 
	`°bi__skù
(
s
, 
c
.
Àngth
);

5195 
	`°bi__gë32be
(
s
);

5197 
	}
}

5199 *
	$°bi__do_≤g
(
°bi__≤g
 *
p
, *
x
, *
y
, *
n
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

5201 *
ªsu…
=
NULL
;

5202 i‡(
ªq_comp
 < 0 ||Ñeq_com∞> 4Ë 
	`°bi__îΩuc
("badÑeq_comp", "InternalÉrror");

5203 i‡(
	`°bi__∑r£_≤g_fûe
(
p
, 
STBI__SCAN_lﬂd
, 
ªq_comp
)) {

5204 i‡(
p
->
dïth
 <= 8)

5205 
ri
->
bôs_≥r_ch™√l
 = 8;

5206 i‡(
p
->
dïth
 == 16)

5207 
ri
->
bôs_≥r_ch™√l
 = 16;

5209  
	`°bi__îΩuc
("bad bits_per_channel", "PNGÇot supported: unsupported color depth");

5210 
ªsu…
 = 
p
->
out
;

5211 
p
->
out
 = 
NULL
;

5212 i‡(
ªq_comp
 &&Ñeq_com∞!
p
->
s
->
img_out_n
) {

5213 i‡(
ri
->
bôs_≥r_ch™√l
 == 8)

5214 
ªsu…
 = 
	`°bi__c⁄vît_f‹m©
((*Ëªsu…, 
p
->
s
->
img_out_n
, 
ªq_comp
,Ö->s->
img_x
,Ö->s->
img_y
);

5216 
ªsu…
 = 
	`°bi__c⁄vît_f‹m©16
((
°bi__uöt16
 *Ëªsu…, 
p
->
s
->
img_out_n
, 
ªq_comp
,Ö->s->
img_x
,Ö->s->
img_y
);

5217 
p
->
s
->
img_out_n
 = 
ªq_comp
;

5218 i‡(
ªsu…
 =
NULL
) Ñesult;

5220 *
x
 = 
p
->
s
->
img_x
;

5221 *
y
 = 
p
->
s
->
img_y
;

5222 i‡(
n
Ë*¿
p
->
s
->
img_n
;

5224 
	`STBI_FREE
(
p
->
out
);Ö->ouà
NULL
;

5225 
	`STBI_FREE
(
p
->
ex∑nded
);Ö->ex∑nded = 
NULL
;

5226 
	`STBI_FREE
(
p
->
id©a
);Ö->id©®
NULL
;

5228  
ªsu…
;

5229 
	}
}

5231 *
	$°bi__≤g_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

5233 
°bi__≤g
 
p
;

5234 
p
.
s
 = s;

5235  
	`°bi__do_≤g
(&
p
, 
x
,
y
,
comp
,
ªq_comp
, 
ri
);

5236 
	}
}

5238 
	$°bi__≤g_ã°
(
°bi__c⁄ãxt
 *
s
)

5240 
r
;

5241 
r
 = 
	`°bi__check_≤g_hódî
(
s
);

5242 
	`°bi__ªwöd
(
s
);

5243  
r
;

5244 
	}
}

5246 
	$°bi__≤g_öfo_øw
(
°bi__≤g
 *
p
, *
x
, *
y
, *
comp
)

5248 i‡(!
	`°bi__∑r£_≤g_fûe
(
p
, 
STBI__SCAN_hódî
, 0)) {

5249 
	`°bi__ªwöd
–
p
->
s
 );

5252 i‡(
x
Ë*x = 
p
->
s
->
img_x
;

5253 i‡(
y
Ë*y = 
p
->
s
->
img_y
;

5254 i‡(
comp
Ë*com∞
p
->
s
->
img_n
;

5256 
	}
}

5258 
	$°bi__≤g_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

5260 
°bi__≤g
 
p
;

5261 
p
.
s
 = s;

5262  
	`°bi__≤g_öfo_øw
(&
p
, 
x
, 
y
, 
comp
);

5263 
	}
}

5265 
	$°bi__≤g_is16
(
°bi__c⁄ãxt
 *
s
)

5267 
°bi__≤g
 
p
;

5268 
p
.
s
 = s;

5269 i‡(!
	`°bi__≤g_öfo_øw
(&
p
, 
NULL
, NULL, NULL))

5271 i‡(
p
.
dïth
 != 16) {

5272 
	`°bi__ªwöd
(
p
.
s
);

5276 
	}
}

5281 #i‚de‡
STBI_NO_BMP


5282 
	$°bi__bmp_ã°_øw
(
°bi__c⁄ãxt
 *
s
)

5284 
r
;

5285 
sz
;

5286 i‡(
	`°bi__gë8
(
s
) != 'B')  0;

5287 i‡(
	`°bi__gë8
(
s
) != 'M')  0;

5288 
	`°bi__gë32À
(
s
);

5289 
	`°bi__gë16À
(
s
);

5290 
	`°bi__gë16À
(
s
);

5291 
	`°bi__gë32À
(
s
);

5292 
sz
 = 
	`°bi__gë32À
(
s
);

5293 
r
 = (
sz
 == 12 || sz == 40 || sz == 56 || sz == 108 || sz == 124);

5294  
r
;

5295 
	}
}

5297 
	$°bi__bmp_ã°
(
°bi__c⁄ãxt
 *
s
)

5299 
r
 = 
	`°bi__bmp_ã°_øw
(
s
);

5300 
	`°bi__ªwöd
(
s
);

5301  
r
;

5302 
	}
}

5306 
	$°bi__high_bô
(
z
)

5308 
n
=0;

5309 i‡(
z
 == 0)  -1;

5310 i‡(
z
 >0x10000Ë{ 
n
 += 16; z >>= 16; }

5311 i‡(
z
 >0x00100Ë{ 
n
 += 8; z >>= 8; }

5312 i‡(
z
 >0x00010Ë{ 
n
 += 4; z >>= 4; }

5313 i‡(
z
 >0x00004Ë{ 
n
 += 2; z >>= 2; }

5314 i‡(
z
 >0x00002Ë{ 
n
 += 1; }

5315  
n
;

5316 
	}
}

5318 
	$°bi__bôcou¡
(
a
)

5320 
a
 = (a & 0x55555555) + ((a >> 1) & 0x55555555);

5321 
a
 = (a & 0x33333333) + ((a >> 2) & 0x33333333);

5322 
a
 = (a + (a >> 4)) & 0x0f0f0f0f;

5323 
a
 = (a + (a >> 8));

5324 
a
 = (a + (a >> 16));

5325  
a
 & 0xff;

5326 
	}
}

5331 
	$°bi__shi·sig√d
(
v
, 
shi·
, 
bôs
)

5333 
mul_èbÀ
[9] = {

5338 
shi·_èbÀ
[9] = {

5341 i‡(
shi·
 < 0)

5342 
v
 <<-
shi·
;

5344 
v
 >>
shi·
;

5345 
	`STBI_ASSERT
(
v
 < 256);

5346 
v
 >>(8-
bôs
);

5347 
	`STBI_ASSERT
(
bôs
 >= 0 && bits <= 8);

5348  (Ë((Ë
v
 * 
mul_èbÀ
[
bôs
]Ë>> 
shi·_èbÀ
[bits];

5349 
	}
}

5353 
	mbµ
, 
	moff£t
, 
	mhsz
;

5354 
	mmr
,
	mmg
,
	mmb
,
	mma
, 
	mÆl_a
;

5355 
	mexåa_ªad
;

5356 } 
	t°bi__bmp_d©a
;

5358 
	$°bi__bmp_£t_mask_deÁu…s
(
°bi__bmp_d©a
 *
öfo
, 
com¥ess
)

5361 i‡(
com¥ess
 == 3)

5364 i‡(
com¥ess
 == 0) {

5365 i‡(
öfo
->
bµ
 == 16) {

5366 
öfo
->
mr
 = 31u << 10;

5367 
öfo
->
mg
 = 31u << 5;

5368 
öfo
->
mb
 = 31u << 0;

5369 } i‡(
öfo
->
bµ
 == 32) {

5370 
öfo
->
mr
 = 0xffu << 16;

5371 
öfo
->
mg
 = 0xffu << 8;

5372 
öfo
->
mb
 = 0xffu << 0;

5373 
öfo
->
ma
 = 0xffu << 24;

5374 
öfo
->
Æl_a
 = 0;

5377 
öfo
->
mr
 = info->
mg
 = info->
mb
 = info->
ma
 = 0;

5382 
	}
}

5384 *
	$°bi__bmp_∑r£_hódî
(
°bi__c⁄ãxt
 *
s
, 
°bi__bmp_d©a
 *
öfo
)

5386 
hsz
;

5387 i‡(
	`°bi__gë8
(
s
Ë!'B' || stbi__gë8(sË!'M'Ë 
	`°bi__îΩuc
("not BMP", "Corrupt BMP");

5388 
	`°bi__gë32À
(
s
);

5389 
	`°bi__gë16À
(
s
);

5390 
	`°bi__gë16À
(
s
);

5391 
öfo
->
off£t
 = 
	`°bi__gë32À
(
s
);

5392 
öfo
->
hsz
 = hsz = 
	`°bi__gë32À
(
s
);

5393 
öfo
->
mr
 = info->
mg
 = info->
mb
 = info->
ma
 = 0;

5394 
öfo
->
exåa_ªad
 = 14;

5396 i‡(
öfo
->
off£t
 < 0Ë 
	`°bi__îΩuc
("bad BMP", "bad BMP");

5398 i‡(
hsz
 !12 && hsz !40 && hsz !56 && hsz !108 && hsz !124Ë 
	`°bi__îΩuc
("unknown BMP", "BMPÅypeÇot supported: unknown");

5399 i‡(
hsz
 == 12) {

5400 
s
->
img_x
 = 
	`°bi__gë16À
(s);

5401 
s
->
img_y
 = 
	`°bi__gë16À
(s);

5403 
s
->
img_x
 = 
	`°bi__gë32À
(s);

5404 
s
->
img_y
 = 
	`°bi__gë32À
(s);

5406 i‡(
	`°bi__gë16À
(
s
Ë!1Ë 
	`°bi__îΩuc
("bad BMP", "bad BMP");

5407 
öfo
->
bµ
 = 
	`°bi__gë16À
(
s
);

5408 i‡(
hsz
 != 12) {

5409 
com¥ess
 = 
	`°bi__gë32À
(
s
);

5410 i‡(
com¥ess
 =1 || com¥es†=2Ë 
	`°bi__îΩuc
("BMP RLE", "BMPÅypeÇot supported: RLE");

5411 i‡(
com¥ess
 >4Ë 
	`°bi__îΩuc
("BMP JPEG/PNG", "BMPÅypeÇot supported: unsupported compression");

5412 i‡(
com¥ess
 =3 && 
öfo
->
bµ
 !16 && info->bµ !32Ë 
	`°bi__îΩuc
("bad BMP", "bad BMP");

5413 
	`°bi__gë32À
(
s
);

5414 
	`°bi__gë32À
(
s
);

5415 
	`°bi__gë32À
(
s
);

5416 
	`°bi__gë32À
(
s
);

5417 
	`°bi__gë32À
(
s
);

5418 i‡(
hsz
 == 40 || hsz == 56) {

5419 i‡(
hsz
 == 56) {

5420 
	`°bi__gë32À
(
s
);

5421 
	`°bi__gë32À
(
s
);

5422 
	`°bi__gë32À
(
s
);

5423 
	`°bi__gë32À
(
s
);

5425 i‡(
öfo
->
bµ
 == 16 || info->bpp == 32) {

5426 i‡(
com¥ess
 == 0) {

5427 
	`°bi__bmp_£t_mask_deÁu…s
(
öfo
, 
com¥ess
);

5428 } i‡(
com¥ess
 == 3) {

5429 
öfo
->
mr
 = 
	`°bi__gë32À
(
s
);

5430 
öfo
->
mg
 = 
	`°bi__gë32À
(
s
);

5431 
öfo
->
mb
 = 
	`°bi__gë32À
(
s
);

5432 
öfo
->
exåa_ªad
 += 12;

5434 i‡(
öfo
->
mr
 =öfo->
mg
 && info->mg =öfo->
mb
) {

5436  
	`°bi__îΩuc
("bad BMP", "bad BMP");

5439  
	`°bi__îΩuc
("bad BMP", "bad BMP");

5443 
i
;

5444 i‡(
hsz
 != 108 && hsz != 124)

5445  
	`°bi__îΩuc
("bad BMP", "bad BMP");

5446 
öfo
->
mr
 = 
	`°bi__gë32À
(
s
);

5447 
öfo
->
mg
 = 
	`°bi__gë32À
(
s
);

5448 
öfo
->
mb
 = 
	`°bi__gë32À
(
s
);

5449 
öfo
->
ma
 = 
	`°bi__gë32À
(
s
);

5450 i‡(
com¥ess
 != 3)

5451 
	`°bi__bmp_£t_mask_deÁu…s
(
öfo
, 
com¥ess
);

5452 
	`°bi__gë32À
(
s
);

5453 
i
=0; i < 12; ++i)

5454 
	`°bi__gë32À
(
s
);

5455 i‡(
hsz
 == 124) {

5456 
	`°bi__gë32À
(
s
);

5457 
	`°bi__gë32À
(
s
);

5458 
	`°bi__gë32À
(
s
);

5459 
	`°bi__gë32À
(
s
);

5464 
	}
}

5467 *
	$°bi__bmp_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

5469 
°bi_uc
 *
out
;

5470 
mr
=0,
mg
=0,
mb
=0,
ma
=0, 
Æl_a
;

5471 
°bi_uc
 
∑l
[256][4];

5472 
psize
=0,
i
,
j
,
width
;

5473 
Êù_vîtiˇŒy
, 
∑d
, 
èrgë
;

5474 
°bi__bmp_d©a
 
öfo
;

5475 
	`STBI_NOTUSED
(
ri
);

5477 
öfo
.
Æl_a
 = 255;

5478 i‡(
	`°bi__bmp_∑r£_hódî
(
s
, &
öfo
Ë=
NULL
)

5479  
NULL
;

5481 
Êù_vîtiˇŒy
 = ((Ë
s
->
img_y
) > 0;

5482 
s
->
img_y
 = 
	`abs
(() s->img_y);

5484 i‡(
s
->
img_y
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îΩuc
("tooÜarge","VeryÜarge image (corrupt?)");

5485 i‡(
s
->
img_x
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îΩuc
("tooÜarge","VeryÜarge image (corrupt?)");

5487 
mr
 = 
öfo
.mr;

5488 
mg
 = 
öfo
.mg;

5489 
mb
 = 
öfo
.mb;

5490 
ma
 = 
öfo
.ma;

5491 
Æl_a
 = 
öfo
.all_a;

5493 i‡(
öfo
.
hsz
 == 12) {

5494 i‡(
öfo
.
bµ
 < 24)

5495 
psize
 = (
öfo
.
off£t
 - info.
exåa_ªad
 - 24) / 3;

5497 i‡(
öfo
.
bµ
 < 16)

5498 
psize
 = (
öfo
.
off£t
 - info.
exåa_ªad
 - info.
hsz
) >> 2;

5500 i‡(
psize
 == 0) {

5501 i‡(
öfo
.
off£t
 !
s
->
ˇŒback_Æªady_ªad
 + (s->
img_buf„r
 - s->
img_buf„r_‹igöÆ
)) {

5502  
	`°bi__îΩuc
("bad offset", "Corrupt BMP");

5506 i‡(
öfo
.
bµ
 =24 && 
ma
 == 0xff000000)

5507 
s
->
img_n
 = 3;

5509 
s
->
img_n
 = 
ma
 ? 4 : 3;

5510 i‡(
ªq_comp
 &&Ñeq_comp >= 3)

5511 
èrgë
 = 
ªq_comp
;

5513 
èrgë
 = 
s
->
img_n
;

5516 i‡(!
	`°bi__mad3sizes_vÆid
(
èrgë
, 
s
->
img_x
, s->
img_y
, 0))

5517  
	`°bi__îΩuc
("tooÜarge", "Corrupt BMP");

5519 
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
èrgë
, 
s
->
img_x
, s->
img_y
, 0);

5520 i‡(!
out
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

5521 i‡(
öfo
.
bµ
 < 16) {

5522 
z
=0;

5523 i‡(
psize
 =0 ||Ösizê> 256Ë{ 
	`STBI_FREE
(
out
);  
	`°bi__îΩuc
("invalid", "Corrupt BMP"); }

5524 
i
=0; i < 
psize
; ++i) {

5525 
∑l
[
i
][2] = 
	`°bi__gë8
(
s
);

5526 
∑l
[
i
][1] = 
	`°bi__gë8
(
s
);

5527 
∑l
[
i
][0] = 
	`°bi__gë8
(
s
);

5528 i‡(
öfo
.
hsz
 !12Ë
	`°bi__gë8
(
s
);

5529 
∑l
[
i
][3] = 255;

5531 
	`°bi__skù
(
s
, 
öfo
.
off£t
 - info.
exåa_ªad
 - info.
hsz
 - 
psize
 * (info.hsz == 12 ? 3 : 4));

5532 i‡(
öfo
.
bµ
 =1Ë
width
 = (
s
->
img_x
 + 7) >> 3;

5533 i‡(
öfo
.
bµ
 =4Ë
width
 = (
s
->
img_x
 + 1) >> 1;

5534 i‡(
öfo
.
bµ
 =8Ë
width
 = 
s
->
img_x
;

5535 { 
	`STBI_FREE
(
out
);  
	`°bi__îΩuc
("bad bpp", "Corrupt BMP"); }

5536 
∑d
 = (-
width
)&3;

5537 i‡(
öfo
.
bµ
 == 1) {

5538 
j
=0; j < (Ë
s
->
img_y
; ++j) {

5539 
bô_off£t
 = 7, 
v
 = 
	`°bi__gë8
(
s
);

5540 
i
=0; i < (Ë
s
->
img_x
; ++i) {

5541 
cﬁ‹
 = (
v
>>
bô_off£t
)&0x1;

5542 
out
[
z
++] = 
∑l
[
cﬁ‹
][0];

5543 
out
[
z
++] = 
∑l
[
cﬁ‹
][1];

5544 
out
[
z
++] = 
∑l
[
cﬁ‹
][2];

5545 i‡(
èrgë
 =4Ë
out
[
z
++] = 255;

5546 i‡(
i
+1 =(Ë
s
->
img_x
) ;

5547 if((--
bô_off£t
) < 0) {

5548 
bô_off£t
 = 7;

5549 
v
 = 
	`°bi__gë8
(
s
);

5552 
	`°bi__skù
(
s
, 
∑d
);

5555 
j
=0; j < (Ë
s
->
img_y
; ++j) {

5556 
i
=0; i < (Ë
s
->
img_x
; i += 2) {

5557 
v
=
	`°bi__gë8
(
s
),
v2
=0;

5558 i‡(
öfo
.
bµ
 == 4) {

5559 
v2
 = 
v
 & 15;

5560 
v
 >>= 4;

5562 
out
[
z
++] = 
∑l
[
v
][0];

5563 
out
[
z
++] = 
∑l
[
v
][1];

5564 
out
[
z
++] = 
∑l
[
v
][2];

5565 i‡(
èrgë
 =4Ë
out
[
z
++] = 255;

5566 i‡(
i
+1 =(Ë
s
->
img_x
) ;

5567 
v
 = (
öfo
.
bµ
 =8Ë? 
	`°bi__gë8
(
s
Ë: 
v2
;

5568 
out
[
z
++] = 
∑l
[
v
][0];

5569 
out
[
z
++] = 
∑l
[
v
][1];

5570 
out
[
z
++] = 
∑l
[
v
][2];

5571 i‡(
èrgë
 =4Ë
out
[
z
++] = 255;

5573 
	`°bi__skù
(
s
, 
∑d
);

5577 
rshi·
=0,
gshi·
=0,
bshi·
=0,
ashi·
=0,
rcou¡
=0,
gcou¡
=0,
bcou¡
=0,
acou¡
=0;

5578 
z
 = 0;

5579 
ósy
=0;

5580 
	`°bi__skù
(
s
, 
öfo
.
off£t
 - info.
exåa_ªad
 - info.
hsz
);

5581 i‡(
öfo
.
bµ
 =24Ë
width
 = 3 * 
s
->
img_x
;

5582 i‡(
öfo
.
bµ
 =16Ë
width
 = 2*
s
->
img_x
;

5583 
width
=0;

5584 
∑d
 = (-
width
) & 3;

5585 i‡(
öfo
.
bµ
 == 24) {

5586 
ósy
 = 1;

5587 } i‡(
öfo
.
bµ
 == 32) {

5588 i‡(
mb
 =0xf‡&& 
mg
 =0xff00 && 
mr
 =0x00ff0000 && 
ma
 == 0xff000000)

5589 
ósy
 = 2;

5591 i‡(!
ósy
) {

5592 i‡(!
mr
 || !
mg
 || !
mb
Ë{ 
	`STBI_FREE
(
out
);  
	`°bi__îΩuc
("bad masks", "Corrupt BMP"); }

5594 
rshi·
 = 
	`°bi__high_bô
(
mr
)-7; 
rcou¡
 = 
	`°bi__bôcou¡
(mr);

5595 
gshi·
 = 
	`°bi__high_bô
(
mg
)-7; 
gcou¡
 = 
	`°bi__bôcou¡
(mg);

5596 
bshi·
 = 
	`°bi__high_bô
(
mb
)-7; 
bcou¡
 = 
	`°bi__bôcou¡
(mb);

5597 
ashi·
 = 
	`°bi__high_bô
(
ma
)-7; 
acou¡
 = 
	`°bi__bôcou¡
(ma);

5598 i‡(
rcou¡
 > 8 || 
gcou¡
 > 8 || 
bcou¡
 > 8 || 
acou¡
 > 8Ë{ 
	`STBI_FREE
(
out
);  
	`°bi__îΩuc
("bad masks", "Corrupt BMP"); }

5600 
j
=0; j < (Ë
s
->
img_y
; ++j) {

5601 i‡(
ósy
) {

5602 
i
=0; i < (Ë
s
->
img_x
; ++i) {

5603 
a
;

5604 
out
[
z
+2] = 
	`°bi__gë8
(
s
);

5605 
out
[
z
+1] = 
	`°bi__gë8
(
s
);

5606 
out
[
z
+0] = 
	`°bi__gë8
(
s
);

5607 
z
 += 3;

5608 
a
 = (
ósy
 =2 ? 
	`°bi__gë8
(
s
) : 255);

5609 
Æl_a
 |
a
;

5610 i‡(
èrgë
 =4Ë
out
[
z
++] = 
a
;

5613 
bµ
 = 
öfo
.bpp;

5614 
i
=0; i < (Ë
s
->
img_x
; ++i) {

5615 
°bi__uöt32
 
v
 = (
bµ
 =16 ? (°bi__uöt32Ë
	`°bi__gë16À
(
s
Ë: 
	`°bi__gë32À
(s));

5616 
a
;

5617 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`°bi__shi·sig√d
(
v
 & 
mr
, 
rshi·
, 
rcou¡
));

5618 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`°bi__shi·sig√d
(
v
 & 
mg
, 
gshi·
, 
gcou¡
));

5619 
out
[
z
++] = 
	`STBI__BYTECAST
(
	`°bi__shi·sig√d
(
v
 & 
mb
, 
bshi·
, 
bcou¡
));

5620 
a
 = (
ma
 ? 
	`°bi__shi·sig√d
(
v
 & ma, 
ashi·
, 
acou¡
) : 255);

5621 
Æl_a
 |
a
;

5622 i‡(
èrgë
 =4Ë
out
[
z
++] = 
	`STBI__BYTECAST
(
a
);

5625 
	`°bi__skù
(
s
, 
∑d
);

5630 i‡(
èrgë
 =4 && 
Æl_a
 == 0)

5631 
i
=4*
s
->
img_x
*s->
img_y
-1; i >= 0; i -= 4)

5632 
out
[
i
] = 255;

5634 i‡(
Êù_vîtiˇŒy
) {

5635 
°bi_uc
 
t
;

5636 
j
=0; j < (Ë
s
->
img_y
>>1; ++j) {

5637 
°bi_uc
 *
p1
 = 
out
 + 
j
 *
s
->
img_x
*
èrgë
;

5638 
°bi_uc
 *
p2
 = 
out
 + (
s
->
img_y
-1-
j
)*s->
img_x
*
èrgë
;

5639 
i
=0; i < (Ë
s
->
img_x
*
èrgë
; ++i) {

5640 
t
 = 
p1
[
i
];Ö1[i] = 
p2
[i];Ö2[i] =Å;

5645 i‡(
ªq_comp
 &&Ñeq_com∞!
èrgë
) {

5646 
out
 = 
	`°bi__c⁄vît_f‹m©
(out, 
èrgë
, 
ªq_comp
, 
s
->
img_x
, s->
img_y
);

5647 i‡(
out
 =
NULL
)  out;

5650 *
x
 = 
s
->
img_x
;

5651 *
y
 = 
s
->
img_y
;

5652 i‡(
comp
Ë*com∞
s
->
img_n
;

5653  
out
;

5654 
	}
}

5659 #i‚de‡
STBI_NO_TGA


5661 
	$°bi__tga_gë_comp
(
bôs_≥r_pixñ
, 
is_gªy
, * 
is_rgb16
)

5664 i‡(
is_rgb16
) *is_rgb16 = 0;

5665 
bôs_≥r_pixñ
) {

5666 8:  
STBI_gªy
;

5667 16: if(
is_gªy
Ë 
STBI_gªy_Æpha
;

5669 15: if(
is_rgb16
) *is_rgb16 = 1;

5670  
STBI_rgb
;

5672 32:  
bôs_≥r_pixñ
/8;

5675 
	}
}

5677 
	$°bi__tga_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

5679 
tga_w
, 
tga_h
, 
tga_comp
, 
tga_image_ty≥
, 
tga_bôs_≥r_pixñ
, 
tga_cﬁ‹m≠_bµ
;

5680 
sz
, 
tga_cﬁ‹m≠_ty≥
;

5681 
	`°bi__gë8
(
s
);

5682 
tga_cﬁ‹m≠_ty≥
 = 
	`°bi__gë8
(
s
);

5683 if–
tga_cﬁ‹m≠_ty≥
 > 1 ) {

5684 
	`°bi__ªwöd
(
s
);

5687 
tga_image_ty≥
 = 
	`°bi__gë8
(
s
);

5688 i‡–
tga_cﬁ‹m≠_ty≥
 == 1 ) {

5689 i‡(
tga_image_ty≥
 != 1 &&Åga_image_type != 9) {

5690 
	`°bi__ªwöd
(
s
);

5693 
	`°bi__skù
(
s
,4);

5694 
sz
 = 
	`°bi__gë8
(
s
);

5695 i‡–(
sz
 != 8) && (sz != 15) && (sz != 16) && (sz != 24) && (sz != 32) ) {

5696 
	`°bi__ªwöd
(
s
);

5699 
	`°bi__skù
(
s
,4);

5700 
tga_cﬁ‹m≠_bµ
 = 
sz
;

5702 i‡–(
tga_image_ty≥
 != 2) && (tga_image_type != 3) && (tga_image_type != 10) && (tga_image_type != 11) ) {

5703 
	`°bi__ªwöd
(
s
);

5706 
	`°bi__skù
(
s
,9);

5707 
tga_cﬁ‹m≠_bµ
 = 0;

5709 
tga_w
 = 
	`°bi__gë16À
(
s
);

5710 if–
tga_w
 < 1 ) {

5711 
	`°bi__ªwöd
(
s
);

5714 
tga_h
 = 
	`°bi__gë16À
(
s
);

5715 if–
tga_h
 < 1 ) {

5716 
	`°bi__ªwöd
(
s
);

5719 
tga_bôs_≥r_pixñ
 = 
	`°bi__gë8
(
s
);

5720 
	`°bi__gë8
(
s
);

5721 i‡(
tga_cﬁ‹m≠_bµ
 != 0) {

5722 if((
tga_bôs_≥r_pixñ
 != 8) && (tga_bits_per_pixel != 16)) {

5725 
	`°bi__ªwöd
(
s
);

5728 
tga_comp
 = 
	`°bi__tga_gë_comp
(
tga_cﬁ‹m≠_bµ
, 0, 
NULL
);

5730 
tga_comp
 = 
	`°bi__tga_gë_comp
(
tga_bôs_≥r_pixñ
, (
tga_image_ty≥
 =3Ë|| (tga_image_ty≥ =11), 
NULL
);

5732 if(!
tga_comp
) {

5733 
	`°bi__ªwöd
(
s
);

5736 i‡(
x
Ë*x = 
tga_w
;

5737 i‡(
y
Ë*y = 
tga_h
;

5738 i‡(
comp
Ë*com∞
tga_comp
;

5740 
	}
}

5742 
	$°bi__tga_ã°
(
°bi__c⁄ãxt
 *
s
)

5744 
ªs
 = 0;

5745 
sz
, 
tga_cﬁ‹_ty≥
;

5746 
	`°bi__gë8
(
s
);

5747 
tga_cﬁ‹_ty≥
 = 
	`°bi__gë8
(
s
);

5748 i‡–
tga_cﬁ‹_ty≥
 > 1 ) 
îr‹End
;

5749 
sz
 = 
	`°bi__gë8
(
s
);

5750 i‡–
tga_cﬁ‹_ty≥
 == 1 ) {

5751 i‡(
sz
 !1 && sz !9Ë
îr‹End
;

5752 
	`°bi__skù
(
s
,4);

5753 
sz
 = 
	`°bi__gë8
(
s
);

5754 i‡–(
sz
 !8Ë&& (sz !15Ë&& (sz !16Ë&& (sz !24Ë&& (sz !32ËË
îr‹End
;

5755 
	`°bi__skù
(
s
,4);

5757 i‡–(
sz
 !2Ë&& (sz !3Ë&& (sz !10Ë&& (sz !11ËË
îr‹End
;

5758 
	`°bi__skù
(
s
,9);

5760 i‡–
	`°bi__gë16À
(
s
Ë< 1 ) 
îr‹End
;

5761 i‡–
	`°bi__gë16À
(
s
Ë< 1 ) 
îr‹End
;

5762 
sz
 = 
	`°bi__gë8
(
s
);

5763 i‡–(
tga_cﬁ‹_ty≥
 =1Ë&& (
sz
 !8Ë&& (sz !16ËË
îr‹End
;

5764 i‡–(
sz
 !8Ë&& (sz !15Ë&& (sz !16Ë&& (sz !24Ë&& (sz !32ËË
îr‹End
;

5766 
ªs
 = 1;

5768 
îr‹End
:

5769 
	`°bi__ªwöd
(
s
);

5770  
ªs
;

5771 
	}
}

5774 
	$°bi__tga_ªad_rgb16
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
* 
out
)

5776 
°bi__uöt16
 
px
 = (°bi__uöt16)
	`°bi__gë16À
(
s
);

5777 
°bi__uöt16
 
fiveBôMask
 = 31;

5779 
r
 = (
px
 >> 10Ë& 
fiveBôMask
;

5780 
g
 = (
px
 >> 5Ë& 
fiveBôMask
;

5781 
b
 = 
px
 & 
fiveBôMask
;

5783 
out
[0] = (
°bi_uc
)((
r
 * 255)/31);

5784 
out
[1] = (
°bi_uc
)((
g
 * 255)/31);

5785 
out
[2] = (
°bi_uc
)((
b
 * 255)/31);

5791 
	}
}

5793 *
	$°bi__tga_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

5796 
tga_off£t
 = 
	`°bi__gë8
(
s
);

5797 
tga_ödexed
 = 
	`°bi__gë8
(
s
);

5798 
tga_image_ty≥
 = 
	`°bi__gë8
(
s
);

5799 
tga_is_RLE
 = 0;

5800 
tga_∑Àâe_°¨t
 = 
	`°bi__gë16À
(
s
);

5801 
tga_∑Àâe_Àn
 = 
	`°bi__gë16À
(
s
);

5802 
tga_∑Àâe_bôs
 = 
	`°bi__gë8
(
s
);

5803 
tga_x_‹igö
 = 
	`°bi__gë16À
(
s
);

5804 
tga_y_‹igö
 = 
	`°bi__gë16À
(
s
);

5805 
tga_width
 = 
	`°bi__gë16À
(
s
);

5806 
tga_height
 = 
	`°bi__gë16À
(
s
);

5807 
tga_bôs_≥r_pixñ
 = 
	`°bi__gë8
(
s
);

5808 
tga_comp
, 
tga_rgb16
=0;

5809 
tga_övîãd
 = 
	`°bi__gë8
(
s
);

5812 *
tga_d©a
;

5813 *
tga_∑Àâe
 = 
NULL
;

5814 
i
, 
j
;

5815 
øw_d©a
[4] = {0};

5816 
RLE_cou¡
 = 0;

5817 
RLE_ª≥©ög
 = 0;

5818 
ªad_√xt_pixñ
 = 1;

5819 
	`STBI_NOTUSED
(
ri
);

5820 
	`STBI_NOTUSED
(
tga_x_‹igö
);

5821 
	`STBI_NOTUSED
(
tga_y_‹igö
);

5823 i‡(
tga_height
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îΩuc
("tooÜarge","VeryÜarge image (corrupt?)");

5824 i‡(
tga_width
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îΩuc
("tooÜarge","VeryÜarge image (corrupt?)");

5827 i‡–
tga_image_ty≥
 >= 8 )

5829 
tga_image_ty≥
 -= 8;

5830 
tga_is_RLE
 = 1;

5832 
tga_övîãd
 = 1 - ((tga_inverted >> 5) & 1);

5835 i‡–
tga_ödexed
 ) 
tga_comp
 = 
	`°bi__tga_gë_comp
(
tga_∑Àâe_bôs
, 0, &
tga_rgb16
);

5836 
tga_comp
 = 
	`°bi__tga_gë_comp
(
tga_bôs_≥r_pixñ
, (
tga_image_ty≥
 =3), &
tga_rgb16
);

5838 if(!
tga_comp
)

5839  
	`°bi__îΩuc
("bad format", "Can't find out TGAÖixelformat");

5842 *
x
 = 
tga_width
;

5843 *
y
 = 
tga_height
;

5844 i‡(
comp
Ë*com∞
tga_comp
;

5846 i‡(!
	`°bi__mad3sizes_vÆid
(
tga_width
, 
tga_height
, 
tga_comp
, 0))

5847  
	`°bi__îΩuc
("tooÜarge", "Corrupt TGA");

5849 
tga_d©a
 = (*)
	`°bi__mÆloc_mad3
(
tga_width
, 
tga_height
, 
tga_comp
, 0);

5850 i‡(!
tga_d©a
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

5853 
	`°bi__skù
(
s
, 
tga_off£t
 );

5855 i‡–!
tga_ödexed
 && !
tga_is_RLE
 && !
tga_rgb16
 ) {

5856 
i
=0; i < 
tga_height
; ++i) {

5857 
row
 = 
tga_övîãd
 ? 
tga_height
 -
i
 - 1 : i;

5858 
°bi_uc
 *
tga_row
 = 
tga_d©a
 + 
row
*
tga_width
*
tga_comp
;

5859 
	`°bi__gën
(
s
, 
tga_row
, 
tga_width
 * 
tga_comp
);

5863 i‡–
tga_ödexed
)

5865 i‡(
tga_∑Àâe_Àn
 == 0) {

5866 
	`STBI_FREE
(
tga_d©a
);

5867  
	`°bi__îΩuc
("badÖalette", "Corrupt TGA");

5871 
	`°bi__skù
(
s
, 
tga_∑Àâe_°¨t
 );

5873 
tga_∑Àâe
 = (*)
	`°bi__mÆloc_mad2
(
tga_∑Àâe_Àn
, 
tga_comp
, 0);

5874 i‡(!
tga_∑Àâe
) {

5875 
	`STBI_FREE
(
tga_d©a
);

5876  
	`°bi__îΩuc
("outofmem", "Out of memory");

5878 i‡(
tga_rgb16
) {

5879 
°bi_uc
 *
∑l_íåy
 = 
tga_∑Àâe
;

5880 
	`STBI_ASSERT
(
tga_comp
 =
STBI_rgb
);

5881 
i
=0; i < 
tga_∑Àâe_Àn
; ++i) {

5882 
	`°bi__tga_ªad_rgb16
(
s
, 
∑l_íåy
);

5883 
∑l_íåy
 +
tga_comp
;

5885 } i‡(!
	`°bi__gën
(
s
, 
tga_∑Àâe
, 
tga_∑Àâe_Àn
 * 
tga_comp
)) {

5886 
	`STBI_FREE
(
tga_d©a
);

5887 
	`STBI_FREE
(
tga_∑Àâe
);

5888  
	`°bi__îΩuc
("badÖalette", "Corrupt TGA");

5892 
i
=0; i < 
tga_width
 * 
tga_height
; ++i)

5895 i‡–
tga_is_RLE
 )

5897 i‡–
RLE_cou¡
 == 0 )

5900 
RLE_cmd
 = 
	`°bi__gë8
(
s
);

5901 
RLE_cou¡
 = 1 + (
RLE_cmd
 & 127);

5902 
RLE_ª≥©ög
 = 
RLE_cmd
 >> 7;

5903 
ªad_√xt_pixñ
 = 1;

5904 } i‡–!
RLE_ª≥©ög
 )

5906 
ªad_√xt_pixñ
 = 1;

5910 
ªad_√xt_pixñ
 = 1;

5913 i‡–
ªad_√xt_pixñ
 )

5916 i‡–
tga_ödexed
 )

5919 
∑l_idx
 = (
tga_bôs_≥r_pixñ
 =8Ë? 
	`°bi__gë8
(
s
Ë: 
	`°bi__gë16À
(s);

5920 i‡–
∑l_idx
 >
tga_∑Àâe_Àn
 ) {

5922 
∑l_idx
 = 0;

5924 
∑l_idx
 *
tga_comp
;

5925 
j
 = 0; j < 
tga_comp
; ++j) {

5926 
øw_d©a
[
j
] = 
tga_∑Àâe
[
∑l_idx
+j];

5928 } if(
tga_rgb16
) {

5929 
	`STBI_ASSERT
(
tga_comp
 =
STBI_rgb
);

5930 
	`°bi__tga_ªad_rgb16
(
s
, 
øw_d©a
);

5933 
j
 = 0; j < 
tga_comp
; ++j) {

5934 
øw_d©a
[
j
] = 
	`°bi__gë8
(
s
);

5938 
ªad_√xt_pixñ
 = 0;

5942 
j
 = 0; j < 
tga_comp
; ++j)

5943 
tga_d©a
[
i
*
tga_comp
+
j
] = 
øw_d©a
[j];

5946 --
RLE_cou¡
;

5949 i‡–
tga_övîãd
 )

5951 
j
 = 0; j*2 < 
tga_height
; ++j)

5953 
ödex1
 = 
j
 * 
tga_width
 * 
tga_comp
;

5954 
ödex2
 = (
tga_height
 - 1 - 
j
Ë* 
tga_width
 * 
tga_comp
;

5955 
i
 = 
tga_width
 * 
tga_comp
; i > 0; --i)

5957 
ãmp
 = 
tga_d©a
[
ödex1
];

5958 
tga_d©a
[
ödex1
] =Åga_d©a[
ödex2
];

5959 
tga_d©a
[
ödex2
] = 
ãmp
;

5960 ++
ödex1
;

5961 ++
ödex2
;

5966 i‡–
tga_∑Àâe
 !
NULL
 )

5968 
	`STBI_FREE
–
tga_∑Àâe
 );

5973 i‡(
tga_comp
 >3 && !
tga_rgb16
)

5975 * 
tga_pixñ
 = 
tga_d©a
;

5976 
i
=0; i < 
tga_width
 * 
tga_height
; ++i)

5978 
ãmp
 = 
tga_pixñ
[0];

5979 
tga_pixñ
[0] =Åga_pixel[2];

5980 
tga_pixñ
[2] = 
ãmp
;

5981 
tga_pixñ
 +
tga_comp
;

5986 i‡(
ªq_comp
 &&Ñeq_com∞!
tga_comp
)

5987 
tga_d©a
 = 
	`°bi__c⁄vît_f‹m©
—ga_d©a, 
tga_comp
, 
ªq_comp
, 
tga_width
, 
tga_height
);

5991 
tga_∑Àâe_°¨t
 = 
tga_∑Àâe_Àn
 = 
tga_∑Àâe_bôs
 =

5992 
tga_x_‹igö
 = 
tga_y_‹igö
 = 0;

5993 
	`STBI_NOTUSED
(
tga_∑Àâe_°¨t
);

5995  
tga_d©a
;

5996 
	}
}

6002 #i‚de‡
STBI_NO_PSD


6003 
	$°bi__psd_ã°
(
°bi__c⁄ãxt
 *
s
)

6005 
r
 = (
	`°bi__gë32be
(
s
) == 0x38425053);

6006 
	`°bi__ªwöd
(
s
);

6007  
r
;

6008 
	}
}

6010 
	$°bi__psd_decode_æe
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
 *
p
, 
pixñCou¡
)

6012 
cou¡
, 
∆e·
, 
Àn
;

6014 
cou¡
 = 0;

6015 (
∆e·
 = 
pixñCou¡
 - 
cou¡
) > 0) {

6016 
Àn
 = 
	`°bi__gë8
(
s
);

6017 i‡(
Àn
 == 128) {

6019 } i‡(
Àn
 < 128) {

6021 
Àn
++;

6022 i‡(
Àn
 > 
∆e·
)  0;

6023 
cou¡
 +
Àn
;

6024 
Àn
) {

6025 *
p
 = 
	`°bi__gë8
(
s
);

6026 
p
 += 4;

6027 
Àn
--;

6029 } i‡(
Àn
 > 128) {

6030 
°bi_uc
 
vÆ
;

6033 
Àn
 = 257 -Üen;

6034 i‡(
Àn
 > 
∆e·
)  0;

6035 
vÆ
 = 
	`°bi__gë8
(
s
);

6036 
cou¡
 +
Àn
;

6037 
Àn
) {

6038 *
p
 = 
vÆ
;

6039 
p
 += 4;

6040 
Àn
--;

6046 
	}
}

6048 *
	$°bi__psd_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
, 
bpc
)

6050 
pixñCou¡
;

6051 
ch™√lCou¡
, 
com¥essi⁄
;

6052 
ch™√l
, 
i
;

6053 
bôdïth
;

6054 
w
,
h
;

6055 
°bi_uc
 *
out
;

6056 
	`STBI_NOTUSED
(
ri
);

6059 i‡(
	`°bi__gë32be
(
s
) != 0x38425053)

6060  
	`°bi__îΩuc
("not PSD", "Corrupt PSD image");

6063 i‡(
	`°bi__gë16be
(
s
) != 1)

6064  
	`°bi__îΩuc
("wrong version", "Unsupported version of PSD image");

6067 
	`°bi__skù
(
s
, 6 );

6070 
ch™√lCou¡
 = 
	`°bi__gë16be
(
s
);

6071 i‡(
ch™√lCou¡
 < 0 || channelCount > 16)

6072  
	`°bi__îΩuc
("wrong channel count", "UnsupportedÇumber of channels in PSD image");

6075 
h
 = 
	`°bi__gë32be
(
s
);

6076 
w
 = 
	`°bi__gë32be
(
s
);

6078 i‡(
h
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îΩuc
("tooÜarge","VeryÜarge image (corrupt?)");

6079 i‡(
w
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îΩuc
("tooÜarge","VeryÜarge image (corrupt?)");

6082 
bôdïth
 = 
	`°bi__gë16be
(
s
);

6083 i‡(
bôdïth
 != 8 && bitdepth != 16)

6084  
	`°bi__îΩuc
("unsupported bit depth", "PSD bit depth isÇot 8 or 16 bit");

6096 i‡(
	`°bi__gë16be
(
s
) != 3)

6097  
	`°bi__îΩuc
("wrong color format", "PSD isÇot in RGB color format");

6100 
	`°bi__skù
(
s
,
	`°bi__gë32be
(s) );

6103 
	`°bi__skù
(
s
, 
	`°bi__gë32be
(s) );

6106 
	`°bi__skù
(
s
, 
	`°bi__gë32be
(s) );

6112 
com¥essi⁄
 = 
	`°bi__gë16be
(
s
);

6113 i‡(
com¥essi⁄
 > 1)

6114  
	`°bi__îΩuc
("bad compression", "PSD hasán unknown compression format");

6117 i‡(!
	`°bi__mad3sizes_vÆid
(4, 
w
, 
h
, 0))

6118  
	`°bi__îΩuc
("tooÜarge", "Corrupt PSD");

6122 i‡(!
com¥essi⁄
 && 
bôdïth
 =16 && 
bpc
 == 16) {

6123 
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(8, 
w
, 
h
, 0);

6124 
ri
->
bôs_≥r_ch™√l
 = 16;

6126 
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(4 * 
w
*
h
);

6128 i‡(!
out
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

6129 
pixñCou¡
 = 
w
*
h
;

6135 i‡(
com¥essi⁄
) {

6146 
	`°bi__skù
(
s
, 
h
 * 
ch™√lCou¡
 * 2 );

6149 
ch™√l
 = 0; channel < 4; channel++) {

6150 
°bi_uc
 *
p
;

6152 
p
 = 
out
+
ch™√l
;

6153 i‡(
ch™√l
 >
ch™√lCou¡
) {

6155 
i
 = 0; i < 
pixñCou¡
; i++, 
p
 += 4)

6156 *
p
 = (
ch™√l
 == 3 ? 255 : 0);

6159 i‡(!
	`°bi__psd_decode_æe
(
s
, 
p
, 
pixñCou¡
)) {

6160 
	`STBI_FREE
(
out
);

6161  
	`°bi__îΩuc
("corrupt", "bad RLE data");

6171 
ch™√l
 = 0; channel < 4; channel++) {

6172 i‡(
ch™√l
 >
ch™√lCou¡
) {

6174 i‡(
bôdïth
 =16 && 
bpc
 == 16) {

6175 
°bi__uöt16
 *
q
 = ((°bi__uöt16 *Ë
out
Ë+ 
ch™√l
;

6176 
°bi__uöt16
 
vÆ
 = 
ch™√l
 == 3 ? 65535 : 0;

6177 
i
 = 0; i < 
pixñCou¡
; i++, 
q
 += 4)

6178 *
q
 = 
vÆ
;

6180 
°bi_uc
 *
p
 = 
out
+
ch™√l
;

6181 
°bi_uc
 
vÆ
 = 
ch™√l
 == 3 ? 255 : 0;

6182 
i
 = 0; i < 
pixñCou¡
; i++, 
p
 += 4)

6183 *
p
 = 
vÆ
;

6186 i‡(
ri
->
bôs_≥r_ch™√l
 == 16) {

6187 
°bi__uöt16
 *
q
 = ((°bi__uöt16 *Ë
out
Ë+ 
ch™√l
;

6188 
i
 = 0; i < 
pixñCou¡
; i++, 
q
 += 4)

6189 *
q
 = (
°bi__uöt16
Ë
	`°bi__gë16be
(
s
);

6191 
°bi_uc
 *
p
 = 
out
+
ch™√l
;

6192 i‡(
bôdïth
 == 16) {

6193 
i
 = 0; i < 
pixñCou¡
; i++, 
p
 += 4)

6194 *
p
 = (
°bi_uc
Ë(
	`°bi__gë16be
(
s
) >> 8);

6196 
i
 = 0; i < 
pixñCou¡
; i++, 
p
 += 4)

6197 *
p
 = 
	`°bi__gë8
(
s
);

6205 i‡(
ch™√lCou¡
 >= 4) {

6206 i‡(
ri
->
bôs_≥r_ch™√l
 == 16) {

6207 
i
=0; i < 
w
*
h
; ++i) {

6208 
°bi__uöt16
 *
pixñ
 = (°bi__uöt16 *Ë
out
 + 4*
i
;

6209 i‡(
pixñ
[3] != 0 &&Öixel[3] != 65535) {

6210 
a
 = 
pixñ
[3] / 65535.0f;

6211 
ø
 = 1.0‡/ 
a
;

6212 
öv_a
 = 65535.0‡* (1 - 
ø
);

6213 
pixñ
[0] = (
°bi__uöt16
Ë’ixñ[0]*
ø
 + 
öv_a
);

6214 
pixñ
[1] = (
°bi__uöt16
Ë’ixñ[1]*
ø
 + 
öv_a
);

6215 
pixñ
[2] = (
°bi__uöt16
Ë’ixñ[2]*
ø
 + 
öv_a
);

6219 
i
=0; i < 
w
*
h
; ++i) {

6220 *
pixñ
 = 
out
 + 4*
i
;

6221 i‡(
pixñ
[3] != 0 &&Öixel[3] != 255) {

6222 
a
 = 
pixñ
[3] / 255.0f;

6223 
ø
 = 1.0‡/ 
a
;

6224 
öv_a
 = 255.0‡* (1 - 
ø
);

6225 
pixñ
[0] = (Ë’ixñ[0]*
ø
 + 
öv_a
);

6226 
pixñ
[1] = (Ë’ixñ[1]*
ø
 + 
öv_a
);

6227 
pixñ
[2] = (Ë’ixñ[2]*
ø
 + 
öv_a
);

6234 i‡(
ªq_comp
 &&Ñeq_comp != 4) {

6235 i‡(
ri
->
bôs_≥r_ch™√l
 == 16)

6236 
out
 = (
°bi_uc
 *Ë
	`°bi__c⁄vît_f‹m©16
((
°bi__uöt16
 *Ëout, 4, 
ªq_comp
, 
w
, 
h
);

6238 
out
 = 
	`°bi__c⁄vît_f‹m©
(out, 4, 
ªq_comp
, 
w
, 
h
);

6239 i‡(
out
 =
NULL
)  out;

6242 i‡(
comp
) *comp = 4;

6243 *
y
 = 
h
;

6244 *
x
 = 
w
;

6246  
out
;

6247 
	}
}

6257 #i‚de‡
STBI_NO_PIC


6258 
	$°bi__pic_is4
(
°bi__c⁄ãxt
 *
s
,c⁄° *
°r
)

6260 
i
;

6261 
i
=0; i<4; ++i)

6262 i‡(
	`°bi__gë8
(
s
Ë!(
°bi_uc
)
°r
[
i
])

6266 
	}
}

6268 
	$°bi__pic_ã°_c‹e
(
°bi__c⁄ãxt
 *
s
)

6270 
i
;

6272 i‡(!
	`°bi__pic_is4
(
s
,"\x53\x80\xF6\x34"))

6275 
i
=0;i<84;++i)

6276 
	`°bi__gë8
(
s
);

6278 i‡(!
	`°bi__pic_is4
(
s
,"PICT"))

6282 
	}
}

6286 
°bi_uc
 
	msize
,
	mty≥
,
	mch™√l
;

6287 } 
	t°bi__pic_∑ckë
;

6289 
°bi_uc
 *
	$°bi__ªadvÆ
(
°bi__c⁄ãxt
 *
s
, 
ch™√l
, 
°bi_uc
 *
de°
)

6291 
mask
=0x80, 
i
;

6293 
i
=0; i<4; ++i, 
mask
>>=1) {

6294 i‡(
ch™√l
 & 
mask
) {

6295 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","PIC fileÅoo short");

6296 
de°
[
i
]=
	`°bi__gë8
(
s
);

6300  
de°
;

6301 
	}
}

6303 
	$°bi__c›yvÆ
(
ch™√l
,
°bi_uc
 *
de°
,c⁄° stbi_u¯*
§c
)

6305 
mask
=0x80,
i
;

6307 
i
=0;i<4; ++i, 
mask
>>=1)

6308 i‡(
ch™√l
&
mask
)

6309 
de°
[
i
]=
§c
[i];

6310 
	}
}

6312 
°bi_uc
 *
	$°bi__pic_lﬂd_c‹e
(
°bi__c⁄ãxt
 *
s
,
width
,
height
,*
comp
, 
°bi_uc
 *
ªsu…
)

6314 
a˘_comp
=0,
num_∑ckës
=0,
y
,
chaöed
;

6315 
°bi__pic_∑ckë
 
∑ckës
[10];

6320 
°bi__pic_∑ckë
 *
∑ckë
;

6322 i‡(
num_∑ckës
==(
∑ckës
)/(packets[0]))

6323  
	`°bi__îΩuc
("bad format","too manyÖackets");

6325 
∑ckë
 = &
∑ckës
[
num_∑ckës
++];

6327 
chaöed
 = 
	`°bi__gë8
(
s
);

6328 
∑ckë
->
size
 = 
	`°bi__gë8
(
s
);

6329 
∑ckë
->
ty≥
 = 
	`°bi__gë8
(
s
);

6330 
∑ckë
->
ch™√l
 = 
	`°bi__gë8
(
s
);

6332 
a˘_comp
 |
∑ckë
->
ch™√l
;

6334 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","fileÅoo short (readingÖackets)");

6335 i‡(
∑ckë
->
size
 !8Ë 
	`°bi__îΩuc
("bad format","packet isn't 8bpp");

6336 } 
chaöed
);

6338 *
comp
 = (
a˘_comp
 & 0x10 ? 4 : 3);

6340 
y
=0; y<
height
; ++y) {

6341 
∑ckë_idx
;

6343 
∑ckë_idx
=0;Öackë_idx < 
num_∑ckës
; ++packet_idx) {

6344 
°bi__pic_∑ckë
 *
∑ckë
 = &
∑ckës
[
∑ckë_idx
];

6345 
°bi_uc
 *
de°
 = 
ªsu…
+
y
*
width
*4;

6347 
∑ckë
->
ty≥
) {

6349  
	`°bi__îΩuc
("bad format","packet has bad compressionÅype");

6352 
x
;

6354 
x
=0;x<
width
;++x, 
de°
+=4)

6355 i‡(!
	`°bi__ªadvÆ
(
s
,
∑ckë
->
ch™√l
,
de°
))

6362 
À·
=
width
, 
i
;

6364 
À·
>0) {

6365 
°bi_uc
 
cou¡
,
vÆue
[4];

6367 
cou¡
=
	`°bi__gë8
(
s
);

6368 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","fileÅoo short (pureÑead count)");

6370 i‡(
cou¡
 > 
À·
)

6371 
cou¡
 = (
°bi_uc
Ë
À·
;

6373 i‡(!
	`°bi__ªadvÆ
(
s
,
∑ckë
->
ch™√l
,
vÆue
))  0;

6375 
i
=0; i<
cou¡
; ++i,
de°
+=4)

6376 
	`°bi__c›yvÆ
(
∑ckë
->
ch™√l
,
de°
,
vÆue
);

6377 
À·
 -
cou¡
;

6383 
À·
=
width
;

6384 
À·
>0) {

6385 
cou¡
 = 
	`°bi__gë8
(
s
), 
i
;

6386 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","fileÅoo short (mixedÑead count)");

6388 i‡(
cou¡
 >= 128) {

6389 
°bi_uc
 
vÆue
[4];

6391 i‡(
cou¡
==128)

6392 
cou¡
 = 
	`°bi__gë16be
(
s
);

6394 
cou¡
 -= 127;

6395 i‡(
cou¡
 > 
À·
)

6396  
	`°bi__îΩuc
("bad file","scanline overrun");

6398 i‡(!
	`°bi__ªadvÆ
(
s
,
∑ckë
->
ch™√l
,
vÆue
))

6401 
i
=0;i<
cou¡
;++i, 
de°
 += 4)

6402 
	`°bi__c›yvÆ
(
∑ckë
->
ch™√l
,
de°
,
vÆue
);

6404 ++
cou¡
;

6405 i‡(
cou¡
>
À·
Ë 
	`°bi__îΩuc
("bad file","scanline overrun");

6407 
i
=0;i<
cou¡
;++i, 
de°
+=4)

6408 i‡(!
	`°bi__ªadvÆ
(
s
,
∑ckë
->
ch™√l
,
de°
))

6411 
À·
-=
cou¡
;

6419  
ªsu…
;

6420 
	}
}

6422 *
	$°bi__pic_lﬂd
(
°bi__c⁄ãxt
 *
s
,*
px
,*
py
,*
comp
,
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

6424 
°bi_uc
 *
ªsu…
;

6425 
i
, 
x
,
y
, 
öã∫Æ_comp
;

6426 
	`STBI_NOTUSED
(
ri
);

6428 i‡(!
comp
Ëcom∞&
öã∫Æ_comp
;

6430 
i
=0; i<92; ++i)

6431 
	`°bi__gë8
(
s
);

6433 
x
 = 
	`°bi__gë16be
(
s
);

6434 
y
 = 
	`°bi__gë16be
(
s
);

6436 i‡(
y
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îΩuc
("tooÜarge","VeryÜarge image (corrupt?)");

6437 i‡(
x
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îΩuc
("tooÜarge","VeryÜarge image (corrupt?)");

6439 i‡(
	`°bi__©_eof
(
s
)Ë 
	`°bi__îΩuc
("bad file","fileÅoo short (pic header)");

6440 i‡(!
	`°bi__mad3sizes_vÆid
(
x
, 
y
, 4, 0)Ë 
	`°bi__îΩuc
("tooÜarge", "PIC imageÅooÜargeÅo decode");

6442 
	`°bi__gë32be
(
s
);

6443 
	`°bi__gë16be
(
s
);

6444 
	`°bi__gë16be
(
s
);

6447 
ªsu…
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad3
(
x
, 
y
, 4, 0);

6448 i‡(!
ªsu…
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

6449 
	`mem£t
(
ªsu…
, 0xff, 
x
*
y
*4);

6451 i‡(!
	`°bi__pic_lﬂd_c‹e
(
s
,
x
,
y
,
comp
, 
ªsu…
)) {

6452 
	`STBI_FREE
(
ªsu…
);

6453 
ªsu…
=0;

6455 *
px
 = 
x
;

6456 *
py
 = 
y
;

6457 i‡(
ªq_comp
 =0Ëªq_com∞*
comp
;

6458 
ªsu…
=
	`°bi__c⁄vît_f‹m©
‘esu…,4,
ªq_comp
,
x
,
y
);

6460  
ªsu…
;

6461 
	}
}

6463 
	$°bi__pic_ã°
(
°bi__c⁄ãxt
 *
s
)

6465 
r
 = 
	`°bi__pic_ã°_c‹e
(
s
);

6466 
	`°bi__ªwöd
(
s
);

6467  
r
;

6468 
	}
}

6474 #i‚de‡
STBI_NO_GIF


6477 
°bi__öt16
 
	m¥efix
;

6478 
°bi_uc
 
	mfú°
;

6479 
°bi_uc
 
	msuffix
;

6480 } 
	t°bi__gif_lzw
;

6484 
	mw
,
	mh
;

6485 
°bi_uc
 *
	mout
;

6486 
°bi_uc
 *
	mbackground
;

6487 
°bi_uc
 *
	mhi°‹y
;

6488 
	mÊags
, 
	mbgödex
, 
	møtio
, 
	må™•¨ít
, 
	meÊags
;

6489 
°bi_uc
 
	m∑l
[256][4];

6490 
°bi_uc
 
	mÕÆ
[256][4];

6491 
°bi__gif_lzw
 
	mcodes
[8192];

6492 
°bi_uc
 *
	mcﬁ‹_èbÀ
;

6493 
	m∑r£
, 
	m°ï
;

6494 
	mlÊags
;

6495 
	m°¨t_x
, 
	m°¨t_y
;

6496 
	mmax_x
, 
	mmax_y
;

6497 
	mcur_x
, 
	mcur_y
;

6498 
	mlöe_size
;

6499 
	mdñay
;

6500 } 
	t°bi__gif
;

6502 
	$°bi__gif_ã°_øw
(
°bi__c⁄ãxt
 *
s
)

6504 
sz
;

6505 i‡(
	`°bi__gë8
(
s
) != 'G' || stbi__get8(s) != 'I' || stbi__get8(s) != 'F' || stbi__get8(s) != '8')  0;

6506 
sz
 = 
	`°bi__gë8
(
s
);

6507 i‡(
sz
 != '9' && sz != '7')  0;

6508 i‡(
	`°bi__gë8
(
s
) != 'a')  0;

6510 
	}
}

6512 
	$°bi__gif_ã°
(
°bi__c⁄ãxt
 *
s
)

6514 
r
 = 
	`°bi__gif_ã°_øw
(
s
);

6515 
	`°bi__ªwöd
(
s
);

6516  
r
;

6517 
	}
}

6519 
	$°bi__gif_∑r£_cﬁ‹èbÀ
(
°bi__c⁄ãxt
 *
s
, 
°bi_uc
 
∑l
[256][4], 
num_íåõs
, 
å™•
)

6521 
i
;

6522 
i
=0; i < 
num_íåõs
; ++i) {

6523 
∑l
[
i
][2] = 
	`°bi__gë8
(
s
);

6524 
∑l
[
i
][1] = 
	`°bi__gë8
(
s
);

6525 
∑l
[
i
][0] = 
	`°bi__gë8
(
s
);

6526 
∑l
[
i
][3] = 
å™•
 == i ? 0 : 255;

6528 
	}
}

6530 
	$°bi__gif_hódî
(
°bi__c⁄ãxt
 *
s
, 
°bi__gif
 *
g
, *
comp
, 
is_öfo
)

6532 
°bi_uc
 
vîsi⁄
;

6533 i‡(
	`°bi__gë8
(
s
) != 'G' || stbi__get8(s) != 'I' || stbi__get8(s) != 'F' || stbi__get8(s) != '8')

6534  
	`°bi__îr
("not GIF", "Corrupt GIF");

6536 
vîsi⁄
 = 
	`°bi__gë8
(
s
);

6537 i‡(
vîsi⁄
 !'7' && vîsi⁄ !'9'Ë 
	`°bi__îr
("not GIF", "Corrupt GIF");

6538 i‡(
	`°bi__gë8
(
s
Ë!'a'Ë 
	`°bi__îr
("not GIF", "Corrupt GIF");

6540 
°bi__g_Áûuª_ªas⁄
 = "";

6541 
g
->
w
 = 
	`°bi__gë16À
(
s
);

6542 
g
->
h
 = 
	`°bi__gë16À
(
s
);

6543 
g
->
Êags
 = 
	`°bi__gë8
(
s
);

6544 
g
->
bgödex
 = 
	`°bi__gë8
(
s
);

6545 
g
->
øtio
 = 
	`°bi__gë8
(
s
);

6546 
g
->
å™•¨ít
 = -1;

6548 i‡(
g
->
w
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îr
("tooÜarge","VeryÜarge image (corrupt?)");

6549 i‡(
g
->
h
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îr
("tooÜarge","VeryÜarge image (corrupt?)");

6551 i‡(
comp
 != 0) *comp = 4;

6553 i‡(
is_öfo
)  1;

6555 i‡(
g
->
Êags
 & 0x80)

6556 
	`°bi__gif_∑r£_cﬁ‹èbÀ
(
s
,
g
->
∑l
, 2 << (g->
Êags
 & 7), -1);

6559 
	}
}

6561 
	$°bi__gif_öfo_øw
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

6563 
°bi__gif
* 
g
 = (°bi__gif*Ë
	`°bi__mÆloc
((stbi__gif));

6564 i‡(!
g
Ë 
	`°bi__îr
("outofmem", "Out of memory");

6565 i‡(!
	`°bi__gif_hódî
(
s
, 
g
, 
comp
, 1)) {

6566 
	`STBI_FREE
(
g
);

6567 
	`°bi__ªwöd
–
s
 );

6570 i‡(
x
Ë*x = 
g
->
w
;

6571 i‡(
y
Ë*y = 
g
->
h
;

6572 
	`STBI_FREE
(
g
);

6574 
	}
}

6576 
	$°bi__out_gif_code
(
°bi__gif
 *
g
, 
°bi__uöt16
 
code
)

6578 
°bi_uc
 *
p
, *
c
;

6579 
idx
;

6583 i‡(
g
->
codes
[
code
].
¥efix
 >= 0)

6584 
	`°bi__out_gif_code
(
g
, g->
codes
[
code
].
¥efix
);

6586 i‡(
g
->
cur_y
 >g->
max_y
) ;

6588 
idx
 = 
g
->
cur_x
 + g->
cur_y
;

6589 
p
 = &
g
->
out
[
idx
];

6590 
g
->
hi°‹y
[
idx
 / 4] = 1;

6592 
c
 = &
g
->
cﬁ‹_èbÀ
[g->
codes
[
code
].
suffix
 * 4];

6593 i‡(
c
[3] > 128) {

6594 
p
[0] = 
c
[2];

6595 
p
[1] = 
c
[1];

6596 
p
[2] = 
c
[0];

6597 
p
[3] = 
c
[3];

6599 
g
->
cur_x
 += 4;

6601 i‡(
g
->
cur_x
 >g->
max_x
) {

6602 
g
->
cur_x
 = g->
°¨t_x
;

6603 
g
->
cur_y
 +g->
°ï
;

6605 
g
->
cur_y
 >g->
max_y
 && g->
∑r£
 > 0) {

6606 
g
->
°ï
 = (1 << g->
∑r£
Ë* g->
löe_size
;

6607 
g
->
cur_y
 = g->
°¨t_y
 + (g->
°ï
 >> 1);

6608 --
g
->
∑r£
;

6611 
	}
}

6613 
°bi_uc
 *
	$°bi__¥o˚ss_gif_ø°î
(
°bi__c⁄ãxt
 *
s
, 
°bi__gif
 *
g
)

6615 
°bi_uc
 
lzw_cs
;

6616 
°bi__öt32
 
Àn
, 
öô_code
;

6617 
°bi__uöt32
 
fú°
;

6618 
°bi__öt32
 
codesize
, 
codemask
, 
avaû
, 
ﬁdcode
, 
bôs
, 
vÆid_bôs
, 
˛ór
;

6619 
°bi__gif_lzw
 *
p
;

6621 
lzw_cs
 = 
	`°bi__gë8
(
s
);

6622 i‡(
lzw_cs
 > 12Ë 
NULL
;

6623 
˛ór
 = 1 << 
lzw_cs
;

6624 
fú°
 = 1;

6625 
codesize
 = 
lzw_cs
 + 1;

6626 
codemask
 = (1 << 
codesize
) - 1;

6627 
bôs
 = 0;

6628 
vÆid_bôs
 = 0;

6629 
öô_code
 = 0; inô_codê< 
˛ór
; init_code++) {

6630 
g
->
codes
[
öô_code
].
¥efix
 = -1;

6631 
g
->
codes
[
öô_code
].
fú°
 = (
°bi_uc
) init_code;

6632 
g
->
codes
[
öô_code
].
suffix
 = (
°bi_uc
) init_code;

6636 
avaû
 = 
˛ór
+2;

6637 
ﬁdcode
 = -1;

6639 
Àn
 = 0;

6641 i‡(
vÆid_bôs
 < 
codesize
) {

6642 i‡(
Àn
 == 0) {

6643 
Àn
 = 
	`°bi__gë8
(
s
);

6644 i‡(
Àn
 == 0)

6645  
g
->
out
;

6647 --
Àn
;

6648 
bôs
 |(
°bi__öt32
Ë
	`°bi__gë8
(
s
Ë<< 
vÆid_bôs
;

6649 
vÆid_bôs
 += 8;

6651 
°bi__öt32
 
code
 = 
bôs
 & 
codemask
;

6652 
bôs
 >>
codesize
;

6653 
vÆid_bôs
 -
codesize
;

6655 i‡(
code
 =
˛ór
) {

6656 
codesize
 = 
lzw_cs
 + 1;

6657 
codemask
 = (1 << 
codesize
) - 1;

6658 
avaû
 = 
˛ór
 + 2;

6659 
ﬁdcode
 = -1;

6660 
fú°
 = 0;

6661 } i‡(
code
 =
˛ór
 + 1) {

6662 
	`°bi__skù
(
s
, 
Àn
);

6663 (
Àn
 = 
	`°bi__gë8
(
s
)) > 0)

6664 
	`°bi__skù
(
s
,
Àn
);

6665  
g
->
out
;

6666 } i‡(
code
 <
avaû
) {

6667 i‡(
fú°
) {

6668  
	`°bi__îΩuc
("no clear code", "Corrupt GIF");

6671 i‡(
ﬁdcode
 >= 0) {

6672 
p
 = &
g
->
codes
[
avaû
++];

6673 i‡(
avaû
 > 8192) {

6674  
	`°bi__îΩuc
("too many codes", "Corrupt GIF");

6677 
p
->
¥efix
 = (
°bi__öt16
Ë
ﬁdcode
;

6678 
p
->
fú°
 = 
g
->
codes
[
ﬁdcode
].first;

6679 
p
->
suffix
 = (
code
 =
avaû
Ë?Ö->
fú°
 : 
g
->
codes
[code].first;

6680 } i‡(
code
 =
avaû
)

6681  
	`°bi__îΩuc
("illegal code inÑaster", "Corrupt GIF");

6683 
	`°bi__out_gif_code
(
g
, (
°bi__uöt16
Ë
code
);

6685 i‡((
avaû
 & 
codemask
) == 0 &&ávail <= 0x0FFF) {

6686 
codesize
++;

6687 
codemask
 = (1 << 
codesize
) - 1;

6690 
ﬁdcode
 = 
code
;

6692  
	`°bi__îΩuc
("illegal code inÑaster", "Corrupt GIF");

6696 
	}
}

6700 
°bi_uc
 *
	$°bi__gif_lﬂd_√xt
(
°bi__c⁄ãxt
 *
s
, 
°bi__gif
 *
g
, *
comp
, 
ªq_comp
, 
°bi_uc
 *
two_back
)

6702 
di•o£
;

6703 
fú°_‰ame
;

6704 
pi
;

6705 
pcou¡
;

6706 
	`STBI_NOTUSED
(
ªq_comp
);

6709 
fú°_‰ame
 = 0;

6710 i‡(
g
->
out
 == 0) {

6711 i‡(!
	`°bi__gif_hódî
(
s
, 
g
, 
comp
,0))  0;

6712 i‡(!
	`°bi__mad3sizes_vÆid
(4, 
g
->
w
, g->
h
, 0))

6713  
	`°bi__îΩuc
("tooÜarge", "GIF image isÅooÜarge");

6714 
pcou¡
 = 
g
->
w
 * g->
h
;

6715 
g
->
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(4 * 
pcou¡
);

6716 
g
->
background
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(4 * 
pcou¡
);

6717 
g
->
hi°‹y
 = (
°bi_uc
 *Ë
	`°bi__mÆloc
(
pcou¡
);

6718 i‡(!
g
->
out
 || !g->
background
 || !g->
hi°‹y
)

6719  
	`°bi__îΩuc
("outofmem", "Out of memory");

6724 
	`mem£t
(
g
->
out
, 0x00, 4 * 
pcou¡
);

6725 
	`mem£t
(
g
->
background
, 0x00, 4 * 
pcou¡
);

6726 
	`mem£t
(
g
->
hi°‹y
, 0x00, 
pcou¡
);

6727 
fú°_‰ame
 = 1;

6730 
di•o£
 = (
g
->
eÊags
 & 0x1C) >> 2;

6731 
pcou¡
 = 
g
->
w
 * g->
h
;

6733 i‡((
di•o£
 =3Ë&& (
two_back
 == 0)) {

6734 
di•o£
 = 2;

6737 i‡(
di•o£
 == 3) {

6738 
pi
 = 0;Öò< 
pcou¡
; ++pi) {

6739 i‡(
g
->
hi°‹y
[
pi
]) {

6740 
	`mem˝y
–&
g
->
out
[
pi
 * 4], &
two_back
[pi * 4], 4 );

6743 } i‡(
di•o£
 == 2) {

6745 
pi
 = 0;Öò< 
pcou¡
; ++pi) {

6746 i‡(
g
->
hi°‹y
[
pi
]) {

6747 
	`mem˝y
–&
g
->
out
[
pi
 * 4], &g->
background
[pi * 4], 4 );

6758 
	`mem˝y
–
g
->
background
, g->
out
, 4 * g->
w
 * g->
h
 );

6762 
	`mem£t
–
g
->
hi°‹y
, 0x00, g->
w
 * g->
h
 );

6765 
èg
 = 
	`°bi__gë8
(
s
);

6766 
èg
) {

6769 
°bi__öt32
 
x
, 
y
, 
w
, 
h
;

6770 
°bi_uc
 *
o
;

6772 
x
 = 
	`°bi__gë16À
(
s
);

6773 
y
 = 
	`°bi__gë16À
(
s
);

6774 
w
 = 
	`°bi__gë16À
(
s
);

6775 
h
 = 
	`°bi__gë16À
(
s
);

6776 i‡(((
x
 + 
w
Ë> (
g
->w)Ë|| ((
y
 + 
h
) > (g->h)))

6777  
	`°bi__îΩuc
("bad Image Descriptor", "Corrupt GIF");

6779 
g
->
löe_size
 = g->
w
 * 4;

6780 
g
->
°¨t_x
 = 
x
 * 4;

6781 
g
->
°¨t_y
 = 
y
 * g->
löe_size
;

6782 
g
->
max_x
 = g->
°¨t_x
 + 
w
 * 4;

6783 
g
->
max_y
 = g->
°¨t_y
 + 
h
 * g->
löe_size
;

6784 
g
->
cur_x
 = g->
°¨t_x
;

6785 
g
->
cur_y
 = g->
°¨t_y
;

6791 i‡(
w
 == 0)

6792 
g
->
cur_y
 = g->
max_y
;

6794 
g
->
lÊags
 = 
	`°bi__gë8
(
s
);

6796 i‡(
g
->
lÊags
 & 0x40) {

6797 
g
->
°ï
 = 8 * g->
löe_size
;

6798 
g
->
∑r£
 = 3;

6800 
g
->
°ï
 = g->
löe_size
;

6801 
g
->
∑r£
 = 0;

6804 i‡(
g
->
lÊags
 & 0x80) {

6805 
	`°bi__gif_∑r£_cﬁ‹èbÀ
(
s
,
g
->
ÕÆ
, 2 << (g->
lÊags
 & 7), g->
eÊags
 & 0x01 ? g->
å™•¨ít
 : -1);

6806 
g
->
cﬁ‹_èbÀ
 = (
°bi_uc
 *Ëg->
ÕÆ
;

6807 } i‡(
g
->
Êags
 & 0x80) {

6808 
g
->
cﬁ‹_èbÀ
 = (
°bi_uc
 *Ëg->
∑l
;

6810  
	`°bi__îΩuc
("missing colorÅable", "Corrupt GIF");

6812 
o
 = 
	`°bi__¥o˚ss_gif_ø°î
(
s
, 
g
);

6813 i‡(!
o
Ë 
NULL
;

6816 
pcou¡
 = 
g
->
w
 * g->
h
;

6817 i‡(
fú°_‰ame
 && (
g
->
bgödex
 > 0)) {

6819 
pi
 = 0;Öò< 
pcou¡
; ++pi) {

6820 i‡(
g
->
hi°‹y
[
pi
] == 0) {

6821 
g
->
∑l
[g->
bgödex
][3] = 255;

6822 
	`mem˝y
–&
g
->
out
[
pi
 * 4], &g->
∑l
[g->
bgödex
], 4 );

6827  
o
;

6832 
Àn
;

6833 
ext
 = 
	`°bi__gë8
(
s
);

6834 i‡(
ext
 == 0xF9) {

6835 
Àn
 = 
	`°bi__gë8
(
s
);

6836 i‡(
Àn
 == 4) {

6837 
g
->
eÊags
 = 
	`°bi__gë8
(
s
);

6838 
g
->
dñay
 = 10 * 
	`°bi__gë16À
(
s
);

6841 i‡(
g
->
å™•¨ít
 >= 0) {

6842 
g
->
∑l
[g->
å™•¨ít
][3] = 255;

6844 i‡(
g
->
eÊags
 & 0x01) {

6845 
g
->
å™•¨ít
 = 
	`°bi__gë8
(
s
);

6846 i‡(
g
->
å™•¨ít
 >= 0) {

6847 
g
->
∑l
[g->
å™•¨ít
][3] = 0;

6851 
	`°bi__skù
(
s
, 1);

6852 
g
->
å™•¨ít
 = -1;

6855 
	`°bi__skù
(
s
, 
Àn
);

6859 (
Àn
 = 
	`°bi__gë8
(
s
)) != 0) {

6860 
	`°bi__skù
(
s
, 
Àn
);

6866  (
°bi_uc
 *Ë
s
;

6869  
	`°bi__îΩuc
("unknown code", "Corrupt GIF");

6872 
	}
}

6874 *
	$°bi__lﬂd_gif_maö_outofmem
(
°bi__gif
 *
g
, 
°bi_uc
 *
out
, **
dñays
)

6876 
	`STBI_FREE
(
g
->
out
);

6877 
	`STBI_FREE
(
g
->
hi°‹y
);

6878 
	`STBI_FREE
(
g
->
background
);

6880 i‡(
out
Ë
	`STBI_FREE
(out);

6881 i‡(
dñays
 && *dñaysË
	`STBI_FREE
(*delays);

6882  
	`°bi__îΩuc
("outofmem", "Out of memory");

6883 
	}
}

6885 *
	$°bi__lﬂd_gif_maö
(
°bi__c⁄ãxt
 *
s
, **
dñays
, *
x
, *
y
, *
z
, *
comp
, 
ªq_comp
)

6887 i‡(
	`°bi__gif_ã°
(
s
)) {

6888 
œyîs
 = 0;

6889 
°bi_uc
 *
u
 = 0;

6890 
°bi_uc
 *
out
 = 0;

6891 
°bi_uc
 *
two_back
 = 0;

6892 
°bi__gif
 
g
;

6893 
°ride
;

6894 
out_size
 = 0;

6895 
dñays_size
 = 0;

6897 
	`STBI_NOTUSED
(
out_size
);

6898 
	`STBI_NOTUSED
(
dñays_size
);

6900 
	`mem£t
(&
g
, 0, (g));

6901 i‡(
dñays
) {

6902 *
dñays
 = 0;

6906 
u
 = 
	`°bi__gif_lﬂd_√xt
(
s
, &
g
, 
comp
, 
ªq_comp
, 
two_back
);

6907 i‡(
u
 =(
°bi_uc
 *Ë
s
) u = 0;

6909 i‡(
u
) {

6910 *
x
 = 
g
.
w
;

6911 *
y
 = 
g
.
h
;

6912 ++
œyîs
;

6913 
°ride
 = 
g
.
w
 * g.
h
 * 4;

6915 i‡(
out
) {

6916 *
tmp
 = (
°bi_uc
*Ë
	`STBI_REALLOC_SIZED
–
out
, 
out_size
, 
œyîs
 * 
°ride
 );

6917 i‡(!
tmp
)

6918  
	`°bi__lﬂd_gif_maö_outofmem
(&
g
, 
out
, 
dñays
);

6920 
out
 = (
°bi_uc
*Ë
tmp
;

6921 
out_size
 = 
œyîs
 * 
°ride
;

6924 i‡(
dñays
) {

6925 *
√w_dñays
 = (*Ë
	`STBI_REALLOC_SIZED
–*
dñays
, 
dñays_size
, (Ë* 
œyîs
 );

6926 i‡(!
√w_dñays
)

6927  
	`°bi__lﬂd_gif_maö_outofmem
(&
g
, 
out
, 
dñays
);

6928 *
dñays
 = 
√w_dñays
;

6929 
dñays_size
 = 
œyîs
 * ();

6932 
out
 = (
°bi_uc
*)
	`°bi__mÆloc
–
œyîs
 * 
°ride
 );

6933 i‡(!
out
)

6934  
	`°bi__lﬂd_gif_maö_outofmem
(&
g
, 
out
, 
dñays
);

6935 
out_size
 = 
œyîs
 * 
°ride
;

6936 i‡(
dñays
) {

6937 *
dñays
 = (*Ë
	`°bi__mÆloc
–
œyîs
 * () );

6938 i‡(!*
dñays
)

6939  
	`°bi__lﬂd_gif_maö_outofmem
(&
g
, 
out
, 
dñays
);

6940 
dñays_size
 = 
œyîs
 * ();

6943 
	`mem˝y
–
out
 + ((
œyîs
 - 1Ë* 
°ride
), 
u
, stride );

6944 i‡(
œyîs
 >= 2) {

6945 
two_back
 = 
out
 - 2 * 
°ride
;

6948 i‡(
dñays
) {

6949 (*
dñays
)[
œyîs
 - 1U] = 
g
.
dñay
;

6952 } 
u
 != 0);

6955 
	`STBI_FREE
(
g
.
out
);

6956 
	`STBI_FREE
(
g
.
hi°‹y
);

6957 
	`STBI_FREE
(
g
.
background
);

6960 i‡(
ªq_comp
 &&Ñeq_comp != 4)

6961 
out
 = 
	`°bi__c⁄vît_f‹m©
(out, 4, 
ªq_comp
, 
œyîs
 * 
g
.
w
, g.
h
);

6963 *
z
 = 
œyîs
;

6964  
out
;

6966  
	`°bi__îΩuc
("not GIF", "Image wasÇotásá gifÅype.");

6968 
	}
}

6970 *
	$°bi__gif_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

6972 
°bi_uc
 *
u
 = 0;

6973 
°bi__gif
 
g
;

6974 
	`mem£t
(&
g
, 0, (g));

6975 
	`STBI_NOTUSED
(
ri
);

6977 
u
 = 
	`°bi__gif_lﬂd_√xt
(
s
, &
g
, 
comp
, 
ªq_comp
, 0);

6978 i‡(
u
 =(
°bi_uc
 *Ë
s
) u = 0;

6979 i‡(
u
) {

6980 *
x
 = 
g
.
w
;

6981 *
y
 = 
g
.
h
;

6985 i‡(
ªq_comp
 &&Ñeq_comp != 4)

6986 
u
 = 
	`°bi__c⁄vît_f‹m©
(u, 4, 
ªq_comp
, 
g
.
w
, g.
h
);

6987 } i‡(
g
.
out
) {

6989 
	`STBI_FREE
(
g
.
out
);

6993 
	`STBI_FREE
(
g
.
hi°‹y
);

6994 
	`STBI_FREE
(
g
.
background
);

6996  
u
;

6997 
	}
}

6999 
	$°bi__gif_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7001  
	`°bi__gif_öfo_øw
(
s
,
x
,
y
,
comp
);

7002 
	}
}

7008 #i‚de‡
STBI_NO_HDR


7009 
	$°bi__hdr_ã°_c‹e
(
°bi__c⁄ãxt
 *
s
, c⁄° *
sig«tuª
)

7011 
i
;

7012 
i
=0; 
sig«tuª
[i]; ++i)

7013 i‡(
	`°bi__gë8
(
s
Ë!
sig«tuª
[
i
])

7015 
	`°bi__ªwöd
(
s
);

7017 
	}
}

7019 
	$°bi__hdr_ã°
(
°bi__c⁄ãxt
* 
s
)

7021 
r
 = 
	`°bi__hdr_ã°_c‹e
(
s
, "#?RADIANCE\n");

7022 
	`°bi__ªwöd
(
s
);

7023 if(!
r
) {

7024 
r
 = 
	`°bi__hdr_ã°_c‹e
(
s
, "#?RGBE\n");

7025 
	`°bi__ªwöd
(
s
);

7027  
r
;

7028 
	}
}

7030 
	#STBI__HDR_BUFLEN
 1024

	)

7031 *
	$°bi__hdr_gëtokí
(
°bi__c⁄ãxt
 *
z
, *
buf„r
)

7033 
Àn
=0;

7034 
c
 = '\0';

7036 
c
 = (Ë
	`°bi__gë8
(
z
);

7038 !
	`°bi__©_eof
(
z
Ë&& 
c
 != '\n') {

7039 
buf„r
[
Àn
++] = 
c
;

7040 i‡(
Àn
 =
STBI__HDR_BUFLEN
-1) {

7042 !
	`°bi__©_eof
(
z
Ë&& 
	`°bi__gë8
(z) != '\n')

7046 
c
 = (Ë
	`°bi__gë8
(
z
);

7049 
buf„r
[
Àn
] = 0;

7050  
buf„r
;

7051 
	}
}

7053 
	$°bi__hdr_c⁄vît
(*
ouçut
, 
°bi_uc
 *
öput
, 
ªq_comp
)

7055 i‡–
öput
[3] != 0 ) {

7056 
f1
;

7058 
f1
 = (Ë
	`ldexp
(1.0f, 
öput
[3] - ()(128 + 8));

7059 i‡(
ªq_comp
 <= 2)

7060 
ouçut
[0] = (
öput
[0] + i≈ut[1] + i≈ut[2]Ë* 
f1
 / 3;

7062 
ouçut
[0] = 
öput
[0] * 
f1
;

7063 
ouçut
[1] = 
öput
[1] * 
f1
;

7064 
ouçut
[2] = 
öput
[2] * 
f1
;

7066 i‡(
ªq_comp
 =2Ë
ouçut
[1] = 1;

7067 i‡(
ªq_comp
 =4Ë
ouçut
[3] = 1;

7069 
ªq_comp
) {

7070 4: 
ouçut
[3] = 1;

7071 3: 
ouçut
[0] = output[1] = output[2] = 0;

7073 2: 
ouçut
[1] = 1;

7074 1: 
ouçut
[0] = 0;

7078 
	}
}

7080 *
	$°bi__hdr_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

7082 
buf„r
[
STBI__HDR_BUFLEN
];

7083 *
tokí
;

7084 
vÆid
 = 0;

7085 
width
, 
height
;

7086 
°bi_uc
 *
sˇ∆öe
;

7087 *
hdr_d©a
;

7088 
Àn
;

7089 
cou¡
, 
vÆue
;

7090 
i
, 
j
, 
k
, 
c1
,
c2
, 
z
;

7091 c⁄° *
hódîTokí
;

7092 
	`STBI_NOTUSED
(
ri
);

7095 
hódîTokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

7096 i‡(
	`°rcmp
(
hódîTokí
, "#?RADIANCE") != 0 && strcmp(headerToken, "#?RGBE") != 0)

7097  
	`°bi__îΩf
("not HDR", "Corrupt HDR image");

7101 
tokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

7102 i‡(
tokí
[0] == 0) ;

7103 i‡(
	`°rcmp
(
tokí
, "FORMAT=32-bô_æe_rgbe"Ë=0Ë
vÆid
 = 1;

7106 i‡(!
vÆid
Ë 
	`°bi__îΩf
("unsupported format", "Unsupported HDR format");

7110 
tokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

7111 i‡(
	`°∫cmp
(
tokí
, "-Y ", 3)Ë 
	`°bi__îΩf
("unsupported dataÜayout", "Unsupported HDR format");

7112 
tokí
 += 3;

7113 
height
 = (Ë
	`°πﬁ
(
tokí
, &token, 10);

7114 *
tokí
 == ' ') ++token;

7115 i‡(
	`°∫cmp
(
tokí
, "+X ", 3)Ë 
	`°bi__îΩf
("unsupported dataÜayout", "Unsupported HDR format");

7116 
tokí
 += 3;

7117 
width
 = (Ë
	`°πﬁ
(
tokí
, 
NULL
, 10);

7119 i‡(
height
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îΩf
("tooÜarge","VeryÜarge image (corrupt?)");

7120 i‡(
width
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îΩf
("tooÜarge","VeryÜarge image (corrupt?)");

7122 *
x
 = 
width
;

7123 *
y
 = 
height
;

7125 i‡(
comp
) *comp = 3;

7126 i‡(
ªq_comp
 == 0)Ñeq_comp = 3;

7128 i‡(!
	`°bi__mad4sizes_vÆid
(
width
, 
height
, 
ªq_comp
, (), 0))

7129  
	`°bi__îΩf
("tooÜarge", "HDR image isÅooÜarge");

7132 
hdr_d©a
 = (*Ë
	`°bi__mÆloc_mad4
(
width
, 
height
, 
ªq_comp
, (), 0);

7133 i‡(!
hdr_d©a
)

7134  
	`°bi__îΩf
("outofmem", "Out of memory");

7138 i‡–
width
 < 8 || width >= 32768) {

7140 
j
=0; j < 
height
; ++j) {

7141 
i
=0; i < 
width
; ++i) {

7142 
°bi_uc
 
rgbe
[4];

7143 
maö_decode_lo›
:

7144 
	`°bi__gën
(
s
, 
rgbe
, 4);

7145 
	`°bi__hdr_c⁄vît
(
hdr_d©a
 + 
j
 * 
width
 * 
ªq_comp
 + 
i
 *Ñeq_comp, 
rgbe
,Ñeq_comp);

7150 
sˇ∆öe
 = 
NULL
;

7152 
j
 = 0; j < 
height
; ++j) {

7153 
c1
 = 
	`°bi__gë8
(
s
);

7154 
c2
 = 
	`°bi__gë8
(
s
);

7155 
Àn
 = 
	`°bi__gë8
(
s
);

7156 i‡(
c1
 !2 || 
c2
 !2 || (
Àn
 & 0x80)) {

7159 
°bi_uc
 
rgbe
[4];

7160 
rgbe
[0] = (
°bi_uc
Ë
c1
;

7161 
rgbe
[1] = (
°bi_uc
Ë
c2
;

7162 
rgbe
[2] = (
°bi_uc
Ë
Àn
;

7163 
rgbe
[3] = (
°bi_uc
Ë
	`°bi__gë8
(
s
);

7164 
	`°bi__hdr_c⁄vît
(
hdr_d©a
, 
rgbe
, 
ªq_comp
);

7165 
i
 = 1;

7166 
j
 = 0;

7167 
	`STBI_FREE
(
sˇ∆öe
);

7168 
maö_decode_lo›
;

7170 
Àn
 <<= 8;

7171 
Àn
 |
	`°bi__gë8
(
s
);

7172 i‡(
Àn
 !
width
Ë{ 
	`STBI_FREE
(
hdr_d©a
); STBI_FREE(
sˇ∆öe
);  
	`°bi__îΩf
("invalid decoded scanlineÜength", "corrupt HDR"); }

7173 i‡(
sˇ∆öe
 =
NULL
) {

7174 
sˇ∆öe
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad2
(
width
, 4, 0);

7175 i‡(!
sˇ∆öe
) {

7176 
	`STBI_FREE
(
hdr_d©a
);

7177  
	`°bi__îΩf
("outofmem", "Out of memory");

7181 
k
 = 0; k < 4; ++k) {

7182 
∆e·
;

7183 
i
 = 0;

7184 (
∆e·
 = 
width
 - 
i
) > 0) {

7185 
cou¡
 = 
	`°bi__gë8
(
s
);

7186 i‡(
cou¡
 > 128) {

7188 
vÆue
 = 
	`°bi__gë8
(
s
);

7189 
cou¡
 -= 128;

7190 i‡(
cou¡
 > 
∆e·
Ë{ 
	`STBI_FREE
(
hdr_d©a
); STBI_FREE(
sˇ∆öe
);  
	`°bi__îΩf
("corrupt", "bad RLE data in HDR"); }

7191 
z
 = 0; z < 
cou¡
; ++z)

7192 
sˇ∆öe
[
i
++ * 4 + 
k
] = 
vÆue
;

7195 i‡(
cou¡
 > 
∆e·
Ë{ 
	`STBI_FREE
(
hdr_d©a
); STBI_FREE(
sˇ∆öe
);  
	`°bi__îΩf
("corrupt", "bad RLE data in HDR"); }

7196 
z
 = 0; z < 
cou¡
; ++z)

7197 
sˇ∆öe
[
i
++ * 4 + 
k
] = 
	`°bi__gë8
(
s
);

7201 
i
=0; i < 
width
; ++i)

7202 
	`°bi__hdr_c⁄vît
(
hdr_d©a
+(
j
*
width
 + 
i
)*
ªq_comp
, 
sˇ∆öe
 + i*4,Ñeq_comp);

7204 i‡(
sˇ∆öe
)

7205 
	`STBI_FREE
(
sˇ∆öe
);

7208  
hdr_d©a
;

7209 
	}
}

7211 
	$°bi__hdr_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7213 
buf„r
[
STBI__HDR_BUFLEN
];

7214 *
tokí
;

7215 
vÆid
 = 0;

7216 
dummy
;

7218 i‡(!
x
Ëx = &
dummy
;

7219 i‡(!
y
Ëy = &
dummy
;

7220 i‡(!
comp
Ëcom∞&
dummy
;

7222 i‡(
	`°bi__hdr_ã°
(
s
) == 0) {

7223 
	`°bi__ªwöd
–
s
 );

7228 
tokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

7229 i‡(
tokí
[0] == 0) ;

7230 i‡(
	`°rcmp
(
tokí
, "FORMAT=32-bô_æe_rgbe"Ë=0Ë
vÆid
 = 1;

7233 i‡(!
vÆid
) {

7234 
	`°bi__ªwöd
–
s
 );

7237 
tokí
 = 
	`°bi__hdr_gëtokí
(
s
,
buf„r
);

7238 i‡(
	`°∫cmp
(
tokí
, "-Y ", 3)) {

7239 
	`°bi__ªwöd
–
s
 );

7242 
tokí
 += 3;

7243 *
y
 = (Ë
	`°πﬁ
(
tokí
, &token, 10);

7244 *
tokí
 == ' ') ++token;

7245 i‡(
	`°∫cmp
(
tokí
, "+X ", 3)) {

7246 
	`°bi__ªwöd
–
s
 );

7249 
tokí
 += 3;

7250 *
x
 = (Ë
	`°πﬁ
(
tokí
, 
NULL
, 10);

7251 *
comp
 = 3;

7253 
	}
}

7256 #i‚de‡
STBI_NO_BMP


7257 
	$°bi__bmp_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7259 *
p
;

7260 
°bi__bmp_d©a
 
öfo
;

7262 
öfo
.
Æl_a
 = 255;

7263 
p
 = 
	`°bi__bmp_∑r£_hódî
(
s
, &
öfo
);

7264 i‡(
p
 =
NULL
) {

7265 
	`°bi__ªwöd
–
s
 );

7268 i‡(
x
Ë*x = 
s
->
img_x
;

7269 i‡(
y
Ë*y = 
s
->
img_y
;

7270 i‡(
comp
) {

7271 i‡(
öfo
.
bµ
 =24 && info.
ma
 == 0xff000000)

7272 *
comp
 = 3;

7274 *
comp
 = 
öfo
.
ma
 ? 4 : 3;

7277 
	}
}

7280 #i‚de‡
STBI_NO_PSD


7281 
	$°bi__psd_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7283 
ch™√lCou¡
, 
dummy
, 
dïth
;

7284 i‡(!
x
Ëx = &
dummy
;

7285 i‡(!
y
Ëy = &
dummy
;

7286 i‡(!
comp
Ëcom∞&
dummy
;

7287 i‡(
	`°bi__gë32be
(
s
) != 0x38425053) {

7288 
	`°bi__ªwöd
–
s
 );

7291 i‡(
	`°bi__gë16be
(
s
) != 1) {

7292 
	`°bi__ªwöd
–
s
 );

7295 
	`°bi__skù
(
s
, 6);

7296 
ch™√lCou¡
 = 
	`°bi__gë16be
(
s
);

7297 i‡(
ch™√lCou¡
 < 0 || channelCount > 16) {

7298 
	`°bi__ªwöd
–
s
 );

7301 *
y
 = 
	`°bi__gë32be
(
s
);

7302 *
x
 = 
	`°bi__gë32be
(
s
);

7303 
dïth
 = 
	`°bi__gë16be
(
s
);

7304 i‡(
dïth
 != 8 && depth != 16) {

7305 
	`°bi__ªwöd
–
s
 );

7308 i‡(
	`°bi__gë16be
(
s
) != 3) {

7309 
	`°bi__ªwöd
–
s
 );

7312 *
comp
 = 4;

7314 
	}
}

7316 
	$°bi__psd_is16
(
°bi__c⁄ãxt
 *
s
)

7318 
ch™√lCou¡
, 
dïth
;

7319 i‡(
	`°bi__gë32be
(
s
) != 0x38425053) {

7320 
	`°bi__ªwöd
–
s
 );

7323 i‡(
	`°bi__gë16be
(
s
) != 1) {

7324 
	`°bi__ªwöd
–
s
 );

7327 
	`°bi__skù
(
s
, 6);

7328 
ch™√lCou¡
 = 
	`°bi__gë16be
(
s
);

7329 i‡(
ch™√lCou¡
 < 0 || channelCount > 16) {

7330 
	`°bi__ªwöd
–
s
 );

7333 
	`STBI_NOTUSED
(
	`°bi__gë32be
(
s
));

7334 
	`STBI_NOTUSED
(
	`°bi__gë32be
(
s
));

7335 
dïth
 = 
	`°bi__gë16be
(
s
);

7336 i‡(
dïth
 != 16) {

7337 
	`°bi__ªwöd
–
s
 );

7341 
	}
}

7344 #i‚de‡
STBI_NO_PIC


7345 
	$°bi__pic_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7347 
a˘_comp
=0,
num_∑ckës
=0,
chaöed
,
dummy
;

7348 
°bi__pic_∑ckë
 
∑ckës
[10];

7350 i‡(!
x
Ëx = &
dummy
;

7351 i‡(!
y
Ëy = &
dummy
;

7352 i‡(!
comp
Ëcom∞&
dummy
;

7354 i‡(!
	`°bi__pic_is4
(
s
,"\x53\x80\xF6\x34")) {

7355 
	`°bi__ªwöd
(
s
);

7359 
	`°bi__skù
(
s
, 88);

7361 *
x
 = 
	`°bi__gë16be
(
s
);

7362 *
y
 = 
	`°bi__gë16be
(
s
);

7363 i‡(
	`°bi__©_eof
(
s
)) {

7364 
	`°bi__ªwöd
–
s
);

7367 i‡–(*
x
Ë!0 && (1 << 28Ë/ (*xË< (*
y
)) {

7368 
	`°bi__ªwöd
–
s
 );

7372 
	`°bi__skù
(
s
, 8);

7375 
°bi__pic_∑ckë
 *
∑ckë
;

7377 i‡(
num_∑ckës
==(
∑ckës
)/(packets[0]))

7380 
∑ckë
 = &
∑ckës
[
num_∑ckës
++];

7381 
chaöed
 = 
	`°bi__gë8
(
s
);

7382 
∑ckë
->
size
 = 
	`°bi__gë8
(
s
);

7383 
∑ckë
->
ty≥
 = 
	`°bi__gë8
(
s
);

7384 
∑ckë
->
ch™√l
 = 
	`°bi__gë8
(
s
);

7385 
a˘_comp
 |
∑ckë
->
ch™√l
;

7387 i‡(
	`°bi__©_eof
(
s
)) {

7388 
	`°bi__ªwöd
–
s
 );

7391 i‡(
∑ckë
->
size
 != 8) {

7392 
	`°bi__ªwöd
–
s
 );

7395 } 
chaöed
);

7397 *
comp
 = (
a˘_comp
 & 0x10 ? 4 : 3);

7400 
	}
}

7414 #i‚de‡
STBI_NO_PNM


7416 
	$°bi__≤m_ã°
(
°bi__c⁄ãxt
 *
s
)

7418 
p
, 
t
;

7419 
p
 = (Ë
	`°bi__gë8
(
s
);

7420 
t
 = (Ë
	`°bi__gë8
(
s
);

7421 i‡(
p
 !'P' || (
t
 != '5' &&Å != '6')) {

7422 
	`°bi__ªwöd
–
s
 );

7426 
	}
}

7428 *
	$°bi__≤m_lﬂd
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
, 
ªq_comp
, 
°bi__ªsu…_öfo
 *
ri
)

7430 
°bi_uc
 *
out
;

7431 
	`STBI_NOTUSED
(
ri
);

7433 
ri
->
bôs_≥r_ch™√l
 = 
	`°bi__≤m_öfo
(
s
, (*)&s->
img_x
, (*)&s->
img_y
, (*)&s->
img_n
);

7434 i‡(
ri
->
bôs_≥r_ch™√l
 == 0)

7437 i‡(
s
->
img_y
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îΩuc
("tooÜarge","VeryÜarge image (corrupt?)");

7438 i‡(
s
->
img_x
 > 
STBI_MAX_DIMENSIONS
Ë 
	`°bi__îΩuc
("tooÜarge","VeryÜarge image (corrupt?)");

7440 *
x
 = 
s
->
img_x
;

7441 *
y
 = 
s
->
img_y
;

7442 i‡(
comp
Ë*com∞
s
->
img_n
;

7444 i‡(!
	`°bi__mad4sizes_vÆid
(
s
->
img_n
, s->
img_x
, s->
img_y
, 
ri
->
bôs_≥r_ch™√l
 / 8, 0))

7445  
	`°bi__îΩuc
("tooÜarge", "PNMÅooÜarge");

7447 
out
 = (
°bi_uc
 *Ë
	`°bi__mÆloc_mad4
(
s
->
img_n
, s->
img_x
, s->
img_y
, 
ri
->
bôs_≥r_ch™√l
 / 8, 0);

7448 i‡(!
out
Ë 
	`°bi__îΩuc
("outofmem", "Out of memory");

7449 
	`°bi__gën
(
s
, 
out
, s->
img_n
 * s->
img_x
 * s->
img_y
 * (
ri
->
bôs_≥r_ch™√l
 / 8));

7451 i‡(
ªq_comp
 &&Ñeq_com∞!
s
->
img_n
) {

7452 
out
 = 
	`°bi__c⁄vît_f‹m©
(out, 
s
->
img_n
, 
ªq_comp
, s->
img_x
, s->
img_y
);

7453 i‡(
out
 =
NULL
)  out;

7455  
out
;

7456 
	}
}

7458 
	$°bi__≤m_is•a˚
(
c
)

7460  
c
 == ' ' || c == '\t' || c == '\n' || c == '\v' || c == '\f' || c == '\r';

7461 
	}
}

7463 
	$°bi__≤m_skù_whôe•a˚
(
°bi__c⁄ãxt
 *
s
, *
c
)

7466 !
	`°bi__©_eof
(
s
Ë&& 
	`°bi__≤m_is•a˚
(*
c
))

7467 *
c
 = (Ë
	`°bi__gë8
(
s
);

7469 i‡(
	`°bi__©_eof
(
s
Ë|| *
c
 != '#')

7472 !
	`°bi__©_eof
(
s
Ë&& *
c
 != '\n' && *c != '\r' )

7473 *
c
 = (Ë
	`°bi__gë8
(
s
);

7475 
	}
}

7477 
	$°bi__≤m_isdigô
(
c
)

7479  
c
 >= '0' && c <= '9';

7480 
	}
}

7482 
	$°bi__≤m_gëöãgî
(
°bi__c⁄ãxt
 *
s
, *
c
)

7484 
vÆue
 = 0;

7486 !
	`°bi__©_eof
(
s
Ë&& 
	`°bi__≤m_isdigô
(*
c
)) {

7487 
vÆue
 = vÆue*10 + (*
c
 - '0');

7488 *
c
 = (Ë
	`°bi__gë8
(
s
);

7491  
vÆue
;

7492 
	}
}

7494 
	$°bi__≤m_öfo
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7496 
maxv
, 
dummy
;

7497 
c
, 
p
, 
t
;

7499 i‡(!
x
Ëx = &
dummy
;

7500 i‡(!
y
Ëy = &
dummy
;

7501 i‡(!
comp
Ëcom∞&
dummy
;

7503 
	`°bi__ªwöd
(
s
);

7506 
p
 = (Ë
	`°bi__gë8
(
s
);

7507 
t
 = (Ë
	`°bi__gë8
(
s
);

7508 i‡(
p
 !'P' || (
t
 != '5' &&Å != '6')) {

7509 
	`°bi__ªwöd
(
s
);

7513 *
comp
 = (
t
 == '6') ? 3 : 1;

7515 
c
 = (Ë
	`°bi__gë8
(
s
);

7516 
	`°bi__≤m_skù_whôe•a˚
(
s
, &
c
);

7518 *
x
 = 
	`°bi__≤m_gëöãgî
(
s
, &
c
);

7519 
	`°bi__≤m_skù_whôe•a˚
(
s
, &
c
);

7521 *
y
 = 
	`°bi__≤m_gëöãgî
(
s
, &
c
);

7522 
	`°bi__≤m_skù_whôe•a˚
(
s
, &
c
);

7524 
maxv
 = 
	`°bi__≤m_gëöãgî
(
s
, &
c
);

7525 i‡(
maxv
 > 65535)

7526  
	`°bi__îr
("max value > 65535", "PPM image supports only 8-bitánd 16-bit images");

7527 i‡(
maxv
 > 255)

7531 
	}
}

7533 
	$°bi__≤m_is16
(
°bi__c⁄ãxt
 *
s
)

7535 i‡(
	`°bi__≤m_öfo
(
s
, 
NULL
, NULL, NULL) == 16)

7538 
	}
}

7541 
	$°bi__öfo_maö
(
°bi__c⁄ãxt
 *
s
, *
x
, *
y
, *
comp
)

7543 #i‚de‡
STBI_NO_JPEG


7544 i‡(
	`°bi__j≥g_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7547 #i‚de‡
STBI_NO_PNG


7548 i‡(
	`°bi__≤g_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7551 #i‚de‡
STBI_NO_GIF


7552 i‡(
	`°bi__gif_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7555 #i‚de‡
STBI_NO_BMP


7556 i‡(
	`°bi__bmp_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7559 #i‚de‡
STBI_NO_PSD


7560 i‡(
	`°bi__psd_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7563 #i‚de‡
STBI_NO_PIC


7564 i‡(
	`°bi__pic_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7567 #i‚de‡
STBI_NO_PNM


7568 i‡(
	`°bi__≤m_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7571 #i‚de‡
STBI_NO_HDR


7572 i‡(
	`°bi__hdr_öfo
(
s
, 
x
, 
y
, 
comp
))  1;

7576 #i‚de‡
STBI_NO_TGA


7577 i‡(
	`°bi__tga_öfo
(
s
, 
x
, 
y
, 
comp
))

7580  
	`°bi__îr
("unknown imageÅype", "ImageÇot ofány knownÅype, or corrupt");

7581 
	}
}

7583 
	$°bi__is_16_maö
(
°bi__c⁄ãxt
 *
s
)

7585 #i‚de‡
STBI_NO_PNG


7586 i‡(
	`°bi__≤g_is16
(
s
))  1;

7589 #i‚de‡
STBI_NO_PSD


7590 i‡(
	`°bi__psd_is16
(
s
))  1;

7593 #i‚de‡
STBI_NO_PNM


7594 i‡(
	`°bi__≤m_is16
(
s
))  1;

7597 
	}
}

7599 #i‚de‡
STBI_NO_STDIO


7600 
STBIDEF
 
	$°bi_öfo
(c⁄° *
fûíame
, *
x
, *
y
, *
comp
)

7602 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

7603 
ªsu…
;

7604 i‡(!
f
Ë 
	`°bi__îr
("can't fopen", "UnableÅo open file");

7605 
ªsu…
 = 
	`°bi_öfo_‰om_fûe
(
f
, 
x
, 
y
, 
comp
);

7606 
	`f˛o£
(
f
);

7607  
ªsu…
;

7608 
	}
}

7610 
STBIDEF
 
	$°bi_öfo_‰om_fûe
(
FILE
 *
f
, *
x
, *
y
, *
comp
)

7612 
r
;

7613 
°bi__c⁄ãxt
 
s
;

7614 
pos
 = 
	`·ñl
(
f
);

7615 
	`°bi__°¨t_fûe
(&
s
, 
f
);

7616 
r
 = 
	`°bi__öfo_maö
(&
s
,
x
,
y
,
comp
);

7617 
	`f£ek
(
f
,
pos
,
SEEK_SET
);

7618  
r
;

7619 
	}
}

7621 
STBIDEF
 
	$°bi_is_16_bô
(c⁄° *
fûíame
)

7623 
FILE
 *
f
 = 
	`°bi__f›í
(
fûíame
, "rb");

7624 
ªsu…
;

7625 i‡(!
f
Ë 
	`°bi__îr
("can't fopen", "UnableÅo open file");

7626 
ªsu…
 = 
	`°bi_is_16_bô_‰om_fûe
(
f
);

7627 
	`f˛o£
(
f
);

7628  
ªsu…
;

7629 
	}
}

7631 
STBIDEF
 
	$°bi_is_16_bô_‰om_fûe
(
FILE
 *
f
)

7633 
r
;

7634 
°bi__c⁄ãxt
 
s
;

7635 
pos
 = 
	`·ñl
(
f
);

7636 
	`°bi__°¨t_fûe
(&
s
, 
f
);

7637 
r
 = 
	`°bi__is_16_maö
(&
s
);

7638 
	`f£ek
(
f
,
pos
,
SEEK_SET
);

7639  
r
;

7640 
	}
}

7643 
STBIDEF
 
	$°bi_öfo_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
, *
x
, *
y
, *
comp
)

7645 
°bi__c⁄ãxt
 
s
;

7646 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

7647  
	`°bi__öfo_maö
(&
s
,
x
,
y
,
comp
);

7648 
	}
}

7650 
STBIDEF
 
	$°bi_öfo_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
c
, *
u£r
, *
x
, *
y
, *
comp
)

7652 
°bi__c⁄ãxt
 
s
;

7653 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
c
, 
u£r
);

7654  
	`°bi__öfo_maö
(&
s
,
x
,
y
,
comp
);

7655 
	}
}

7657 
STBIDEF
 
	$°bi_is_16_bô_‰om_mem‹y
(
°bi_uc
 c⁄° *
buf„r
, 
Àn
)

7659 
°bi__c⁄ãxt
 
s
;

7660 
	`°bi__°¨t_mem
(&
s
,
buf„r
,
Àn
);

7661  
	`°bi__is_16_maö
(&
s
);

7662 
	}
}

7664 
STBIDEF
 
	$°bi_is_16_bô_‰om_ˇŒbacks
(
°bi_io_ˇŒbacks
 c⁄° *
c
, *
u£r
)

7666 
°bi__c⁄ãxt
 
s
;

7667 
	`°bi__°¨t_ˇŒbacks
(&
s
, (
°bi_io_ˇŒbacks
 *Ë
c
, 
u£r
);

7668  
	`°bi__is_16_maö
(&
s
);

7669 
	}
}

	@include/stb_rect_pack.h

66 #i‚de‡
STB_INCLUDE_STB_RECT_PACK_H


67 
	#STB_INCLUDE_STB_RECT_PACK_H


	)

69 
	#STB_RECT_PACK_VERSION
 1

	)

71 #ifde‡
STBRP_STATIC


72 
	#STBRP_DEF
 

	)

74 
	#STBRP_DEF
 

	)

77 #ifde‡
__˝lu•lus


81 
°bΩ_c⁄ãxt
 
	t°bΩ_c⁄ãxt
;

82 
°bΩ_node
 
	t°bΩ_node
;

83 
°bΩ_ª˘
 
	t°bΩ_ª˘
;

85 
	t°bΩ_co‹d
;

87 
	#STBRP__MAXVAL
 0x7fffffff

	)

90 
STBRP_DEF
 
°bΩ_∑ck_ª˘s
 (
°bΩ_c⁄ãxt
 *
c⁄ãxt
, 
°bΩ_ª˘
 *
ª˘s
, 
num_ª˘s
);

115 
	s°bΩ_ª˘


118 
id
;

121 
°bΩ_co‹d
 
w
, 
h
;

124 
°bΩ_co‹d
 
x
, 
y
;

125 
was_∑cked
;

130 
STBRP_DEF
 
°bΩ_öô_èrgë
 (
°bΩ_c⁄ãxt
 *
c⁄ãxt
, 
width
, 
height
, 
°bΩ_node
 *
nodes
, 
num_nodes
);

151 
STBRP_DEF
 
°bΩ_£tup_Ælow_out_of_mem
 (
°bΩ_c⁄ãxt
 *
c⁄ãxt
, 
Ælow_out_of_mem
);

157 
STBRP_DEF
 
°bΩ_£tup_heuri°ic
 (
°bΩ_c⁄ãxt
 *
c⁄ãxt
, 
heuri°ic
);

164 
STBRP_HEURISTIC_Skylöe_deÁu…
=0,

165 
STBRP_HEURISTIC_Skylöe_BL_s‹tHeight
 = 
STBRP_HEURISTIC_Skylöe_deÁu…
,

166 
STBRP_HEURISTIC_Skylöe_BF_s‹tHeight


175 
	s°bΩ_node


177 
°bΩ_co‹d
 
x
,
y
;

178 
°bΩ_node
 *
√xt
;

181 
	s°bΩ_c⁄ãxt


183 
width
;

184 
height
;

185 
Æign
;

186 
öô_mode
;

187 
heuri°ic
;

188 
num_nodes
;

189 
°bΩ_node
 *
a˘ive_hód
;

190 
°bΩ_node
 *
‰ì_hód
;

191 
°bΩ_node
 
exåa
[2];

194 #ifde‡
__˝lu•lus


205 #ifde‡
STB_RECT_PACK_IMPLEMENTATION


206 #i‚de‡
STBRP_SORT


207 
	~<°dlib.h
>

208 
	#STBRP_SORT
 
qs‹t


	)

211 #i‚de‡
STBRP_ASSERT


212 
	~<as£π.h
>

213 
	#STBRP_ASSERT
 
as£π


	)

216 #ifde‡
_MSC_VER


217 
	#STBRP__NOTUSED
(
v
Ë()(v)

	)

218 
	#STBRP__CDECL
 
__cde˛


	)

220 
	#STBRP__NOTUSED
(
v
Ë()(v)

	)

221 
	#STBRP__CDECL


	)

226 
STBRP__INIT_skylöe
 = 1

229 
STBRP_DEF
 
	$°bΩ_£tup_heuri°ic
(
°bΩ_c⁄ãxt
 *
c⁄ãxt
, 
heuri°ic
)

231 
c⁄ãxt
->
öô_mode
) {

232 
STBRP__INIT_skylöe
:

233 
	`STBRP_ASSERT
(
heuri°ic
 =
STBRP_HEURISTIC_Skylöe_BL_s‹tHeight
 || heuri°i¯=
STBRP_HEURISTIC_Skylöe_BF_s‹tHeight
);

234 
c⁄ãxt
->
heuri°ic
 = heuristic;

237 
	`STBRP_ASSERT
(0);

239 
	}
}

241 
STBRP_DEF
 
	$°bΩ_£tup_Ælow_out_of_mem
(
°bΩ_c⁄ãxt
 *
c⁄ãxt
, 
Ælow_out_of_mem
)

243 i‡(
Ælow_out_of_mem
)

248 
c⁄ãxt
->
Æign
 = 1;

257 
c⁄ãxt
->
Æign
 = (c⁄ãxt->
width
 + c⁄ãxt->
num_nodes
-1) / context->num_nodes;

259 
	}
}

261 
STBRP_DEF
 
	$°bΩ_öô_èrgë
(
°bΩ_c⁄ãxt
 *
c⁄ãxt
, 
width
, 
height
, 
°bΩ_node
 *
nodes
, 
num_nodes
)

263 
i
;

265 
i
=0; i < 
num_nodes
-1; ++i)

266 
nodes
[
i
].
√xt
 = &nodes[i+1];

267 
nodes
[
i
].
√xt
 = 
NULL
;

268 
c⁄ãxt
->
öô_mode
 = 
STBRP__INIT_skylöe
;

269 
c⁄ãxt
->
heuri°ic
 = 
STBRP_HEURISTIC_Skylöe_deÁu…
;

270 
c⁄ãxt
->
‰ì_hód
 = &
nodes
[0];

271 
c⁄ãxt
->
a˘ive_hód
 = &c⁄ãxt->
exåa
[0];

272 
c⁄ãxt
->
width
 = width;

273 
c⁄ãxt
->
height
 = height;

274 
c⁄ãxt
->
num_nodes
 =Çum_nodes;

275 
	`°bΩ_£tup_Ælow_out_of_mem
(
c⁄ãxt
, 0);

278 
c⁄ãxt
->
exåa
[0].
x
 = 0;

279 
c⁄ãxt
->
exåa
[0].
y
 = 0;

280 
c⁄ãxt
->
exåa
[0].
√xt
 = &context->extra[1];

281 
c⁄ãxt
->
exåa
[1].
x
 = (
°bΩ_co‹d
Ë
width
;

282 
c⁄ãxt
->
exåa
[1].
y
 = (1<<30);

283 
c⁄ãxt
->
exåa
[1].
√xt
 = 
NULL
;

284 
	}
}

287 
	$°bΩ__skylöe_föd_mö_y
(
°bΩ_c⁄ãxt
 *
c
, 
°bΩ_node
 *
fú°
, 
x0
, 
width
, *
pwa°e
)

289 
°bΩ_node
 *
node
 = 
fú°
;

290 
x1
 = 
x0
 + 
width
;

291 
mö_y
, 
visôed_width
, 
wa°e_¨ó
;

293 
	`STBRP__NOTUSED
(
c
);

295 
	`STBRP_ASSERT
(
fú°
->
x
 <
x0
);

299 
node
->
√xt
->
x
 <
x0
)

300 ++
node
;

302 
	`STBRP_ASSERT
(
node
->
√xt
->
x
 > 
x0
);

305 
	`STBRP_ASSERT
(
node
->
x
 <
x0
);

307 
mö_y
 = 0;

308 
wa°e_¨ó
 = 0;

309 
visôed_width
 = 0;

310 
node
->
x
 < 
x1
) {

311 i‡(
node
->
y
 > 
mö_y
) {

315 
wa°e_¨ó
 +
visôed_width
 * (
node
->
y
 - 
mö_y
);

316 
mö_y
 = 
node
->
y
;

318 i‡(
node
->
x
 < 
x0
)

319 
visôed_width
 +
node
->
√xt
->
x
 - 
x0
;

321 
visôed_width
 +
node
->
√xt
->
x
 -Çode->x;

324 
undî_width
 = 
node
->
√xt
->
x
 -Çode->x;

325 i‡(
undî_width
 + 
visôed_width
 > 
width
)

326 
undî_width
 = 
width
 - 
visôed_width
;

327 
wa°e_¨ó
 +
undî_width
 * (
mö_y
 - 
node
->
y
);

328 
visôed_width
 +
undî_width
;

330 
node
 =Çode->
√xt
;

333 *
pwa°e
 = 
wa°e_¨ó
;

334  
mö_y
;

335 
	}
}

339 
	mx
,
	my
;

340 
°bΩ_node
 **
	m¥ev_lök
;

341 } 
	t°bΩ__födªsu…
;

343 
°bΩ__födªsu…
 
	$°bΩ__skylöe_föd_be°_pos
(
°bΩ_c⁄ãxt
 *
c
, 
width
, 
height
)

345 
be°_wa°e
 = (1<<30), 
be°_x
, 
be°_y
 = (1 << 30);

346 
°bΩ__födªsu…
 
‰
;

347 
°bΩ_node
 **
¥ev
, *
node
, *
èû
, **
be°
 = 
NULL
;

350 
width
 = (width + 
c
->
Æign
 - 1);

351 
width
 -width % 
c
->
Æign
;

352 
	`STBRP_ASSERT
(
width
 % 
c
->
Æign
 == 0);

355 i‡(
width
 > 
c
->width || 
height
 > c->height) {

356 
‰
.
¥ev_lök
 = 
NULL
;

357 
‰
.
x
 = fr.
y
 = 0;

358  
‰
;

361 
node
 = 
c
->
a˘ive_hód
;

362 
¥ev
 = &
c
->
a˘ive_hód
;

363 
node
->
x
 + 
width
 <
c
->width) {

364 
y
,
wa°e
;

365 
y
 = 
	`°bΩ__skylöe_föd_mö_y
(
c
, 
node
,Çode->
x
, 
width
, &
wa°e
);

366 i‡(
c
->
heuri°ic
 =
STBRP_HEURISTIC_Skylöe_BL_s‹tHeight
) {

368 i‡(
y
 < 
be°_y
) {

369 
be°_y
 = 
y
;

370 
be°
 = 
¥ev
;

374 i‡(
y
 + 
height
 <
c
->height) {

376 i‡(
y
 < 
be°_y
 || (y =be°_y && 
wa°e
 < 
be°_wa°e
)) {

377 
be°_y
 = 
y
;

378 
be°_wa°e
 = 
wa°e
;

379 
be°
 = 
¥ev
;

383 
¥ev
 = &
node
->
√xt
;

384 
node
 =Çode->
√xt
;

387 
be°_x
 = (
be°
 =
NULL
Ë? 0 : (*be°)->
x
;

406 i‡(
c
->
heuri°ic
 =
STBRP_HEURISTIC_Skylöe_BF_s‹tHeight
) {

407 
èû
 = 
c
->
a˘ive_hód
;

408 
node
 = 
c
->
a˘ive_hód
;

409 
¥ev
 = &
c
->
a˘ive_hód
;

411 
èû
->
x
 < 
width
)

412 
èû
 =Åaû->
√xt
;

413 
èû
) {

414 
xpos
 = 
èû
->
x
 - 
width
;

415 
y
,
wa°e
;

416 
	`STBRP_ASSERT
(
xpos
 >= 0);

418 
node
->
√xt
->
x
 <
xpos
) {

419 
¥ev
 = &
node
->
√xt
;

420 
node
 =Çode->
√xt
;

422 
	`STBRP_ASSERT
(
node
->
√xt
->
x
 > 
xpos
 &&Çode->x <= xpos);

423 
y
 = 
	`°bΩ__skylöe_föd_mö_y
(
c
, 
node
, 
xpos
, 
width
, &
wa°e
);

424 i‡(
y
 + 
height
 <
c
->height) {

425 i‡(
y
 <
be°_y
) {

426 i‡(
y
 < 
be°_y
 || 
wa°e
 < 
be°_wa°e
 || (wa°e==be°_wa°ê&& 
xpos
 < 
be°_x
)) {

427 
be°_x
 = 
xpos
;

428 
	`STBRP_ASSERT
(
y
 <
be°_y
);

429 
be°_y
 = 
y
;

430 
be°_wa°e
 = 
wa°e
;

431 
be°
 = 
¥ev
;

435 
èû
 =Åaû->
√xt
;

439 
‰
.
¥ev_lök
 = 
be°
;

440 
‰
.
x
 = 
be°_x
;

441 
‰
.
y
 = 
be°_y
;

442  
‰
;

443 
	}
}

445 
°bΩ__födªsu…
 
	$°bΩ__skylöe_∑ck_ª˘™gÀ
(
°bΩ_c⁄ãxt
 *
c⁄ãxt
, 
width
, 
height
)

448 
°bΩ__födªsu…
 
ªs
 = 
	`°bΩ__skylöe_föd_be°_pos
(
c⁄ãxt
, 
width
, 
height
);

449 
°bΩ_node
 *
node
, *
cur
;

455 i‡(
ªs
.
¥ev_lök
 =
NULL
 ||Ñes.
y
 + 
height
 > 
c⁄ãxt
->heighà|| c⁄ãxt->
‰ì_hód
 == NULL) {

456 
ªs
.
¥ev_lök
 = 
NULL
;

457  
ªs
;

461 
node
 = 
c⁄ãxt
->
‰ì_hód
;

462 
node
->
x
 = (
°bΩ_co‹d
Ë
ªs
.x;

463 
node
->
y
 = (
°bΩ_co‹d
Ë(
ªs
.y + 
height
);

465 
c⁄ãxt
->
‰ì_hód
 = 
node
->
√xt
;

471 
cur
 = *
ªs
.
¥ev_lök
;

472 i‡(
cur
->
x
 < 
ªs
.x) {

474 
°bΩ_node
 *
√xt
 = 
cur
->next;

475 
cur
->
√xt
 = 
node
;

476 
cur
 = 
√xt
;

478 *
ªs
.
¥ev_lök
 = 
node
;

483 
cur
->
√xt
 && cur->√xt->
x
 <
ªs
.x + 
width
) {

484 
°bΩ_node
 *
√xt
 = 
cur
->next;

486 
cur
->
√xt
 = 
c⁄ãxt
->
‰ì_hód
;

487 
c⁄ãxt
->
‰ì_hód
 = 
cur
;

488 
cur
 = 
√xt
;

492 
node
->
√xt
 = 
cur
;

494 i‡(
cur
->
x
 < 
ªs
.x + 
width
)

495 
cur
->
x
 = (
°bΩ_co‹d
Ë(
ªs
.x + 
width
);

497 #ifde‡
_DEBUG


498 
cur
 = 
c⁄ãxt
->
a˘ive_hód
;

499 
cur
->
x
 < 
c⁄ãxt
->
width
) {

500 
	`STBRP_ASSERT
(
cur
->
x
 < cur->
√xt
->x);

501 
cur
 = cur->
√xt
;

503 
	`STBRP_ASSERT
(
cur
->
√xt
 =
NULL
);

506 
cou¡
=0;

507 
cur
 = 
c⁄ãxt
->
a˘ive_hód
;

508 
cur
) {

509 
cur
 = cur->
√xt
;

510 ++
cou¡
;

512 
cur
 = 
c⁄ãxt
->
‰ì_hód
;

513 
cur
) {

514 
cur
 = cur->
√xt
;

515 ++
cou¡
;

517 
	`STBRP_ASSERT
(
cou¡
 =
c⁄ãxt
->
num_nodes
+2);

521  
ªs
;

522 
	}
}

524 
STBRP__CDECL
 
	$ª˘_height_com∑ª
(c⁄° *
a
, c⁄° *
b
)

526 c⁄° 
°bΩ_ª˘
 *
p
 = (c⁄° stbΩ_ª˘ *Ë
a
;

527 c⁄° 
°bΩ_ª˘
 *
q
 = (c⁄° stbΩ_ª˘ *Ë
b
;

528 i‡(
p
->
h
 > 
q
->h)

530 i‡(
p
->
h
 < 
q
->h)

532  (
p
->
w
 > 
q
->w) ? -1 : (p->w < q->w);

533 
	}
}

535 
STBRP__CDECL
 
	$ª˘_‹igöÆ_‹dî
(c⁄° *
a
, c⁄° *
b
)

537 c⁄° 
°bΩ_ª˘
 *
p
 = (c⁄° stbΩ_ª˘ *Ë
a
;

538 c⁄° 
°bΩ_ª˘
 *
q
 = (c⁄° stbΩ_ª˘ *Ë
b
;

539  (
p
->
was_∑cked
 < 
q
->was_packed) ? -1 : (p->was_packed > q->was_packed);

540 
	}
}

542 
STBRP_DEF
 
	$°bΩ_∑ck_ª˘s
(
°bΩ_c⁄ãxt
 *
c⁄ãxt
, 
°bΩ_ª˘
 *
ª˘s
, 
num_ª˘s
)

544 
i
, 
Æl_ª˘s_∑cked
 = 1;

547 
i
=0; i < 
num_ª˘s
; ++i) {

548 
ª˘s
[
i
].
was_∑cked
 = i;

552 
	`STBRP_SORT
(
ª˘s
, 
num_ª˘s
, ‘e˘s[0]), 
ª˘_height_com∑ª
);

554 
i
=0; i < 
num_ª˘s
; ++i) {

555 i‡(
ª˘s
[
i
].
w
 =0 ||Ñe˘s[i].
h
 == 0) {

556 
ª˘s
[
i
].
x
 =Ñe˘s[i].
y
 = 0;

558 
°bΩ__födªsu…
 
‰
 = 
	`°bΩ__skylöe_∑ck_ª˘™gÀ
(
c⁄ãxt
, 
ª˘s
[
i
].
w
,Ñe˘s[i].
h
);

559 i‡(
‰
.
¥ev_lök
) {

560 
ª˘s
[
i
].
x
 = (
°bΩ_co‹d
Ë
‰
.x;

561 
ª˘s
[
i
].
y
 = (
°bΩ_co‹d
Ë
‰
.y;

563 
ª˘s
[
i
].
x
 =Ñe˘s[i].
y
 = 
STBRP__MAXVAL
;

569 
	`STBRP_SORT
(
ª˘s
, 
num_ª˘s
, ‘e˘s[0]), 
ª˘_‹igöÆ_‹dî
);

572 
i
=0; i < 
num_ª˘s
; ++i) {

573 
ª˘s
[
i
].
was_∑cked
 = !‘e˘s[i].
x
 =
STBRP__MAXVAL
 &&Ñe˘s[i].
y
 == STBRP__MAXVAL);

574 i‡(!
ª˘s
[
i
].
was_∑cked
)

575 
Æl_ª˘s_∑cked
 = 0;

579  
Æl_ª˘s_∑cked
;

580 
	}
}

	@include/stb_sprintf.h

29 #i‚de‡
STB_SPRINTF_H_INCLUDE


30 
	#STB_SPRINTF_H_INCLUDE


	)

145 #i‡
deföed
(
__˛™g__
)

146 #i‡
deföed
(
__has_„©uª
Ë&& deföed(
__has_©åibuã
)

147 #i‡
__has_„©uª
(
addªss_ßnôizî
)

148 #i‡
__has_©åibuã
(
__no_ßnôize__
)

149 
	#STBSP__ASAN
 
	`__©åibuã__
((
	`__no_ßnôize__
("addªss")))

	)

150 #ñi‡
__has_©åibuã
(
__no_ßnôize_addªss__
)

151 
	#STBSP__ASAN
 
	`__©åibuã__
((
__no_ßnôize_addªss__
))

	)

152 #ñi‡
__has_©åibuã
(
__no_addªss_ß„ty_™Æysis__
)

153 
	#STBSP__ASAN
 
	`__©åibuã__
((
__no_addªss_ß„ty_™Æysis__
))

	)

157 #ñi‡
deföed
(
__GNUC__
Ë&& (__GNUC__ >5 || (__GNUC__ =4 && 
__GNUC_MINOR__
 >= 8))

158 #i‡
deföed
(
__SANITIZE_ADDRESS__
) && __SANITIZE_ADDRESS__

159 
	#STBSP__ASAN
 
	`__©åibuã__
((
__no_ßnôize_addªss__
))

	)

163 #i‚de‡
STBSP__ASAN


164 
	#STBSP__ASAN


	)

167 #ifde‡
STB_SPRINTF_STATIC


168 
	#STBSP__PUBLICDEC
 

	)

169 
	#STBSP__PUBLICDEF
 
STBSP__ASAN


	)

171 #ifde‡
__˝lu•lus


172 
	#STBSP__PUBLICDEC
 "C"

	)

173 
	#STBSP__PUBLICDEF
 "C" 
STBSP__ASAN


	)

175 
	#STBSP__PUBLICDEC
 

	)

176 
	#STBSP__PUBLICDEF
 
STBSP__ASAN


	)

180 #i‡
deföed
(
__has_©åibuã
)

181 #i‡
__has_©åibuã
(
f‹m©
)

182 
	#STBSP__ATTRIBUTE_FORMAT
(
fmt
,
va
Ë
	`__©åibuã__
((
	`f‹m©
(
¥ötf
,fmt,va)))

	)

186 #i‚de‡
STBSP__ATTRIBUTE_FORMAT


187 
	#STBSP__ATTRIBUTE_FORMAT
(
fmt
,
va
)

	)

190 #ifde‡
_MSC_VER


191 
	#STBSP__NOTUSED
(
v
Ë()(v)

	)

193 
	#STBSP__NOTUSED
(
v
Ë()(v)

	)

196 
	~<°d¨g.h
>

197 
	~<°ddef.h
>

199 #i‚de‡
STB_SPRINTF_MIN


200 
	#STB_SPRINTF_MIN
 512

202 *
	tSTBSP_SPRINTFCB
(c⁄° *
	tbuf
, *
	tu£r
, 
	tÀn
);

	)

204 #i‚de‡
STB_SPRINTF_DECORATE


205 
	#STB_SPRINTF_DECORATE
(
«me
Ë
°b•_
##name

207 

	)

208 
STBSP__PUBLICDEC
 
	$STB_SPRINTF_DECORATE
(
v•rötf
)(*
buf
, c⁄° *
fmt
, 
va_li°
 
va
);

209 
STBSP__PUBLICDEC
 
	$STB_SPRINTF_DECORATE
(
v¢¥ötf
)(*
buf
, 
cou¡
, c⁄° *
fmt
, 
va_li°
 
va
);

210 
STBSP__PUBLICDEC
 
	$STB_SPRINTF_DECORATE
(
•rötf
)(*
buf
, c⁄° *
fmt
, ...Ë
	`STBSP__ATTRIBUTE_FORMAT
(2,3);

211 
STBSP__PUBLICDEC
 
	$STB_SPRINTF_DECORATE
(
¢¥ötf
)(*
buf
, 
cou¡
, c⁄° *
fmt
, ...Ë
	`STBSP__ATTRIBUTE_FORMAT
(3,4);

213 
STBSP__PUBLICDEC
 
	$STB_SPRINTF_DECORATE
(
v•rötfcb
)(
STBSP_SPRINTFCB
 *
ˇŒback
, *
u£r
, *
buf
, c⁄° *
fmt
, 
va_li°
 
va
);

214 
STBSP__PUBLICDEC
 
	$STB_SPRINTF_DECORATE
(
£t_£∑øt‹s
)(
comma
, 
≥riod
);

218 #ifde‡
STB_SPRINTF_IMPLEMENTATION


220 
	#°b•__uöt32
 

	)

221 
	#°b•__öt32
 sig√d 

	)

223 #ifde‡
_MSC_VER


224 
	#°b•__uöt64
 
__öt64


	)

225 
	#°b•__öt64
 sig√d 
__öt64


	)

227 
	#°b•__uöt64
 

	)

228 
	#°b•__öt64
 sig√d 

	)

230 
	#°b•__uöt16
 

	)

232 #i‚de‡
°b•__uöçå


233 #i‡
	`deföed
(
__µc64__
Ë|| deföed(
__powîpc64__
Ë|| deföed(
__Ørch64__
Ë|| deföed(
_M_X64
Ë|| deföed(
__x86_64__
Ë|| deföed(
__x86_64
Ë|| deföed(
__s390x__
)

234 
	#°b•__uöçå
 
°b•__uöt64


	)

236 
	#°b•__uöçå
 
°b•__uöt32


	)

240 #i‚de‡
STB_SPRINTF_MSVC_MODE


241 #i‡
	`deföed
(
_MSC_VER
) && (_MSC_VER < 1900)

242 
	#STB_SPRINTF_MSVC_MODE


	)

246 #ifde‡
STB_SPRINTF_NOUNALIGNED


247 
	#STBSP__UNALIGNED
(
code
)

	)

249 
	#STBSP__UNALIGNED
(
code
Ë
	)
code

252 #i‚de‡
STB_SPRINTF_NOFLOAT


254 
°b•__öt32
 
	`°b•__ªÆ_to_°r
(c⁄° **
°¨t
, 
°b•__uöt32
 *
Àn
, *
out
, stb•__öt32 *
decimÆ_pos
, 
vÆue
, stb•__uöt32 
‰ac_digôs
);

255 
°b•__öt32
 
	`°b•__ªÆ_to_∑πs
(
°b•__öt64
 *
bôs
, stb•__öt32 *
expo
, 
vÆue
);

256 
	#STBSP__SPECIAL
 0x7000

	)

259 
°b•__≥riod
 = '.';

260 
°b•__comma
 = ',';

263 
ãmp
;

264 
∑ú
[201];

265 } 
°b•__digô∑ú
 =

272 
	}
};

274 
STBSP__PUBLICDEF
 
	$STB_SPRINTF_DECORATE
(
£t_£∑øt‹s
)(
pcomma
, 
µîiod
)

276 
°b•__≥riod
 = 
µîiod
;

277 
°b•__comma
 = 
pcomma
;

278 
	}
}

280 
	#STBSP__LEFTJUST
 1

	)

281 
	#STBSP__LEADINGPLUS
 2

	)

282 
	#STBSP__LEADINGSPACE
 4

	)

283 
	#STBSP__LEADING_0X
 8

	)

284 
	#STBSP__LEADINGZERO
 16

	)

285 
	#STBSP__INTMAX
 32

	)

286 
	#STBSP__TRIPLET_COMMA
 64

	)

287 
	#STBSP__NEGATIVE
 128

	)

288 
	#STBSP__METRIC_SUFFIX
 256

	)

289 
	#STBSP__HALFWIDTH
 512

	)

290 
	#STBSP__METRIC_NOSPACE
 1024

	)

291 
	#STBSP__METRIC_1024
 2048

	)

292 
	#STBSP__METRIC_JEDEC
 4096

	)

294 
	$°b•__Àad_sign
(
°b•__uöt32
 
Ê
, *
sign
)

296 
sign
[0] = 0;

297 i‡(
Ê
 & 
STBSP__NEGATIVE
) {

298 
sign
[0] = 1;

299 
sign
[1] = '-';

300 } i‡(
Ê
 & 
STBSP__LEADINGSPACE
) {

301 
sign
[0] = 1;

302 
sign
[1] = ' ';

303 } i‡(
Ê
 & 
STBSP__LEADINGPLUS
) {

304 
sign
[0] = 1;

305 
sign
[1] = '+';

307 
	}
}

309 
STBSP__ASAN
 
°b•__uöt32
 
	$°b•__°æí_limôed
(c⁄° *
s
, 
°b•__uöt32
 
limô
)

311 c⁄° * 
¢
 = 
s
;

315 i‡(((
°b•__uöçå
)
¢
 & 3) == 0)

318 i‡(!
limô
 || *
¢
 == 0)

319  (
°b•__uöt32
)(
¢
 - 
s
);

321 ++
¢
;

322 --
limô
;

330 
limô
 >= 4) {

331 
°b•__uöt32
 
v
 = *(°b•__uöt32 *)
¢
;

333 i‡((
v
 - 0x01010101) & (~v) & 0x80808080UL)

336 
¢
 += 4;

337 
limô
 -= 4;

341 
limô
 && *
¢
) {

342 ++
¢
;

343 --
limô
;

346  (
°b•__uöt32
)(
¢
 - 
s
);

347 
	}
}

349 
STBSP__PUBLICDEF
 
	$STB_SPRINTF_DECORATE
(
v•rötfcb
)(
STBSP_SPRINTFCB
 *
ˇŒback
, *
u£r
, *
buf
, c⁄° *
fmt
, 
va_li°
 
va
)

351 
hex
[] = "0123456789abcdefxp";

352 
hexu
[] = "0123456789ABCDEFXP";

353 *
bf
;

354 c⁄° *
f
;

355 
éí
 = 0;

357 
bf
 = 
buf
;

358 
f
 = 
fmt
;

360 
°b•__öt32
 
fw
, 
¥
, 
tz
;

361 
°b•__uöt32
 
Ê
;

364 
	#°b•__chk_cb_bufL
(
byãs
) \

366 
Àn
 = ()(
bf
 - 
buf
); \

367 i‡((
Àn
 + (
byãs
)Ë>
STB_SPRINTF_MIN
) { \

368 
éí
 +
Àn
; \

369 i‡(0 =(
bf
 = 
buf
 = 
	`ˇŒback
(buf, 
u£r
, 
Àn
))) \

370 
d⁄e
; \

372 }

	)

373 
	#°b•__chk_cb_buf
(
byãs
) \

375 i‡(
ˇŒback
) { \

376 
	`°b•__chk_cb_bufL
(
byãs
); \

378 }

	)

379 
	#°b•__Êush_cb
() \

381 
	`°b•__chk_cb_bufL
(
STB_SPRINTF_MIN
 - 1); \

383 
	#°b•__cb_buf_˛amp
(
˛
, 
v
) \

384 
˛
 = 
v
; \

385 i‡(
ˇŒback
) { \

386 
lg
 = 
STB_SPRINTF_MIN
 - ()(
bf
 - 
buf
); \

387 i‡(
˛
 > 
lg
) \

388 
˛
 = 
lg
; \

389 }

	)

393 ((
°b•__uöçå
)
f
) & 3) {

394 
schk1
:

395 i‡(
f
[0] == '%')

396 
sˇndd
;

397 
schk2
:

398 i‡(
f
[0] == 0)

399 
ídfmt
;

400 
	`°b•__chk_cb_buf
(1);

401 *
bf
++ = 
f
[0];

402 ++
f
;

408 
°b•__uöt32
 
v
, 
c
;

409 
v
 = *(
°b•__uöt32
 *)
f
;

410 
c
 = (~
v
) & 0x80808080;

411 i‡(((
v
 ^ 0x25252525Ë- 0x01010101Ë& 
c
)

412 
schk1
;

413 i‡((
v
 - 0x01010101Ë& 
c
)

414 
schk2
;

415 i‡(
ˇŒback
)

416 i‡((
STB_SPRINTF_MIN
 - ()(
bf
 - 
buf
)) < 4)

417 
schk1
;

418 #ifde‡
STB_SPRINTF_NOUNALIGNED


419 if(((
°b•__uöçå
)
bf
) & 3) {

420 
bf
[0] = 
f
[0];

421 
bf
[1] = 
f
[1];

422 
bf
[2] = 
f
[2];

423 
bf
[3] = 
f
[3];

427 *(
°b•__uöt32
 *)
bf
 = 
v
;

429 
bf
 += 4;

430 
f
 += 4;

433 
sˇndd
:

435 ++
f
;

438 
fw
 = 0;

439 
¥
 = -1;

440 
Ê
 = 0;

441 
tz
 = 0;

445 
f
[0]) {

448 
Ê
 |
STBSP__LEFTJUST
;

449 ++
f
;

453 
Ê
 |
STBSP__LEADINGPLUS
;

454 ++
f
;

458 
Ê
 |
STBSP__LEADINGSPACE
;

459 ++
f
;

463 
Ê
 |
STBSP__LEADING_0X
;

464 ++
f
;

468 
Ê
 |
STBSP__TRIPLET_COMMA
;

469 ++
f
;

473 i‡(
Ê
 & 
STBSP__METRIC_SUFFIX
) {

474 i‡(
Ê
 & 
STBSP__METRIC_1024
) {

475 
Ê
 |
STBSP__METRIC_JEDEC
;

477 
Ê
 |
STBSP__METRIC_1024
;

480 
Ê
 |
STBSP__METRIC_SUFFIX
;

482 ++
f
;

486 
Ê
 |
STBSP__METRIC_NOSPACE
;

487 ++
f
;

491 
Ê
 |
STBSP__LEADINGZERO
;

492 ++
f
;

493 
Êags_d⁄e
;

494 : 
Êags_d⁄e
;

497 
Êags_d⁄e
:

500 i‡(
f
[0] == '*') {

501 
fw
 = 
	`va_¨g
(
va
, 
°b•__uöt32
);

502 ++
f
;

504 (
f
[0] >= '0') && (f[0] <= '9')) {

505 
fw
 = fw * 10 + 
f
[0] - '0';

506 
f
++;

510 i‡(
f
[0] == '.') {

511 ++
f
;

512 i‡(
f
[0] == '*') {

513 
¥
 = 
	`va_¨g
(
va
, 
°b•__uöt32
);

514 ++
f
;

516 
¥
 = 0;

517 (
f
[0] >= '0') && (f[0] <= '9')) {

518 
¥
 =Ö∏* 10 + 
f
[0] - '0';

519 
f
++;

525 
f
[0]) {

528 
Ê
 |
STBSP__HALFWIDTH
;

529 ++
f
;

530 i‡(
f
[0] == 'h')

531 ++
f
;

535 
Ê
 |(((Ë=8Ë? 
STBSP__INTMAX
 : 0);

536 ++
f
;

537 i‡(
f
[0] == 'l') {

538 
Ê
 |
STBSP__INTMAX
;

539 ++
f
;

544 
Ê
 |((
size_t
Ë=8Ë? 
STBSP__INTMAX
 : 0;

545 ++
f
;

549 
Ê
 |((
±rdiff_t
Ë=8Ë? 
STBSP__INTMAX
 : 0;

550 ++
f
;

553 
Ê
 |((
±rdiff_t
Ë=8Ë? 
STBSP__INTMAX
 : 0;

554 ++
f
;

558 i‡((
f
[1] == '6') && (f[2] == '4')) {

559 
Ê
 |
STBSP__INTMAX
;

560 
f
 += 3;

561 } i‡((
f
[1] == '3') && (f[2] == '2')) {

562 
f
 += 3;

564 
Ê
 |(((*Ë=8Ë? 
STBSP__INTMAX
 : 0);

565 ++
f
;

572 
f
[0]) {

573 
	#STBSP__NUMSZ
 512

574 
num
[
STBSP__NUMSZ
];

	)

575 
Àad
[8];

576 
èû
[8];

577 *
s
;

578 c⁄° *
h
;

579 
°b•__uöt32
 
l
, 
n
, 
cs
;

580 
°b•__uöt64
 
n64
;

581 #i‚de‡
STB_SPRINTF_NOFLOAT


582 
fv
;

584 
°b•__öt32
 
dp
;

585 c⁄° *
¢
;

589 
s
 = 
	`va_¨g
(
va
, *);

590 i‡(
s
 == 0)

591 
s
 = (*)"null";

594 
l
 = 
	`°b•__°æí_limôed
(
s
, (
¥
 >= 0) ?Ör : ~0u);

595 
Àad
[0] = 0;

596 
èû
[0] = 0;

597 
¥
 = 0;

598 
dp
 = 0;

599 
cs
 = 0;

601 
sc›y
;

605 
s
 = 
num
 + 
STBSP__NUMSZ
 - 1;

606 *
s
 = ()
	`va_¨g
(
va
, );

607 
l
 = 1;

608 
Àad
[0] = 0;

609 
èû
[0] = 0;

610 
¥
 = 0;

611 
dp
 = 0;

612 
cs
 = 0;

613 
sc›y
;

617 *
d
 = 
	`va_¨g
(
va
, *);

618 *
d
 = 
éí
 + ()(
bf
 - 
buf
);

621 #ifde‡
STB_SPRINTF_NOFLOAT


629 
	`va_¨g
(
va
, );

630 
s
 = (*)"No float";

631 
l
 = 8;

632 
Àad
[0] = 0;

633 
èû
[0] = 0;

634 
¥
 = 0;

635 
cs
 = 0;

636 
	`STBSP__NOTUSED
(
dp
);

637 
sc›y
;

641 
h
 = (
f
[0] ='A'Ë? 
hexu
 : 
hex
;

642 
fv
 = 
	`va_¨g
(
va
, );

643 i‡(
¥
 == -1)

644 
¥
 = 6;

646 i‡(
	`°b•__ªÆ_to_∑πs
((
°b•__öt64
 *)&
n64
, &
dp
, 
fv
))

647 
Ê
 |
STBSP__NEGATIVE
;

649 
s
 = 
num
 + 64;

651 
	`°b•__Àad_sign
(
Ê
, 
Àad
);

653 i‡(
dp
 == -1023)

654 
dp
 = (
n64
) ? -1022 : 0;

656 
n64
 |(((
°b•__uöt64
)1) << 52);

657 
n64
 <<= (64 - 56);

658 i‡(
¥
 < 15)

659 
n64
 +((((
°b•__uöt64
)8Ë<< 56Ë>> (
¥
 * 4));

662 #ifde‡
STB_SPRINTF_MSVC_MODE


663 *
s
++ = '0';

664 *
s
++ = 'x';

666 
Àad
[1 +Üead[0]] = '0';

667 
Àad
[2 +Üead[0]] = 'x';

668 
Àad
[0] += 2;

670 *
s
++ = 
h
[(
n64
 >> 60) & 15];

671 
n64
 <<= 4;

672 i‡(
¥
)

673 *
s
++ = 
°b•__≥riod
;

674 
¢
 = 
s
;

677 
n
 = 
¥
;

678 i‡(
n
 > 13)

679 
n
 = 13;

680 i‡(
¥
 > (
°b•__öt32
)
n
)

681 
tz
 = 
¥
 - 
n
;

682 
¥
 = 0;

683 
n
--) {

684 *
s
++ = 
h
[(
n64
 >> 60) & 15];

685 
n64
 <<= 4;

689 
èû
[1] = 
h
[17];

690 i‡(
dp
 < 0) {

691 
èû
[2] = '-';

692 
dp
 = -dp;

694 
èû
[2] = '+';

695 
n
 = (
dp
 >= 1000) ? 6 : ((dp >= 100) ? 5 : ((dp >= 10) ? 4 : 3));

696 
èû
[0] = ()
n
;

698 
èû
[
n
] = '0' + 
dp
 % 10;

699 i‡(
n
 <= 3)

701 --
n
;

702 
dp
 /= 10;

705 
dp
 = ()(
s
 - 
¢
);

706 
l
 = ()(
s
 - (
num
 + 64));

707 
s
 = 
num
 + 64;

708 
cs
 = 1 + (3 << 24);

709 
sc›y
;

713 
h
 = (
f
[0] ='G'Ë? 
hexu
 : 
hex
;

714 
fv
 = 
	`va_¨g
(
va
, );

715 i‡(
¥
 == -1)

716 
¥
 = 6;

717 i‡(
¥
 == 0)

718 
¥
 = 1;

720 i‡(
	`°b•__ªÆ_to_°r
(&
¢
, &
l
, 
num
, &
dp
, 
fv
, (
¥
 - 1) | 0x80000000))

721 
Ê
 |
STBSP__NEGATIVE
;

724 
n
 = 
¥
;

725 i‡(
l
 > (
°b•__uöt32
)
¥
)

726 
l
 = 
¥
;

727 (
l
 > 1Ë&& (
¥
Ë&& (
¢
[l - 1] == '0')) {

728 --
¥
;

729 --
l
;

733 i‡((
dp
 <-4Ë|| (d∞> (
°b•__öt32
)
n
)) {

734 i‡(
¥
 > (
°b•__öt32
)
l
)

735 
¥
 = 
l
 - 1;

736 i‡(
¥
)

737 --
¥
;

738 
d€xp‰omg
;

741 i‡(
dp
 > 0) {

742 
¥
 = (
dp
 < (
°b•__öt32
)
l
) ?Ü - dp : 0;

744 
¥
 = -
dp
 + (’∏> (
°b•__öt32
)
l
) ? (stbsp__int32)Ü :Ör);

746 
doÊﬂt‰omg
;

750 
h
 = (
f
[0] ='E'Ë? 
hexu
 : 
hex
;

751 
fv
 = 
	`va_¨g
(
va
, );

752 i‡(
¥
 == -1)

753 
¥
 = 6;

755 i‡(
	`°b•__ªÆ_to_°r
(&
¢
, &
l
, 
num
, &
dp
, 
fv
, 
¥
 | 0x80000000))

756 
Ê
 |
STBSP__NEGATIVE
;

757 
d€xp‰omg
:

758 
èû
[0] = 0;

759 
	`°b•__Àad_sign
(
Ê
, 
Àad
);

760 i‡(
dp
 =
STBSP__SPECIAL
) {

761 
s
 = (*)
¢
;

762 
cs
 = 0;

763 
¥
 = 0;

764 
sc›y
;

766 
s
 = 
num
 + 64;

768 *
s
++ = 
¢
[0];

770 i‡(
¥
)

771 *
s
++ = 
°b•__≥riod
;

774 i‡((
l
 - 1Ë> (
°b•__uöt32
)
¥
)

775 
l
 = 
¥
 + 1;

776 
n
 = 1;Ç < 
l
;Ç++)

777 *
s
++ = 
¢
[
n
];

779 
tz
 = 
¥
 - (
l
 - 1);

780 
¥
 = 0;

782 
èû
[1] = 
h
[0xe];

783 
dp
 -= 1;

784 i‡(
dp
 < 0) {

785 
èû
[2] = '-';

786 
dp
 = -dp;

788 
èû
[2] = '+';

789 #ifde‡
STB_SPRINTF_MSVC_MODE


790 
n
 = 5;

792 
n
 = (
dp
 >= 100) ? 5 : 4;

794 
èû
[0] = ()
n
;

796 
èû
[
n
] = '0' + 
dp
 % 10;

797 i‡(
n
 <= 3)

799 --
n
;

800 
dp
 /= 10;

802 
cs
 = 1 + (3 << 24);

803 
Êt_Àad
;

806 
fv
 = 
	`va_¨g
(
va
, );

807 
dﬂÊﬂt
:

809 i‡(
Ê
 & 
STBSP__METRIC_SUFFIX
) {

810 
divis‹
;

811 
divis‹
 = 1000.0f;

812 i‡(
Ê
 & 
STBSP__METRIC_1024
)

813 
divis‹
 = 1024.0;

814 
Ê
 < 0x4000000) {

815 i‡((
fv
 < 
divis‹
) && (fv > -divisor))

817 
fv
 /
divis‹
;

818 
Ê
 += 0x1000000;

821 i‡(
¥
 == -1)

822 
¥
 = 6;

824 i‡(
	`°b•__ªÆ_to_°r
(&
¢
, &
l
, 
num
, &
dp
, 
fv
, 
¥
))

825 
Ê
 |
STBSP__NEGATIVE
;

826 
doÊﬂt‰omg
:

827 
èû
[0] = 0;

828 
	`°b•__Àad_sign
(
Ê
, 
Àad
);

829 i‡(
dp
 =
STBSP__SPECIAL
) {

830 
s
 = (*)
¢
;

831 
cs
 = 0;

832 
¥
 = 0;

833 
sc›y
;

835 
s
 = 
num
 + 64;

838 i‡(
dp
 <= 0) {

839 
°b•__öt32
 
i
;

841 *
s
++ = '0';

842 i‡(
¥
)

843 *
s
++ = 
°b•__≥riod
;

844 
n
 = -
dp
;

845 i‡((
°b•__öt32
)
n
 > 
¥
)

846 
n
 = 
¥
;

847 
i
 = 
n
;

848 
i
) {

849 i‡((((
°b•__uöçå
)
s
) & 3) == 0)

851 *
s
++ = '0';

852 --
i
;

854 
i
 >= 4) {

855 *(
°b•__uöt32
 *)
s
 = 0x30303030;

856 
s
 += 4;

857 
i
 -= 4;

859 
i
) {

860 *
s
++ = '0';

861 --
i
;

863 i‡((
°b•__öt32
)(
l
 + 
n
Ë> 
¥
)

864 
l
 = 
¥
 - 
n
;

865 
i
 = 
l
;

866 
i
) {

867 *
s
++ = *
¢
++;

868 --
i
;

870 
tz
 = 
¥
 - (
n
 + 
l
);

871 
cs
 = 1 + (3 << 24);

873 
cs
 = (
Ê
 & 
STBSP__TRIPLET_COMMA
Ë? ((600 - (
°b•__uöt32
)
dp
) % 3) : 0;

874 i‡((
°b•__uöt32
)
dp
 >
l
) {

876 
n
 = 0;

878 i‡((
Ê
 & 
STBSP__TRIPLET_COMMA
Ë&& (++
cs
 == 4)) {

879 
cs
 = 0;

880 *
s
++ = 
°b•__comma
;

882 *
s
++ = 
¢
[
n
];

883 ++
n
;

884 i‡(
n
 >
l
)

888 i‡(
n
 < (
°b•__uöt32
)
dp
) {

889 
n
 = 
dp
 -Ç;

890 i‡((
Ê
 & 
STBSP__TRIPLET_COMMA
) == 0) {

891 
n
) {

892 i‡((((
°b•__uöçå
)
s
) & 3) == 0)

894 *
s
++ = '0';

895 --
n
;

897 
n
 >= 4) {

898 *(
°b•__uöt32
 *)
s
 = 0x30303030;

899 
s
 += 4;

900 
n
 -= 4;

903 
n
) {

904 i‡((
Ê
 & 
STBSP__TRIPLET_COMMA
Ë&& (++
cs
 == 4)) {

905 
cs
 = 0;

906 *
s
++ = 
°b•__comma
;

908 *
s
++ = '0';

909 --
n
;

913 
cs
 = ()(
s
 - (
num
 + 64)) + (3 << 24);

914 i‡(
¥
) {

915 *
s
++ = 
°b•__≥riod
;

916 
tz
 = 
¥
;

920 
n
 = 0;

922 i‡((
Ê
 & 
STBSP__TRIPLET_COMMA
Ë&& (++
cs
 == 4)) {

923 
cs
 = 0;

924 *
s
++ = 
°b•__comma
;

926 *
s
++ = 
¢
[
n
];

927 ++
n
;

928 i‡(
n
 >(
°b•__uöt32
)
dp
)

932 
cs
 = ()(
s
 - (
num
 + 64)) + (3 << 24);

933 i‡(
¥
)

934 *
s
++ = 
°b•__≥riod
;

935 i‡((
l
 - 
dp
Ë> (
°b•__uöt32
)
¥
)

936 
l
 = 
¥
 + 
dp
;

937 
n
 < 
l
) {

938 *
s
++ = 
¢
[
n
];

939 ++
n
;

941 
tz
 = 
¥
 - (
l
 - 
dp
);

944 
¥
 = 0;

947 i‡(
Ê
 & 
STBSP__METRIC_SUFFIX
) {

948 
idx
;

949 
idx
 = 1;

950 i‡(
Ê
 & 
STBSP__METRIC_NOSPACE
)

951 
idx
 = 0;

952 
èû
[0] = 
idx
;

953 
èû
[1] = ' ';

955 i‡(
Ê
 >> 24) {

956 i‡(
Ê
 & 
STBSP__METRIC_1024
)

957 
èû
[
idx
 + 1] = "_KMGT"[
Ê
 >> 24];

959 
èû
[
idx
 + 1] = "_kMGT"[
Ê
 >> 24];

960 
idx
++;

962 i‡(
Ê
 & 
STBSP__METRIC_1024
 && !(Ê & 
STBSP__METRIC_JEDEC
)) {

963 
èû
[
idx
 + 1] = 'i';

964 
idx
++;

966 
èû
[0] = 
idx
;

971 
Êt_Àad
:

973 
l
 = (
°b•__uöt32
)(
s
 - (
num
 + 64));

974 
s
 = 
num
 + 64;

975 
sc›y
;

980 
h
 = (
f
[0] ='B'Ë? 
hexu
 : 
hex
;

981 
Àad
[0] = 0;

982 i‡(
Ê
 & 
STBSP__LEADING_0X
) {

983 
Àad
[0] = 2;

984 
Àad
[1] = '0';

985 
Àad
[2] = 
h
[0xb];

987 
l
 = (8 << 4) | (1 << 8);

988 
ødixnum
;

991 
h
 = 
hexu
;

992 
Àad
[0] = 0;

993 i‡(
Ê
 & 
STBSP__LEADING_0X
) {

994 
Àad
[0] = 1;

995 
Àad
[1] = '0';

997 
l
 = (3 << 4) | (3 << 8);

998 
ødixnum
;

1001 
Ê
 |((*Ë=8Ë? 
STBSP__INTMAX
 : 0;

1002 
¥
 = (*) * 2;

1003 
Ê
 &~
STBSP__LEADINGZERO
;

1008 
h
 = (
f
[0] ='X'Ë? 
hexu
 : 
hex
;

1009 
l
 = (4 << 4) | (4 << 8);

1010 
Àad
[0] = 0;

1011 i‡(
Ê
 & 
STBSP__LEADING_0X
) {

1012 
Àad
[0] = 2;

1013 
Àad
[1] = '0';

1014 
Àad
[2] = 
h
[16];

1016 
ødixnum
:

1018 i‡(
Ê
 & 
STBSP__INTMAX
)

1019 
n64
 = 
	`va_¨g
(
va
, 
°b•__uöt64
);

1021 
n64
 = 
	`va_¨g
(
va
, 
°b•__uöt32
);

1023 
s
 = 
num
 + 
STBSP__NUMSZ
;

1024 
dp
 = 0;

1026 
èû
[0] = 0;

1027 i‡(
n64
 == 0) {

1028 
Àad
[0] = 0;

1029 i‡(
¥
 == 0) {

1030 
l
 = 0;

1031 
cs
 = 0;

1032 
sc›y
;

1037 *--
s
 = 
h
[
n64
 & ((1 << (
l
 >> 8)) - 1)];

1038 
n64
 >>(
l
 >> 8);

1039 i‡(!((
n64
Ë|| ((
°b•__öt32
)((
num
 + 
STBSP__NUMSZ
Ë- 
s
Ë< 
¥
)))

1041 i‡(
Ê
 & 
STBSP__TRIPLET_COMMA
) {

1042 ++
l
;

1043 i‡((
l
 & 15) == ((l >> 4) & 15)) {

1044 
l
 &= ~15;

1045 *--
s
 = 
°b•__comma
;

1050 
cs
 = (
°b•__uöt32
)((
num
 + 
STBSP__NUMSZ
Ë- 
s
Ë+ ((((
l
 >> 4) & 15)) << 24);

1052 
l
 = (
°b•__uöt32
)((
num
 + 
STBSP__NUMSZ
Ë- 
s
);

1054 
sc›y
;

1060 i‡(
Ê
 & 
STBSP__INTMAX
) {

1061 
°b•__öt64
 
i64
 = 
	`va_¨g
(
va
, stbsp__int64);

1062 
n64
 = (
°b•__uöt64
)
i64
;

1063 i‡((
f
[0] !'u'Ë&& (
i64
 < 0)) {

1064 
n64
 = (
°b•__uöt64
)-
i64
;

1065 
Ê
 |
STBSP__NEGATIVE
;

1068 
°b•__öt32
 
i
 = 
	`va_¨g
(
va
, stbsp__int32);

1069 
n64
 = (
°b•__uöt32
)
i
;

1070 i‡((
f
[0] !'u'Ë&& (
i
 < 0)) {

1071 
n64
 = (
°b•__uöt32
)-
i
;

1072 
Ê
 |
STBSP__NEGATIVE
;

1076 #i‚de‡
STB_SPRINTF_NOFLOAT


1077 i‡(
Ê
 & 
STBSP__METRIC_SUFFIX
) {

1078 i‡(
n64
 < 1024)

1079 
¥
 = 0;

1080 i‡(
¥
 == -1)

1081 
¥
 = 1;

1082 
fv
 = ()(
°b•__öt64
)
n64
;

1083 
dﬂÊﬂt
;

1088 
s
 = 
num
 + 
STBSP__NUMSZ
;

1089 
l
 = 0;

1093 *
o
 = 
s
 - 8;

1094 i‡(
n64
 >= 100000000) {

1095 
n
 = (
°b•__uöt32
)(
n64
 % 100000000);

1096 
n64
 /= 100000000;

1098 
n
 = (
°b•__uöt32
)
n64
;

1099 
n64
 = 0;

1101 i‡((
Ê
 & 
STBSP__TRIPLET_COMMA
) == 0) {

1103 
s
 -= 2;

1104 *(
°b•__uöt16
 *)
s
 = *(°b•__uöt16 *)&
°b•__digô∑ú
.
∑ú
[(
n
 % 100) * 2];

1105 
n
 /= 100;

1106 } 
n
);

1108 
n
) {

1109 i‡((
Ê
 & 
STBSP__TRIPLET_COMMA
Ë&& (
l
++ == 3)) {

1110 
l
 = 0;

1111 *--
s
 = 
°b•__comma
;

1112 --
o
;

1114 *--
s
 = ()(
n
 % 10) + '0';

1115 
n
 /= 10;

1118 i‡(
n64
 == 0) {

1119 i‡((
s
[0] ='0'Ë&& (†!(
num
 + 
STBSP__NUMSZ
)))

1120 ++
s
;

1123 
s
 !
o
)

1124 i‡((
Ê
 & 
STBSP__TRIPLET_COMMA
Ë&& (
l
++ == 3)) {

1125 
l
 = 0;

1126 *--
s
 = 
°b•__comma
;

1127 --
o
;

1129 *--
s
 = '0';

1133 
èû
[0] = 0;

1134 
	`°b•__Àad_sign
(
Ê
, 
Àad
);

1137 
l
 = (
°b•__uöt32
)((
num
 + 
STBSP__NUMSZ
Ë- 
s
);

1138 i‡(
l
 == 0) {

1139 *--
s
 = '0';

1140 
l
 = 1;

1142 
cs
 = 
l
 + (3 << 24);

1143 i‡(
¥
 < 0)

1144 
¥
 = 0;

1146 
sc›y
:

1148 i‡(
¥
 < (
°b•__öt32
)
l
)

1149 
¥
 = 
l
;

1150 
n
 = 
¥
 + 
Àad
[0] + 
èû
[0] + 
tz
;

1151 i‡(
fw
 < (
°b•__öt32
)
n
)

1152 
fw
 = 
n
;

1153 
fw
 -
n
;

1154 
¥
 -
l
;

1157 i‡((
Ê
 & 
STBSP__LEFTJUST
) == 0) {

1158 i‡(
Ê
 & 
STBSP__LEADINGZERO
)

1160 
¥
 = (
fw
 >Ör) ? fw :Ör;

1161 
fw
 = 0;

1163 
Ê
 &~
STBSP__TRIPLET_COMMA
;

1168 i‡(
fw
 + 
¥
) {

1169 
°b•__öt32
 
i
;

1170 
°b•__uöt32
 
c
;

1173 i‡((
Ê
 & 
STBSP__LEFTJUST
) == 0)

1174 
fw
 > 0) {

1175 
	`°b•__cb_buf_˛amp
(
i
, 
fw
);

1176 
fw
 -
i
;

1177 
i
) {

1178 i‡((((
°b•__uöçå
)
bf
) & 3) == 0)

1180 *
bf
++ = ' ';

1181 --
i
;

1183 
i
 >= 4) {

1184 *(
°b•__uöt32
 *)
bf
 = 0x20202020;

1185 
bf
 += 4;

1186 
i
 -= 4;

1188 
i
) {

1189 *
bf
++ = ' ';

1190 --
i
;

1192 
	`°b•__chk_cb_buf
(1);

1196 
¢
 = 
Àad
 + 1;

1197 
Àad
[0]) {

1198 
	`°b•__cb_buf_˛amp
(
i
, 
Àad
[0]);

1199 
Àad
[0] -()
i
;

1200 
i
) {

1201 *
bf
++ = *
¢
++;

1202 --
i
;

1204 
	`°b•__chk_cb_buf
(1);

1208 
c
 = 
cs
 >> 24;

1209 
cs
 &= 0xffffff;

1210 
cs
 = (
Ê
 & 
STBSP__TRIPLET_COMMA
Ë? ((
°b•__uöt32
)(
c
 - ((
¥
 + cs) % (c + 1)))) : 0;

1211 
¥
 > 0) {

1212 
	`°b•__cb_buf_˛amp
(
i
, 
¥
);

1213 
¥
 -
i
;

1214 i‡((
Ê
 & 
STBSP__TRIPLET_COMMA
) == 0) {

1215 
i
) {

1216 i‡((((
°b•__uöçå
)
bf
) & 3) == 0)

1218 *
bf
++ = '0';

1219 --
i
;

1221 
i
 >= 4) {

1222 *(
°b•__uöt32
 *)
bf
 = 0x30303030;

1223 
bf
 += 4;

1224 
i
 -= 4;

1227 
i
) {

1228 i‡((
Ê
 & 
STBSP__TRIPLET_COMMA
Ë&& (
cs
++ =
c
)) {

1229 
cs
 = 0;

1230 *
bf
++ = 
°b•__comma
;

1232 *
bf
++ = '0';

1233 --
i
;

1235 
	`°b•__chk_cb_buf
(1);

1240 
¢
 = 
Àad
 + 1;

1241 
Àad
[0]) {

1242 
°b•__öt32
 
i
;

1243 
	`°b•__cb_buf_˛amp
(
i
, 
Àad
[0]);

1244 
Àad
[0] -()
i
;

1245 
i
) {

1246 *
bf
++ = *
¢
++;

1247 --
i
;

1249 
	`°b•__chk_cb_buf
(1);

1253 
n
 = 
l
;

1254 
n
) {

1255 
°b•__öt32
 
i
;

1256 
	`°b•__cb_buf_˛amp
(
i
, 
n
);

1257 
n
 -
i
;

1258 
	`STBSP__UNALIGNED
(
i
 >= 4) {

1259 *(
°b•__uöt32
 vﬁ©ûê*)
bf
 = *(°b•__uöt32 vﬁ©ûê*)
s
;

1260 
bf
 += 4;

1261 
s
 += 4;

1262 
i
 -= 4;

1264 
i
) {

1265 *
bf
++ = *
s
++;

1266 --
i
;

1268 
	`°b•__chk_cb_buf
(1);

1272 
tz
) {

1273 
°b•__öt32
 
i
;

1274 
	`°b•__cb_buf_˛amp
(
i
, 
tz
);

1275 
tz
 -
i
;

1276 
i
) {

1277 i‡((((
°b•__uöçå
)
bf
) & 3) == 0)

1279 *
bf
++ = '0';

1280 --
i
;

1282 
i
 >= 4) {

1283 *(
°b•__uöt32
 *)
bf
 = 0x30303030;

1284 
bf
 += 4;

1285 
i
 -= 4;

1287 
i
) {

1288 *
bf
++ = '0';

1289 --
i
;

1291 
	`°b•__chk_cb_buf
(1);

1295 
¢
 = 
èû
 + 1;

1296 
èû
[0]) {

1297 
°b•__öt32
 
i
;

1298 
	`°b•__cb_buf_˛amp
(
i
, 
èû
[0]);

1299 
èû
[0] -()
i
;

1300 
i
) {

1301 *
bf
++ = *
¢
++;

1302 --
i
;

1304 
	`°b•__chk_cb_buf
(1);

1308 i‡(
Ê
 & 
STBSP__LEFTJUST
)

1309 i‡(
fw
 > 0) {

1310 
fw
) {

1311 
°b•__öt32
 
i
;

1312 
	`°b•__cb_buf_˛amp
(
i
, 
fw
);

1313 
fw
 -
i
;

1314 
i
) {

1315 i‡((((
°b•__uöçå
)
bf
) & 3) == 0)

1317 *
bf
++ = ' ';

1318 --
i
;

1320 
i
 >= 4) {

1321 *(
°b•__uöt32
 *)
bf
 = 0x20202020;

1322 
bf
 += 4;

1323 
i
 -= 4;

1325 
i
--)

1326 *
bf
++ = ' ';

1327 
	`°b•__chk_cb_buf
(1);

1333 
s
 = 
num
 + 
STBSP__NUMSZ
 - 1;

1334 *
s
 = 
f
[0];

1335 
l
 = 1;

1336 
fw
 = 
Ê
 = 0;

1337 
Àad
[0] = 0;

1338 
èû
[0] = 0;

1339 
¥
 = 0;

1340 
dp
 = 0;

1341 
cs
 = 0;

1342 
sc›y
;

1344 ++
f
;

1346 
ídfmt
:

1348 i‡(!
ˇŒback
)

1349 *
bf
 = 0;

1351 
	`°b•__Êush_cb
();

1353 
d⁄e
:

1354  
éí
 + ()(
bf
 - 
buf
);

1355 
	}
}

1358 #unde‡
STBSP__LEFTJUST


1359 #unde‡
STBSP__LEADINGPLUS


1360 #unde‡
STBSP__LEADINGSPACE


1361 #unde‡
STBSP__LEADING_0X


1362 #unde‡
STBSP__LEADINGZERO


1363 #unde‡
STBSP__INTMAX


1364 #unde‡
STBSP__TRIPLET_COMMA


1365 #unde‡
STBSP__NEGATIVE


1366 #unde‡
STBSP__METRIC_SUFFIX


1367 #unde‡
STBSP__NUMSZ


1368 #unde‡
°b•__chk_cb_bufL


1369 #unde‡
°b•__chk_cb_buf


1370 #unde‡
°b•__Êush_cb


1371 #unde‡
°b•__cb_buf_˛amp


1376 
STBSP__PUBLICDEF
 
	$STB_SPRINTF_DECORATE
(
•rötf
)(*
buf
, c⁄° *
fmt
, ...)

1378 
ªsu…
;

1379 
va_li°
 
va
;

1380 
	`va_°¨t
(
va
, 
fmt
);

1381 
ªsu…
 = 
	`STB_SPRINTF_DECORATE
(
v•rötfcb
)(0, 0, 
buf
, 
fmt
, 
va
);

1382 
	`va_íd
(
va
);

1383  
ªsu…
;

1384 
	}
}

1386 
	s°b•__c⁄ãxt
 {

1387 *
	mbuf
;

1388 
	mcou¡
;

1389 
	mÀngth
;

1390 
	mtmp
[
STB_SPRINTF_MIN
];

1391 } 
	t°b•__c⁄ãxt
;

1393 *
	$°b•__˛amp_ˇŒback
(c⁄° *
buf
, *
u£r
, 
Àn
)

1395 
°b•__c⁄ãxt
 *
c
 = (°b•__c⁄ãxà*)
u£r
;

1396 
c
->
Àngth
 +
Àn
;

1398 i‡(
Àn
 > 
c
->
cou¡
)

1399 
Àn
 = 
c
->
cou¡
;

1401 i‡(
Àn
) {

1402 i‡(
buf
 !
c
->buf) {

1403 c⁄° *
s
, *
£
;

1404 *
d
;

1405 
d
 = 
c
->
buf
;

1406 
s
 = 
buf
;

1407 
£
 = 
buf
 + 
Àn
;

1409 *
d
++ = *
s
++;

1410 } 
s
 < 
£
);

1412 
c
->
buf
 +
Àn
;

1413 
c
->
cou¡
 -
Àn
;

1416 i‡(
c
->
cou¡
 <= 0)

1417  
c
->
tmp
;

1418  (
c
->
cou¡
 >
STB_SPRINTF_MIN
Ë? c->
buf
 : c->
tmp
;

1419 
	}
}

1421 * 
	$°b•__cou¡_˛amp_ˇŒback
–c⁄° * 
buf
, * 
u£r
, 
Àn
 )

1423 
°b•__c⁄ãxt
 * 
c
 = (°b•__c⁄ãxt*)
u£r
;

1424 (Ë(
buf
);

1426 
c
->
Àngth
 +
Àn
;

1427  
c
->
tmp
;

1428 
	}
}

1430 
STBSP__PUBLICDEF
 
	$STB_SPRINTF_DECORATE
–
v¢¥ötf
 )–* 
buf
, 
cou¡
, c⁄° * 
fmt
, 
va_li°
 
va
 )

1432 
°b•__c⁄ãxt
 
c
;

1434 i‡–(
cou¡
 =0Ë&& !
buf
 )

1436 
c
.
Àngth
 = 0;

1438 
	`STB_SPRINTF_DECORATE
–
v•rötfcb
 )–
°b•__cou¡_˛amp_ˇŒback
, &
c
, c.
tmp
, 
fmt
, 
va
 );

1442 
l
;

1444 
c
.
buf
 = buf;

1445 
c
.
cou¡
 = count;

1446 
c
.
Àngth
 = 0;

1448 
	`STB_SPRINTF_DECORATE
–
v•rötfcb
 )–
°b•__˛amp_ˇŒback
, &
c
, 
	`°b•__˛amp_ˇŒback
(0,&c,0), 
fmt
, 
va
 );

1451 
l
 = ()–
c
.
buf
 - buf );

1452 i‡–
l
 >
cou¡
 )

1453 
l
 = 
cou¡
 - 1;

1454 
buf
[
l
] = 0;

1457  
c
.
Àngth
;

1458 
	}
}

1460 
STBSP__PUBLICDEF
 
	$STB_SPRINTF_DECORATE
(
¢¥ötf
)(*
buf
, 
cou¡
, c⁄° *
fmt
, ...)

1462 
ªsu…
;

1463 
va_li°
 
va
;

1464 
	`va_°¨t
(
va
, 
fmt
);

1466 
ªsu…
 = 
	`STB_SPRINTF_DECORATE
(
v¢¥ötf
)(
buf
, 
cou¡
, 
fmt
, 
va
);

1467 
	`va_íd
(
va
);

1469  
ªsu…
;

1470 
	}
}

1472 
STBSP__PUBLICDEF
 
	$STB_SPRINTF_DECORATE
(
v•rötf
)(*
buf
, c⁄° *
fmt
, 
va_li°
 
va
)

1474  
	`STB_SPRINTF_DECORATE
(
v•rötfcb
)(0, 0, 
buf
, 
fmt
, 
va
);

1475 
	}
}

1480 #i‚de‡
STB_SPRINTF_NOFLOAT


1483 
	#STBSP__COPYFP
(
de°
, 
§c
) \

1485 
˙
; \

1486 
˙
 = 0; cn < 8; cn++) \

1487 ((*)&
de°
)[
˙
] = ((*)&
§c
)[cn]; \

1488 }

	)

1491 
°b•__öt32
 
	$°b•__ªÆ_to_∑πs
(
°b•__öt64
 *
bôs
, 
°b•__öt32
 *
expo
, 
vÆue
)

1493 
d
;

1494 
°b•__öt64
 
b
 = 0;

1497 
d
 = 
vÆue
;

1499 
	`STBSP__COPYFP
(
b
, 
d
);

1501 *
bôs
 = 
b
 & ((((
°b•__uöt64
)1) << 52) - 1);

1502 *
expo
 = (
°b•__öt32
)(((
b
 >> 52) & 2047) - 1023);

1504  (
°b•__öt32
)((
°b•__uöt64
Ë
b
 >> 63);

1505 
	}
}

1507 c⁄° 
	g°b•__bŸ
[23] = {

1511 c⁄° 
	g°b•__√gbŸ
[22] = {

1515 c⁄° 
	g°b•__√gbŸîr
[22] = {

1521 c⁄° 
	g°b•__t›
[13] = {

1524 c⁄° 
	g°b•__√gt›
[13] = {

1527 c⁄° 
	g°b•__t›îr
[13] = {

1542 c⁄° 
	g°b•__√gt›îr
[13] = {

1549 #i‡
deföed
(
_MSC_VER
) && (_MSC_VER <= 1200)

1550 
°b•__uöt64
 c⁄° 
	g°b•__powãn
[20] = {

1572 
	#°b•__ã¡o19th
 ((
°b•__uöt64
)1000000000000000000)

	)

1574 
°b•__uöt64
 c⁄° 
	g°b•__powãn
[20] = {

1596 
	#°b•__ã¡o19th
 (1000000000000000000ULL)

	)

1599 
	#°b•__ddmu…hi
(
oh
, 
ﬁ
, 
xh
, 
yh
) \

1601 
ahi
 = 0, 
Æo
, 
bhi
 = 0, 
blo
; \

1602 
°b•__öt64
 
bt
; \

1603 
oh
 = 
xh
 * 
yh
; \

1604 
	`STBSP__COPYFP
(
bt
, 
xh
); \

1605 
bt
 &((~(
°b•__uöt64
)0) << 27); \

1606 
	`STBSP__COPYFP
(
ahi
, 
bt
); \

1607 
Æo
 = 
xh
 - 
ahi
; \

1608 
	`STBSP__COPYFP
(
bt
, 
yh
); \

1609 
bt
 &((~(
°b•__uöt64
)0) << 27); \

1610 
	`STBSP__COPYFP
(
bhi
, 
bt
); \

1611 
blo
 = 
yh
 - 
bhi
; \

1612 
ﬁ
 = ((
ahi
 * 
bhi
 - 
oh
Ë+áhò* 
blo
 + 
Æo
 * bhi) +álo * blo; \

1613 }

	)

1615 
	#°b•__ddtoS64
(
ob
, 
xh
, 
xl
) \

1617 
ahi
 = 0, 
Æo
, 
vh
, 
t
; \

1618 
ob
 = (
°b•__öt64
)
xh
; \

1619 
vh
 = ()
ob
; \

1620 
ahi
 = (
xh
 - 
vh
); \

1621 
t
 = (
ahi
 - 
xh
); \

1622 
Æo
 = (
xh
 - (
ahi
 - 
t
)Ë- (
vh
 +Å); \

1623 
ob
 +(
°b•__öt64
)(
ahi
 + 
Æo
 + 
xl
); \

1624 }

	)

1626 
	#°b•__ddªn‹m
(
oh
, 
ﬁ
) \

1628 
s
; \

1629 
s
 = 
oh
 + 
ﬁ
; \

1630 
ﬁ
 = o»- (
s
 - 
oh
); \

1631 
oh
 = 
s
; \

1632 }

	)

1634 
	#°b•__ddmu…lo
(
oh
, 
ﬁ
, 
xh
, 
xl
, 
yh
, 
yl
Ëﬁ = o»+ (xh * y»+ x»* yh);

	)

1636 
	#°b•__ddmu…los
(
oh
, 
ﬁ
, 
xh
, 
yl
Ëﬁ = o»+ (xh * yl);

	)

1638 
	$°b•__øi£_to_powî10
(*
ohi
, *
ﬁo
, 
d
, 
°b•__öt32
 
powî
)

1640 
ph
, 
∂
;

1641 i‡((
powî
 >= 0) && (power <= 22)) {

1642 
	`°b•__ddmu…hi
(
ph
, 
∂
, 
d
, 
°b•__bŸ
[
powî
]);

1644 
°b•__öt32
 
e
, 
ë
, 
eb
;

1645 
p2h
, 
p2l
;

1647 
e
 = 
powî
;

1648 i‡(
powî
 < 0)

1649 
e
 = -e;

1650 
ë
 = (
e
 * 0x2c9) >> 14;

1651 i‡(
ë
 > 13)

1652 
ë
 = 13;

1653 
eb
 = 
e
 - (
ë
 * 23);

1655 
ph
 = 
d
;

1656 
∂
 = 0.0;

1657 i‡(
powî
 < 0) {

1658 i‡(
eb
) {

1659 --
eb
;

1660 
	`°b•__ddmu…hi
(
ph
, 
∂
, 
d
, 
°b•__√gbŸ
[
eb
]);

1661 
	`°b•__ddmu…los
(
ph
, 
∂
, 
d
, 
°b•__√gbŸîr
[
eb
]);

1663 i‡(
ë
) {

1664 
	`°b•__ddªn‹m
(
ph
, 
∂
);

1665 --
ë
;

1666 
	`°b•__ddmu…hi
(
p2h
, 
p2l
, 
ph
, 
°b•__√gt›
[
ë
]);

1667 
	`°b•__ddmu…lo
(
p2h
, 
p2l
, 
ph
, 
∂
, 
°b•__√gt›
[
ë
], 
°b•__√gt›îr
[et]);

1668 
ph
 = 
p2h
;

1669 
∂
 = 
p2l
;

1672 i‡(
eb
) {

1673 
e
 = 
eb
;

1674 i‡(
eb
 > 22)

1675 
eb
 = 22;

1676 
e
 -
eb
;

1677 
	`°b•__ddmu…hi
(
ph
, 
∂
, 
d
, 
°b•__bŸ
[
eb
]);

1678 i‡(
e
) {

1679 
	`°b•__ddªn‹m
(
ph
, 
∂
);

1680 
	`°b•__ddmu…hi
(
p2h
, 
p2l
, 
ph
, 
°b•__bŸ
[
e
]);

1681 
	`°b•__ddmu…los
(
p2h
, 
p2l
, 
°b•__bŸ
[
e
], 
∂
);

1682 
ph
 = 
p2h
;

1683 
∂
 = 
p2l
;

1686 i‡(
ë
) {

1687 
	`°b•__ddªn‹m
(
ph
, 
∂
);

1688 --
ë
;

1689 
	`°b•__ddmu…hi
(
p2h
, 
p2l
, 
ph
, 
°b•__t›
[
ë
]);

1690 
	`°b•__ddmu…lo
(
p2h
, 
p2l
, 
ph
, 
∂
, 
°b•__t›
[
ë
], 
°b•__t›îr
[et]);

1691 
ph
 = 
p2h
;

1692 
∂
 = 
p2l
;

1696 
	`°b•__ddªn‹m
(
ph
, 
∂
);

1697 *
ohi
 = 
ph
;

1698 *
ﬁo
 = 
∂
;

1699 
	}
}

1705 
°b•__öt32
 
	$°b•__ªÆ_to_°r
(c⁄° **
°¨t
, 
°b•__uöt32
 *
Àn
, *
out
, 
°b•__öt32
 *
decimÆ_pos
, 
vÆue
, stb•__uöt32 
‰ac_digôs
)

1707 
d
;

1708 
°b•__öt64
 
bôs
 = 0;

1709 
°b•__öt32
 
expo
, 
e
, 
ng
, 
ãns
;

1711 
d
 = 
vÆue
;

1712 
	`STBSP__COPYFP
(
bôs
, 
d
);

1713 
expo
 = (
°b•__öt32
)((
bôs
 >> 52) & 2047);

1714 
ng
 = (
°b•__öt32
)((
°b•__uöt64
Ë
bôs
 >> 63);

1715 i‡(
ng
)

1716 
d
 = -d;

1718 i‡(
expo
 == 2047)

1720 *
°¨t
 = (
bôs
 & ((((
°b•__uöt64
)1) << 52) - 1)) ? "NaN" : "Inf";

1721 *
decimÆ_pos
 = 
STBSP__SPECIAL
;

1722 *
Àn
 = 3;

1723  
ng
;

1726 i‡(
expo
 == 0)

1728 i‡(((
°b•__uöt64
Ë
bôs
 << 1) == 0)

1730 *
decimÆ_pos
 = 1;

1731 *
°¨t
 = 
out
;

1732 
out
[0] = '0';

1733 *
Àn
 = 1;

1734  
ng
;

1738 
°b•__öt64
 
v
 = ((
°b•__uöt64
)1) << 51;

1739 (
bôs
 & 
v
) == 0) {

1740 --
expo
;

1741 
v
 >>= 1;

1748 
ph
, 
∂
;

1751 
ãns
 = 
expo
 - 1023;

1752 
ãns
 = (tens < 0) ? ((tens * 617) / 2048) : (((tens * 1233) / 4096) + 1);

1755 
	`°b•__øi£_to_powî10
(&
ph
, &
∂
, 
d
, 18 - 
ãns
);

1758 
	`°b•__ddtoS64
(
bôs
, 
ph
, 
∂
);

1761 i‡(((
°b•__uöt64
)
bôs
Ë>
°b•__ã¡o19th
)

1762 ++
ãns
;

1766 
‰ac_digôs
 = (‰ac_digô†& 0x80000000Ë? ((‰ac_digô†& 0x7ffffffË+ 1Ë: (
ãns
 + frac_digits);

1767 i‡((
‰ac_digôs
 < 24)) {

1768 
°b•__uöt32
 
dg
 = 1;

1769 i‡((
°b•__uöt64
)
bôs
 >
°b•__powãn
[9])

1770 
dg
 = 10;

1771 (
°b•__uöt64
)
bôs
 >
°b•__powãn
[
dg
]) {

1772 ++
dg
;

1773 i‡(
dg
 == 20)

1774 
n‹ound
;

1776 i‡(
‰ac_digôs
 < 
dg
) {

1777 
°b•__uöt64
 
r
;

1779 
e
 = 
dg
 - 
‰ac_digôs
;

1780 i‡((
°b•__uöt32
)
e
 >= 24)

1781 
n‹ound
;

1782 
r
 = 
°b•__powãn
[
e
];

1783 
bôs
 = bô†+ (
r
 / 2);

1784 i‡((
°b•__uöt64
)
bôs
 >
°b•__powãn
[
dg
])

1785 ++
ãns
;

1786 
bôs
 /
r
;

1788 
n‹ound
:;

1792 i‡(
bôs
) {

1793 
°b•__uöt32
 
n
;

1795 i‡(
bôs
 <= 0xffffffff)

1797 i‡(
bôs
 % 1000)

1798 
d⁄ez
;

1799 
bôs
 /= 1000;

1801 
n
 = (
°b•__uöt32
)
bôs
;

1802 (
n
 % 1000) == 0)

1803 
n
 /= 1000;

1804 
bôs
 = 
n
;

1805 
d⁄ez
:;

1809 
out
 += 64;

1810 
e
 = 0;

1812 
°b•__uöt32
 
n
;

1813 *
o
 = 
out
 - 8;

1815 i‡(
bôs
 >= 100000000) {

1816 
n
 = (
°b•__uöt32
)(
bôs
 % 100000000);

1817 
bôs
 /= 100000000;

1819 
n
 = (
°b•__uöt32
)
bôs
;

1820 
bôs
 = 0;

1822 
n
) {

1823 
out
 -= 2;

1824 *(
°b•__uöt16
 *)
out
 = *(°b•__uöt16 *)&
°b•__digô∑ú
.
∑ú
[(
n
 % 100) * 2];

1825 
n
 /= 100;

1826 
e
 += 2;

1828 i‡(
bôs
 == 0) {

1829 i‡((
e
Ë&& (
out
[0] == '0')) {

1830 ++
out
;

1831 --
e
;

1835 
out
 !
o
) {

1836 *--
out
 = '0';

1837 ++
e
;

1841 *
decimÆ_pos
 = 
ãns
;

1842 *
°¨t
 = 
out
;

1843 *
Àn
 = 
e
;

1844  
ng
;

1845 
	}
}

1847 #unde‡
°b•__ddmu…hi


1848 #unde‡
°b•__ddªn‹m


1849 #unde‡
°b•__ddmu…lo


1850 #unde‡
°b•__ddmu…los


1851 #unde‡
STBSP__SPECIAL


1852 #unde‡
STBSP__COPYFP


1857 #unde‡
°b•__uöt16


1858 #unde‡
°b•__uöt32


1859 #unde‡
°b•__öt32


1860 #unde‡
°b•__uöt64


1861 #unde‡
°b•__öt64


1862 #unde‡
STBSP__UNALIGNED


	@include/stb_truetype.h

278 
	#STB_TRUETYPE_IMPLEMENTATION


279 
	~"°b_åuëy≥.h
"

	)

281 
	gâf_buf„r
[1<<20];

282 
	gãmp_bôm≠
[512*512];

284 
°bâ_bakedch¨
 
	gcd©a
[96];

285 
GLuöt
 
	g·ex
;

287 
	$my_°bâ_öôf⁄t
()

289 
	`‰ód
(
âf_buf„r
, 1, 1<<20, 
	`f›í
("c:/windows/fonts/times.ttf", "rb"));

290 
	`°bâ_BakeF⁄tBôm≠
(
âf_buf„r
,0, 32.0, 
ãmp_bôm≠
,512,512, 32,96, 
cd©a
);

292 
	`glGíTextuªs
(1, &
·ex
);

293 
	`glBödTextuª
(
GL_TEXTURE_2D
, 
·ex
);

294 
	`glTexImage2D
(
GL_TEXTURE_2D
, 0, 
GL_ALPHA
, 512,512, 0, GL_ALPHA, 
GL_UNSIGNED_BYTE
, 
ãmp_bôm≠
);

296 
	`glTexP¨amëîi
(
GL_TEXTURE_2D
, 
GL_TEXTURE_MIN_FILTER
, 
GL_LINEAR
);

297 
	}
}

299 
	$my_°bâ_¥öt
(
x
, 
y
, *
ãxt
)

302 
	`glE«bÀ
(
GL_BLEND
);

303 
	`glBÀndFunc
(
GL_SRC_ALPHA
, 
GL_ONE_MINUS_SRC_ALPHA
);

304 
	`glE«bÀ
(
GL_TEXTURE_2D
);

305 
	`glBödTextuª
(
GL_TEXTURE_2D
, 
·ex
);

306 
	`glBegö
(
GL_QUADS
);

307 *
ãxt
) {

308 i‡(*
ãxt
 >= 32 && *text < 128) {

309 
°bâ_Æig√d_quad
 
q
;

310 
	`°bâ_GëBakedQuad
(
cd©a
, 512,512, *
ãxt
-32, &
x
,&
y
,&
q
,1);

311 
	`glTexCo‹d2f
(
q
.
s0
,q.
t0
); 
	`glVîãx2f
(q.
x0
,q.
y0
);

312 
	`glTexCo‹d2f
(
q
.
s1
,q.
t0
); 
	`glVîãx2f
(q.
x1
,q.
y0
);

313 
	`glTexCo‹d2f
(
q
.
s1
,q.
t1
); 
	`glVîãx2f
(q.
x1
,q.
y1
);

314 
	`glTexCo‹d2f
(
q
.
s0
,q.
t1
); 
	`glVîãx2f
(q.
x0
,q.
y1
);

316 ++
ãxt
;

318 
	`glEnd
();

319 
	}
}

328 
	~<°dio.h
>

329 
	#STB_TRUETYPE_IMPLEMENTATION


330 
	~"°b_åuëy≥.h
"

	)

332 
	gâf_buf„r
[1<<25];

334 
	$maö
(
¨gc
, **
¨gv
)

336 
°bâ_f⁄töfo
 
f⁄t
;

337 *
bôm≠
;

338 
w
,
h
,
i
,
j
,
c
 = (
¨gc
 > 1 ? 
	`©oi
(
¨gv
[1]Ë: 'a'), 
s
 = (argc > 2 ?átoi(argv[2]) : 20);

340 
	`‰ód
(
âf_buf„r
, 1, 1<<25, 
	`f›í
(
¨gc
 > 3 ? 
¨gv
[3] : "c:/windows/fonts/arialbd.ttf", "rb"));

342 
	`°bâ_InôF⁄t
(&
f⁄t
, 
âf_buf„r
, 
	`°bâ_GëF⁄tOff£tF‹Index
(ttf_buffer,0));

343 
bôm≠
 = 
	`°bâ_GëCodïoötBôm≠
(&
f⁄t
, 0,
	`°bâ_SˇÀF‹PixñHeight
(&f⁄t, 
s
), 
c
, &
w
, &
h
, 0,0);

345 
j
=0; j < 
h
; ++j) {

346 
i
=0; i < 
w
; ++i)

347 
	`putch¨
(" .:ioVM@"[
bôm≠
[
j
*
w
+
i
]>>5]);

348 
	`putch¨
('\n');

351 
	}
}

372 
	gbuf„r
[24<<20];

373 
	gs¸ìn
[20][79];

375 
	$maö
(
¨g
, **
¨gv
)

377 
°bâ_f⁄töfo
 
f⁄t
;

378 
i
,
j
,
as˚¡
,
ba£löe
,
ch
=0;

379 
sˇÀ
, 
xpos
=2;

380 *
ãxt
 = "Heljo World!";

382 
	`‰ód
(
buf„r
, 1, 1000000, 
	`f›í
("c:/windows/fonts/arialbd.ttf", "rb"));

383 
	`°bâ_InôF⁄t
(&
f⁄t
, 
buf„r
, 0);

385 
sˇÀ
 = 
	`°bâ_SˇÀF‹PixñHeight
(&
f⁄t
, 15);

386 
	`°bâ_GëF⁄tVMërics
(&
f⁄t
, &
as˚¡
,0,0);

387 
ba£löe
 = (Ë(
as˚¡
*
sˇÀ
);

389 
ãxt
[
ch
]) {

390 
adv™˚
,
lsb
,
x0
,
y0
,
x1
,
y1
;

391 
x_shi·
 = 
xpos
 - (Ë
	`Êo‹
(xpos);

392 
	`°bâ_GëCodïoötHMërics
(&
f⁄t
, 
ãxt
[
ch
], &
adv™˚
, &
lsb
);

393 
	`°bâ_GëCodïoötBôm≠BoxSubpixñ
(&
f⁄t
, 
ãxt
[
ch
], 
sˇÀ
,sˇÀ,
x_shi·
,0, &
x0
,&
y0
,&
x1
,&
y1
);

394 
	`°bâ_MakeCodïoötBôm≠Subpixñ
(&
f⁄t
, &
s¸ìn
[
ba£löe
 + 
y0
][(Ë
xpos
 + 
x0
], 
x1
-x0,
y1
-y0, 79, 
sˇÀ
,sˇÀ,
x_shi·
,0, 
ãxt
[
ch
]);

399 
xpos
 +(
adv™˚
 * 
sˇÀ
);

400 i‡(
ãxt
[
ch
+1])

401 
xpos
 +
sˇÀ
*
	`°bâ_GëCodïoötKînAdv™˚
(&
f⁄t
, 
ãxt
[
ch
],text[ch+1]);

402 ++
ch
;

405 
j
=0; j < 20; ++j) {

406 
i
=0; i < 78; ++i)

407 
	`putch¨
(" .:ioVM@"[
s¸ìn
[
j
][
i
]>>5]);

408 
	`putch¨
('\n');

412 
	}
}

425 #ifde‡
STB_TRUETYPE_IMPLEMENTATION


427 #i‚de‡
°bâ_uöt8


428 
	t°bâ_uöt8
;

429 sig√d 
	t°bâ_öt8
;

430 
	t°bâ_uöt16
;

431 sig√d 
	t°bâ_öt16
;

432 
	t°bâ_uöt32
;

433 sig√d 
	t°bâ_öt32
;

436 
	t°bâ__check_size32
[(
°bâ_öt32
)==4 ? 1 : -1];

437 
	t°bâ__check_size16
[(
°bâ_öt16
)==2 ? 1 : -1];

440 #i‚de‡
STBTT_iÊo‹


441 
	~<m©h.h
>

442 
	#STBTT_iÊo‹
(
x
Ë((Ë
	`Êo‹
(x))

	)

443 
	#STBTT_i˚û
(
x
Ë((Ë
	`˚û
(x))

	)

446 #i‚de‡
STBTT_sqπ


447 
	~<m©h.h
>

448 
	#STBTT_sqπ
(
x
Ë
	`sqπ
(x)

	)

449 
	#STBTT_pow
(
x
,
y
Ë
	`pow
(x,y)

	)

452 #i‚de‡
STBTT_fmod


453 
	~<m©h.h
>

454 
	#STBTT_fmod
(
x
,
y
Ë
	`fmod
(x,y)

	)

457 #i‚de‡
STBTT_cos


458 
	~<m©h.h
>

459 
	#STBTT_cos
(
x
Ë
	`cos
(x)

	)

460 
	#STBTT_acos
(
x
Ë
	`acos
(x)

	)

463 #i‚de‡
STBTT_Ábs


464 
	~<m©h.h
>

465 
	#STBTT_Ábs
(
x
Ë
	`Ábs
(x)

	)

469 #i‚de‡
STBTT_mÆloc


470 
	~<°dlib.h
>

471 
	#STBTT_mÆloc
(
x
,
u
Ë(()(u),
	`mÆloc
(x))

	)

472 
	#STBTT_‰ì
(
x
,
u
Ë(()(u),
	`‰ì
(x))

	)

475 #i‚de‡
STBTT_as£π


476 
	~<as£π.h
>

477 
	#STBTT_as£π
(
x
Ë
	`as£π
(x)

	)

480 #i‚de‡
STBTT_°æí


481 
	~<°rög.h
>

482 
	#STBTT_°æí
(
x
Ë
	`°æí
(x)

	)

485 #i‚de‡
STBTT_mem˝y


486 
	~<°rög.h
>

487 
	#STBTT_mem˝y
 
mem˝y


	)

488 
	#STBTT_mem£t
 
mem£t


	)

499 #i‚de‡
__STB_INCLUDE_STB_TRUETYPE_H__


500 
	#__STB_INCLUDE_STB_TRUETYPE_H__


	)

502 #ifde‡
STBTT_STATIC


503 
	#STBTT_DEF
 

	)

505 
	#STBTT_DEF
 

	)

508 #ifde‡
__˝lu•lus


515 *
d©a
;

516 
curs‹
;

517 
size
;

518 } 
	t°bâ__buf
;

529 
x0
,
y0
,
x1
,
y1
;

530 
xoff
,
yoff
,
xadv™˚
;

531 } 
	t°bâ_bakedch¨
;

533 
STBTT_DEF
 
°bâ_BakeF⁄tBôm≠
(c⁄° *
d©a
, 
off£t
,

534 
pixñ_height
,

535 *
pixñs
, 
pw
, 
ph
,

536 
fú°_ch¨
, 
num_ch¨s
,

537 
°bâ_bakedch¨
 *
ch¨d©a
);

545 
x0
,
y0
,
s0
,
t0
;

546 
x1
,
y1
,
s1
,
t1
;

547 } 
	t°bâ_Æig√d_quad
;

549 
STBTT_DEF
 
°bâ_GëBakedQuad
(c⁄° 
°bâ_bakedch¨
 *
ch¨d©a
, 
pw
, 
ph
,

550 
ch¨_ödex
,

551 *
xpos
, *
ypos
,

552 
°bâ_Æig√d_quad
 *
q
,

553 
›ígl_fûÃuÀ
);

564 
STBTT_DEF
 
°bâ_GëSˇÀdF⁄tVMërics
(c⁄° *
f⁄td©a
, 
ödex
, 
size
, *
as˚¡
, *
des˚¡
, *
löeG≠
);

577 
x0
,
y0
,
x1
,
y1
;

578 
xoff
,
yoff
,
xadv™˚
;

579 
xoff2
,
yoff2
;

580 } 
	t°bâ_∑ckedch¨
;

582 
°bâ_∑ck_c⁄ãxt
 
	t°bâ_∑ck_c⁄ãxt
;

583 
°bâ_f⁄töfo
 
	t°bâ_f⁄töfo
;

584 #i‚de‡
STB_RECT_PACK_VERSION


585 
°bΩ_ª˘
 
	t°bΩ_ª˘
;

588 
STBTT_DEF
 
°bâ_PackBegö
(
°bâ_∑ck_c⁄ãxt
 *
•c
, *
pixñs
, 
width
, 
height
, 
°ride_ö_byãs
, 
∑ddög
, *
Æloc_c⁄ãxt
);

599 
STBTT_DEF
 
°bâ_PackEnd
 (
°bâ_∑ck_c⁄ãxt
 *
•c
);

602 
	#STBTT_POINT_SIZE
(
x
Ë(-(x))

	)

604 
STBTT_DEF
 
°bâ_PackF⁄tR™ge
(
°bâ_∑ck_c⁄ãxt
 *
•c
, c⁄° *
f⁄td©a
, 
f⁄t_ödex
, 
f⁄t_size
,

605 
fú°_unicode_ch¨_ö_ønge
, 
num_ch¨s_ö_ønge
, 
°bâ_∑ckedch¨
 *
ch¨d©a_f‹_ønge
);

621 
f⁄t_size
;

622 
fú°_unicode_codïoöt_ö_ønge
;

623 *
¨øy_of_unicode_codïoöts
;

624 
num_ch¨s
;

625 
°bâ_∑ckedch¨
 *
ch¨d©a_f‹_ønge
;

626 
h_ovîßm∂e
, 
v_ovîßm∂e
;

627 } 
	t°bâ_∑ck_ønge
;

629 
STBTT_DEF
 
°bâ_PackF⁄tR™ges
(
°bâ_∑ck_c⁄ãxt
 *
•c
, c⁄° *
f⁄td©a
, 
f⁄t_ödex
, 
°bâ_∑ck_ønge
 *
ønges
, 
num_ønges
);

635 
STBTT_DEF
 
°bâ_PackSëOvîßm∂ög
(
°bâ_∑ck_c⁄ãxt
 *
•c
, 
h_ovîßm∂e
, 
v_ovîßm∂e
);

651 
STBTT_DEF
 
°bâ_PackSëSkùMissögCodïoöts
(
°bâ_∑ck_c⁄ãxt
 *
•c
, 
skù
);

657 
STBTT_DEF
 
°bâ_GëPackedQuad
(c⁄° 
°bâ_∑ckedch¨
 *
ch¨d©a
, 
pw
, 
ph
,

658 
ch¨_ödex
,

659 *
xpos
, *
ypos
,

660 
°bâ_Æig√d_quad
 *
q
,

661 
Æign_to_öãgî
);

663 
STBTT_DEF
 
°bâ_PackF⁄tR™gesG©hîRe˘s
(
°bâ_∑ck_c⁄ãxt
 *
•c
, c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
°bâ_∑ck_ønge
 *
ønges
, 
num_ønges
, 
°bΩ_ª˘
 *
ª˘s
);

664 
STBTT_DEF
 
°bâ_PackF⁄tR™gesPackRe˘s
(
°bâ_∑ck_c⁄ãxt
 *
•c
, 
°bΩ_ª˘
 *
ª˘s
, 
num_ª˘s
);

665 
STBTT_DEF
 
°bâ_PackF⁄tR™gesRídîI¡oRe˘s
(
°bâ_∑ck_c⁄ãxt
 *
•c
, c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
°bâ_∑ck_ønge
 *
ønges
, 
num_ønges
, 
°bΩ_ª˘
 *
ª˘s
);

678 
	s°bâ_∑ck_c⁄ãxt
 {

679 *
u£r_Æloˇt‹_c⁄ãxt
;

680 *
∑ck_öfo
;

681 
width
;

682 
height
;

683 
°ride_ö_byãs
;

684 
∑ddög
;

685 
skù_missög
;

686 
h_ovîßm∂e
, 
v_ovîßm∂e
;

687 *
pixñs
;

688 *
nodes
;

697 
STBTT_DEF
 
°bâ_GëNumbîOfF⁄ts
(c⁄° *
d©a
);

704 
STBTT_DEF
 
°bâ_GëF⁄tOff£tF‹Index
(c⁄° *
d©a
, 
ödex
);

713 
	s°bâ_f⁄töfo


715 * 
u£rd©a
;

716 * 
d©a
;

717 
f⁄t°¨t
;

719 
numGlyphs
;

721 
loˇ
,
hód
,
glyf
,
hhó
,
hmtx
,
kîn
,
gpos
,
svg
;

722 
ödex_m≠
;

723 
ödexToLocF‹m©
;

725 
°bâ__buf
 
cff
;

726 
°bâ__buf
 
ch¨°rögs
;

727 
°bâ__buf
 
gsubrs
;

728 
°bâ__buf
 
subrs
;

729 
°bâ__buf
 
f⁄tdi˘s
;

730 
°bâ__buf
 
fd£À˘
;

733 
STBTT_DEF
 
°bâ_InôF⁄t
(
°bâ_f⁄töfo
 *
öfo
, c⁄° *
d©a
, 
off£t
);

745 
STBTT_DEF
 
°bâ_FödGlyphIndex
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
unicode_codïoöt
);

758 
STBTT_DEF
 
°bâ_SˇÀF‹PixñHeight
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
pixñs
);

766 
STBTT_DEF
 
°bâ_SˇÀF‹M≠pögEmToPixñs
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
pixñs
);

771 
STBTT_DEF
 
°bâ_GëF⁄tVMërics
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
as˚¡
, *
des˚¡
, *
löeG≠
);

779 
STBTT_DEF
 
°bâ_GëF⁄tVMëricsOS2
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
typoAs˚¡
, *
typoDes˚¡
, *
typoLöeG≠
);

785 
STBTT_DEF
 
°bâ_GëF⁄tBoundögBox
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
x0
, *
y0
, *
x1
, *
y1
);

788 
STBTT_DEF
 
°bâ_GëCodïoötHMërics
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
codïoöt
, *
adv™˚Width
, *
À·SideBórög
);

793 
STBTT_DEF
 
°bâ_GëCodïoötKînAdv™˚
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
ch1
, 
ch2
);

796 
STBTT_DEF
 
°bâ_GëCodïoötBox
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
codïoöt
, *
x0
, *
y0
, *
x1
, *
y1
);

799 
STBTT_DEF
 
°bâ_GëGlyphHMërics
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
, *
adv™˚Width
, *
À·SideBórög
);

800 
STBTT_DEF
 
°bâ_GëGlyphKînAdv™˚
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph1
, 
glyph2
);

801 
STBTT_DEF
 
°bâ_GëGlyphBox
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
, *
x0
, *
y0
, *
x1
, *
y1
);

804 
	s°bâ_kînögíåy


806 
glyph1
;

807 
glyph2
;

808 
adv™˚
;

809 } 
	t°bâ_kînögíåy
;

811 
STBTT_DEF
 
°bâ_GëKînögTabÀLígth
(c⁄° 
°bâ_f⁄töfo
 *
öfo
);

812 
STBTT_DEF
 
°bâ_GëKînögTabÀ
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
°bâ_kînögíåy
* 
èbÀ
, 
èbÀ_Àngth
);

823 #i‚de‡
STBTT_vmove


825 
STBTT_vmove
=1,

826 
STBTT_vlöe
,

827 
STBTT_vcurve
,

828 
STBTT_vcubic


832 #i‚de‡
°bâ_vîãx


834 
	#°bâ_vîãx_ty≥
 

835 °ru˘

	)

837 
°bâ_vîãx_ty≥
 
x
,
y
,
cx
,
cy
,
cx1
,
cy1
;

838 
ty≥
,
∑ddög
;

839 } 
	t°bâ_vîãx
;

842 
STBTT_DEF
 
°bâ_IsGlyphEm±y
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
);

845 
STBTT_DEF
 
°bâ_GëCodïoötSh≠e
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
unicode_codïoöt
, 
°bâ_vîãx
 **
vîti˚s
);

846 
STBTT_DEF
 
°bâ_GëGlyphSh≠e
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
, 
°bâ_vîãx
 **
vîti˚s
);

857 
STBTT_DEF
 
°bâ_FªeSh≠e
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
°bâ_vîãx
 *
vîti˚s
);

860 
STBTT_DEF
 *
°bâ_FödSVGDoc
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
gl
);

861 
STBTT_DEF
 
°bâ_GëCodïoötSVG
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
unicode_codïoöt
, c⁄° **
svg
);

862 
STBTT_DEF
 
°bâ_GëGlyphSVG
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
gl
, c⁄° **
svg
);

871 
STBTT_DEF
 
°bâ_FªeBôm≠
(*
bôm≠
, *
u£rd©a
);

874 
STBTT_DEF
 *
°bâ_GëCodïoötBôm≠
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
sˇÀ_x
, 
sˇÀ_y
, 
codïoöt
, *
width
, *
height
, *
xoff
, *
yoff
);

883 
STBTT_DEF
 *
°bâ_GëCodïoötBôm≠Subpixñ
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
codïoöt
, *
width
, *
height
, *
xoff
, *
yoff
);

887 
STBTT_DEF
 
°bâ_MakeCodïoötBôm≠
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
codïoöt
);

893 
STBTT_DEF
 
°bâ_MakeCodïoötBôm≠Subpixñ
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
codïoöt
);

897 
STBTT_DEF
 
°bâ_MakeCodïoötBôm≠SubpixñPªfûãr
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
ovîßm∂e_x
, 
ovîßm∂e_y
, *
sub_x
, *
sub_y
, 
codïoöt
);

901 
STBTT_DEF
 
°bâ_GëCodïoötBôm≠Box
(c⁄° 
°bâ_f⁄töfo
 *
f⁄t
, 
codïoöt
, 
sˇÀ_x
, 
sˇÀ_y
, *
ix0
, *
iy0
, *
ix1
, *
iy1
);

908 
STBTT_DEF
 
°bâ_GëCodïoötBôm≠BoxSubpixñ
(c⁄° 
°bâ_f⁄töfo
 *
f⁄t
, 
codïoöt
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, *
ix0
, *
iy0
, *
ix1
, *
iy1
);

914 
STBTT_DEF
 *
°bâ_GëGlyphBôm≠
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
sˇÀ_x
, 
sˇÀ_y
, 
glyph
, *
width
, *
height
, *
xoff
, *
yoff
);

915 
STBTT_DEF
 *
°bâ_GëGlyphBôm≠Subpixñ
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
glyph
, *
width
, *
height
, *
xoff
, *
yoff
);

916 
STBTT_DEF
 
°bâ_MakeGlyphBôm≠
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
glyph
);

917 
STBTT_DEF
 
°bâ_MakeGlyphBôm≠Subpixñ
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
glyph
);

918 
STBTT_DEF
 
°bâ_MakeGlyphBôm≠SubpixñPªfûãr
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
ovîßm∂e_x
, 
ovîßm∂e_y
, *
sub_x
, *
sub_y
, 
glyph
);

919 
STBTT_DEF
 
°bâ_GëGlyphBôm≠Box
(c⁄° 
°bâ_f⁄töfo
 *
f⁄t
, 
glyph
, 
sˇÀ_x
, 
sˇÀ_y
, *
ix0
, *
iy0
, *
ix1
, *
iy1
);

920 
STBTT_DEF
 
°bâ_GëGlyphBôm≠BoxSubpixñ
(c⁄° 
°bâ_f⁄töfo
 *
f⁄t
, 
glyph
, 
sˇÀ_x
, 
sˇÀ_y
,
shi·_x
, 
shi·_y
, *
ix0
, *
iy0
, *
ix1
, *
iy1
);

926 
w
,
h
,
°ride
;

927 *
pixñs
;

928 } 
	t°bâ__bôm≠
;

931 
STBTT_DEF
 
°bâ_Ra°îize
(
°bâ__bôm≠
 *
ªsu…
,

932 
Ê©√ss_ö_pixñs
,

933 
°bâ_vîãx
 *
vîti˚s
,

934 
num_vîts
,

935 
sˇÀ_x
, 
sˇÀ_y
,

936 
shi·_x
, 
shi·_y
,

937 
x_off
, 
y_off
,

938 
övît
,

939 *
u£rd©a
);

945 
STBTT_DEF
 
°bâ_FªeSDF
(*
bôm≠
, *
u£rd©a
);

948 
STBTT_DEF
 * 
°bâ_GëGlyphSDF
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
sˇÀ
, 
glyph
, 
∑ddög
, 
⁄edge_vÆue
, 
pixñ_di°_sˇÀ
, *
width
, *
height
, *
xoff
, *
yoff
);

949 
STBTT_DEF
 * 
°bâ_GëCodïoötSDF
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
sˇÀ
, 
codïoöt
, 
∑ddög
, 
⁄edge_vÆue
, 
pixñ_di°_sˇÀ
, *
width
, *
height
, *
xoff
, *
yoff
);

1021 
STBTT_DEF
 
°bâ_FödM©chögF⁄t
(c⁄° *
f⁄td©a
, c⁄° *
«me
, 
Êags
);

1026 
	#STBTT_MACSTYLE_DONTCARE
 0

	)

1027 
	#STBTT_MACSTYLE_BOLD
 1

	)

1028 
	#STBTT_MACSTYLE_ITALIC
 2

	)

1029 
	#STBTT_MACSTYLE_UNDERSCORE
 4

	)

1030 
	#STBTT_MACSTYLE_NONE
 8

1031 

	)

1032 
STBTT_DEF
 
°bâ_Com∑ªUTF8toUTF16_bigídün
(c⁄° *
s1
, 
Àn1
, c⁄° *
s2
, 
Àn2
);

1036 
STBTT_DEF
 c⁄° *
°bâ_GëF⁄tNameSåög
(c⁄° 
°bâ_f⁄töfo
 *
f⁄t
, *
Àngth
, 
∂©f‹mID
, 
ícodögID
, 
œnguageID
, 
«meID
);

1045 
STBTT_PLATFORM_ID_UNICODE
 =0,

1046 
STBTT_PLATFORM_ID_MAC
 =1,

1047 
STBTT_PLATFORM_ID_ISO
 =2,

1048 
STBTT_PLATFORM_ID_MICROSOFT
 =3

1052 
STBTT_UNICODE_EID_UNICODE_1_0
 =0,

1053 
STBTT_UNICODE_EID_UNICODE_1_1
 =1,

1054 
STBTT_UNICODE_EID_ISO_10646
 =2,

1055 
STBTT_UNICODE_EID_UNICODE_2_0_BMP
=3,

1056 
STBTT_UNICODE_EID_UNICODE_2_0_FULL
=4

1060 
STBTT_MS_EID_SYMBOL
 =0,

1061 
STBTT_MS_EID_UNICODE_BMP
 =1,

1062 
STBTT_MS_EID_SHIFTJIS
 =2,

1063 
STBTT_MS_EID_UNICODE_FULL
 =10

1067 
STBTT_MAC_EID_ROMAN
 =0, 
STBTT_MAC_EID_ARABIC
 =4,

1068 
STBTT_MAC_EID_JAPANESE
 =1, 
STBTT_MAC_EID_HEBREW
 =5,

1069 
STBTT_MAC_EID_CHINESE_TRAD
 =2, 
STBTT_MAC_EID_GREEK
 =6,

1070 
STBTT_MAC_EID_KOREAN
 =3, 
STBTT_MAC_EID_RUSSIAN
 =7

1075 
STBTT_MS_LANG_ENGLISH
 =0x0409, 
STBTT_MS_LANG_ITALIAN
 =0x0410,

1076 
STBTT_MS_LANG_CHINESE
 =0x0804, 
STBTT_MS_LANG_JAPANESE
 =0x0411,

1077 
STBTT_MS_LANG_DUTCH
 =0x0413, 
STBTT_MS_LANG_KOREAN
 =0x0412,

1078 
STBTT_MS_LANG_FRENCH
 =0x040c, 
STBTT_MS_LANG_RUSSIAN
 =0x0419,

1079 
STBTT_MS_LANG_GERMAN
 =0x0407, 
STBTT_MS_LANG_SPANISH
 =0x0409,

1080 
STBTT_MS_LANG_HEBREW
 =0x040d, 
STBTT_MS_LANG_SWEDISH
 =0x041D

1084 
STBTT_MAC_LANG_ENGLISH
 =0 , 
STBTT_MAC_LANG_JAPANESE
 =11,

1085 
STBTT_MAC_LANG_ARABIC
 =12, 
STBTT_MAC_LANG_KOREAN
 =23,

1086 
STBTT_MAC_LANG_DUTCH
 =4 , 
STBTT_MAC_LANG_RUSSIAN
 =32,

1087 
STBTT_MAC_LANG_FRENCH
 =1 , 
STBTT_MAC_LANG_SPANISH
 =6 ,

1088 
STBTT_MAC_LANG_GERMAN
 =2 , 
STBTT_MAC_LANG_SWEDISH
 =5 ,

1089 
STBTT_MAC_LANG_HEBREW
 =10, 
STBTT_MAC_LANG_CHINESE_SIMPLIFIED
 =33,

1090 
STBTT_MAC_LANG_ITALIAN
 =3 , 
STBTT_MAC_LANG_CHINESE_TRAD
 =19

1093 #ifde‡
__˝lu•lus


1106 #ifde‡
STB_TRUETYPE_IMPLEMENTATION


1108 #i‚de‡
STBTT_MAX_OVERSAMPLE


1109 
	#STBTT_MAX_OVERSAMPLE
 8

	)

1112 #i‡
STBTT_MAX_OVERSAMPLE
 > 255

1116 
	t°bâ__ã°_ovîßm∂e_pow2
[(
STBTT_MAX_OVERSAMPLE
 & (STBTT_MAX_OVERSAMPLE-1)) == 0 ? 1 : -1];

1118 #i‚de‡
STBTT_RASTERIZER_VERSION


1119 
	#STBTT_RASTERIZER_VERSION
 2

	)

1122 #ifde‡
_MSC_VER


1123 
	#STBTT__NOTUSED
(
v
Ë()(v)

	)

1125 
	#STBTT__NOTUSED
(
v
Ë()(v)

	)

1133 
°bâ_uöt8
 
	$°bâ__buf_gë8
(
°bâ__buf
 *
b
)

1135 i‡(
b
->
curs‹
 >b->
size
)

1137  
b
->
d©a
[b->
curs‹
++];

1138 
	}
}

1140 
°bâ_uöt8
 
	$°bâ__buf_≥ek8
(
°bâ__buf
 *
b
)

1142 i‡(
b
->
curs‹
 >b->
size
)

1144  
b
->
d©a
[b->
curs‹
];

1145 
	}
}

1147 
	$°bâ__buf_£ek
(
°bâ__buf
 *
b
, 
o
)

1149 
	`STBTT_as£π
(!(
o
 > 
b
->
size
 || o < 0));

1150 
b
->
curs‹
 = (
o
 > b->
size
 || o < 0) ? b->size : o;

1151 
	}
}

1153 
	$°bâ__buf_skù
(
°bâ__buf
 *
b
, 
o
)

1155 
	`°bâ__buf_£ek
(
b
, b->
curs‹
 + 
o
);

1156 
	}
}

1158 
°bâ_uöt32
 
	$°bâ__buf_gë
(
°bâ__buf
 *
b
, 
n
)

1160 
°bâ_uöt32
 
v
 = 0;

1161 
i
;

1162 
	`STBTT_as£π
(
n
 >= 1 &&Ç <= 4);

1163 
i
 = 0; i < 
n
; i++)

1164 
v
 = (v << 8Ë| 
	`°bâ__buf_gë8
(
b
);

1165  
v
;

1166 
	}
}

1168 
°bâ__buf
 
	$°bâ__√w_buf
(c⁄° *
p
, 
size_t
 
size
)

1170 
°bâ__buf
 
r
;

1171 
	`STBTT_as£π
(
size
 < 0x40000000);

1172 
r
.
d©a
 = (
°bâ_uöt8
*Ë
p
;

1173 
r
.
size
 = () size;

1174 
r
.
curs‹
 = 0;

1175  
r
;

1176 
	}
}

1178 
	#°bâ__buf_gë16
(
b
Ë
	`°bâ__buf_gë
((b), 2)

	)

1179 
	#°bâ__buf_gë32
(
b
Ë
	`°bâ__buf_gë
((b), 4)

	)

1181 
°bâ__buf
 
	$°bâ__buf_ønge
(c⁄° 
°bâ__buf
 *
b
, 
o
, 
s
)

1183 
°bâ__buf
 
r
 = 
	`°bâ__√w_buf
(
NULL
, 0);

1184 i‡(
o
 < 0 || 
s
 < 0 || o > 
b
->
size
 || s > b->sizê- oË 
r
;

1185 
r
.
d©a
 = 
b
->d©®+ 
o
;

1186 
r
.
size
 = 
s
;

1187  
r
;

1188 
	}
}

1190 
°bâ__buf
 
	$°bâ__cff_gë_ödex
(
°bâ__buf
 *
b
)

1192 
cou¡
, 
°¨t
, 
offsize
;

1193 
°¨t
 = 
b
->
curs‹
;

1194 
cou¡
 = 
	`°bâ__buf_gë16
(
b
);

1195 i‡(
cou¡
) {

1196 
offsize
 = 
	`°bâ__buf_gë8
(
b
);

1197 
	`STBTT_as£π
(
offsize
 >= 1 && offsize <= 4);

1198 
	`°bâ__buf_skù
(
b
, 
offsize
 * 
cou¡
);

1199 
	`°bâ__buf_skù
(
b
, 
	`°bâ__buf_gë
(b, 
offsize
) - 1);

1201  
	`°bâ__buf_ønge
(
b
, 
°¨t
, b->
curs‹
 - start);

1202 
	}
}

1204 
°bâ_uöt32
 
	$°bâ__cff_öt
(
°bâ__buf
 *
b
)

1206 
b0
 = 
	`°bâ__buf_gë8
(
b
);

1207 i‡(
b0
 >= 32 && b0 <= 246)  b0 - 139;

1208 i‡(
b0
 >247 && b0 <250Ë (b0 - 247)*256 + 
	`°bâ__buf_gë8
(
b
) + 108;

1209 i‡(
b0
 >251 && b0 <254Ë -(b0 - 251)*256 - 
	`°bâ__buf_gë8
(
b
) - 108;

1210 i‡(
b0
 =28Ë 
	`°bâ__buf_gë16
(
b
);

1211 i‡(
b0
 =29Ë 
	`°bâ__buf_gë32
(
b
);

1212 
	`STBTT_as£π
(0);

1214 
	}
}

1216 
	$°bâ__cff_skù_›î™d
(
°bâ__buf
 *
b
) {

1217 
v
, 
b0
 = 
	`°bâ__buf_≥ek8
(
b
);

1218 
	`STBTT_as£π
(
b0
 >= 28);

1219 i‡(
b0
 == 30) {

1220 
	`°bâ__buf_skù
(
b
, 1);

1221 
b
->
curs‹
 < b->
size
) {

1222 
v
 = 
	`°bâ__buf_gë8
(
b
);

1223 i‡((
v
 & 0xF) == 0xF || (v >> 4) == 0xF)

1227 
	`°bâ__cff_öt
(
b
);

1229 
	}
}

1231 
°bâ__buf
 
	$°bâ__di˘_gë
(
°bâ__buf
 *
b
, 
key
)

1233 
	`°bâ__buf_£ek
(
b
, 0);

1234 
b
->
curs‹
 < b->
size
) {

1235 
°¨t
 = 
b
->
curs‹
, 
íd
, 
›
;

1236 
	`°bâ__buf_≥ek8
(
b
) >= 28)

1237 
	`°bâ__cff_skù_›î™d
(
b
);

1238 
íd
 = 
b
->
curs‹
;

1239 
›
 = 
	`°bâ__buf_gë8
(
b
);

1240 i‡(
›
 =12Ë› = 
	`°bâ__buf_gë8
(
b
) | 0x100;

1241 i‡(
›
 =
key
Ë 
	`°bâ__buf_ønge
(
b
, 
°¨t
, 
íd
-start);

1243  
	`°bâ__buf_ønge
(
b
, 0, 0);

1244 
	}
}

1246 
	$°bâ__di˘_gë_öts
(
°bâ__buf
 *
b
, 
key
, 
outcou¡
, 
°bâ_uöt32
 *
out
)

1248 
i
;

1249 
°bâ__buf
 
›î™ds
 = 
	`°bâ__di˘_gë
(
b
, 
key
);

1250 
i
 = 0; i < 
outcou¡
 && 
›î™ds
.
curs‹
 < o≥ønds.
size
; i++)

1251 
out
[
i
] = 
	`°bâ__cff_öt
(&
›î™ds
);

1252 
	}
}

1254 
	$°bâ__cff_ödex_cou¡
(
°bâ__buf
 *
b
)

1256 
	`°bâ__buf_£ek
(
b
, 0);

1257  
	`°bâ__buf_gë16
(
b
);

1258 
	}
}

1260 
°bâ__buf
 
	$°bâ__cff_ödex_gë
(
°bâ__buf
 
b
, 
i
)

1262 
cou¡
, 
offsize
, 
°¨t
, 
íd
;

1263 
	`°bâ__buf_£ek
(&
b
, 0);

1264 
cou¡
 = 
	`°bâ__buf_gë16
(&
b
);

1265 
offsize
 = 
	`°bâ__buf_gë8
(&
b
);

1266 
	`STBTT_as£π
(
i
 >0 && i < 
cou¡
);

1267 
	`STBTT_as£π
(
offsize
 >= 1 && offsize <= 4);

1268 
	`°bâ__buf_skù
(&
b
, 
i
*
offsize
);

1269 
°¨t
 = 
	`°bâ__buf_gë
(&
b
, 
offsize
);

1270 
íd
 = 
	`°bâ__buf_gë
(&
b
, 
offsize
);

1271  
	`°bâ__buf_ønge
(&
b
, 2+(
cou¡
+1)*
offsize
+
°¨t
, 
íd
 - start);

1272 
	}
}

1282 
	#âBYTE
(
p
Ë(* (
°bâ_uöt8
 *Ë’))

	)

1283 
	#âCHAR
(
p
Ë(* (
°bâ_öt8
 *Ë’))

	)

1284 
	#âFixed
(
p
Ë
	`âLONG
’)

	)

1286 
°bâ_uöt16
 
	$âUSHORT
(
°bâ_uöt8
 *
p
Ë{ Ö[0]*256 +Ö[1]; 
	}
}

1287 
°bâ_öt16
 
	$âSHORT
(
°bâ_uöt8
 *
p
Ë{ Ö[0]*256 +Ö[1]; 
	}
}

1288 
°bâ_uöt32
 
	$âULONG
(
°bâ_uöt8
 *
p
Ë{  (p[0]<<24Ë+ (p[1]<<16Ë+ (p[2]<<8Ë+Ö[3]; 
	}
}

1289 
°bâ_öt32
 
	$âLONG
(
°bâ_uöt8
 *
p
Ë{  (p[0]<<24Ë+ (p[1]<<16Ë+ (p[2]<<8Ë+Ö[3]; 
	}
}

1291 
	#°bâ_èg4
(
p
,
c0
,
c1
,
c2
,
c3
Ë(’)[0] =(c0Ë&& (p)[1] =(c1Ë&& (p)[2] =(c2Ë&& (p)[3] =(c3))

	)

1292 
	#°bâ_èg
(
p
,
°r
Ë
	`°bâ_èg4
’,°r[0],°r[1],°r[2],°r[3])

	)

1294 
	$°bâ__isf⁄t
(
°bâ_uöt8
 *
f⁄t
)

1297 i‡(
	`°bâ_èg4
(
f⁄t
, '1',0,0,0))  1;

1298 i‡(
	`°bâ_èg
(
f⁄t
, "typ1"))  1;

1299 i‡(
	`°bâ_èg
(
f⁄t
, "OTTO"))  1;

1300 i‡(
	`°bâ_èg4
(
f⁄t
, 0,1,0,0))  1;

1301 i‡(
	`°bâ_èg
(
f⁄t
, "true"))  1;

1303 
	}
}

1306 
°bâ_uöt32
 
	$°bâ__föd_èbÀ
(
°bâ_uöt8
 *
d©a
, 
°bâ_uöt32
 
f⁄t°¨t
, c⁄° *
èg
)

1308 
°bâ_öt32
 
num_èbÀs
 = 
	`âUSHORT
(
d©a
+
f⁄t°¨t
+4);

1309 
°bâ_uöt32
 
èbÀdú
 = 
f⁄t°¨t
 + 12;

1310 
°bâ_öt32
 
i
;

1311 
i
=0; i < 
num_èbÀs
; ++i) {

1312 
°bâ_uöt32
 
loc
 = 
èbÀdú
 + 16*
i
;

1313 i‡(
	`°bâ_èg
(
d©a
+
loc
+0, 
èg
))

1314  
	`âULONG
(
d©a
+
loc
+8);

1317 
	}
}

1319 
	$°bâ_GëF⁄tOff£tF‹Index_öã∫Æ
(*
f⁄t_cﬁÀ˘i⁄
, 
ödex
)

1322 i‡(
	`°bâ__isf⁄t
(
f⁄t_cﬁÀ˘i⁄
))

1323  
ödex
 == 0 ? 0 : -1;

1326 i‡(
	`°bâ_èg
(
f⁄t_cﬁÀ˘i⁄
, "ttcf")) {

1328 i‡(
	`âULONG
(
f⁄t_cﬁÀ˘i⁄
+4) == 0x00010000 ||ÅtULONG(font_collection+4) == 0x00020000) {

1329 
°bâ_öt32
 
n
 = 
	`âLONG
(
f⁄t_cﬁÀ˘i⁄
+8);

1330 i‡(
ödex
 >
n
)

1332  
	`âULONG
(
f⁄t_cﬁÀ˘i⁄
+12+
ödex
*4);

1336 
	}
}

1338 
	$°bâ_GëNumbîOfF⁄ts_öã∫Æ
(*
f⁄t_cﬁÀ˘i⁄
)

1341 i‡(
	`°bâ__isf⁄t
(
f⁄t_cﬁÀ˘i⁄
))

1345 i‡(
	`°bâ_èg
(
f⁄t_cﬁÀ˘i⁄
, "ttcf")) {

1347 i‡(
	`âULONG
(
f⁄t_cﬁÀ˘i⁄
+4) == 0x00010000 ||ÅtULONG(font_collection+4) == 0x00020000) {

1348  
	`âLONG
(
f⁄t_cﬁÀ˘i⁄
+8);

1352 
	}
}

1354 
°bâ__buf
 
	$°bâ__gë_subrs
(
°bâ__buf
 
cff
, stbâ__bu‡
f⁄tdi˘
)

1356 
°bâ_uöt32
 
subrsoff
 = 0, 
¥iv©e_loc
[2] = { 0, 0 };

1357 
°bâ__buf
 
pdi˘
;

1358 
	`°bâ__di˘_gë_öts
(&
f⁄tdi˘
, 18, 2, 
¥iv©e_loc
);

1359 i‡(!
¥iv©e_loc
[1] || !¥iv©e_loc[0]Ë 
	`°bâ__√w_buf
(
NULL
, 0);

1360 
pdi˘
 = 
	`°bâ__buf_ønge
(&
cff
, 
¥iv©e_loc
[1],Örivate_loc[0]);

1361 
	`°bâ__di˘_gë_öts
(&
pdi˘
, 19, 1, &
subrsoff
);

1362 i‡(!
subrsoff
Ë 
	`°bâ__√w_buf
(
NULL
, 0);

1363 
	`°bâ__buf_£ek
(&
cff
, 
¥iv©e_loc
[1]+
subrsoff
);

1364  
	`°bâ__cff_gë_ödex
(&
cff
);

1365 
	}
}

1368 
	$°bâ__gë_svg
(
°bâ_f⁄töfo
 *
öfo
)

1370 
°bâ_uöt32
 
t
;

1371 i‡(
öfo
->
svg
 < 0) {

1372 
t
 = 
	`°bâ__föd_èbÀ
(
öfo
->
d©a
, info->
f⁄t°¨t
, "SVG ");

1373 i‡(
t
) {

1374 
°bâ_uöt32
 
off£t
 = 
	`âULONG
(
öfo
->
d©a
 + 
t
 + 2);

1375 
öfo
->
svg
 = 
t
 + 
off£t
;

1377 
öfo
->
svg
 = 0;

1380  
öfo
->
svg
;

1381 
	}
}

1383 
	$°bâ_InôF⁄t_öã∫Æ
(
°bâ_f⁄töfo
 *
öfo
, *
d©a
, 
f⁄t°¨t
)

1385 
°bâ_uöt32
 
cm≠
, 
t
;

1386 
°bâ_öt32
 
i
,
numTabÀs
;

1388 
öfo
->
d©a
 = data;

1389 
öfo
->
f⁄t°¨t
 = fontstart;

1390 
öfo
->
cff
 = 
	`°bâ__√w_buf
(
NULL
, 0);

1392 
cm≠
 = 
	`°bâ__föd_èbÀ
(
d©a
, 
f⁄t°¨t
, "cmap");

1393 
öfo
->
loˇ
 = 
	`°bâ__föd_èbÀ
(
d©a
, 
f⁄t°¨t
, "loca");

1394 
öfo
->
hód
 = 
	`°bâ__föd_èbÀ
(
d©a
, 
f⁄t°¨t
, "head");

1395 
öfo
->
glyf
 = 
	`°bâ__föd_èbÀ
(
d©a
, 
f⁄t°¨t
, "glyf");

1396 
öfo
->
hhó
 = 
	`°bâ__föd_èbÀ
(
d©a
, 
f⁄t°¨t
, "hhea");

1397 
öfo
->
hmtx
 = 
	`°bâ__föd_èbÀ
(
d©a
, 
f⁄t°¨t
, "hmtx");

1398 
öfo
->
kîn
 = 
	`°bâ__föd_èbÀ
(
d©a
, 
f⁄t°¨t
, "kern");

1399 
öfo
->
gpos
 = 
	`°bâ__föd_èbÀ
(
d©a
, 
f⁄t°¨t
, "GPOS");

1401 i‡(!
cm≠
 || !
öfo
->
hód
 || !öfo->
hhó
 || !öfo->
hmtx
)

1403 i‡(
öfo
->
glyf
) {

1405 i‡(!
öfo
->
loˇ
)  0;

1408 
°bâ__buf
 
b
, 
t›di˘
, 
t›di˘idx
;

1409 
°bâ_uöt32
 
c°y≥
 = 2, 
ch¨°rögs
 = 0, 
fd¨øyoff
 = 0, 
fd£À˘off
 = 0;

1410 
°bâ_uöt32
 
cff
;

1412 
cff
 = 
	`°bâ__föd_èbÀ
(
d©a
, 
f⁄t°¨t
, "CFF ");

1413 i‡(!
cff
)  0;

1415 
öfo
->
f⁄tdi˘s
 = 
	`°bâ__√w_buf
(
NULL
, 0);

1416 
öfo
->
fd£À˘
 = 
	`°bâ__√w_buf
(
NULL
, 0);

1419 
öfo
->
cff
 = 
	`°bâ__√w_buf
(
d©a
+cff, 512*1024*1024);

1420 
b
 = 
öfo
->
cff
;

1423 
	`°bâ__buf_skù
(&
b
, 2);

1424 
	`°bâ__buf_£ek
(&
b
, 
	`°bâ__buf_gë8
(&b));

1428 
	`°bâ__cff_gë_ödex
(&
b
);

1429 
t›di˘idx
 = 
	`°bâ__cff_gë_ödex
(&
b
);

1430 
t›di˘
 = 
	`°bâ__cff_ödex_gë
(
t›di˘idx
, 0);

1431 
	`°bâ__cff_gë_ödex
(&
b
);

1432 
öfo
->
gsubrs
 = 
	`°bâ__cff_gë_ödex
(&
b
);

1434 
	`°bâ__di˘_gë_öts
(&
t›di˘
, 17, 1, &
ch¨°rögs
);

1435 
	`°bâ__di˘_gë_öts
(&
t›di˘
, 0x100 | 6, 1, &
c°y≥
);

1436 
	`°bâ__di˘_gë_öts
(&
t›di˘
, 0x100 | 36, 1, &
fd¨øyoff
);

1437 
	`°bâ__di˘_gë_öts
(&
t›di˘
, 0x100 | 37, 1, &
fd£À˘off
);

1438 
öfo
->
subrs
 = 
	`°bâ__gë_subrs
(
b
, 
t›di˘
);

1441 i‡(
c°y≥
 != 2)  0;

1442 i‡(
ch¨°rögs
 == 0)  0;

1444 i‡(
fd¨øyoff
) {

1446 i‡(!
fd£À˘off
)  0;

1447 
	`°bâ__buf_£ek
(&
b
, 
fd¨øyoff
);

1448 
öfo
->
f⁄tdi˘s
 = 
	`°bâ__cff_gë_ödex
(&
b
);

1449 
öfo
->
fd£À˘
 = 
	`°bâ__buf_ønge
(&
b
, 
fd£À˘off
, b.
size
-fdselectoff);

1452 
	`°bâ__buf_£ek
(&
b
, 
ch¨°rögs
);

1453 
öfo
->
ch¨°rögs
 = 
	`°bâ__cff_gë_ödex
(&
b
);

1456 
t
 = 
	`°bâ__föd_èbÀ
(
d©a
, 
f⁄t°¨t
, "maxp");

1457 i‡(
t
)

1458 
öfo
->
numGlyphs
 = 
	`âUSHORT
(
d©a
+
t
+4);

1460 
öfo
->
numGlyphs
 = 0xffff;

1462 
öfo
->
svg
 = -1;

1467 
numTabÀs
 = 
	`âUSHORT
(
d©a
 + 
cm≠
 + 2);

1468 
öfo
->
ödex_m≠
 = 0;

1469 
i
=0; i < 
numTabÀs
; ++i) {

1470 
°bâ_uöt32
 
ícodög_ªc‹d
 = 
cm≠
 + 4 + 8 * 
i
;

1472 
	`âUSHORT
(
d©a
+
ícodög_ªc‹d
)) {

1473 
STBTT_PLATFORM_ID_MICROSOFT
:

1474 
	`âUSHORT
(
d©a
+
ícodög_ªc‹d
+2)) {

1475 
STBTT_MS_EID_UNICODE_BMP
:

1476 
STBTT_MS_EID_UNICODE_FULL
:

1478 
öfo
->
ödex_m≠
 = 
cm≠
 + 
	`âULONG
(
d©a
+
ícodög_ªc‹d
+4);

1482 
STBTT_PLATFORM_ID_UNICODE
:

1485 
öfo
->
ödex_m≠
 = 
cm≠
 + 
	`âULONG
(
d©a
+
ícodög_ªc‹d
+4);

1489 i‡(
öfo
->
ödex_m≠
 == 0)

1492 
öfo
->
ödexToLocF‹m©
 = 
	`âUSHORT
(
d©a
+öfo->
hód
 + 50);

1494 
	}
}

1496 
STBTT_DEF
 
	$°bâ_FödGlyphIndex
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
unicode_codïoöt
)

1498 
°bâ_uöt8
 *
d©a
 = 
öfo
->data;

1499 
°bâ_uöt32
 
ödex_m≠
 = 
öfo
->index_map;

1501 
°bâ_uöt16
 
f‹m©
 = 
	`âUSHORT
(
d©a
 + 
ödex_m≠
 + 0);

1502 i‡(
f‹m©
 == 0) {

1503 
°bâ_öt32
 
byãs
 = 
	`âUSHORT
(
d©a
 + 
ödex_m≠
 + 2);

1504 i‡(
unicode_codïoöt
 < 
byãs
-6)

1505  
	`âBYTE
(
d©a
 + 
ödex_m≠
 + 6 + 
unicode_codïoöt
);

1507 } i‡(
f‹m©
 == 6) {

1508 
°bâ_uöt32
 
fú°
 = 
	`âUSHORT
(
d©a
 + 
ödex_m≠
 + 6);

1509 
°bâ_uöt32
 
cou¡
 = 
	`âUSHORT
(
d©a
 + 
ödex_m≠
 + 8);

1510 i‡((
°bâ_uöt32
Ë
unicode_codïoöt
 >
fú°
 && (°bâ_uöt32Ëunicode_codïoöà< fú°+
cou¡
)

1511  
	`âUSHORT
(
d©a
 + 
ödex_m≠
 + 10 + (
unicode_codïoöt
 - 
fú°
)*2);

1513 } i‡(
f‹m©
 == 2) {

1514 
	`STBTT_as£π
(0);

1516 } i‡(
f‹m©
 == 4) {

1517 
°bâ_uöt16
 
£gcou¡
 = 
	`âUSHORT
(
d©a
+
ödex_m≠
+6) >> 1;

1518 
°bâ_uöt16
 
£¨chR™ge
 = 
	`âUSHORT
(
d©a
+
ödex_m≠
+8) >> 1;

1519 
°bâ_uöt16
 
íåySñe˘‹
 = 
	`âUSHORT
(
d©a
+
ödex_m≠
+10);

1520 
°bâ_uöt16
 
øngeShi·
 = 
	`âUSHORT
(
d©a
+
ödex_m≠
+12) >> 1;

1523 
°bâ_uöt32
 
ídCou¡
 = 
ödex_m≠
 + 14;

1524 
°bâ_uöt32
 
£¨ch
 = 
ídCou¡
;

1526 i‡(
unicode_codïoöt
 > 0xffff)

1531 i‡(
unicode_codïoöt
 >
	`âUSHORT
(
d©a
 + 
£¨ch
 + 
øngeShi·
*2))

1532 
£¨ch
 +
øngeShi·
*2;

1535 
£¨ch
 -= 2;

1536 
íåySñe˘‹
) {

1537 
°bâ_uöt16
 
íd
;

1538 
£¨chR™ge
 >>= 1;

1539 
íd
 = 
	`âUSHORT
(
d©a
 + 
£¨ch
 + 
£¨chR™ge
*2);

1540 i‡(
unicode_codïoöt
 > 
íd
)

1541 
£¨ch
 +
£¨chR™ge
*2;

1542 --
íåySñe˘‹
;

1544 
£¨ch
 += 2;

1547 
°bâ_uöt16
 
off£t
, 
°¨t
, 
œ°
;

1548 
°bâ_uöt16
 
ôem
 = (°bâ_uöt16Ë((
£¨ch
 - 
ídCou¡
) >> 1);

1550 
°¨t
 = 
	`âUSHORT
(
d©a
 + 
ödex_m≠
 + 14 + 
£gcou¡
*2 + 2 + 2*
ôem
);

1551 
œ°
 = 
	`âUSHORT
(
d©a
 + 
ídCou¡
 + 2*
ôem
);

1552 i‡(
unicode_codïoöt
 < 
°¨t
 || unicode_codïoöà> 
œ°
)

1555 
off£t
 = 
	`âUSHORT
(
d©a
 + 
ödex_m≠
 + 14 + 
£gcou¡
*6 + 2 + 2*
ôem
);

1556 i‡(
off£t
 == 0)

1557  (
°bâ_uöt16
Ë(
unicode_codïoöt
 + 
	`âSHORT
(
d©a
 + 
ödex_m≠
 + 14 + 
£gcou¡
*4 + 2 + 2*
ôem
));

1559  
	`âUSHORT
(
d©a
 + 
off£t
 + (
unicode_codïoöt
-
°¨t
)*2 + 
ödex_m≠
 + 14 + 
£gcou¡
*6 + 2 + 2*
ôem
);

1561 } i‡(
f‹m©
 == 12 || format == 13) {

1562 
°bâ_uöt32
 
ngroups
 = 
	`âULONG
(
d©a
+
ödex_m≠
+12);

1563 
°bâ_öt32
 
low
,
high
;

1564 
low
 = 0; 
high
 = (
°bâ_öt32
)
ngroups
;

1566 
low
 < 
high
) {

1567 
°bâ_öt32
 
mid
 = 
low
 + ((
high
-low) >> 1);

1568 
°bâ_uöt32
 
°¨t_ch¨
 = 
	`âULONG
(
d©a
+
ödex_m≠
+16+
mid
*12);

1569 
°bâ_uöt32
 
íd_ch¨
 = 
	`âULONG
(
d©a
+
ödex_m≠
+16+
mid
*12+4);

1570 i‡((
°bâ_uöt32
Ë
unicode_codïoöt
 < 
°¨t_ch¨
)

1571 
high
 = 
mid
;

1572 i‡((
°bâ_uöt32
Ë
unicode_codïoöt
 > 
íd_ch¨
)

1573 
low
 = 
mid
+1;

1575 
°bâ_uöt32
 
°¨t_glyph
 = 
	`âULONG
(
d©a
+
ödex_m≠
+16+
mid
*12+8);

1576 i‡(
f‹m©
 == 12)

1577  
°¨t_glyph
 + 
unicode_codïoöt
-
°¨t_ch¨
;

1579  
°¨t_glyph
;

1585 
	`STBTT_as£π
(0);

1587 
	}
}

1589 
STBTT_DEF
 
	$°bâ_GëCodïoötSh≠e
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
unicode_codïoöt
, 
°bâ_vîãx
 **
vîti˚s
)

1591  
	`°bâ_GëGlyphSh≠e
(
öfo
, 
	`°bâ_FödGlyphIndex
(öfo, 
unicode_codïoöt
), 
vîti˚s
);

1592 
	}
}

1594 
	$°bâ_£tvîãx
(
°bâ_vîãx
 *
v
, 
°bâ_uöt8
 
ty≥
, 
°bâ_öt32
 
x
, stbâ_öt32 
y
, stbâ_öt32 
cx
, stbâ_öt32 
cy
)

1596 
v
->
ty≥
 =Åype;

1597 
v
->
x
 = (
°bâ_öt16
) x;

1598 
v
->
y
 = (
°bâ_öt16
) y;

1599 
v
->
cx
 = (
°bâ_öt16
) cx;

1600 
v
->
cy
 = (
°bâ_öt16
) cy;

1601 
	}
}

1603 
	$°bâ__GëGlyfOff£t
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
)

1605 
g1
,
g2
;

1607 
	`STBTT_as£π
(!
öfo
->
cff
.
size
);

1609 i‡(
glyph_ödex
 >
öfo
->
numGlyphs
)  -1;

1610 i‡(
öfo
->
ödexToLocF‹m©
 >= 2)  -1;

1612 i‡(
öfo
->
ödexToLocF‹m©
 == 0) {

1613 
g1
 = 
öfo
->
glyf
 + 
	`âUSHORT
(öfo->
d©a
 + info->
loˇ
 + 
glyph_ödex
 * 2) * 2;

1614 
g2
 = 
öfo
->
glyf
 + 
	`âUSHORT
(öfo->
d©a
 + info->
loˇ
 + 
glyph_ödex
 * 2 + 2) * 2;

1616 
g1
 = 
öfo
->
glyf
 + 
	`âULONG
 (öfo->
d©a
 + info->
loˇ
 + 
glyph_ödex
 * 4);

1617 
g2
 = 
öfo
->
glyf
 + 
	`âULONG
 (öfo->
d©a
 + info->
loˇ
 + 
glyph_ödex
 * 4 + 4);

1620  
g1
==
g2
 ? -1 : g1;

1621 
	}
}

1623 
°bâ__GëGlyphInfoT2
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
, *
x0
, *
y0
, *
x1
, *
y1
);

1625 
STBTT_DEF
 
	$°bâ_GëGlyphBox
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
, *
x0
, *
y0
, *
x1
, *
y1
)

1627 i‡(
öfo
->
cff
.
size
) {

1628 
	`°bâ__GëGlyphInfoT2
(
öfo
, 
glyph_ödex
, 
x0
, 
y0
, 
x1
, 
y1
);

1630 
g
 = 
	`°bâ__GëGlyfOff£t
(
öfo
, 
glyph_ödex
);

1631 i‡(
g
 < 0)  0;

1633 i‡(
x0
Ë*x0 = 
	`âSHORT
(
öfo
->
d©a
 + 
g
 + 2);

1634 i‡(
y0
Ë*y0 = 
	`âSHORT
(
öfo
->
d©a
 + 
g
 + 4);

1635 i‡(
x1
Ë*x1 = 
	`âSHORT
(
öfo
->
d©a
 + 
g
 + 6);

1636 i‡(
y1
Ë*y1 = 
	`âSHORT
(
öfo
->
d©a
 + 
g
 + 8);

1639 
	}
}

1641 
STBTT_DEF
 
	$°bâ_GëCodïoötBox
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
codïoöt
, *
x0
, *
y0
, *
x1
, *
y1
)

1643  
	`°bâ_GëGlyphBox
(
öfo
, 
	`°bâ_FödGlyphIndex
(öfo,
codïoöt
), 
x0
,
y0
,
x1
,
y1
);

1644 
	}
}

1646 
STBTT_DEF
 
	$°bâ_IsGlyphEm±y
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
)

1648 
°bâ_öt16
 
numbîOfC⁄tours
;

1649 
g
;

1650 i‡(
öfo
->
cff
.
size
)

1651  
	`°bâ__GëGlyphInfoT2
(
öfo
, 
glyph_ödex
, 
NULL
, NULL, NULL, NULL) == 0;

1652 
g
 = 
	`°bâ__GëGlyfOff£t
(
öfo
, 
glyph_ödex
);

1653 i‡(
g
 < 0)  1;

1654 
numbîOfC⁄tours
 = 
	`âSHORT
(
öfo
->
d©a
 + 
g
);

1655  
numbîOfC⁄tours
 == 0;

1656 
	}
}

1658 
	$°bâ__˛o£_sh≠e
(
°bâ_vîãx
 *
vîti˚s
, 
num_vîti˚s
, 
was_off
, 
°¨t_off
,

1659 
°bâ_öt32
 
sx
, stbâ_öt32 
sy
, stbâ_öt32 
scx
, stbâ_öt32 
scy
, stbâ_öt32 
cx
, stbâ_öt32 
cy
)

1661 i‡(
°¨t_off
) {

1662 i‡(
was_off
)

1663 
	`°bâ_£tvîãx
(&
vîti˚s
[
num_vîti˚s
++], 
STBTT_vcurve
, (
cx
+
scx
)>>1, (
cy
+
scy
)>>1, cx,cy);

1664 
	`°bâ_£tvîãx
(&
vîti˚s
[
num_vîti˚s
++], 
STBTT_vcurve
, 
sx
,
sy
,
scx
,
scy
);

1666 i‡(
was_off
)

1667 
	`°bâ_£tvîãx
(&
vîti˚s
[
num_vîti˚s
++], 
STBTT_vcurve
,
sx
,
sy
,
cx
,
cy
);

1669 
	`°bâ_£tvîãx
(&
vîti˚s
[
num_vîti˚s
++], 
STBTT_vlöe
,
sx
,
sy
,0,0);

1671  
num_vîti˚s
;

1672 
	}
}

1674 
	$°bâ__GëGlyphSh≠eTT
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
, 
°bâ_vîãx
 **
pvîti˚s
)

1676 
°bâ_öt16
 
numbîOfC⁄tours
;

1677 
°bâ_uöt8
 *
ídPtsOfC⁄tours
;

1678 
°bâ_uöt8
 *
d©a
 = 
öfo
->data;

1679 
°bâ_vîãx
 *
vîti˚s
=0;

1680 
num_vîti˚s
=0;

1681 
g
 = 
	`°bâ__GëGlyfOff£t
(
öfo
, 
glyph_ödex
);

1683 *
pvîti˚s
 = 
NULL
;

1685 i‡(
g
 < 0)  0;

1687 
numbîOfC⁄tours
 = 
	`âSHORT
(
d©a
 + 
g
);

1689 i‡(
numbîOfC⁄tours
 > 0) {

1690 
°bâ_uöt8
 
Êags
=0,
Êagcou¡
;

1691 
°bâ_öt32
 
ös
, 
i
,
j
=0,
m
,
n
, 
√xt_move
, 
was_off
=0, 
off
, 
°¨t_off
=0;

1692 
°bâ_öt32
 
x
,
y
,
cx
,
cy
,
sx
,
sy
, 
scx
,
scy
;

1693 
°bâ_uöt8
 *
poöts
;

1694 
ídPtsOfC⁄tours
 = (
d©a
 + 
g
 + 10);

1695 
ös
 = 
	`âUSHORT
(
d©a
 + 
g
 + 10 + 
numbîOfC⁄tours
 * 2);

1696 
poöts
 = 
d©a
 + 
g
 + 10 + 
numbîOfC⁄tours
 * 2 + 2 + 
ös
;

1698 
n
 = 1+
	`âUSHORT
(
ídPtsOfC⁄tours
 + 
numbîOfC⁄tours
*2-2);

1700 
m
 = 
n
 + 2*
numbîOfC⁄tours
;

1701 
vîti˚s
 = (
°bâ_vîãx
 *Ë
	`STBTT_mÆloc
(
m
 * (vîti˚s[0]), 
öfo
->
u£rd©a
);

1702 i‡(
vîti˚s
 == 0)

1705 
√xt_move
 = 0;

1706 
Êagcou¡
=0;

1712 
off
 = 
m
 - 
n
;

1716 
i
=0; i < 
n
; ++i) {

1717 i‡(
Êagcou¡
 == 0) {

1718 
Êags
 = *
poöts
++;

1719 i‡(
Êags
 & 8)

1720 
Êagcou¡
 = *
poöts
++;

1722 --
Êagcou¡
;

1723 
vîti˚s
[
off
+
i
].
ty≥
 = 
Êags
;

1727 
x
=0;

1728 
i
=0; i < 
n
; ++i) {

1729 
Êags
 = 
vîti˚s
[
off
+
i
].
ty≥
;

1730 i‡(
Êags
 & 2) {

1731 
°bâ_öt16
 
dx
 = *
poöts
++;

1732 
x
 +(
Êags
 & 16Ë? 
dx
 : -dx;

1734 i‡(!(
Êags
 & 16)) {

1735 
x
 = x + (
°bâ_öt16
Ë(
poöts
[0]*256 +Öoints[1]);

1736 
poöts
 += 2;

1739 
vîti˚s
[
off
+
i
].
x
 = (
°bâ_öt16
) x;

1743 
y
=0;

1744 
i
=0; i < 
n
; ++i) {

1745 
Êags
 = 
vîti˚s
[
off
+
i
].
ty≥
;

1746 i‡(
Êags
 & 4) {

1747 
°bâ_öt16
 
dy
 = *
poöts
++;

1748 
y
 +(
Êags
 & 32Ë? 
dy
 : -dy;

1750 i‡(!(
Êags
 & 32)) {

1751 
y
 = y + (
°bâ_öt16
Ë(
poöts
[0]*256 +Öoints[1]);

1752 
poöts
 += 2;

1755 
vîti˚s
[
off
+
i
].
y
 = (
°bâ_öt16
) y;

1759 
num_vîti˚s
=0;

1760 
sx
 = 
sy
 = 
cx
 = 
cy
 = 
scx
 = 
scy
 = 0;

1761 
i
=0; i < 
n
; ++i) {

1762 
Êags
 = 
vîti˚s
[
off
+
i
].
ty≥
;

1763 
x
 = (
°bâ_öt16
Ë
vîti˚s
[
off
+
i
].x;

1764 
y
 = (
°bâ_öt16
Ë
vîti˚s
[
off
+
i
].y;

1766 i‡(
√xt_move
 =
i
) {

1767 i‡(
i
 != 0)

1768 
num_vîti˚s
 = 
	`°bâ__˛o£_sh≠e
(
vîti˚s
,Çum_vîti˚s, 
was_off
, 
°¨t_off
, 
sx
,
sy
,
scx
,
scy
,
cx
,
cy
);

1771 
°¨t_off
 = !(
Êags
 & 1);

1772 i‡(
°¨t_off
) {

1775 
scx
 = 
x
;

1776 
scy
 = 
y
;

1777 i‡(!(
vîti˚s
[
off
+
i
+1].
ty≥
 & 1)) {

1779 
sx
 = (
x
 + (
°bâ_öt32
Ë
vîti˚s
[
off
+
i
+1].x) >> 1;

1780 
sy
 = (
y
 + (
°bâ_öt32
Ë
vîti˚s
[
off
+
i
+1].y) >> 1;

1783 
sx
 = (
°bâ_öt32
Ë
vîti˚s
[
off
+
i
+1].
x
;

1784 
sy
 = (
°bâ_öt32
Ë
vîti˚s
[
off
+
i
+1].
y
;

1785 ++
i
;

1788 
sx
 = 
x
;

1789 
sy
 = 
y
;

1791 
	`°bâ_£tvîãx
(&
vîti˚s
[
num_vîti˚s
++], 
STBTT_vmove
,
sx
,
sy
,0,0);

1792 
was_off
 = 0;

1793 
√xt_move
 = 1 + 
	`âUSHORT
(
ídPtsOfC⁄tours
+
j
*2);

1794 ++
j
;

1796 i‡(!(
Êags
 & 1)) {

1797 i‡(
was_off
)

1798 
	`°bâ_£tvîãx
(&
vîti˚s
[
num_vîti˚s
++], 
STBTT_vcurve
, (
cx
+
x
)>>1, (
cy
+
y
)>>1, cx, cy);

1799 
cx
 = 
x
;

1800 
cy
 = 
y
;

1801 
was_off
 = 1;

1803 i‡(
was_off
)

1804 
	`°bâ_£tvîãx
(&
vîti˚s
[
num_vîti˚s
++], 
STBTT_vcurve
, 
x
,
y
, 
cx
, 
cy
);

1806 
	`°bâ_£tvîãx
(&
vîti˚s
[
num_vîti˚s
++], 
STBTT_vlöe
, 
x
,
y
,0,0);

1807 
was_off
 = 0;

1811 
num_vîti˚s
 = 
	`°bâ__˛o£_sh≠e
(
vîti˚s
,Çum_vîti˚s, 
was_off
, 
°¨t_off
, 
sx
,
sy
,
scx
,
scy
,
cx
,
cy
);

1812 } i‡(
numbîOfC⁄tours
 < 0) {

1814 
m‹e
 = 1;

1815 
°bâ_uöt8
 *
comp
 = 
d©a
 + 
g
 + 10;

1816 
num_vîti˚s
 = 0;

1817 
vîti˚s
 = 0;

1818 
m‹e
) {

1819 
°bâ_uöt16
 
Êags
, 
gidx
;

1820 
comp_num_vîts
 = 0, 
i
;

1821 
°bâ_vîãx
 *
comp_vîts
 = 0, *
tmp
 = 0;

1822 
mtx
[6] = {1,0,0,1,0,0}, 
m
, 
n
;

1824 
Êags
 = 
	`âSHORT
(
comp
); comp+=2;

1825 
gidx
 = 
	`âSHORT
(
comp
); comp+=2;

1827 i‡(
Êags
 & 2) {

1828 i‡(
Êags
 & 1) {

1829 
mtx
[4] = 
	`âSHORT
(
comp
); comp+=2;

1830 
mtx
[5] = 
	`âSHORT
(
comp
); comp+=2;

1832 
mtx
[4] = 
	`âCHAR
(
comp
); comp+=1;

1833 
mtx
[5] = 
	`âCHAR
(
comp
); comp+=1;

1838 
	`STBTT_as£π
(0);

1840 i‡(
Êags
 & (1<<3)) {

1841 
mtx
[0] = mtx[3] = 
	`âSHORT
(
comp
)/16384.0f; comp+=2;

1842 
mtx
[1] = mtx[2] = 0;

1843 } i‡(
Êags
 & (1<<6)) {

1844 
mtx
[0] = 
	`âSHORT
(
comp
)/16384.0f; comp+=2;

1845 
mtx
[1] = mtx[2] = 0;

1846 
mtx
[3] = 
	`âSHORT
(
comp
)/16384.0f; comp+=2;

1847 } i‡(
Êags
 & (1<<7)) {

1848 
mtx
[0] = 
	`âSHORT
(
comp
)/16384.0f; comp+=2;

1849 
mtx
[1] = 
	`âSHORT
(
comp
)/16384.0f; comp+=2;

1850 
mtx
[2] = 
	`âSHORT
(
comp
)/16384.0f; comp+=2;

1851 
mtx
[3] = 
	`âSHORT
(
comp
)/16384.0f; comp+=2;

1855 
m
 = (Ë
	`STBTT_sqπ
(
mtx
[0]*mtx[0] + mtx[1]*mtx[1]);

1856 
n
 = (Ë
	`STBTT_sqπ
(
mtx
[2]*mtx[2] + mtx[3]*mtx[3]);

1859 
comp_num_vîts
 = 
	`°bâ_GëGlyphSh≠e
(
öfo
, 
gidx
, &
comp_vîts
);

1860 i‡(
comp_num_vîts
 > 0) {

1862 
i
 = 0; i < 
comp_num_vîts
; ++i) {

1863 
°bâ_vîãx
* 
v
 = &
comp_vîts
[
i
];

1864 
°bâ_vîãx_ty≥
 
x
,
y
;

1865 
x
=
v
->x; 
y
=v->y;

1866 
v
->
x
 = (
°bâ_vîãx_ty≥
)(
m
 * (
mtx
[0]*x + mtx[2]*
y
 + mtx[4]));

1867 
v
->
y
 = (
°bâ_vîãx_ty≥
)(
n
 * (
mtx
[1]*
x
 + mtx[3]*y + mtx[5]));

1868 
x
=
v
->
cx
; 
y
=v->
cy
;

1869 
v
->
cx
 = (
°bâ_vîãx_ty≥
)(
m
 * (
mtx
[0]*
x
 + mtx[2]*
y
 + mtx[4]));

1870 
v
->
cy
 = (
°bâ_vîãx_ty≥
)(
n
 * (
mtx
[1]*
x
 + mtx[3]*
y
 + mtx[5]));

1873 
tmp
 = (
°bâ_vîãx
*)
	`STBTT_mÆloc
((
num_vîti˚s
+
comp_num_vîts
)*(°bâ_vîãx), 
öfo
->
u£rd©a
);

1874 i‡(!
tmp
) {

1875 i‡(
vîti˚s
Ë
	`STBTT_‰ì
(vîti˚s, 
öfo
->
u£rd©a
);

1876 i‡(
comp_vîts
Ë
	`STBTT_‰ì
(comp_vîts, 
öfo
->
u£rd©a
);

1879 i‡(
num_vîti˚s
 > 0 && 
vîti˚s
Ë
	`STBTT_mem˝y
(
tmp
, vîti˚s,Çum_vîti˚s*(
°bâ_vîãx
));

1880 
	`STBTT_mem˝y
(
tmp
+
num_vîti˚s
, 
comp_vîts
, 
comp_num_vîts
*(
°bâ_vîãx
));

1881 i‡(
vîti˚s
Ë
	`STBTT_‰ì
(vîti˚s, 
öfo
->
u£rd©a
);

1882 
vîti˚s
 = 
tmp
;

1883 
	`STBTT_‰ì
(
comp_vîts
, 
öfo
->
u£rd©a
);

1884 
num_vîti˚s
 +
comp_num_vîts
;

1887 
m‹e
 = 
Êags
 & (1<<5);

1893 *
pvîti˚s
 = 
vîti˚s
;

1894  
num_vîti˚s
;

1895 
	}
}

1899 
	mbounds
;

1900 
	m°¨ãd
;

1901 
	mfú°_x
, 
	mfú°_y
;

1902 
	mx
, 
	my
;

1903 
°bâ_öt32
 
	mmö_x
, 
	mmax_x
, 
	mmö_y
, 
	mmax_y
;

1905 
°bâ_vîãx
 *
	mpvîti˚s
;

1906 
	mnum_vîti˚s
;

1907 } 
	t°bâ__cs˘x
;

1909 
	#STBTT__CSCTX_INIT
(
bounds
Ë{bounds,0, 0,0, 0,0, 0,0,0,0, 
NULL
, 0}

	)

1911 
	$°bâ__åack_vîãx
(
°bâ__cs˘x
 *
c
, 
°bâ_öt32
 
x
, stbâ_öt32 
y
)

1913 i‡(
x
 > 
c
->
max_x
 || !c->
°¨ãd
) c->max_x = x;

1914 i‡(
y
 > 
c
->
max_y
 || !c->
°¨ãd
) c->max_y = y;

1915 i‡(
x
 < 
c
->
mö_x
 || !c->
°¨ãd
) c->min_x = x;

1916 i‡(
y
 < 
c
->
mö_y
 || !c->
°¨ãd
) c->min_y = y;

1917 
c
->
°¨ãd
 = 1;

1918 
	}
}

1920 
	$°bâ__cs˘x_v
(
°bâ__cs˘x
 *
c
, 
°bâ_uöt8
 
ty≥
, 
°bâ_öt32
 
x
, stbâ_öt32 
y
, stbâ_öt32 
cx
, stbâ_öt32 
cy
, stbâ_öt32 
cx1
, stbâ_öt32 
cy1
)

1922 i‡(
c
->
bounds
) {

1923 
	`°bâ__åack_vîãx
(
c
, 
x
, 
y
);

1924 i‡(
ty≥
 =
STBTT_vcubic
) {

1925 
	`°bâ__åack_vîãx
(
c
, 
cx
, 
cy
);

1926 
	`°bâ__åack_vîãx
(
c
, 
cx1
, 
cy1
);

1929 
	`°bâ_£tvîãx
(&
c
->
pvîti˚s
[c->
num_vîti˚s
], 
ty≥
, 
x
, 
y
, 
cx
, 
cy
);

1930 
c
->
pvîti˚s
[c->
num_vîti˚s
].
cx1
 = (
°bâ_öt16
) cx1;

1931 
c
->
pvîti˚s
[c->
num_vîti˚s
].
cy1
 = (
°bâ_öt16
) cy1;

1933 
c
->
num_vîti˚s
++;

1934 
	}
}

1936 
	$°bâ__cs˘x_˛o£_sh≠e
(
°bâ__cs˘x
 *
˘x
)

1938 i‡(
˘x
->
fú°_x
 !˘x->
x
 || ctx->
fú°_y
 !˘x->
y
)

1939 
	`°bâ__cs˘x_v
(
˘x
, 
STBTT_vlöe
, ()˘x->
fú°_x
, ()˘x->
fú°_y
, 0, 0, 0, 0);

1940 
	}
}

1942 
	$°bâ__cs˘x_rmove_to
(
°bâ__cs˘x
 *
˘x
, 
dx
, 
dy
)

1944 
	`°bâ__cs˘x_˛o£_sh≠e
(
˘x
);

1945 
˘x
->
fú°_x
 = ctx->
x
 = ctx->x + 
dx
;

1946 
˘x
->
fú°_y
 = ctx->
y
 = ctx->y + 
dy
;

1947 
	`°bâ__cs˘x_v
(
˘x
, 
STBTT_vmove
, ()˘x->
x
, ()˘x->
y
, 0, 0, 0, 0);

1948 
	}
}

1950 
	$°bâ__cs˘x_æöe_to
(
°bâ__cs˘x
 *
˘x
, 
dx
, 
dy
)

1952 
˘x
->
x
 +
dx
;

1953 
˘x
->
y
 +
dy
;

1954 
	`°bâ__cs˘x_v
(
˘x
, 
STBTT_vlöe
, ()˘x->
x
, ()˘x->
y
, 0, 0, 0, 0);

1955 
	}
}

1957 
	$°bâ__cs˘x_rccurve_to
(
°bâ__cs˘x
 *
˘x
, 
dx1
, 
dy1
, 
dx2
, 
dy2
, 
dx3
, 
dy3
)

1959 
cx1
 = 
˘x
->
x
 + 
dx1
;

1960 
cy1
 = 
˘x
->
y
 + 
dy1
;

1961 
cx2
 = 
cx1
 + 
dx2
;

1962 
cy2
 = 
cy1
 + 
dy2
;

1963 
˘x
->
x
 = 
cx2
 + 
dx3
;

1964 
˘x
->
y
 = 
cy2
 + 
dy3
;

1965 
	`°bâ__cs˘x_v
(
˘x
, 
STBTT_vcubic
, ()˘x->
x
, ()˘x->
y
, ()
cx1
, ()
cy1
, ()
cx2
, ()
cy2
);

1966 
	}
}

1968 
°bâ__buf
 
	$°bâ__gë_subr
(
°bâ__buf
 
idx
, 
n
)

1970 
cou¡
 = 
	`°bâ__cff_ödex_cou¡
(&
idx
);

1971 
büs
 = 107;

1972 i‡(
cou¡
 >= 33900)

1973 
büs
 = 32768;

1974 i‡(
cou¡
 >= 1240)

1975 
büs
 = 1131;

1976 
n
 +
büs
;

1977 i‡(
n
 < 0 ||Ç >
cou¡
)

1978  
	`°bâ__√w_buf
(
NULL
, 0);

1979  
	`°bâ__cff_ödex_gë
(
idx
, 
n
);

1980 
	}
}

1982 
°bâ__buf
 
	$°bâ__cid_gë_glyph_subrs
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
)

1984 
°bâ__buf
 
fd£À˘
 = 
öfo
->fdselect;

1985 
ƒ™ges
, 
°¨t
, 
íd
, 
v
, 
fmt
, 
fd£À˘‹
 = -1, 
i
;

1987 
	`°bâ__buf_£ek
(&
fd£À˘
, 0);

1988 
fmt
 = 
	`°bâ__buf_gë8
(&
fd£À˘
);

1989 i‡(
fmt
 == 0) {

1991 
	`°bâ__buf_skù
(&
fd£À˘
, 
glyph_ödex
);

1992 
fd£À˘‹
 = 
	`°bâ__buf_gë8
(&
fd£À˘
);

1993 } i‡(
fmt
 == 3) {

1994 
ƒ™ges
 = 
	`°bâ__buf_gë16
(&
fd£À˘
);

1995 
°¨t
 = 
	`°bâ__buf_gë16
(&
fd£À˘
);

1996 
i
 = 0; i < 
ƒ™ges
; i++) {

1997 
v
 = 
	`°bâ__buf_gë8
(&
fd£À˘
);

1998 
íd
 = 
	`°bâ__buf_gë16
(&
fd£À˘
);

1999 i‡(
glyph_ödex
 >
°¨t
 && glyph_ödex < 
íd
) {

2000 
fd£À˘‹
 = 
v
;

2003 
°¨t
 = 
íd
;

2006 i‡(
fd£À˘‹
 =-1Ë
	`°bâ__√w_buf
(
NULL
, 0);

2007  
	`°bâ__gë_subrs
(
öfo
->
cff
, 
	`°bâ__cff_ödex_gë
(öfo->
f⁄tdi˘s
, 
fd£À˘‹
));

2008 
	}
}

2010 
	$°bâ__run_ch¨°rög
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
, 
°bâ__cs˘x
 *
c
)

2012 
ö_hódî
 = 1, 
maskbôs
 = 0, 
subr_°ack_height
 = 0, 
•
 = 0, 
v
, 
i
, 
b0
;

2013 
has_subrs
 = 0, 
˛ór_°ack
;

2014 
s
[48];

2015 
°bâ__buf
 
subr_°ack
[10], 
subrs
 = 
öfo
->subrs, 
b
;

2016 
f
;

2018 
	#STBTT__CSERR
(
s
Ë(0)

	)

2021 
b
 = 
	`°bâ__cff_ödex_gë
(
öfo
->
ch¨°rögs
, 
glyph_ödex
);

2022 
b
.
curs‹
 < b.
size
) {

2023 
i
 = 0;

2024 
˛ór_°ack
 = 1;

2025 
b0
 = 
	`°bâ__buf_gë8
(&
b
);

2026 
b0
) {

2030 i‡(
ö_hódî
)

2031 
maskbôs
 +(
•
 / 2);

2032 
ö_hódî
 = 0;

2033 
	`°bâ__buf_skù
(&
b
, (
maskbôs
 + 7) / 8);

2040 
maskbôs
 +(
•
 / 2);

2044 
ö_hódî
 = 0;

2045 i‡(
•
 < 2Ë 
	`STBTT__CSERR
("rmoveto stack");

2046 
	`°bâ__cs˘x_rmove_to
(
c
, 
s
[
•
-2], s[sp-1]);

2049 
ö_hódî
 = 0;

2050 i‡(
•
 < 1Ë 
	`STBTT__CSERR
("vmoveto stack");

2051 
	`°bâ__cs˘x_rmove_to
(
c
, 0, 
s
[
•
-1]);

2054 
ö_hódî
 = 0;

2055 i‡(
•
 < 1Ë 
	`STBTT__CSERR
("hmoveto stack");

2056 
	`°bâ__cs˘x_rmove_to
(
c
, 
s
[
•
-1], 0);

2060 i‡(
•
 < 2Ë 
	`STBTT__CSERR
("rlineto stack");

2061 ; 
i
 + 1 < 
•
; i += 2)

2062 
	`°bâ__cs˘x_æöe_to
(
c
, 
s
[
i
], s[i+1]);

2069 i‡(
•
 < 1Ë 
	`STBTT__CSERR
("vlineto stack");

2070 
vlöëo
;

2072 i‡(
•
 < 1Ë 
	`STBTT__CSERR
("hlineto stack");

2074 i‡(
i
 >
•
) ;

2075 
	`°bâ__cs˘x_æöe_to
(
c
, 
s
[
i
], 0);

2076 
i
++;

2077 
vlöëo
:

2078 i‡(
i
 >
•
) ;

2079 
	`°bâ__cs˘x_æöe_to
(
c
, 0, 
s
[
i
]);

2080 
i
++;

2085 i‡(
•
 < 4Ë 
	`STBTT__CSERR
("hvcurveto stack");

2086 
hvcurvëo
;

2088 i‡(
•
 < 4Ë 
	`STBTT__CSERR
("vhcurveto stack");

2090 i‡(
i
 + 3 >
•
) ;

2091 
	`°bâ__cs˘x_rccurve_to
(
c
, 0, 
s
[
i
], s[i+1], s[i+2], s[i+3], (
•
 - i == 5) ? s[i + 4] : 0.0f);

2092 
i
 += 4;

2093 
hvcurvëo
:

2094 i‡(
i
 + 3 >
•
) ;

2095 
	`°bâ__cs˘x_rccurve_to
(
c
, 
s
[
i
], 0, s[i+1], s[i+2], (
•
 - i == 5) ? s[i+4] : 0.0f, s[i+3]);

2096 
i
 += 4;

2101 i‡(
•
 < 6Ë 
	`STBTT__CSERR
("rcurveline stack");

2102 ; 
i
 + 5 < 
•
; i += 6)

2103 
	`°bâ__cs˘x_rccurve_to
(
c
, 
s
[
i
], s[i+1], s[i+2], s[i+3], s[i+4], s[i+5]);

2107 i‡(
•
 < 8Ë 
	`STBTT__CSERR
("rcurveline stack");

2108 ; 
i
 + 5 < 
•
 - 2; i += 6)

2109 
	`°bâ__cs˘x_rccurve_to
(
c
, 
s
[
i
], s[i+1], s[i+2], s[i+3], s[i+4], s[i+5]);

2110 i‡(
i
 + 1 >
•
Ë 
	`STBTT__CSERR
("rcurveline stack");

2111 
	`°bâ__cs˘x_æöe_to
(
c
, 
s
[
i
], s[i+1]);

2115 i‡(
•
 < 8Ë 
	`STBTT__CSERR
("rlinecurve stack");

2116 ; 
i
 + 1 < 
•
 - 6; i += 2)

2117 
	`°bâ__cs˘x_æöe_to
(
c
, 
s
[
i
], s[i+1]);

2118 i‡(
i
 + 5 >
•
Ë 
	`STBTT__CSERR
("rlinecurve stack");

2119 
	`°bâ__cs˘x_rccurve_to
(
c
, 
s
[
i
], s[i+1], s[i+2], s[i+3], s[i+4], s[i+5]);

2124 i‡(
•
 < 4Ë 
	`STBTT__CSERR
("(vv|hh)curveto stack");

2125 
f
 = 0.0;

2126 i‡(
•
 & 1Ë{ 
f
 = 
s
[
i
]; i++; }

2127 ; 
i
 + 3 < 
•
; i += 4) {

2128 i‡(
b0
 == 0x1B)

2129 
	`°bâ__cs˘x_rccurve_to
(
c
, 
s
[
i
], 
f
, s[i+1], s[i+2], s[i+3], 0.0);

2131 
	`°bâ__cs˘x_rccurve_to
(
c
, 
f
, 
s
[
i
], s[i+1], s[i+2], 0.0, s[i+3]);

2132 
f
 = 0.0;

2137 i‡(!
has_subrs
) {

2138 i‡(
öfo
->
fd£À˘
.
size
)

2139 
subrs
 = 
	`°bâ__cid_gë_glyph_subrs
(
öfo
, 
glyph_ödex
);

2140 
has_subrs
 = 1;

2144 i‡(
•
 < 1Ë 
	`STBTT__CSERR
("call(g|)subr stack");

2145 
v
 = (Ë
s
[--
•
];

2146 i‡(
subr_°ack_height
 >10Ë 
	`STBTT__CSERR
("recursionÜimit");

2147 
subr_°ack
[
subr_°ack_height
++] = 
b
;

2148 
b
 = 
	`°bâ__gë_subr
(
b0
 =0x0A ? 
subrs
 : 
öfo
->
gsubrs
, 
v
);

2149 i‡(
b
.
size
 =0Ë 
	`STBTT__CSERR
("subrÇot found");

2150 
b
.
curs‹
 = 0;

2151 
˛ór_°ack
 = 0;

2155 i‡(
subr_°ack_height
 <0Ë 
	`STBTT__CSERR
("return outside subr");

2156 
b
 = 
subr_°ack
[--
subr_°ack_height
];

2157 
˛ór_°ack
 = 0;

2161 
	`°bâ__cs˘x_˛o£_sh≠e
(
c
);

2165 
dx1
, 
dx2
, 
dx3
, 
dx4
, 
dx5
, 
dx6
, 
dy1
, 
dy2
, 
dy3
, 
dy4
, 
dy5
, 
dy6
;

2166 
dx
, 
dy
;

2167 
b1
 = 
	`°bâ__buf_gë8
(&
b
);

2168 
b1
) {

2172 i‡(
•
 < 7Ë 
	`STBTT__CSERR
("hflex stack");

2173 
dx1
 = 
s
[0];

2174 
dx2
 = 
s
[1];

2175 
dy2
 = 
s
[2];

2176 
dx3
 = 
s
[3];

2177 
dx4
 = 
s
[4];

2178 
dx5
 = 
s
[5];

2179 
dx6
 = 
s
[6];

2180 
	`°bâ__cs˘x_rccurve_to
(
c
, 
dx1
, 0, 
dx2
, 
dy2
, 
dx3
, 0);

2181 
	`°bâ__cs˘x_rccurve_to
(
c
, 
dx4
, 0, 
dx5
, -
dy2
, 
dx6
, 0);

2185 i‡(
•
 < 13Ë 
	`STBTT__CSERR
("flex stack");

2186 
dx1
 = 
s
[0];

2187 
dy1
 = 
s
[1];

2188 
dx2
 = 
s
[2];

2189 
dy2
 = 
s
[3];

2190 
dx3
 = 
s
[4];

2191 
dy3
 = 
s
[5];

2192 
dx4
 = 
s
[6];

2193 
dy4
 = 
s
[7];

2194 
dx5
 = 
s
[8];

2195 
dy5
 = 
s
[9];

2196 
dx6
 = 
s
[10];

2197 
dy6
 = 
s
[11];

2199 
	`°bâ__cs˘x_rccurve_to
(
c
, 
dx1
, 
dy1
, 
dx2
, 
dy2
, 
dx3
, 
dy3
);

2200 
	`°bâ__cs˘x_rccurve_to
(
c
, 
dx4
, 
dy4
, 
dx5
, 
dy5
, 
dx6
, 
dy6
);

2204 i‡(
•
 < 9Ë 
	`STBTT__CSERR
("hflex1 stack");

2205 
dx1
 = 
s
[0];

2206 
dy1
 = 
s
[1];

2207 
dx2
 = 
s
[2];

2208 
dy2
 = 
s
[3];

2209 
dx3
 = 
s
[4];

2210 
dx4
 = 
s
[5];

2211 
dx5
 = 
s
[6];

2212 
dy5
 = 
s
[7];

2213 
dx6
 = 
s
[8];

2214 
	`°bâ__cs˘x_rccurve_to
(
c
, 
dx1
, 
dy1
, 
dx2
, 
dy2
, 
dx3
, 0);

2215 
	`°bâ__cs˘x_rccurve_to
(
c
, 
dx4
, 0, 
dx5
, 
dy5
, 
dx6
, -(
dy1
+
dy2
+dy5));

2219 i‡(
•
 < 11Ë 
	`STBTT__CSERR
("flex1 stack");

2220 
dx1
 = 
s
[0];

2221 
dy1
 = 
s
[1];

2222 
dx2
 = 
s
[2];

2223 
dy2
 = 
s
[3];

2224 
dx3
 = 
s
[4];

2225 
dy3
 = 
s
[5];

2226 
dx4
 = 
s
[6];

2227 
dy4
 = 
s
[7];

2228 
dx5
 = 
s
[8];

2229 
dy5
 = 
s
[9];

2230 
dx6
 = 
dy6
 = 
s
[10];

2231 
dx
 = 
dx1
+
dx2
+
dx3
+
dx4
+
dx5
;

2232 
dy
 = 
dy1
+
dy2
+
dy3
+
dy4
+
dy5
;

2233 i‡(
	`STBTT_Ábs
(
dx
Ë> STBTT_Ábs(
dy
))

2234 
dy6
 = -
dy
;

2236 
dx6
 = -
dx
;

2237 
	`°bâ__cs˘x_rccurve_to
(
c
, 
dx1
, 
dy1
, 
dx2
, 
dy2
, 
dx3
, 
dy3
);

2238 
	`°bâ__cs˘x_rccurve_to
(
c
, 
dx4
, 
dy4
, 
dx5
, 
dy5
, 
dx6
, 
dy6
);

2242  
	`STBTT__CSERR
("unimplemented");

2247 i‡(
b0
 != 255 && b0 != 28 && b0 < 32)

2248  
	`STBTT__CSERR
("reserved operator");

2251 i‡(
b0
 == 255) {

2252 
f
 = ()(
°bâ_öt32
)
	`°bâ__buf_gë32
(&
b
) / 0x10000;

2254 
	`°bâ__buf_skù
(&
b
, -1);

2255 
f
 = ()(
°bâ_öt16
)
	`°bâ__cff_öt
(&
b
);

2257 i‡(
•
 >48Ë 
	`STBTT__CSERR
("push stack overflow");

2258 
s
[
•
++] = 
f
;

2259 
˛ór_°ack
 = 0;

2262 i‡(
˛ór_°ack
Ë
•
 = 0;

2264  
	`STBTT__CSERR
("noÉndchar");

2266 #unde‡
STBTT__CSERR


2267 
	}
}

2269 
	$°bâ__GëGlyphSh≠eT2
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
, 
°bâ_vîãx
 **
pvîti˚s
)

2272 
°bâ__cs˘x
 
cou¡_˘x
 = 
	`STBTT__CSCTX_INIT
(1);

2273 
°bâ__cs˘x
 
ouçut_˘x
 = 
	`STBTT__CSCTX_INIT
(0);

2274 i‡(
	`°bâ__run_ch¨°rög
(
öfo
, 
glyph_ödex
, &
cou¡_˘x
)) {

2275 *
pvîti˚s
 = (
°bâ_vîãx
*)
	`STBTT_mÆloc
(
cou¡_˘x
.
num_vîti˚s
*(°bâ_vîãx), 
öfo
->
u£rd©a
);

2276 
ouçut_˘x
.
pvîti˚s
 = *pvertices;

2277 i‡(
	`°bâ__run_ch¨°rög
(
öfo
, 
glyph_ödex
, &
ouçut_˘x
)) {

2278 
	`STBTT_as£π
(
ouçut_˘x
.
num_vîti˚s
 =
cou¡_˘x
.num_vertices);

2279  
ouçut_˘x
.
num_vîti˚s
;

2282 *
pvîti˚s
 = 
NULL
;

2284 
	}
}

2286 
	$°bâ__GëGlyphInfoT2
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
, *
x0
, *
y0
, *
x1
, *
y1
)

2288 
°bâ__cs˘x
 
c
 = 
	`STBTT__CSCTX_INIT
(1);

2289 
r
 = 
	`°bâ__run_ch¨°rög
(
öfo
, 
glyph_ödex
, &
c
);

2290 i‡(
x0
Ë*x0 = 
r
 ? 
c
.
mö_x
 : 0;

2291 i‡(
y0
Ë*y0 = 
r
 ? 
c
.
mö_y
 : 0;

2292 i‡(
x1
Ë*x1 = 
r
 ? 
c
.
max_x
 : 0;

2293 i‡(
y1
Ë*y1 = 
r
 ? 
c
.
max_y
 : 0;

2294  
r
 ? 
c
.
num_vîti˚s
 : 0;

2295 
	}
}

2297 
STBTT_DEF
 
	$°bâ_GëGlyphSh≠e
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
, 
°bâ_vîãx
 **
pvîti˚s
)

2299 i‡(!
öfo
->
cff
.
size
)

2300  
	`°bâ__GëGlyphSh≠eTT
(
öfo
, 
glyph_ödex
, 
pvîti˚s
);

2302  
	`°bâ__GëGlyphSh≠eT2
(
öfo
, 
glyph_ödex
, 
pvîti˚s
);

2303 
	}
}

2305 
STBTT_DEF
 
	$°bâ_GëGlyphHMërics
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph_ödex
, *
adv™˚Width
, *
À·SideBórög
)

2307 
°bâ_uöt16
 
numOfL⁄gH‹Mërics
 = 
	`âUSHORT
(
öfo
->
d©a
+öfo->
hhó
 + 34);

2308 i‡(
glyph_ödex
 < 
numOfL⁄gH‹Mërics
) {

2309 i‡(
adv™˚Width
Ë*adv™˚Width = 
	`âSHORT
(
öfo
->
d©a
 + info->
hmtx
 + 4*
glyph_ödex
);

2310 i‡(
À·SideBórög
Ë*À·SideBórög = 
	`âSHORT
(
öfo
->
d©a
 + info->
hmtx
 + 4*
glyph_ödex
 + 2);

2312 i‡(
adv™˚Width
Ë*adv™˚Width = 
	`âSHORT
(
öfo
->
d©a
 + info->
hmtx
 + 4*(
numOfL⁄gH‹Mërics
-1));

2313 i‡(
À·SideBórög
Ë*À·SideBórög = 
	`âSHORT
(
öfo
->
d©a
 + info->
hmtx
 + 4*
numOfL⁄gH‹Mërics
 + 2*(
glyph_ödex
 -ÇumOfLongHorMetrics));

2315 
	}
}

2317 
STBTT_DEF
 
	$°bâ_GëKînögTabÀLígth
(c⁄° 
°bâ_f⁄töfo
 *
öfo
)

2319 
°bâ_uöt8
 *
d©a
 = 
öfo
->d©®+ info->
kîn
;

2322 i‡(!
öfo
->
kîn
)

2324 i‡(
	`âUSHORT
(
d©a
+2) < 1)

2326 i‡(
	`âUSHORT
(
d©a
+8) != 1)

2329  
	`âUSHORT
(
d©a
+10);

2330 
	}
}

2332 
STBTT_DEF
 
	$°bâ_GëKînögTabÀ
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
°bâ_kînögíåy
* 
èbÀ
, 
èbÀ_Àngth
)

2334 
°bâ_uöt8
 *
d©a
 = 
öfo
->d©®+ info->
kîn
;

2335 
k
, 
Àngth
;

2338 i‡(!
öfo
->
kîn
)

2340 i‡(
	`âUSHORT
(
d©a
+2) < 1)

2342 i‡(
	`âUSHORT
(
d©a
+8) != 1)

2345 
Àngth
 = 
	`âUSHORT
(
d©a
+10);

2346 i‡(
èbÀ_Àngth
 < 
Àngth
)

2347 
Àngth
 = 
èbÀ_Àngth
;

2349 
k
 = 0; k < 
Àngth
; k++)

2351 
èbÀ
[
k
].
glyph1
 = 
	`âUSHORT
(
d©a
+18+(k*6));

2352 
èbÀ
[
k
].
glyph2
 = 
	`âUSHORT
(
d©a
+20+(k*6));

2353 
èbÀ
[
k
].
adv™˚
 = 
	`âSHORT
(
d©a
+22+(k*6));

2356  
Àngth
;

2357 
	}
}

2359 
	$°bâ__GëGlyphKînInfoAdv™˚
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph1
, 
glyph2
)

2361 
°bâ_uöt8
 *
d©a
 = 
öfo
->d©®+ info->
kîn
;

2362 
°bâ_uöt32
 
√edÀ
, 
°øw
;

2363 
l
, 
r
, 
m
;

2366 i‡(!
öfo
->
kîn
)

2368 i‡(
	`âUSHORT
(
d©a
+2) < 1)

2370 i‡(
	`âUSHORT
(
d©a
+8) != 1)

2373 
l
 = 0;

2374 
r
 = 
	`âUSHORT
(
d©a
+10) - 1;

2375 
√edÀ
 = 
glyph1
 << 16 | 
glyph2
;

2376 
l
 <
r
) {

2377 
m
 = (
l
 + 
r
) >> 1;

2378 
°øw
 = 
	`âULONG
(
d©a
+18+(
m
*6));

2379 i‡(
√edÀ
 < 
°øw
)

2380 
r
 = 
m
 - 1;

2381 i‡(
√edÀ
 > 
°øw
)

2382 
l
 = 
m
 + 1;

2384  
	`âSHORT
(
d©a
+22+(
m
*6));

2387 
	}
}

2389 
°bâ_öt32
 
	$°bâ__GëCovîageIndex
(
°bâ_uöt8
 *
covîageTabÀ
, 
glyph
)

2391 
°bâ_uöt16
 
covîageF‹m©
 = 
	`âUSHORT
(
covîageTabÀ
);

2392 
covîageF‹m©
) {

2394 
°bâ_uöt16
 
glyphCou¡
 = 
	`âUSHORT
(
covîageTabÀ
 + 2);

2397 
°bâ_öt32
 
l
=0, 
r
=
glyphCou¡
-1, 
m
;

2398 
°øw
, 
√edÀ
=
glyph
;

2399 
l
 <
r
) {

2400 
°bâ_uöt8
 *
glyphAºay
 = 
covîageTabÀ
 + 4;

2401 
°bâ_uöt16
 
glyphID
;

2402 
m
 = (
l
 + 
r
) >> 1;

2403 
glyphID
 = 
	`âUSHORT
(
glyphAºay
 + 2 * 
m
);

2404 
°øw
 = 
glyphID
;

2405 i‡(
√edÀ
 < 
°øw
)

2406 
r
 = 
m
 - 1;

2407 i‡(
√edÀ
 > 
°øw
)

2408 
l
 = 
m
 + 1;

2410  
m
;

2417 
°bâ_uöt16
 
øngeCou¡
 = 
	`âUSHORT
(
covîageTabÀ
 + 2);

2418 
°bâ_uöt8
 *
øngeAºay
 = 
covîageTabÀ
 + 4;

2421 
°bâ_öt32
 
l
=0, 
r
=
øngeCou¡
-1, 
m
;

2422 
°øwSèπ
, 
°øwEnd
, 
√edÀ
=
glyph
;

2423 
l
 <
r
) {

2424 
°bâ_uöt8
 *
øngeRec‹d
;

2425 
m
 = (
l
 + 
r
) >> 1;

2426 
øngeRec‹d
 = 
øngeAºay
 + 6 * 
m
;

2427 
°øwSèπ
 = 
	`âUSHORT
(
øngeRec‹d
);

2428 
°øwEnd
 = 
	`âUSHORT
(
øngeRec‹d
 + 2);

2429 i‡(
√edÀ
 < 
°øwSèπ
)

2430 
r
 = 
m
 - 1;

2431 i‡(
√edÀ
 > 
°øwEnd
)

2432 
l
 = 
m
 + 1;

2434 
°bâ_uöt16
 
°¨tCovîageIndex
 = 
	`âUSHORT
(
øngeRec‹d
 + 4);

2435  
°¨tCovîageIndex
 + 
glyph
 - 
°øwSèπ
;

2445 
	}
}

2447 
°bâ_öt32
 
	$°bâ__GëGlyphCœss
(
°bâ_uöt8
 *
˛assDefTabÀ
, 
glyph
)

2449 
°bâ_uöt16
 
˛assDefF‹m©
 = 
	`âUSHORT
(
˛assDefTabÀ
);

2450 
˛assDefF‹m©
)

2453 
°bâ_uöt16
 
°¨tGlyphID
 = 
	`âUSHORT
(
˛assDefTabÀ
 + 2);

2454 
°bâ_uöt16
 
glyphCou¡
 = 
	`âUSHORT
(
˛assDefTabÀ
 + 4);

2455 
°bâ_uöt8
 *
˛assDef1VÆueAºay
 = 
˛assDefTabÀ
 + 6;

2457 i‡(
glyph
 >
°¨tGlyphID
 && glyph < sèπGlyphID + 
glyphCou¡
)

2458  (
°bâ_öt32
)
	`âUSHORT
(
˛assDef1VÆueAºay
 + 2 * (
glyph
 - 
°¨tGlyphID
));

2463 
°bâ_uöt16
 
˛assR™geCou¡
 = 
	`âUSHORT
(
˛assDefTabÀ
 + 2);

2464 
°bâ_uöt8
 *
˛assR™geRec‹ds
 = 
˛assDefTabÀ
 + 4;

2467 
°bâ_öt32
 
l
=0, 
r
=
˛assR™geCou¡
-1, 
m
;

2468 
°øwSèπ
, 
°øwEnd
, 
√edÀ
=
glyph
;

2469 
l
 <
r
) {

2470 
°bâ_uöt8
 *
˛assR™geRec‹d
;

2471 
m
 = (
l
 + 
r
) >> 1;

2472 
˛assR™geRec‹d
 = 
˛assR™geRec‹ds
 + 6 * 
m
;

2473 
°øwSèπ
 = 
	`âUSHORT
(
˛assR™geRec‹d
);

2474 
°øwEnd
 = 
	`âUSHORT
(
˛assR™geRec‹d
 + 2);

2475 i‡(
√edÀ
 < 
°øwSèπ
)

2476 
r
 = 
m
 - 1;

2477 i‡(
√edÀ
 > 
°øwEnd
)

2478 
l
 = 
m
 + 1;

2480  (
°bâ_öt32
)
	`âUSHORT
(
˛assR™geRec‹d
 + 4);

2491 
	}
}

2494 
	#STBTT_GPOS_TODO_as£π
(
x
)

	)

2496 
°bâ_öt32
 
	$°bâ__GëGlyphGPOSInfoAdv™˚
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
glyph1
, 
glyph2
)

2498 
°bâ_uöt16
 
lookupLi°Off£t
;

2499 
°bâ_uöt8
 *
lookupLi°
;

2500 
°bâ_uöt16
 
lookupCou¡
;

2501 
°bâ_uöt8
 *
d©a
;

2502 
°bâ_öt32
 
i
, 
°i
;

2504 i‡(!
öfo
->
gpos
)  0;

2506 
d©a
 = 
öfo
->d©®+ info->
gpos
;

2508 i‡(
	`âUSHORT
(
d©a
+0) != 1)  0;

2509 i‡(
	`âUSHORT
(
d©a
+2) != 0)  0;

2511 
lookupLi°Off£t
 = 
	`âUSHORT
(
d©a
+8);

2512 
lookupLi°
 = 
d©a
 + 
lookupLi°Off£t
;

2513 
lookupCou¡
 = 
	`âUSHORT
(
lookupLi°
);

2515 
i
=0; i<
lookupCou¡
; ++i) {

2516 
°bâ_uöt16
 
lookupOff£t
 = 
	`âUSHORT
(
lookupLi°
 + 2 + 2 * 
i
);

2517 
°bâ_uöt8
 *
lookupTabÀ
 = 
lookupLi°
 + 
lookupOff£t
;

2519 
°bâ_uöt16
 
lookupTy≥
 = 
	`âUSHORT
(
lookupTabÀ
);

2520 
°bâ_uöt16
 
subTabÀCou¡
 = 
	`âUSHORT
(
lookupTabÀ
 + 4);

2521 
°bâ_uöt8
 *
subTabÀOff£ts
 = 
lookupTabÀ
 + 6;

2522 i‡(
lookupTy≥
 != 2)

2525 
°i
=0; sti<
subTabÀCou¡
; sti++) {

2526 
°bâ_uöt16
 
subèbÀOff£t
 = 
	`âUSHORT
(
subTabÀOff£ts
 + 2 * 
°i
);

2527 
°bâ_uöt8
 *
èbÀ
 = 
lookupTabÀ
 + 
subèbÀOff£t
;

2528 
°bâ_uöt16
 
posF‹m©
 = 
	`âUSHORT
(
èbÀ
);

2529 
°bâ_uöt16
 
covîageOff£t
 = 
	`âUSHORT
(
èbÀ
 + 2);

2530 
°bâ_öt32
 
covîageIndex
 = 
	`°bâ__GëCovîageIndex
(
èbÀ
 + 
covîageOff£t
, 
glyph1
);

2531 i‡(
covîageIndex
 == -1) ;

2533 
posF‹m©
) {

2535 
°bâ_öt32
 
l
, 
r
, 
m
;

2536 
°øw
, 
√edÀ
;

2537 
°bâ_uöt16
 
vÆueF‹m©1
 = 
	`âUSHORT
(
èbÀ
 + 4);

2538 
°bâ_uöt16
 
vÆueF‹m©2
 = 
	`âUSHORT
(
èbÀ
 + 6);

2539 i‡(
vÆueF‹m©1
 =4 && 
vÆueF‹m©2
 == 0) {

2540 
°bâ_öt32
 
vÆueRec‹dPaúSizeInByãs
 = 2;

2541 
°bâ_uöt16
 
∑úSëCou¡
 = 
	`âUSHORT
(
èbÀ
 + 8);

2542 
°bâ_uöt16
 
∑úPosOff£t
 = 
	`âUSHORT
(
èbÀ
 + 10 + 2 * 
covîageIndex
);

2543 
°bâ_uöt8
 *
∑úVÆueTabÀ
 = 
èbÀ
 + 
∑úPosOff£t
;

2544 
°bâ_uöt16
 
∑úVÆueCou¡
 = 
	`âUSHORT
(
∑úVÆueTabÀ
);

2545 
°bâ_uöt8
 *
∑úVÆueAºay
 = 
∑úVÆueTabÀ
 + 2;

2547 i‡(
covîageIndex
 >
∑úSëCou¡
)  0;

2549 
√edÀ
=
glyph2
;

2550 
r
=
∑úVÆueCou¡
-1;

2551 
l
=0;

2554 
l
 <
r
) {

2555 
°bâ_uöt16
 
£c⁄dGlyph
;

2556 
°bâ_uöt8
 *
∑úVÆue
;

2557 
m
 = (
l
 + 
r
) >> 1;

2558 
∑úVÆue
 = 
∑úVÆueAºay
 + (2 + 
vÆueRec‹dPaúSizeInByãs
Ë* 
m
;

2559 
£c⁄dGlyph
 = 
	`âUSHORT
(
∑úVÆue
);

2560 
°øw
 = 
£c⁄dGlyph
;

2561 i‡(
√edÀ
 < 
°øw
)

2562 
r
 = 
m
 - 1;

2563 i‡(
√edÀ
 > 
°øw
)

2564 
l
 = 
m
 + 1;

2566 
°bâ_öt16
 
xAdv™˚
 = 
	`âSHORT
(
∑úVÆue
 + 2);

2567  
xAdv™˚
;

2576 
°bâ_uöt16
 
vÆueF‹m©1
 = 
	`âUSHORT
(
èbÀ
 + 4);

2577 
°bâ_uöt16
 
vÆueF‹m©2
 = 
	`âUSHORT
(
èbÀ
 + 6);

2578 i‡(
vÆueF‹m©1
 =4 && 
vÆueF‹m©2
 == 0) {

2579 
°bâ_uöt16
 
˛assDef1Off£t
 = 
	`âUSHORT
(
èbÀ
 + 8);

2580 
°bâ_uöt16
 
˛assDef2Off£t
 = 
	`âUSHORT
(
èbÀ
 + 10);

2581 
glyph1˛ass
 = 
	`°bâ__GëGlyphCœss
(
èbÀ
 + 
˛assDef1Off£t
, 
glyph1
);

2582 
glyph2˛ass
 = 
	`°bâ__GëGlyphCœss
(
èbÀ
 + 
˛assDef2Off£t
, 
glyph2
);

2584 
°bâ_uöt16
 
˛ass1Cou¡
 = 
	`âUSHORT
(
èbÀ
 + 12);

2585 
°bâ_uöt16
 
˛ass2Cou¡
 = 
	`âUSHORT
(
èbÀ
 + 14);

2586 
°bâ_uöt8
 *
˛ass1Rec‹ds
, *
˛ass2Rec‹ds
;

2587 
°bâ_öt16
 
xAdv™˚
;

2589 i‡(
glyph1˛ass
 < 0 || glyph1˛as†>
˛ass1Cou¡
)  0;

2590 i‡(
glyph2˛ass
 < 0 || glyph2˛as†>
˛ass2Cou¡
)  0;

2592 
˛ass1Rec‹ds
 = 
èbÀ
 + 16;

2593 
˛ass2Rec‹ds
 = 
˛ass1Rec‹ds
 + 2 * (
glyph1˛ass
 * 
˛ass2Cou¡
);

2594 
xAdv™˚
 = 
	`âSHORT
(
˛ass2Rec‹ds
 + 2 * 
glyph2˛ass
);

2595  
xAdv™˚
;

2608 
	}
}

2610 
STBTT_DEF
 
	$°bâ_GëGlyphKînAdv™˚
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
g1
, 
g2
)

2612 
xAdv™˚
 = 0;

2614 i‡(
öfo
->
gpos
)

2615 
xAdv™˚
 +
	`°bâ__GëGlyphGPOSInfoAdv™˚
(
öfo
, 
g1
, 
g2
);

2616 i‡(
öfo
->
kîn
)

2617 
xAdv™˚
 +
	`°bâ__GëGlyphKînInfoAdv™˚
(
öfo
, 
g1
, 
g2
);

2619  
xAdv™˚
;

2620 
	}
}

2622 
STBTT_DEF
 
	$°bâ_GëCodïoötKînAdv™˚
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
ch1
, 
ch2
)

2624 i‡(!
öfo
->
kîn
 && !öfo->
gpos
)

2626  
	`°bâ_GëGlyphKînAdv™˚
(
öfo
, 
	`°bâ_FödGlyphIndex
(öfo,
ch1
), stbâ_FödGlyphIndex(öfo,
ch2
));

2627 
	}
}

2629 
STBTT_DEF
 
	$°bâ_GëCodïoötHMërics
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
codïoöt
, *
adv™˚Width
, *
À·SideBórög
)

2631 
	`°bâ_GëGlyphHMërics
(
öfo
, 
	`°bâ_FödGlyphIndex
(öfo,
codïoöt
), 
adv™˚Width
, 
À·SideBórög
);

2632 
	}
}

2634 
STBTT_DEF
 
	$°bâ_GëF⁄tVMërics
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
as˚¡
, *
des˚¡
, *
löeG≠
)

2636 i‡(
as˚¡
 ) *as˚¡ = 
	`âSHORT
(
öfo
->
d©a
+öfo->
hhó
 + 4);

2637 i‡(
des˚¡
Ë*des˚¡ = 
	`âSHORT
(
öfo
->
d©a
+öfo->
hhó
 + 6);

2638 i‡(
löeG≠
Ë*löeG≠ = 
	`âSHORT
(
öfo
->
d©a
+öfo->
hhó
 + 8);

2639 
	}
}

2641 
STBTT_DEF
 
	$°bâ_GëF⁄tVMëricsOS2
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
typoAs˚¡
, *
typoDes˚¡
, *
typoLöeG≠
)

2643 
èb
 = 
	`°bâ__föd_èbÀ
(
öfo
->
d©a
, info->
f⁄t°¨t
, "OS/2");

2644 i‡(!
èb
)

2646 i‡(
typoAs˚¡
 ) *typoAs˚¡ = 
	`âSHORT
(
öfo
->
d©a
+
èb
 + 68);

2647 i‡(
typoDes˚¡
Ë*typoDes˚¡ = 
	`âSHORT
(
öfo
->
d©a
+
èb
 + 70);

2648 i‡(
typoLöeG≠
Ë*typoLöeG≠ = 
	`âSHORT
(
öfo
->
d©a
+
èb
 + 72);

2650 
	}
}

2652 
STBTT_DEF
 
	$°bâ_GëF⁄tBoundögBox
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
x0
, *
y0
, *
x1
, *
y1
)

2654 *
x0
 = 
	`âSHORT
(
öfo
->
d©a
 + info->
hód
 + 36);

2655 *
y0
 = 
	`âSHORT
(
öfo
->
d©a
 + info->
hód
 + 38);

2656 *
x1
 = 
	`âSHORT
(
öfo
->
d©a
 + info->
hód
 + 40);

2657 *
y1
 = 
	`âSHORT
(
öfo
->
d©a
 + info->
hód
 + 42);

2658 
	}
}

2660 
STBTT_DEF
 
	$°bâ_SˇÀF‹PixñHeight
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
height
)

2662 
fheight
 = 
	`âSHORT
(
öfo
->
d©a
 + info->
hhó
 + 4) -ÅtSHORT(info->data + info->hhea + 6);

2663  (Ë
height
 / 
fheight
;

2664 
	}
}

2666 
STBTT_DEF
 
	$°bâ_SˇÀF‹M≠pögEmToPixñs
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
pixñs
)

2668 
unôsPîEm
 = 
	`âUSHORT
(
öfo
->
d©a
 + info->
hód
 + 18);

2669  
pixñs
 / 
unôsPîEm
;

2670 
	}
}

2672 
STBTT_DEF
 
	$°bâ_FªeSh≠e
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
°bâ_vîãx
 *
v
)

2674 
	`STBTT_‰ì
(
v
, 
öfo
->
u£rd©a
);

2675 
	}
}

2677 
STBTT_DEF
 
°bâ_uöt8
 *
	$°bâ_FödSVGDoc
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
gl
)

2679 
i
;

2680 
°bâ_uöt8
 *
d©a
 = 
öfo
->data;

2681 
°bâ_uöt8
 *
svg_doc_li°
 = 
d©a
 + 
	`°bâ__gë_svg
((
°bâ_f⁄töfo
 *Ë
öfo
);

2683 
numE¡rõs
 = 
	`âUSHORT
(
svg_doc_li°
);

2684 
°bâ_uöt8
 *
svg_docs
 = 
svg_doc_li°
 + 2;

2686 
i
=0; i<
numE¡rõs
; i++) {

2687 
°bâ_uöt8
 *
svg_doc
 = 
svg_docs
 + (12 * 
i
);

2688 i‡((
gl
 >
	`âUSHORT
(
svg_doc
)) && (gl <=ÅtUSHORT(svg_doc + 2)))

2689  
svg_doc
;

2692 
	}
}

2694 
STBTT_DEF
 
	$°bâ_GëGlyphSVG
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
gl
, c⁄° **
svg
)

2696 
°bâ_uöt8
 *
d©a
 = 
öfo
->data;

2697 
°bâ_uöt8
 *
svg_doc
;

2699 i‡(
öfo
->
svg
 == 0)

2702 
svg_doc
 = 
	`°bâ_FödSVGDoc
(
öfo
, 
gl
);

2703 i‡(
svg_doc
 !
NULL
) {

2704 *
svg
 = (*Ë
d©a
 + 
öfo
->svg + 
	`âULONG
(
svg_doc
 + 4);

2705  
	`âULONG
(
svg_doc
 + 8);

2709 
	}
}

2711 
STBTT_DEF
 
	$°bâ_GëCodïoötSVG
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
unicode_codïoöt
, c⁄° **
svg
)

2713  
	`°bâ_GëGlyphSVG
(
öfo
, 
	`°bâ_FödGlyphIndex
(öfo, 
unicode_codïoöt
), 
svg
);

2714 
	}
}

2721 
STBTT_DEF
 
	$°bâ_GëGlyphBôm≠BoxSubpixñ
(c⁄° 
°bâ_f⁄töfo
 *
f⁄t
, 
glyph
, 
sˇÀ_x
, 
sˇÀ_y
,
shi·_x
, 
shi·_y
, *
ix0
, *
iy0
, *
ix1
, *
iy1
)

2723 
x0
=0,
y0
=0,
x1
,
y1
;

2724 i‡(!
	`°bâ_GëGlyphBox
(
f⁄t
, 
glyph
, &
x0
,&
y0
,&
x1
,&
y1
)) {

2726 i‡(
ix0
) *ix0 = 0;

2727 i‡(
iy0
) *iy0 = 0;

2728 i‡(
ix1
) *ix1 = 0;

2729 i‡(
iy1
) *iy1 = 0;

2732 i‡(
ix0
Ë*ix0 = 
	`STBTT_iÊo‹
–
x0
 * 
sˇÀ_x
 + 
shi·_x
);

2733 i‡(
iy0
Ë*iy0 = 
	`STBTT_iÊo‹
(-
y1
 * 
sˇÀ_y
 + 
shi·_y
);

2734 i‡(
ix1
Ë*ix1 = 
	`STBTT_i˚û
 ( 
x1
 * 
sˇÀ_x
 + 
shi·_x
);

2735 i‡(
iy1
Ë*iy1 = 
	`STBTT_i˚û
 (-
y0
 * 
sˇÀ_y
 + 
shi·_y
);

2737 
	}
}

2739 
STBTT_DEF
 
	$°bâ_GëGlyphBôm≠Box
(c⁄° 
°bâ_f⁄töfo
 *
f⁄t
, 
glyph
, 
sˇÀ_x
, 
sˇÀ_y
, *
ix0
, *
iy0
, *
ix1
, *
iy1
)

2741 
	`°bâ_GëGlyphBôm≠BoxSubpixñ
(
f⁄t
, 
glyph
, 
sˇÀ_x
, 
sˇÀ_y
,0.0f,0.0f, 
ix0
, 
iy0
, 
ix1
, 
iy1
);

2742 
	}
}

2744 
STBTT_DEF
 
	$°bâ_GëCodïoötBôm≠BoxSubpixñ
(c⁄° 
°bâ_f⁄töfo
 *
f⁄t
, 
codïoöt
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, *
ix0
, *
iy0
, *
ix1
, *
iy1
)

2746 
	`°bâ_GëGlyphBôm≠BoxSubpixñ
(
f⁄t
, 
	`°bâ_FödGlyphIndex
(f⁄t,
codïoöt
), 
sˇÀ_x
, 
sˇÀ_y
,
shi·_x
,
shi·_y
, 
ix0
,
iy0
,
ix1
,
iy1
);

2747 
	}
}

2749 
STBTT_DEF
 
	$°bâ_GëCodïoötBôm≠Box
(c⁄° 
°bâ_f⁄töfo
 *
f⁄t
, 
codïoöt
, 
sˇÀ_x
, 
sˇÀ_y
, *
ix0
, *
iy0
, *
ix1
, *
iy1
)

2751 
	`°bâ_GëCodïoötBôm≠BoxSubpixñ
(
f⁄t
, 
codïoöt
, 
sˇÀ_x
, 
sˇÀ_y
,0.0f,0.0f, 
ix0
,
iy0
,
ix1
,
iy1
);

2752 
	}
}

2758 
	s°bâ__hhóp_chunk


2760 
°bâ__hhóp_chunk
 *
	m√xt
;

2761 } 
	t°bâ__hhóp_chunk
;

2763 
	s°bâ__hhóp


2765 
°bâ__hhóp_chunk
 *
	mhód
;

2766 *
	mfú°_‰ì
;

2767 
	mnum_ªmaöög_ö_hód_chunk
;

2768 } 
	t°bâ__hhóp
;

2770 *
	$°bâ__hhóp_Æloc
(
°bâ__hhóp
 *
hh
, 
size_t
 
size
, *
u£rd©a
)

2772 i‡(
hh
->
fú°_‰ì
) {

2773 *
p
 = 
hh
->
fú°_‰ì
;

2774 
hh
->
fú°_‰ì
 = * (**Ë
p
;

2775  
p
;

2777 i‡(
hh
->
num_ªmaöög_ö_hód_chunk
 == 0) {

2778 
cou¡
 = (
size
 < 32 ? 2000 : size < 128 ? 800 : 100);

2779 
°bâ__hhóp_chunk
 *
c
 = (°bâ__hhóp_chunk *Ë
	`STBTT_mÆloc
((°bâ__hhóp_chunkË+ 
size
 * 
cou¡
, 
u£rd©a
);

2780 i‡(
c
 =
NULL
)

2781  
NULL
;

2782 
c
->
√xt
 = 
hh
->
hód
;

2783 
hh
->
hód
 = 
c
;

2784 
hh
->
num_ªmaöög_ö_hód_chunk
 = 
cou¡
;

2786 --
hh
->
num_ªmaöög_ö_hód_chunk
;

2787  (*Ë(
hh
->
hód
Ë+ (
°bâ__hhóp_chunk
Ë+ 
size
 * hh->
num_ªmaöög_ö_hód_chunk
;

2789 
	}
}

2791 
	$°bâ__hhóp_‰ì
(
°bâ__hhóp
 *
hh
, *
p
)

2793 *(**Ë
p
 = 
hh
->
fú°_‰ì
;

2794 
hh
->
fú°_‰ì
 = 
p
;

2795 
	}
}

2797 
	$°bâ__hhóp_˛ónup
(
°bâ__hhóp
 *
hh
, *
u£rd©a
)

2799 
°bâ__hhóp_chunk
 *
c
 = 
hh
->
hód
;

2800 
c
) {

2801 
°bâ__hhóp_chunk
 *
n
 = 
c
->
√xt
;

2802 
	`STBTT_‰ì
(
c
, 
u£rd©a
);

2803 
c
 = 
n
;

2805 
	}
}

2807 
	s°bâ__edge
 {

2808 
	mx0
,
	my0
, 
	mx1
,
	my1
;

2809 
	mövît
;

2810 } 
	t°bâ__edge
;

2813 
	s°bâ__a˘ive_edge


2815 
°bâ__a˘ive_edge
 *
	m√xt
;

2816 #i‡
STBTT_RASTERIZER_VERSION
==1

2817 
	mx
,
	mdx
;

2818 
	mey
;

2819 
	mdúe˘i⁄
;

2820 #ñi‡
STBTT_RASTERIZER_VERSION
==2

2821 
	mfx
,
	mfdx
,
	mfdy
;

2822 
	mdúe˘i⁄
;

2823 
	msy
;

2824 
	mey
;

2828 } 
	t°bâ__a˘ive_edge
;

2830 #i‡
STBTT_RASTERIZER_VERSION
 == 1

2831 
	#STBTT_FIXSHIFT
 10

	)

2832 
	#STBTT_FIX
 (1 << 
STBTT_FIXSHIFT
)

	)

2833 
	#STBTT_FIXMASK
 (
STBTT_FIX
-1)

	)

2835 
°bâ__a˘ive_edge
 *
	$°bâ__√w_a˘ive
(
°bâ__hhóp
 *
hh
, 
°bâ__edge
 *
e
, 
off_x
, 
°¨t_poöt
, *
u£rd©a
)

2837 
°bâ__a˘ive_edge
 *
z
 = (°bâ__a˘ive_edgê*Ë
	`°bâ__hhóp_Æloc
(
hh
, (*z), 
u£rd©a
);

2838 
dxdy
 = (
e
->
x1
 -É->
x0
Ë/ (e->
y1
 -É->
y0
);

2839 
	`STBTT_as£π
(
z
 !
NULL
);

2840 i‡(!
z
)  z;

2843 i‡(
dxdy
 < 0)

2844 
z
->
dx
 = -
	`STBTT_iÊo‹
(
STBTT_FIX
 * -
dxdy
);

2846 
z
->
dx
 = 
	`STBTT_iÊo‹
(
STBTT_FIX
 * 
dxdy
);

2848 
z
->
x
 = 
	`STBTT_iÊo‹
(
STBTT_FIX
 * 
e
->
x0
 + z->
dx
 * (
°¨t_poöt
 -É->
y0
));

2849 
z
->
x
 -
off_x
 * 
STBTT_FIX
;

2851 
z
->
ey
 = 
e
->
y1
;

2852 
z
->
√xt
 = 0;

2853 
z
->
dúe˘i⁄
 = 
e
->
övît
 ? 1 : -1;

2854  
z
;

2855 
	}
}

2856 #ñi‡
STBTT_RASTERIZER_VERSION
 == 2

2857 
°bâ__a˘ive_edge
 *
	$°bâ__√w_a˘ive
(
°bâ__hhóp
 *
hh
, 
°bâ__edge
 *
e
, 
off_x
, 
°¨t_poöt
, *
u£rd©a
)

2859 
°bâ__a˘ive_edge
 *
z
 = (°bâ__a˘ive_edgê*Ë
	`°bâ__hhóp_Æloc
(
hh
, (*z), 
u£rd©a
);

2860 
dxdy
 = (
e
->
x1
 -É->
x0
Ë/ (e->
y1
 -É->
y0
);

2861 
	`STBTT_as£π
(
z
 !
NULL
);

2863 i‡(!
z
)  z;

2864 
z
->
fdx
 = 
dxdy
;

2865 
z
->
fdy
 = 
dxdy
 != 0.0f ? (1.0f/dxdy) : 0.0f;

2866 
z
->
fx
 = 
e
->
x0
 + 
dxdy
 * (
°¨t_poöt
 -É->
y0
);

2867 
z
->
fx
 -
off_x
;

2868 
z
->
dúe˘i⁄
 = 
e
->
övît
 ? 1.0f : -1.0f;

2869 
z
->
sy
 = 
e
->
y0
;

2870 
z
->
ey
 = 
e
->
y1
;

2871 
z
->
√xt
 = 0;

2872  
z
;

2873 
	}
}

2878 #i‡
STBTT_RASTERIZER_VERSION
 == 1

2882 
	$°bâ__fûl_a˘ive_edges
(*
sˇ∆öe
, 
Àn
, 
°bâ__a˘ive_edge
 *
e
, 
max_weight
)

2885 
x0
=0, 
w
=0;

2887 
e
) {

2888 i‡(
w
 == 0) {

2890 
x0
 = 
e
->
x
; 
w
 +e->
dúe˘i⁄
;

2892 
x1
 = 
e
->
x
; 
w
 +e->
dúe˘i⁄
;

2894 i‡(
w
 == 0) {

2895 
i
 = 
x0
 >> 
STBTT_FIXSHIFT
;

2896 
j
 = 
x1
 >> 
STBTT_FIXSHIFT
;

2898 i‡(
i
 < 
Àn
 && 
j
 >= 0) {

2899 i‡(
i
 =
j
) {

2901 
sˇ∆öe
[
i
] = sˇ∆öe[i] + (
°bâ_uöt8
Ë((
x1
 - 
x0
Ë* 
max_weight
 >> 
STBTT_FIXSHIFT
);

2903 i‡(
i
 >= 0)

2904 
sˇ∆öe
[
i
] = sˇ∆öe[i] + (
°bâ_uöt8
Ë(((
STBTT_FIX
 - (
x0
 & 
STBTT_FIXMASK
)Ë* 
max_weight
Ë>> 
STBTT_FIXSHIFT
);

2906 
i
 = -1;

2908 i‡(
j
 < 
Àn
)

2909 
sˇ∆öe
[
j
] = sˇ∆öe[j] + (
°bâ_uöt8
Ë(((
x1
 & 
STBTT_FIXMASK
Ë* 
max_weight
Ë>> 
STBTT_FIXSHIFT
);

2911 
j
 = 
Àn
;

2913 ++
i
; i < 
j
; ++i)

2914 
sˇ∆öe
[
i
] = sˇ∆öe[i] + (
°bâ_uöt8
Ë
max_weight
;

2920 
e
 =É->
√xt
;

2922 
	}
}

2924 
	$°bâ__ø°îize_s‹ãd_edges
(
°bâ__bôm≠
 *
ªsu…
, 
°bâ__edge
 *
e
, 
n
, 
vsubßm∂e
, 
off_x
, 
off_y
, *
u£rd©a
)

2926 
°bâ__hhóp
 
hh
 = { 0, 0, 0 };

2927 
°bâ__a˘ive_edge
 *
a˘ive
 = 
NULL
;

2928 
y
,
j
=0;

2929 
max_weight
 = (255 / 
vsubßm∂e
);

2930 
s
;

2931 
sˇ∆öe_d©a
[512], *
sˇ∆öe
;

2933 i‡(
ªsu…
->
w
 > 512)

2934 
sˇ∆öe
 = (*Ë
	`STBTT_mÆloc
(
ªsu…
->
w
, 
u£rd©a
);

2936 
sˇ∆öe
 = 
sˇ∆öe_d©a
;

2938 
y
 = 
off_y
 * 
vsubßm∂e
;

2939 
e
[
n
].
y0
 = (
off_y
 + 
ªsu…
->
h
Ë* (Ë
vsubßm∂e
 + 1;

2941 
j
 < 
ªsu…
->
h
) {

2942 
	`STBTT_mem£t
(
sˇ∆öe
, 0, 
ªsu…
->
w
);

2943 
s
=0; s < 
vsubßm∂e
; ++s) {

2945 
sˇn_y
 = 
y
 + 0.5f;

2946 
°bâ__a˘ive_edge
 **
°ï
 = &
a˘ive
;

2950 *
°ï
) {

2951 
°bâ__a˘ive_edge
 * 
z
 = *
°ï
;

2952 i‡(
z
->
ey
 <
sˇn_y
) {

2953 *
°ï
 = 
z
->
√xt
;

2954 
	`STBTT_as£π
(
z
->
dúe˘i⁄
);

2955 
z
->
dúe˘i⁄
 = 0;

2956 
	`°bâ__hhóp_‰ì
(&
hh
, 
z
);

2958 
z
->
x
 +z->
dx
;

2959 
°ï
 = &((*°ï)->
√xt
);

2965 
ch™ged
=0;

2966 
°ï
 = &
a˘ive
;

2967 *
°ï
 && (*°ï)->
√xt
) {

2968 i‡((*
°ï
)->
x
 > (*°ï)->
√xt
->x) {

2969 
°bâ__a˘ive_edge
 *
t
 = *
°ï
;

2970 
°bâ__a˘ive_edge
 *
q
 = 
t
->
√xt
;

2972 
t
->
√xt
 = 
q
->next;

2973 
q
->
√xt
 = 
t
;

2974 *
°ï
 = 
q
;

2975 
ch™ged
 = 1;

2977 
°ï
 = &(*°ï)->
√xt
;

2979 i‡(!
ch™ged
) ;

2983 
e
->
y0
 <
sˇn_y
) {

2984 i‡(
e
->
y1
 > 
sˇn_y
) {

2985 
°bâ__a˘ive_edge
 *
z
 = 
	`°bâ__√w_a˘ive
(&
hh
, 
e
, 
off_x
, 
sˇn_y
, 
u£rd©a
);

2986 i‡(
z
 !
NULL
) {

2988 i‡(
a˘ive
 =
NULL
)

2989 
a˘ive
 = 
z
;

2990 i‡(
z
->
x
 < 
a˘ive
->x) {

2992 
z
->
√xt
 = 
a˘ive
;

2993 
a˘ive
 = 
z
;

2996 
°bâ__a˘ive_edge
 *
p
 = 
a˘ive
;

2997 
p
->
√xt
 &&Ö->√xt->
x
 < 
z
->x)

2998 
p
 =Ö->
√xt
;

3000 
z
->
√xt
 = 
p
->next;

3001 
p
->
√xt
 = 
z
;

3005 ++
e
;

3009 i‡(
a˘ive
)

3010 
	`°bâ__fûl_a˘ive_edges
(
sˇ∆öe
, 
ªsu…
->
w
, 
a˘ive
, 
max_weight
);

3012 ++
y
;

3014 
	`STBTT_mem˝y
(
ªsu…
->
pixñs
 + 
j
 *Ñesu…->
°ride
, 
sˇ∆öe
,Ñesu…->
w
);

3015 ++
j
;

3018 
	`°bâ__hhóp_˛ónup
(&
hh
, 
u£rd©a
);

3020 i‡(
sˇ∆öe
 !
sˇ∆öe_d©a
)

3021 
	`STBTT_‰ì
(
sˇ∆öe
, 
u£rd©a
);

3022 
	}
}

3024 #ñi‡
STBTT_RASTERIZER_VERSION
 == 2

3028 
	$°bâ__h™dÀ_˛ù≥d_edge
(*
sˇ∆öe
, 
x
, 
°bâ__a˘ive_edge
 *
e
, 
x0
, 
y0
, 
x1
, 
y1
)

3030 i‡(
y0
 =
y1
) ;

3031 
	`STBTT_as£π
(
y0
 < 
y1
);

3032 
	`STBTT_as£π
(
e
->
sy
 <e->
ey
);

3033 i‡(
y0
 > 
e
->
ey
) ;

3034 i‡(
y1
 < 
e
->
sy
) ;

3035 i‡(
y0
 < 
e
->
sy
) {

3036 
x0
 +(
x1
-x0Ë* (
e
->
sy
 - 
y0
Ë/ (
y1
-y0);

3037 
y0
 = 
e
->
sy
;

3039 i‡(
y1
 > 
e
->
ey
) {

3040 
x1
 +(x1-
x0
Ë* (
e
->
ey
 - 
y1
Ë/ (y1-
y0
);

3041 
y1
 = 
e
->
ey
;

3044 i‡(
x0
 =
x
)

3045 
	`STBTT_as£π
(
x1
 <
x
+1);

3046 i‡(
x0
 =
x
+1)

3047 
	`STBTT_as£π
(
x1
 >
x
);

3048 i‡(
x0
 <
x
)

3049 
	`STBTT_as£π
(
x1
 <
x
);

3050 i‡(
x0
 >
x
+1)

3051 
	`STBTT_as£π
(
x1
 >
x
+1);

3053 
	`STBTT_as£π
(
x1
 >
x
 && x1 <= x+1);

3055 i‡(
x0
 <
x
 && 
x1
 <= x)

3056 
sˇ∆öe
[
x
] +
e
->
dúe˘i⁄
 * (
y1
-
y0
);

3057 i‡(
x0
 >
x
+1 && 
x1
 >= x+1)

3060 
	`STBTT_as£π
(
x0
 >
x
 && x0 <x+1 && 
x1
 >= x && x1 <= x+1);

3061 
sˇ∆öe
[
x
] +
e
->
dúe˘i⁄
 * (
y1
-
y0
Ë* (1-((
x0
-x)+(
x1
-x))/2);

3063 
	}
}

3065 
	$°bâ__sized_å≠ezoid_¨ó
(
height
, 
t›_width
, 
bŸtom_width
)

3067 
	`STBTT_as£π
(
t›_width
 >= 0);

3068 
	`STBTT_as£π
(
bŸtom_width
 >= 0);

3069  (
t›_width
 + 
bŸtom_width
Ë/ 2.0‡* 
height
;

3070 
	}
}

3072 
	$°bâ__posôi⁄_å≠ezoid_¨ó
(
height
, 
tx0
, 
tx1
, 
bx0
, 
bx1
)

3074  
	`°bâ__sized_å≠ezoid_¨ó
(
height
, 
tx1
 - 
tx0
, 
bx1
 - 
bx0
);

3075 
	}
}

3077 
	$°bâ__sized_åüngÀ_¨ó
(
height
, 
width
)

3079  
height
 * 
width
 / 2;

3080 
	}
}

3082 
	$°bâ__fûl_a˘ive_edges_√w
(*
sˇ∆öe
, *
sˇ∆öe_fûl
, 
Àn
, 
°bâ__a˘ive_edge
 *
e
, 
y_t›
)

3084 
y_bŸtom
 = 
y_t›
+1;

3086 
e
) {

3090 
	`STBTT_as£π
(
e
->
ey
 >
y_t›
);

3092 i‡(
e
->
fdx
 == 0) {

3093 
x0
 = 
e
->
fx
;

3094 i‡(
x0
 < 
Àn
) {

3095 i‡(
x0
 >= 0) {

3096 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,(Ë
x0
,
e
, x0,
y_t›
, x0,
y_bŸtom
);

3097 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe_fûl
-1,(Ë
x0
+1,
e
, x0,
y_t›
, x0,
y_bŸtom
);

3099 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe_fûl
-1,0,
e
, 
x0
,
y_t›
, x0,
y_bŸtom
);

3103 
x0
 = 
e
->
fx
;

3104 
dx
 = 
e
->
fdx
;

3105 
xb
 = 
x0
 + 
dx
;

3106 
x_t›
, 
x_bŸtom
;

3107 
sy0
,
sy1
;

3108 
dy
 = 
e
->
fdy
;

3109 
	`STBTT_as£π
(
e
->
sy
 <
y_bŸtom
 &&É->
ey
 >
y_t›
);

3114 i‡(
e
->
sy
 > 
y_t›
) {

3115 
x_t›
 = 
x0
 + 
dx
 * (
e
->
sy
 - 
y_t›
);

3116 
sy0
 = 
e
->
sy
;

3118 
x_t›
 = 
x0
;

3119 
sy0
 = 
y_t›
;

3121 i‡(
e
->
ey
 < 
y_bŸtom
) {

3122 
x_bŸtom
 = 
x0
 + 
dx
 * (
e
->
ey
 - 
y_t›
);

3123 
sy1
 = 
e
->
ey
;

3125 
x_bŸtom
 = 
xb
;

3126 
sy1
 = 
y_bŸtom
;

3129 i‡(
x_t›
 >0 && 
x_bŸtom
 >0 && x_t› < 
Àn
 && x_bottom <Üen) {

3132 i‡((Ë
x_t›
 =(Ë
x_bŸtom
) {

3133 
height
;

3135 
x
 = (Ë
x_t›
;

3136 
height
 = (
sy1
 - 
sy0
Ë* 
e
->
dúe˘i⁄
;

3137 
	`STBTT_as£π
(
x
 >0 && x < 
Àn
);

3138 
sˇ∆öe
[
x
] +
	`°bâ__posôi⁄_å≠ezoid_¨ó
(
height
, 
x_t›
, x+1.0f, 
x_bŸtom
, x+1.0f);

3139 
sˇ∆öe_fûl
[
x
] +
height
;

3141 
x
,
x1
,
x2
;

3142 
y_¸ossög
, 
y_föÆ
, 
°ï
, 
sign
, 
¨ó
;

3144 i‡(
x_t›
 > 
x_bŸtom
) {

3146 
t
;

3147 
sy0
 = 
y_bŸtom
 - (sy0 - 
y_t›
);

3148 
sy1
 = 
y_bŸtom
 - (sy1 - 
y_t›
);

3149 
t
 = 
sy0
, sy0 = 
sy1
, sy1 =Å;

3150 
t
 = 
x_bŸtom
, x_bŸtom = 
x_t›
, x_top =Å;

3151 
dx
 = -dx;

3152 
dy
 = -dy;

3153 
t
 = 
x0
, x0 = 
xb
, xb =Å;

3155 
	`STBTT_as£π
(
dy
 >= 0);

3156 
	`STBTT_as£π
(
dx
 >= 0);

3158 
x1
 = (Ë
x_t›
;

3159 
x2
 = (Ë
x_bŸtom
;

3161 
y_¸ossög
 = 
y_t›
 + 
dy
 * (
x1
+1 - 
x0
);

3164 
y_föÆ
 = 
y_t›
 + 
dy
 * (
x2
 - 
x0
);

3185 i‡(
y_¸ossög
 > 
y_bŸtom
)

3186 
y_¸ossög
 = 
y_bŸtom
;

3188 
sign
 = 
e
->
dúe˘i⁄
;

3191 
¨ó
 = 
sign
 * (
y_¸ossög
-
sy0
);

3194 
sˇ∆öe
[
x1
] +
	`°bâ__sized_åüngÀ_¨ó
(
¨ó
, x1+1 - 
x_t›
);

3197 i‡(
y_föÆ
 > 
y_bŸtom
) {

3198 
y_föÆ
 = 
y_bŸtom
;

3199 
dy
 = (
y_föÆ
 - 
y_¸ossög
 ) / (
x2
 - (
x1
+1));

3212 
°ï
 = 
sign
 * 
dy
 * 1;

3216 
x
 = 
x1
+1; x < 
x2
; ++x) {

3217 
sˇ∆öe
[
x
] +
¨ó
 + 
°ï
/2;

3218 
¨ó
 +
°ï
;

3220 
	`STBTT_as£π
(
	`STBTT_Ábs
(
¨ó
) <= 1.01f);

3221 
	`STBTT_as£π
(
sy1
 > 
y_föÆ
-0.01f);

3225 
sˇ∆öe
[
x2
] +
¨ó
 + 
sign
 * 
	`°bâ__posôi⁄_å≠ezoid_¨ó
(
sy1
-
y_föÆ
, (Ëx2, x2+1.0f, 
x_bŸtom
, x2+1.0f);

3228 
sˇ∆öe_fûl
[
x2
] +
sign
 * (
sy1
-
sy0
);

3238 
x
;

3239 
x
=0; x < 
Àn
; ++x) {

3254 
y0
 = 
y_t›
;

3255 
x1
 = (Ë(
x
);

3256 
x2
 = (Ë(
x
+1);

3257 
x3
 = 
xb
;

3258 
y3
 = 
y_bŸtom
;

3263 
y1
 = (
x
 - 
x0
Ë/ 
dx
 + 
y_t›
;

3264 
y2
 = (
x
+1 - 
x0
Ë/ 
dx
 + 
y_t›
;

3266 i‡(
x0
 < 
x1
 && 
x3
 > 
x2
) {

3267 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x0
,
y0
, 
x1
,
y1
);

3268 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x1
,
y1
, 
x2
,
y2
);

3269 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x2
,
y2
, 
x3
,
y3
);

3270 } i‡(
x3
 < 
x1
 && 
x0
 > 
x2
) {

3271 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x0
,
y0
, 
x2
,
y2
);

3272 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x2
,
y2
, 
x1
,
y1
);

3273 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x1
,
y1
, 
x3
,
y3
);

3274 } i‡(
x0
 < 
x1
 && 
x3
 > x1) {

3275 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x0
,
y0
, 
x1
,
y1
);

3276 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x1
,
y1
, 
x3
,
y3
);

3277 } i‡(
x3
 < 
x1
 && 
x0
 > x1) {

3278 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x0
,
y0
, 
x1
,
y1
);

3279 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x1
,
y1
, 
x3
,
y3
);

3280 } i‡(
x0
 < 
x2
 && 
x3
 > x2) {

3281 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x0
,
y0
, 
x2
,
y2
);

3282 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x2
,
y2
, 
x3
,
y3
);

3283 } i‡(
x3
 < 
x2
 && 
x0
 > x2) {

3284 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x0
,
y0
, 
x2
,
y2
);

3285 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x2
,
y2
, 
x3
,
y3
);

3287 
	`°bâ__h™dÀ_˛ù≥d_edge
(
sˇ∆öe
,
x
,
e
, 
x0
,
y0
, 
x3
,
y3
);

3292 
e
 =É->
√xt
;

3294 
	}
}

3297 
	$°bâ__ø°îize_s‹ãd_edges
(
°bâ__bôm≠
 *
ªsu…
, 
°bâ__edge
 *
e
, 
n
, 
vsubßm∂e
, 
off_x
, 
off_y
, *
u£rd©a
)

3299 
°bâ__hhóp
 
hh
 = { 0, 0, 0 };

3300 
°bâ__a˘ive_edge
 *
a˘ive
 = 
NULL
;

3301 
y
,
j
=0, 
i
;

3302 
sˇ∆öe_d©a
[129], *
sˇ∆öe
, *
sˇ∆öe2
;

3304 
	`STBTT__NOTUSED
(
vsubßm∂e
);

3306 i‡(
ªsu…
->
w
 > 64)

3307 
sˇ∆öe
 = (*Ë
	`STBTT_mÆloc
((
ªsu…
->
w
*2+1Ë* (), 
u£rd©a
);

3309 
sˇ∆öe
 = 
sˇ∆öe_d©a
;

3311 
sˇ∆öe2
 = 
sˇ∆öe
 + 
ªsu…
->
w
;

3313 
y
 = 
off_y
;

3314 
e
[
n
].
y0
 = (Ë(
off_y
 + 
ªsu…
->
h
) + 1;

3316 
j
 < 
ªsu…
->
h
) {

3318 
sˇn_y_t›
 = 
y
 + 0.0f;

3319 
sˇn_y_bŸtom
 = 
y
 + 1.0f;

3320 
°bâ__a˘ive_edge
 **
°ï
 = &
a˘ive
;

3322 
	`STBTT_mem£t
(
sˇ∆öe
 , 0, 
ªsu…
->
w
*(scanline[0]));

3323 
	`STBTT_mem£t
(
sˇ∆öe2
, 0, (
ªsu…
->
w
+1)*(
sˇ∆öe
[0]));

3327 *
°ï
) {

3328 
°bâ__a˘ive_edge
 * 
z
 = *
°ï
;

3329 i‡(
z
->
ey
 <
sˇn_y_t›
) {

3330 *
°ï
 = 
z
->
√xt
;

3331 
	`STBTT_as£π
(
z
->
dúe˘i⁄
);

3332 
z
->
dúe˘i⁄
 = 0;

3333 
	`°bâ__hhóp_‰ì
(&
hh
, 
z
);

3335 
°ï
 = &((*°ï)->
√xt
);

3340 
e
->
y0
 <
sˇn_y_bŸtom
) {

3341 i‡(
e
->
y0
 !e->
y1
) {

3342 
°bâ__a˘ive_edge
 *
z
 = 
	`°bâ__√w_a˘ive
(&
hh
, 
e
, 
off_x
, 
sˇn_y_t›
, 
u£rd©a
);

3343 i‡(
z
 !
NULL
) {

3344 i‡(
j
 =0 && 
off_y
 != 0) {

3345 i‡(
z
->
ey
 < 
sˇn_y_t›
) {

3347 
z
->
ey
 = 
sˇn_y_t›
;

3350 
	`STBTT_as£π
(
z
->
ey
 >
sˇn_y_t›
);

3352 
z
->
√xt
 = 
a˘ive
;

3353 
a˘ive
 = 
z
;

3356 ++
e
;

3360 i‡(
a˘ive
)

3361 
	`°bâ__fûl_a˘ive_edges_√w
(
sˇ∆öe
, 
sˇ∆öe2
+1, 
ªsu…
->
w
, 
a˘ive
, 
sˇn_y_t›
);

3364 
sum
 = 0;

3365 
i
=0; i < 
ªsu…
->
w
; ++i) {

3366 
k
;

3367 
m
;

3368 
sum
 +
sˇ∆öe2
[
i
];

3369 
k
 = 
sˇ∆öe
[
i
] + 
sum
;

3370 
k
 = (Ë
	`STBTT_Ábs
(k)*255 + 0.5f;

3371 
m
 = (Ë
k
;

3372 i‡(
m
 > 255) m = 255;

3373 
ªsu…
->
pixñs
[
j
*ªsu…->
°ride
 + 
i
] = (Ë
m
;

3377 
°ï
 = &
a˘ive
;

3378 *
°ï
) {

3379 
°bâ__a˘ive_edge
 *
z
 = *
°ï
;

3380 
z
->
fx
 +z->
fdx
;

3381 
°ï
 = &((*°ï)->
√xt
);

3384 ++
y
;

3385 ++
j
;

3388 
	`°bâ__hhóp_˛ónup
(&
hh
, 
u£rd©a
);

3390 i‡(
sˇ∆öe
 !
sˇ∆öe_d©a
)

3391 
	`STBTT_‰ì
(
sˇ∆öe
, 
u£rd©a
);

3392 
	}
}

3397 
	#STBTT__COMPARE
(
a
,
b
Ë(◊)->
y0
 < (b)->y0)

	)

3399 
	$°bâ__s‹t_edges_ös_s‹t
(
°bâ__edge
 *
p
, 
n
)

3401 
i
,
j
;

3402 
i
=1; i < 
n
; ++i) {

3403 
°bâ__edge
 
t
 = 
p
[
i
], *
a
 = &t;

3404 
j
 = 
i
;

3405 
j
 > 0) {

3406 
°bâ__edge
 *
b
 = &
p
[
j
-1];

3407 
c
 = 
	`STBTT__COMPARE
(
a
,
b
);

3408 i‡(!
c
) ;

3409 
p
[
j
] =Ö[j-1];

3410 --
j
;

3412 i‡(
i
 !
j
)

3413 
p
[
j
] = 
t
;

3415 
	}
}

3417 
	$°bâ__s‹t_edges_quicks‹t
(
°bâ__edge
 *
p
, 
n
)

3420 
n
 > 12) {

3421 
°bâ__edge
 
t
;

3422 
c01
,
c12
,
c
,
m
,
i
,
j
;

3425 
m
 = 
n
 >> 1;

3426 
c01
 = 
	`STBTT__COMPARE
(&
p
[0],&p[
m
]);

3427 
c12
 = 
	`STBTT__COMPARE
(&
p
[
m
],&p[
n
-1]);

3429 i‡(
c01
 !
c12
) {

3431 
z
;

3432 
c
 = 
	`STBTT__COMPARE
(&
p
[0],&p[
n
-1]);

3435 
z
 = (
c
 =
c12
Ë? 0 : 
n
-1;

3436 
t
 = 
p
[
z
];

3437 
p
[
z
] =Ö[
m
];

3438 
p
[
m
] = 
t
;

3442 
t
 = 
p
[0];

3443 
p
[0] =Ö[
m
];

3444 
p
[
m
] = 
t
;

3447 
i
=1;

3448 
j
=
n
-1;

3452 ;;++
i
) {

3453 i‡(!
	`STBTT__COMPARE
(&
p
[
i
], &p[0])) ;

3455 ;;--
j
) {

3456 i‡(!
	`STBTT__COMPARE
(&
p
[0], &p[
j
])) ;

3459 i‡(
i
 >
j
) ;

3460 
t
 = 
p
[
i
];

3461 
p
[
i
] =Ö[
j
];

3462 
p
[
j
] = 
t
;

3464 ++
i
;

3465 --
j
;

3468 i‡(
j
 < (
n
-
i
)) {

3469 
	`°bâ__s‹t_edges_quicks‹t
(
p
,
j
);

3470 
p
 =Ö+
i
;

3471 
n
 =Ç-
i
;

3473 
	`°bâ__s‹t_edges_quicks‹t
(
p
+
i
, 
n
-i);

3474 
n
 = 
j
;

3477 
	}
}

3479 
	$°bâ__s‹t_edges
(
°bâ__edge
 *
p
, 
n
)

3481 
	`°bâ__s‹t_edges_quicks‹t
(
p
, 
n
);

3482 
	`°bâ__s‹t_edges_ös_s‹t
(
p
, 
n
);

3483 
	}
}

3487 
	mx
,
	my
;

3488 } 
	t°bâ__poöt
;

3490 
	$°bâ__ø°îize
(
°bâ__bôm≠
 *
ªsu…
, 
°bâ__poöt
 *
±s
, *
wcou¡
, 
wödögs
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
off_x
, 
off_y
, 
övît
, *
u£rd©a
)

3492 
y_sˇÀ_öv
 = 
övît
 ? -
sˇÀ_y
 : scale_y;

3493 
°bâ__edge
 *
e
;

3494 
n
,
i
,
j
,
k
,
m
;

3495 #i‡
STBTT_RASTERIZER_VERSION
 == 1

3496 
vsubßm∂e
 = 
ªsu…
->
h
 < 8 ? 15 : 5;

3497 #ñi‡
STBTT_RASTERIZER_VERSION
 == 2

3498 
vsubßm∂e
 = 1;

3505 
n
 = 0;

3506 
i
=0; i < 
wödögs
; ++i)

3507 
n
 +
wcou¡
[
i
];

3509 
e
 = (
°bâ__edge
 *Ë
	`STBTT_mÆloc
((*eË* (
n
+1), 
u£rd©a
);

3510 i‡(
e
 == 0) ;

3511 
n
 = 0;

3513 
m
=0;

3514 
i
=0; i < 
wödögs
; ++i) {

3515 
°bâ__poöt
 *
p
 = 
±s
 + 
m
;

3516 
m
 +
wcou¡
[
i
];

3517 
j
 = 
wcou¡
[
i
]-1;

3518 
k
=0; k < 
wcou¡
[
i
]; 
j
=k++) {

3519 
a
=
k
,
b
=
j
;

3521 i‡(
p
[
j
].
y
 =p[
k
].y)

3524 
e
[
n
].
övît
 = 0;

3525 i‡(
övît
 ? 
p
[
j
].
y
 >Ö[
k
].y :Ö[j].y <Ö[k].y) {

3526 
e
[
n
].
övît
 = 1;

3527 
a
=
j
,
b
=
k
;

3529 
e
[
n
].
x0
 = 
p
[
a
].
x
 * 
sˇÀ_x
 + 
shi·_x
;

3530 
e
[
n
].
y0
 = (
p
[
a
].
y
 * 
y_sˇÀ_öv
 + 
shi·_y
Ë* 
vsubßm∂e
;

3531 
e
[
n
].
x1
 = 
p
[
b
].
x
 * 
sˇÀ_x
 + 
shi·_x
;

3532 
e
[
n
].
y1
 = (
p
[
b
].
y
 * 
y_sˇÀ_öv
 + 
shi·_y
Ë* 
vsubßm∂e
;

3533 ++
n
;

3539 
	`°bâ__s‹t_edges
(
e
, 
n
);

3542 
	`°bâ__ø°îize_s‹ãd_edges
(
ªsu…
, 
e
, 
n
, 
vsubßm∂e
, 
off_x
, 
off_y
, 
u£rd©a
);

3544 
	`STBTT_‰ì
(
e
, 
u£rd©a
);

3545 
	}
}

3547 
	$°bâ__add_poöt
(
°bâ__poöt
 *
poöts
, 
n
, 
x
, 
y
)

3549 i‡(!
poöts
) ;

3550 
poöts
[
n
].
x
 = x;

3551 
poöts
[
n
].
y
 = y;

3552 
	}
}

3555 
	$°bâ__ãs£œã_curve
(
°bâ__poöt
 *
poöts
, *
num_poöts
, 
x0
, 
y0
, 
x1
, 
y1
, 
x2
, 
y2
, 
obj•a˚_Ê©√ss_squ¨ed
, 
n
)

3558 
mx
 = (
x0
 + 2*
x1
 + 
x2
)/4;

3559 
my
 = (
y0
 + 2*
y1
 + 
y2
)/4;

3561 
dx
 = (
x0
+
x2
)/2 - 
mx
;

3562 
dy
 = (
y0
+
y2
)/2 - 
my
;

3563 i‡(
n
 > 16)

3565 i‡(
dx
*dx+
dy
*dy > 
obj•a˚_Ê©√ss_squ¨ed
) {

3566 
	`°bâ__ãs£œã_curve
(
poöts
, 
num_poöts
, 
x0
,
y0
, (x0+
x1
)/2.0f,(y0+
y1
)/2.0f, 
mx
,
my
, 
obj•a˚_Ê©√ss_squ¨ed
,
n
+1);

3567 
	`°bâ__ãs£œã_curve
(
poöts
, 
num_poöts
, 
mx
,
my
, (
x1
+
x2
)/2.0f,(
y1
+
y2
)/2.0f, x2,y2, 
obj•a˚_Ê©√ss_squ¨ed
,
n
+1);

3569 
	`°bâ__add_poöt
(
poöts
, *
num_poöts
,
x2
,
y2
);

3570 *
num_poöts
 = *num_points+1;

3573 
	}
}

3575 
	$°bâ__ãs£œã_cubic
(
°bâ__poöt
 *
poöts
, *
num_poöts
, 
x0
, 
y0
, 
x1
, 
y1
, 
x2
, 
y2
, 
x3
, 
y3
, 
obj•a˚_Ê©√ss_squ¨ed
, 
n
)

3578 
dx0
 = 
x1
-
x0
;

3579 
dy0
 = 
y1
-
y0
;

3580 
dx1
 = 
x2
-
x1
;

3581 
dy1
 = 
y2
-
y1
;

3582 
dx2
 = 
x3
-
x2
;

3583 
dy2
 = 
y3
-
y2
;

3584 
dx
 = 
x3
-
x0
;

3585 
dy
 = 
y3
-
y0
;

3586 
l⁄gÀn
 = (Ë(
	`STBTT_sqπ
(
dx0
*dx0+
dy0
*dy0)+STBTT_sqπ(
dx1
*dx1+
dy1
*dy1)+STBTT_sqπ(
dx2
*dx2+
dy2
*dy2));

3587 
sh‹éí
 = (Ë
	`STBTT_sqπ
(
dx
*dx+
dy
*dy);

3588 
Ê©√ss_squ¨ed
 = 
l⁄gÀn
*l⁄gÀn-
sh‹éí
*shortlen;

3590 i‡(
n
 > 16)

3593 i‡(
Ê©√ss_squ¨ed
 > 
obj•a˚_Ê©√ss_squ¨ed
) {

3594 
x01
 = (
x0
+
x1
)/2;

3595 
y01
 = (
y0
+
y1
)/2;

3596 
x12
 = (
x1
+
x2
)/2;

3597 
y12
 = (
y1
+
y2
)/2;

3598 
x23
 = (
x2
+
x3
)/2;

3599 
y23
 = (
y2
+
y3
)/2;

3601 
xa
 = (
x01
+
x12
)/2;

3602 
ya
 = (
y01
+
y12
)/2;

3603 
xb
 = (
x12
+
x23
)/2;

3604 
yb
 = (
y12
+
y23
)/2;

3606 
mx
 = (
xa
+
xb
)/2;

3607 
my
 = (
ya
+
yb
)/2;

3609 
	`°bâ__ãs£œã_cubic
(
poöts
, 
num_poöts
, 
x0
,
y0
, 
x01
,
y01
, 
xa
,
ya
, 
mx
,
my
, 
obj•a˚_Ê©√ss_squ¨ed
,
n
+1);

3610 
	`°bâ__ãs£œã_cubic
(
poöts
, 
num_poöts
, 
mx
,
my
, 
xb
,
yb
, 
x23
,
y23
, 
x3
,
y3
, 
obj•a˚_Ê©√ss_squ¨ed
,
n
+1);

3612 
	`°bâ__add_poöt
(
poöts
, *
num_poöts
,
x3
,
y3
);

3613 *
num_poöts
 = *num_points+1;

3615 
	}
}

3618 
°bâ__poöt
 *
	$°bâ_FœâíCurves
(
°bâ_vîãx
 *
vîti˚s
, 
num_vîts
, 
obj•a˚_Ê©√ss
, **
c⁄tour_Àngths
, *
num_c⁄tours
, *
u£rd©a
)

3620 
°bâ__poöt
 *
poöts
=0;

3621 
num_poöts
=0;

3623 
obj•a˚_Ê©√ss_squ¨ed
 = 
obj•a˚_Ê©√ss
 * objspace_flatness;

3624 
i
,
n
=0,
°¨t
=0, 
∑ss
;

3627 
i
=0; i < 
num_vîts
; ++i)

3628 i‡(
vîti˚s
[
i
].
ty≥
 =
STBTT_vmove
)

3629 ++
n
;

3631 *
num_c⁄tours
 = 
n
;

3632 i‡(
n
 == 0)  0;

3634 *
c⁄tour_Àngths
 = (*Ë
	`STBTT_mÆloc
((**c⁄tour_ÀngthsË* 
n
, 
u£rd©a
);

3636 i‡(*
c⁄tour_Àngths
 == 0) {

3637 *
num_c⁄tours
 = 0;

3642 
∑ss
=0;Öass < 2; ++pass) {

3643 
x
=0,
y
=0;

3644 i‡(
∑ss
 == 1) {

3645 
poöts
 = (
°bâ__poöt
 *Ë
	`STBTT_mÆloc
(
num_poöts
 * ’oöts[0]), 
u£rd©a
);

3646 i‡(
poöts
 =
NULL
Ë
îr‹
;

3648 
num_poöts
 = 0;

3649 
n
= -1;

3650 
i
=0; i < 
num_vîts
; ++i) {

3651 
vîti˚s
[
i
].
ty≥
) {

3652 
STBTT_vmove
:

3654 i‡(
n
 >= 0)

3655 (*
c⁄tour_Àngths
)[
n
] = 
num_poöts
 - 
°¨t
;

3656 ++
n
;

3657 
°¨t
 = 
num_poöts
;

3659 
x
 = 
vîti˚s
[
i
].x, 
y
 = vertices[i].y;

3660 
	`°bâ__add_poöt
(
poöts
, 
num_poöts
++, 
x
,
y
);

3662 
STBTT_vlöe
:

3663 
x
 = 
vîti˚s
[
i
].x, 
y
 = vertices[i].y;

3664 
	`°bâ__add_poöt
(
poöts
, 
num_poöts
++, 
x
, 
y
);

3666 
STBTT_vcurve
:

3667 
	`°bâ__ãs£œã_curve
(
poöts
, &
num_poöts
, 
x
,
y
,

3668 
vîti˚s
[
i
].
cx
, vîti˚s[i].
cy
,

3669 
vîti˚s
[
i
].
x
, vîti˚s[i].
y
,

3670 
obj•a˚_Ê©√ss_squ¨ed
, 0);

3671 
x
 = 
vîti˚s
[
i
].x, 
y
 = vertices[i].y;

3673 
STBTT_vcubic
:

3674 
	`°bâ__ãs£œã_cubic
(
poöts
, &
num_poöts
, 
x
,
y
,

3675 
vîti˚s
[
i
].
cx
, vîti˚s[i].
cy
,

3676 
vîti˚s
[
i
].
cx1
, vîti˚s[i].
cy1
,

3677 
vîti˚s
[
i
].
x
, vîti˚s[i].
y
,

3678 
obj•a˚_Ê©√ss_squ¨ed
, 0);

3679 
x
 = 
vîti˚s
[
i
].x, 
y
 = vertices[i].y;

3683 (*
c⁄tour_Àngths
)[
n
] = 
num_poöts
 - 
°¨t
;

3686  
poöts
;

3687 
îr‹
:

3688 
	`STBTT_‰ì
(
poöts
, 
u£rd©a
);

3689 
	`STBTT_‰ì
(*
c⁄tour_Àngths
, 
u£rd©a
);

3690 *
c⁄tour_Àngths
 = 0;

3691 *
num_c⁄tours
 = 0;

3692  
NULL
;

3693 
	}
}

3695 
STBTT_DEF
 
	$°bâ_Ra°îize
(
°bâ__bôm≠
 *
ªsu…
, 
Ê©√ss_ö_pixñs
, 
°bâ_vîãx
 *
vîti˚s
, 
num_vîts
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
x_off
, 
y_off
, 
övît
, *
u£rd©a
)

3697 
sˇÀ
 = 
sˇÀ_x
 > 
sˇÀ_y
 ? scale_y : scale_x;

3698 
wödög_cou¡
 = 0;

3699 *
wödög_Àngths
 = 
NULL
;

3700 
°bâ__poöt
 *
wödögs
 = 
	`°bâ_FœâíCurves
(
vîti˚s
, 
num_vîts
, 
Ê©√ss_ö_pixñs
 / 
sˇÀ
, &
wödög_Àngths
, &
wödög_cou¡
, 
u£rd©a
);

3701 i‡(
wödögs
) {

3702 
	`°bâ__ø°îize
(
ªsu…
, 
wödögs
, 
wödög_Àngths
, 
wödög_cou¡
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
x_off
, 
y_off
, 
övît
, 
u£rd©a
);

3703 
	`STBTT_‰ì
(
wödög_Àngths
, 
u£rd©a
);

3704 
	`STBTT_‰ì
(
wödögs
, 
u£rd©a
);

3706 
	}
}

3708 
STBTT_DEF
 
	$°bâ_FªeBôm≠
(*
bôm≠
, *
u£rd©a
)

3710 
	`STBTT_‰ì
(
bôm≠
, 
u£rd©a
);

3711 
	}
}

3713 
STBTT_DEF
 *
	$°bâ_GëGlyphBôm≠Subpixñ
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
glyph
, *
width
, *
height
, *
xoff
, *
yoff
)

3715 
ix0
,
iy0
,
ix1
,
iy1
;

3716 
°bâ__bôm≠
 
gbm
;

3717 
°bâ_vîãx
 *
vîti˚s
;

3718 
num_vîts
 = 
	`°bâ_GëGlyphSh≠e
(
öfo
, 
glyph
, &
vîti˚s
);

3720 i‡(
sˇÀ_x
 =0ËsˇÀ_x = 
sˇÀ_y
;

3721 i‡(
sˇÀ_y
 == 0) {

3722 i‡(
sˇÀ_x
 == 0) {

3723 
	`STBTT_‰ì
(
vîti˚s
, 
öfo
->
u£rd©a
);

3724  
NULL
;

3726 
sˇÀ_y
 = 
sˇÀ_x
;

3729 
	`°bâ_GëGlyphBôm≠BoxSubpixñ
(
öfo
, 
glyph
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, &
ix0
,&
iy0
,&
ix1
,&
iy1
);

3732 
gbm
.
w
 = (
ix1
 - 
ix0
);

3733 
gbm
.
h
 = (
iy1
 - 
iy0
);

3734 
gbm
.
pixñs
 = 
NULL
;

3736 i‡(
width
 ) *width = 
gbm
.
w
;

3737 i‡(
height
Ë*heighà
gbm
.
h
;

3738 i‡(
xoff
 ) *xof‡
ix0
;

3739 i‡(
yoff
 ) *yof‡
iy0
;

3741 i‡(
gbm
.
w
 && gbm.
h
) {

3742 
gbm
.
pixñs
 = (*Ë
	`STBTT_mÆloc
(gbm.
w
 * gbm.
h
, 
öfo
->
u£rd©a
);

3743 i‡(
gbm
.
pixñs
) {

3744 
gbm
.
°ride
 = gbm.
w
;

3746 
	`°bâ_Ra°îize
(&
gbm
, 0.35f, 
vîti˚s
, 
num_vîts
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
ix0
, 
iy0
, 1, 
öfo
->
u£rd©a
);

3749 
	`STBTT_‰ì
(
vîti˚s
, 
öfo
->
u£rd©a
);

3750  
gbm
.
pixñs
;

3751 
	}
}

3753 
STBTT_DEF
 *
	$°bâ_GëGlyphBôm≠
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
sˇÀ_x
, 
sˇÀ_y
, 
glyph
, *
width
, *
height
, *
xoff
, *
yoff
)

3755  
	`°bâ_GëGlyphBôm≠Subpixñ
(
öfo
, 
sˇÀ_x
, 
sˇÀ_y
, 0.0f, 0.0f, 
glyph
, 
width
, 
height
, 
xoff
, 
yoff
);

3756 
	}
}

3758 
STBTT_DEF
 
	$°bâ_MakeGlyphBôm≠Subpixñ
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
glyph
)

3760 
ix0
,
iy0
;

3761 
°bâ_vîãx
 *
vîti˚s
;

3762 
num_vîts
 = 
	`°bâ_GëGlyphSh≠e
(
öfo
, 
glyph
, &
vîti˚s
);

3763 
°bâ__bôm≠
 
gbm
;

3765 
	`°bâ_GëGlyphBôm≠BoxSubpixñ
(
öfo
, 
glyph
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, &
ix0
,&
iy0
,0,0);

3766 
gbm
.
pixñs
 = 
ouçut
;

3767 
gbm
.
w
 = 
out_w
;

3768 
gbm
.
h
 = 
out_h
;

3769 
gbm
.
°ride
 = 
out_°ride
;

3771 i‡(
gbm
.
w
 && gbm.
h
)

3772 
	`°bâ_Ra°îize
(&
gbm
, 0.35f, 
vîti˚s
, 
num_vîts
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
ix0
,
iy0
, 1, 
öfo
->
u£rd©a
);

3774 
	`STBTT_‰ì
(
vîti˚s
, 
öfo
->
u£rd©a
);

3775 
	}
}

3777 
STBTT_DEF
 
	$°bâ_MakeGlyphBôm≠
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
glyph
)

3779 
	`°bâ_MakeGlyphBôm≠Subpixñ
(
öfo
, 
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 0.0f,0.0f, 
glyph
);

3780 
	}
}

3782 
STBTT_DEF
 *
	$°bâ_GëCodïoötBôm≠Subpixñ
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
codïoöt
, *
width
, *
height
, *
xoff
, *
yoff
)

3784  
	`°bâ_GëGlyphBôm≠Subpixñ
(
öfo
, 
sˇÀ_x
, 
sˇÀ_y
,
shi·_x
,
shi·_y
, 
	`°bâ_FödGlyphIndex
(öfo,
codïoöt
), 
width
,
height
,
xoff
,
yoff
);

3785 
	}
}

3787 
STBTT_DEF
 
	$°bâ_MakeCodïoötBôm≠SubpixñPªfûãr
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
ovîßm∂e_x
, 
ovîßm∂e_y
, *
sub_x
, *
sub_y
, 
codïoöt
)

3789 
	`°bâ_MakeGlyphBôm≠SubpixñPªfûãr
(
öfo
, 
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
ovîßm∂e_x
, 
ovîßm∂e_y
, 
sub_x
, 
sub_y
, 
	`°bâ_FödGlyphIndex
(öfo,
codïoöt
));

3790 
	}
}

3792 
STBTT_DEF
 
	$°bâ_MakeCodïoötBôm≠Subpixñ
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
codïoöt
)

3794 
	`°bâ_MakeGlyphBôm≠Subpixñ
(
öfo
, 
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
	`°bâ_FödGlyphIndex
(öfo,
codïoöt
));

3795 
	}
}

3797 
STBTT_DEF
 *
	$°bâ_GëCodïoötBôm≠
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
sˇÀ_x
, 
sˇÀ_y
, 
codïoöt
, *
width
, *
height
, *
xoff
, *
yoff
)

3799  
	`°bâ_GëCodïoötBôm≠Subpixñ
(
öfo
, 
sˇÀ_x
, 
sˇÀ_y
, 0.0f,0.0f, 
codïoöt
, 
width
,
height
,
xoff
,
yoff
);

3800 
	}
}

3802 
STBTT_DEF
 
	$°bâ_MakeCodïoötBôm≠
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
codïoöt
)

3804 
	`°bâ_MakeCodïoötBôm≠Subpixñ
(
öfo
, 
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 0.0f,0.0f, 
codïoöt
);

3805 
	}
}

3813 
	$°bâ_BakeF⁄tBôm≠_öã∫Æ
(*
d©a
, 
off£t
,

3814 
pixñ_height
,

3815 *
pixñs
, 
pw
, 
ph
,

3816 
fú°_ch¨
, 
num_ch¨s
,

3817 
°bâ_bakedch¨
 *
ch¨d©a
)

3819 
sˇÀ
;

3820 
x
,
y
,
bŸtom_y
, 
i
;

3821 
°bâ_f⁄töfo
 
f
;

3822 
f
.
u£rd©a
 = 
NULL
;

3823 i‡(!
	`°bâ_InôF⁄t
(&
f
, 
d©a
, 
off£t
))

3825 
	`STBTT_mem£t
(
pixñs
, 0, 
pw
*
ph
);

3826 
x
=
y
=1;

3827 
bŸtom_y
 = 1;

3829 
sˇÀ
 = 
	`°bâ_SˇÀF‹PixñHeight
(&
f
, 
pixñ_height
);

3831 
i
=0; i < 
num_ch¨s
; ++i) {

3832 
adv™˚
, 
lsb
, 
x0
,
y0
,
x1
,
y1
,
gw
,
gh
;

3833 
g
 = 
	`°bâ_FödGlyphIndex
(&
f
, 
fú°_ch¨
 + 
i
);

3834 
	`°bâ_GëGlyphHMërics
(&
f
, 
g
, &
adv™˚
, &
lsb
);

3835 
	`°bâ_GëGlyphBôm≠Box
(&
f
, 
g
, 
sˇÀ
,sˇÀ, &
x0
,&
y0
,&
x1
,&
y1
);

3836 
gw
 = 
x1
-
x0
;

3837 
gh
 = 
y1
-
y0
;

3838 i‡(
x
 + 
gw
 + 1 >
pw
)

3839 
y
 = 
bŸtom_y
, 
x
 = 1;

3840 i‡(
y
 + 
gh
 + 1 >
ph
)

3841  -
i
;

3842 
	`STBTT_as£π
(
x
+
gw
 < 
pw
);

3843 
	`STBTT_as£π
(
y
+
gh
 < 
ph
);

3844 
	`°bâ_MakeGlyphBôm≠
(&
f
, 
pixñs
+
x
+
y
*
pw
, 
gw
,
gh
,pw, 
sˇÀ
,sˇÀ, 
g
);

3845 
ch¨d©a
[
i
].
x0
 = (
°bâ_öt16
Ë
x
;

3846 
ch¨d©a
[
i
].
y0
 = (
°bâ_öt16
Ë
y
;

3847 
ch¨d©a
[
i
].
x1
 = (
°bâ_öt16
Ë(
x
 + 
gw
);

3848 
ch¨d©a
[
i
].
y1
 = (
°bâ_öt16
Ë(
y
 + 
gh
);

3849 
ch¨d©a
[
i
].
xadv™˚
 = 
sˇÀ
 * 
adv™˚
;

3850 
ch¨d©a
[
i
].
xoff
 = (Ë
x0
;

3851 
ch¨d©a
[
i
].
yoff
 = (Ë
y0
;

3852 
x
 = x + 
gw
 + 1;

3853 i‡(
y
+
gh
+1 > 
bŸtom_y
)

3854 
bŸtom_y
 = 
y
+
gh
+1;

3856  
bŸtom_y
;

3857 
	}
}

3859 
STBTT_DEF
 
	$°bâ_GëBakedQuad
(c⁄° 
°bâ_bakedch¨
 *
ch¨d©a
, 
pw
, 
ph
, 
ch¨_ödex
, *
xpos
, *
ypos
, 
°bâ_Æig√d_quad
 *
q
, 
›ígl_fûÃuÀ
)

3861 
d3d_büs
 = 
›ígl_fûÃuÀ
 ? 0 : -0.5f;

3862 
ùw
 = 1.0‡/ 
pw
, 
ùh
 = 1.0‡/ 
ph
;

3863 c⁄° 
°bâ_bakedch¨
 *
b
 = 
ch¨d©a
 + 
ch¨_ödex
;

3864 
round_x
 = 
	`STBTT_iÊo‹
((*
xpos
 + 
b
->
xoff
) + 0.5f);

3865 
round_y
 = 
	`STBTT_iÊo‹
((*
ypos
 + 
b
->
yoff
) + 0.5f);

3867 
q
->
x0
 = 
round_x
 + 
d3d_büs
;

3868 
q
->
y0
 = 
round_y
 + 
d3d_büs
;

3869 
q
->
x1
 = 
round_x
 + 
b
->x1 - b->
x0
 + 
d3d_büs
;

3870 
q
->
y1
 = 
round_y
 + 
b
->y1 - b->
y0
 + 
d3d_büs
;

3872 
q
->
s0
 = 
b
->
x0
 * 
ùw
;

3873 
q
->
t0
 = 
b
->
y0
 * 
ùh
;

3874 
q
->
s1
 = 
b
->
x1
 * 
ùw
;

3875 
q
->
t1
 = 
b
->
y1
 * 
ùh
;

3877 *
xpos
 +
b
->
xadv™˚
;

3878 
	}
}

3885 #i‚de‡
STB_RECT_PACK_VERSION


3887 
	t°bΩ_co‹d
;

3902 
	mwidth
,
	mheight
;

3903 
	mx
,
	my
,
	mbŸtom_y
;

3904 } 
	t°bΩ_c⁄ãxt
;

3908 
	mx
;

3909 } 
	t°bΩ_node
;

3911 
	s°bΩ_ª˘


3913 
°bΩ_co‹d
 
	mx
,
	my
;

3914 
	mid
,
	mw
,
	mh
,
	mwas_∑cked
;

3917 
	$°bΩ_öô_èrgë
(
°bΩ_c⁄ãxt
 *
c⁄
, 
pw
, 
ph
, 
°bΩ_node
 *
nodes
, 
num_nodes
)

3919 
c⁄
->
width
 = 
pw
;

3920 
c⁄
->
height
 = 
ph
;

3921 
c⁄
->
x
 = 0;

3922 
c⁄
->
y
 = 0;

3923 
c⁄
->
bŸtom_y
 = 0;

3924 
	`STBTT__NOTUSED
(
nodes
);

3925 
	`STBTT__NOTUSED
(
num_nodes
);

3926 
	}
}

3928 
	$°bΩ_∑ck_ª˘s
(
°bΩ_c⁄ãxt
 *
c⁄
, 
°bΩ_ª˘
 *
ª˘s
, 
num_ª˘s
)

3930 
i
;

3931 
i
=0; i < 
num_ª˘s
; ++i) {

3932 i‡(
c⁄
->
x
 + 
ª˘s
[
i
].
w
 > c⁄->
width
) {

3933 
c⁄
->
x
 = 0;

3934 
c⁄
->
y
 = c⁄->
bŸtom_y
;

3936 i‡(
c⁄
->
y
 + 
ª˘s
[
i
].
h
 > c⁄->
height
)

3938 
ª˘s
[
i
].
x
 = 
c⁄
->x;

3939 
ª˘s
[
i
].
y
 = 
c⁄
->y;

3940 
ª˘s
[
i
].
was_∑cked
 = 1;

3941 
c⁄
->
x
 +
ª˘s
[
i
].
w
;

3942 i‡(
c⁄
->
y
 + 
ª˘s
[
i
].
h
 > c⁄->
bŸtom_y
)

3943 
c⁄
->
bŸtom_y
 = c⁄->
y
 + 
ª˘s
[
i
].
h
;

3945  ; 
i
 < 
num_ª˘s
; ++i)

3946 
ª˘s
[
i
].
was_∑cked
 = 0;

3947 
	}
}

3957 
STBTT_DEF
 
	$°bâ_PackBegö
(
°bâ_∑ck_c⁄ãxt
 *
•c
, *
pixñs
, 
pw
, 
ph
, 
°ride_ö_byãs
, 
∑ddög
, *
Æloc_c⁄ãxt
)

3959 
°bΩ_c⁄ãxt
 *
c⁄ãxt
 = (°bΩ_c⁄ãxà*Ë
	`STBTT_mÆloc
((*c⁄ãxtË,
Æloc_c⁄ãxt
);

3960 
num_nodes
 = 
pw
 - 
∑ddög
;

3961 
°bΩ_node
 *
nodes
 = (°bΩ_nodê*Ë
	`STBTT_mÆloc
((*node†Ë* 
num_nodes
,
Æloc_c⁄ãxt
);

3963 i‡(
c⁄ãxt
 =
NULL
 || 
nodes
 == NULL) {

3964 i‡(
c⁄ãxt
 !
NULL
Ë
	`STBTT_‰ì
(c⁄ãxt, 
Æloc_c⁄ãxt
);

3965 i‡(
nodes
 !
NULL
Ë
	`STBTT_‰ì
“ode†, 
Æloc_c⁄ãxt
);

3969 
•c
->
u£r_Æloˇt‹_c⁄ãxt
 = 
Æloc_c⁄ãxt
;

3970 
•c
->
width
 = 
pw
;

3971 
•c
->
height
 = 
ph
;

3972 
•c
->
pixñs
 =Öixels;

3973 
•c
->
∑ck_öfo
 = 
c⁄ãxt
;

3974 
•c
->
nodes
 =Çodes;

3975 
•c
->
∑ddög
 =Öadding;

3976 
•c
->
°ride_ö_byãs
 = såide_ö_byã†!0 ? såide_ö_byã†: 
pw
;

3977 
•c
->
h_ovîßm∂e
 = 1;

3978 
•c
->
v_ovîßm∂e
 = 1;

3979 
•c
->
skù_missög
 = 0;

3981 
	`°bΩ_öô_èrgë
(
c⁄ãxt
, 
pw
-
∑ddög
, 
ph
-∑ddög, 
nodes
, 
num_nodes
);

3983 i‡(
pixñs
)

3984 
	`STBTT_mem£t
(
pixñs
, 0, 
pw
*
ph
);

3987 
	}
}

3989 
STBTT_DEF
 
	$°bâ_PackEnd
 (
°bâ_∑ck_c⁄ãxt
 *
•c
)

3991 
	`STBTT_‰ì
(
•c
->
nodes
 , spc->
u£r_Æloˇt‹_c⁄ãxt
);

3992 
	`STBTT_‰ì
(
•c
->
∑ck_öfo
, spc->
u£r_Æloˇt‹_c⁄ãxt
);

3993 
	}
}

3995 
STBTT_DEF
 
	$°bâ_PackSëOvîßm∂ög
(
°bâ_∑ck_c⁄ãxt
 *
•c
, 
h_ovîßm∂e
, 
v_ovîßm∂e
)

3997 
	`STBTT_as£π
(
h_ovîßm∂e
 <
STBTT_MAX_OVERSAMPLE
);

3998 
	`STBTT_as£π
(
v_ovîßm∂e
 <
STBTT_MAX_OVERSAMPLE
);

3999 i‡(
h_ovîßm∂e
 <
STBTT_MAX_OVERSAMPLE
)

4000 
•c
->
h_ovîßm∂e
 = h_oversample;

4001 i‡(
v_ovîßm∂e
 <
STBTT_MAX_OVERSAMPLE
)

4002 
•c
->
v_ovîßm∂e
 = v_oversample;

4003 
	}
}

4005 
STBTT_DEF
 
	$°bâ_PackSëSkùMissögCodïoöts
(
°bâ_∑ck_c⁄ãxt
 *
•c
, 
skù
)

4007 
•c
->
skù_missög
 = 
skù
;

4008 
	}
}

4010 
	#STBTT__OVER_MASK
 (
STBTT_MAX_OVERSAMPLE
-1)

	)

4012 
	$°bâ__h_¥efûãr
(*
pixñs
, 
w
, 
h
, 
°ride_ö_byãs
, 
kî√l_width
)

4014 
buf„r
[
STBTT_MAX_OVERSAMPLE
];

4015 
ß„_w
 = 
w
 - 
kî√l_width
;

4016 
j
;

4017 
	`STBTT_mem£t
(
buf„r
, 0, 
STBTT_MAX_OVERSAMPLE
);

4018 
j
=0; j < 
h
; ++j) {

4019 
i
;

4020 
tŸÆ
;

4021 
	`STBTT_mem£t
(
buf„r
, 0, 
kî√l_width
);

4023 
tŸÆ
 = 0;

4026 
kî√l_width
) {

4028 
i
=0; i <
ß„_w
; ++i) {

4029 
tŸÆ
 +
pixñs
[
i
] - 
buf„r
[ò& 
STBTT__OVER_MASK
];

4030 
buf„r
[(
i
+
kî√l_width
Ë& 
STBTT__OVER_MASK
] = 
pixñs
[i];

4031 
pixñs
[
i
] = (Ë(
tŸÆ
 / 2);

4035 
i
=0; i <
ß„_w
; ++i) {

4036 
tŸÆ
 +
pixñs
[
i
] - 
buf„r
[ò& 
STBTT__OVER_MASK
];

4037 
buf„r
[(
i
+
kî√l_width
Ë& 
STBTT__OVER_MASK
] = 
pixñs
[i];

4038 
pixñs
[
i
] = (Ë(
tŸÆ
 / 3);

4042 
i
=0; i <
ß„_w
; ++i) {

4043 
tŸÆ
 +
pixñs
[
i
] - 
buf„r
[ò& 
STBTT__OVER_MASK
];

4044 
buf„r
[(
i
+
kî√l_width
Ë& 
STBTT__OVER_MASK
] = 
pixñs
[i];

4045 
pixñs
[
i
] = (Ë(
tŸÆ
 / 4);

4049 
i
=0; i <
ß„_w
; ++i) {

4050 
tŸÆ
 +
pixñs
[
i
] - 
buf„r
[ò& 
STBTT__OVER_MASK
];

4051 
buf„r
[(
i
+
kî√l_width
Ë& 
STBTT__OVER_MASK
] = 
pixñs
[i];

4052 
pixñs
[
i
] = (Ë(
tŸÆ
 / 5);

4056 
i
=0; i <
ß„_w
; ++i) {

4057 
tŸÆ
 +
pixñs
[
i
] - 
buf„r
[ò& 
STBTT__OVER_MASK
];

4058 
buf„r
[(
i
+
kî√l_width
Ë& 
STBTT__OVER_MASK
] = 
pixñs
[i];

4059 
pixñs
[
i
] = (Ë(
tŸÆ
 / 
kî√l_width
);

4064 ; 
i
 < 
w
; ++i) {

4065 
	`STBTT_as£π
(
pixñs
[
i
] == 0);

4066 
tŸÆ
 -
buf„r
[
i
 & 
STBTT__OVER_MASK
];

4067 
pixñs
[
i
] = (Ë(
tŸÆ
 / 
kî√l_width
);

4070 
pixñs
 +
°ride_ö_byãs
;

4072 
	}
}

4074 
	$°bâ__v_¥efûãr
(*
pixñs
, 
w
, 
h
, 
°ride_ö_byãs
, 
kî√l_width
)

4076 
buf„r
[
STBTT_MAX_OVERSAMPLE
];

4077 
ß„_h
 = 
h
 - 
kî√l_width
;

4078 
j
;

4079 
	`STBTT_mem£t
(
buf„r
, 0, 
STBTT_MAX_OVERSAMPLE
);

4080 
j
=0; j < 
w
; ++j) {

4081 
i
;

4082 
tŸÆ
;

4083 
	`STBTT_mem£t
(
buf„r
, 0, 
kî√l_width
);

4085 
tŸÆ
 = 0;

4088 
kî√l_width
) {

4090 
i
=0; i <
ß„_h
; ++i) {

4091 
tŸÆ
 +
pixñs
[
i
*
°ride_ö_byãs
] - 
buf„r
[ò& 
STBTT__OVER_MASK
];

4092 
buf„r
[(
i
+
kî√l_width
Ë& 
STBTT__OVER_MASK
] = 
pixñs
[i*
°ride_ö_byãs
];

4093 
pixñs
[
i
*
°ride_ö_byãs
] = (Ë(
tŸÆ
 / 2);

4097 
i
=0; i <
ß„_h
; ++i) {

4098 
tŸÆ
 +
pixñs
[
i
*
°ride_ö_byãs
] - 
buf„r
[ò& 
STBTT__OVER_MASK
];

4099 
buf„r
[(
i
+
kî√l_width
Ë& 
STBTT__OVER_MASK
] = 
pixñs
[i*
°ride_ö_byãs
];

4100 
pixñs
[
i
*
°ride_ö_byãs
] = (Ë(
tŸÆ
 / 3);

4104 
i
=0; i <
ß„_h
; ++i) {

4105 
tŸÆ
 +
pixñs
[
i
*
°ride_ö_byãs
] - 
buf„r
[ò& 
STBTT__OVER_MASK
];

4106 
buf„r
[(
i
+
kî√l_width
Ë& 
STBTT__OVER_MASK
] = 
pixñs
[i*
°ride_ö_byãs
];

4107 
pixñs
[
i
*
°ride_ö_byãs
] = (Ë(
tŸÆ
 / 4);

4111 
i
=0; i <
ß„_h
; ++i) {

4112 
tŸÆ
 +
pixñs
[
i
*
°ride_ö_byãs
] - 
buf„r
[ò& 
STBTT__OVER_MASK
];

4113 
buf„r
[(
i
+
kî√l_width
Ë& 
STBTT__OVER_MASK
] = 
pixñs
[i*
°ride_ö_byãs
];

4114 
pixñs
[
i
*
°ride_ö_byãs
] = (Ë(
tŸÆ
 / 5);

4118 
i
=0; i <
ß„_h
; ++i) {

4119 
tŸÆ
 +
pixñs
[
i
*
°ride_ö_byãs
] - 
buf„r
[ò& 
STBTT__OVER_MASK
];

4120 
buf„r
[(
i
+
kî√l_width
Ë& 
STBTT__OVER_MASK
] = 
pixñs
[i*
°ride_ö_byãs
];

4121 
pixñs
[
i
*
°ride_ö_byãs
] = (Ë(
tŸÆ
 / 
kî√l_width
);

4126 ; 
i
 < 
h
; ++i) {

4127 
	`STBTT_as£π
(
pixñs
[
i
*
°ride_ö_byãs
] == 0);

4128 
tŸÆ
 -
buf„r
[
i
 & 
STBTT__OVER_MASK
];

4129 
pixñs
[
i
*
°ride_ö_byãs
] = (Ë(
tŸÆ
 / 
kî√l_width
);

4132 
pixñs
 += 1;

4134 
	}
}

4136 
	$°bâ__ovîßm∂e_shi·
(
ovîßm∂e
)

4138 i‡(!
ovîßm∂e
)

4145  ()-(
ovîßm∂e
 - 1) / (2.0f * ()oversample);

4146 
	}
}

4149 
STBTT_DEF
 
	$°bâ_PackF⁄tR™gesG©hîRe˘s
(
°bâ_∑ck_c⁄ãxt
 *
•c
, c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
°bâ_∑ck_ønge
 *
ønges
, 
num_ønges
, 
°bΩ_ª˘
 *
ª˘s
)

4151 
i
,
j
,
k
;

4152 
missög_glyph_added
 = 0;

4154 
k
=0;

4155 
i
=0; i < 
num_ønges
; ++i) {

4156 
fh
 = 
ønges
[
i
].
f⁄t_size
;

4157 
sˇÀ
 = 
fh
 > 0 ? 
	`°bâ_SˇÀF‹PixñHeight
(
öfo
, fhË: 
	`°bâ_SˇÀF‹M≠pögEmToPixñs
(info, -fh);

4158 
ønges
[
i
].
h_ovîßm∂e
 = (Ë
•c
->h_oversample;

4159 
ønges
[
i
].
v_ovîßm∂e
 = (Ë
•c
->v_oversample;

4160 
j
=0; j < 
ønges
[
i
].
num_ch¨s
; ++j) {

4161 
x0
,
y0
,
x1
,
y1
;

4162 
codïoöt
 = 
ønges
[
i
].
¨øy_of_unicode_codïoöts
 =
NULL
 ?Ñ™ges[i].
fú°_unicode_codïoöt_ö_ønge
 + 
j
 :Ñanges[i].array_of_unicode_codepoints[j];

4163 
glyph
 = 
	`°bâ_FödGlyphIndex
(
öfo
, 
codïoöt
);

4164 i‡(
glyph
 =0 && (
•c
->
skù_missög
 || 
missög_glyph_added
)) {

4165 
ª˘s
[
k
].
w
 =Ñe˘s[k].
h
 = 0;

4167 
	`°bâ_GëGlyphBôm≠BoxSubpixñ
(
öfo
,
glyph
,

4168 
sˇÀ
 * 
•c
->
h_ovîßm∂e
,

4169 
sˇÀ
 * 
•c
->
v_ovîßm∂e
,

4171 &
x0
,&
y0
,&
x1
,&
y1
);

4172 
ª˘s
[
k
].
w
 = (
°bΩ_co‹d
Ë(
x1
-
x0
 + 
•c
->
∑ddög
 + spc->
h_ovîßm∂e
-1);

4173 
ª˘s
[
k
].
h
 = (
°bΩ_co‹d
Ë(
y1
-
y0
 + 
•c
->
∑ddög
 + spc->
v_ovîßm∂e
-1);

4174 i‡(
glyph
 == 0)

4175 
missög_glyph_added
 = 1;

4177 ++
k
;

4181  
k
;

4182 
	}
}

4184 
STBTT_DEF
 
	$°bâ_MakeGlyphBôm≠SubpixñPªfûãr
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, *
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
sˇÀ_x
, 
sˇÀ_y
, 
shi·_x
, 
shi·_y
, 
¥efûãr_x
, 
¥efûãr_y
, *
sub_x
, *
sub_y
, 
glyph
)

4186 
	`°bâ_MakeGlyphBôm≠Subpixñ
(
öfo
,

4187 
ouçut
,

4188 
out_w
 - (
¥efûãr_x
 - 1),

4189 
out_h
 - (
¥efûãr_y
 - 1),

4190 
out_°ride
,

4191 
sˇÀ_x
,

4192 
sˇÀ_y
,

4193 
shi·_x
,

4194 
shi·_y
,

4195 
glyph
);

4197 i‡(
¥efûãr_x
 > 1)

4198 
	`°bâ__h_¥efûãr
(
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
¥efûãr_x
);

4200 i‡(
¥efûãr_y
 > 1)

4201 
	`°bâ__v_¥efûãr
(
ouçut
, 
out_w
, 
out_h
, 
out_°ride
, 
¥efûãr_y
);

4203 *
sub_x
 = 
	`°bâ__ovîßm∂e_shi·
(
¥efûãr_x
);

4204 *
sub_y
 = 
	`°bâ__ovîßm∂e_shi·
(
¥efûãr_y
);

4205 
	}
}

4208 
STBTT_DEF
 
	$°bâ_PackF⁄tR™gesRídîI¡oRe˘s
(
°bâ_∑ck_c⁄ãxt
 *
•c
, c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
°bâ_∑ck_ønge
 *
ønges
, 
num_ønges
, 
°bΩ_ª˘
 *
ª˘s
)

4210 
i
,
j
,
k
, 
missög_glyph
 = -1, 
ªtu∫_vÆue
 = 1;

4213 
ﬁd_h_ovî
 = 
•c
->
h_ovîßm∂e
;

4214 
ﬁd_v_ovî
 = 
•c
->
v_ovîßm∂e
;

4216 
k
 = 0;

4217 
i
=0; i < 
num_ønges
; ++i) {

4218 
fh
 = 
ønges
[
i
].
f⁄t_size
;

4219 
sˇÀ
 = 
fh
 > 0 ? 
	`°bâ_SˇÀF‹PixñHeight
(
öfo
, fhË: 
	`°bâ_SˇÀF‹M≠pögEmToPixñs
(info, -fh);

4220 
ªcù_h
,
ªcù_v
,
sub_x
,
sub_y
;

4221 
•c
->
h_ovîßm∂e
 = 
ønges
[
i
].h_oversample;

4222 
•c
->
v_ovîßm∂e
 = 
ønges
[
i
].v_oversample;

4223 
ªcù_h
 = 1.0‡/ 
•c
->
h_ovîßm∂e
;

4224 
ªcù_v
 = 1.0‡/ 
•c
->
v_ovîßm∂e
;

4225 
sub_x
 = 
	`°bâ__ovîßm∂e_shi·
(
•c
->
h_ovîßm∂e
);

4226 
sub_y
 = 
	`°bâ__ovîßm∂e_shi·
(
•c
->
v_ovîßm∂e
);

4227 
j
=0; j < 
ønges
[
i
].
num_ch¨s
; ++j) {

4228 
°bΩ_ª˘
 *
r
 = &
ª˘s
[
k
];

4229 i‡(
r
->
was_∑cked
 &&Ñ->
w
 !0 &&Ñ->
h
 != 0) {

4230 
°bâ_∑ckedch¨
 *
bc
 = &
ønges
[
i
].
ch¨d©a_f‹_ønge
[
j
];

4231 
adv™˚
, 
lsb
, 
x0
,
y0
,
x1
,
y1
;

4232 
codïoöt
 = 
ønges
[
i
].
¨øy_of_unicode_codïoöts
 =
NULL
 ?Ñ™ges[i].
fú°_unicode_codïoöt_ö_ønge
 + 
j
 :Ñanges[i].array_of_unicode_codepoints[j];

4233 
glyph
 = 
	`°bâ_FödGlyphIndex
(
öfo
, 
codïoöt
);

4234 
°bΩ_co‹d
 
∑d
 = (°bΩ_co‹dË
•c
->
∑ddög
;

4237 
r
->
x
 +
∑d
;

4238 
r
->
y
 +
∑d
;

4239 
r
->
w
 -
∑d
;

4240 
r
->
h
 -
∑d
;

4241 
	`°bâ_GëGlyphHMërics
(
öfo
, 
glyph
, &
adv™˚
, &
lsb
);

4242 
	`°bâ_GëGlyphBôm≠Box
(
öfo
, 
glyph
,

4243 
sˇÀ
 * 
•c
->
h_ovîßm∂e
,

4244 
sˇÀ
 * 
•c
->
v_ovîßm∂e
,

4245 &
x0
,&
y0
,&
x1
,&
y1
);

4246 
	`°bâ_MakeGlyphBôm≠Subpixñ
(
öfo
,

4247 
•c
->
pixñs
 + 
r
->
x
 +Ñ->
y
*•c->
°ride_ö_byãs
,

4248 
r
->
w
 - 
•c
->
h_ovîßm∂e
+1,

4249 
r
->
h
 - 
•c
->
v_ovîßm∂e
+1,

4250 
•c
->
°ride_ö_byãs
,

4251 
sˇÀ
 * 
•c
->
h_ovîßm∂e
,

4252 
sˇÀ
 * 
•c
->
v_ovîßm∂e
,

4254 
glyph
);

4256 i‡(
•c
->
h_ovîßm∂e
 > 1)

4257 
	`°bâ__h_¥efûãr
(
•c
->
pixñs
 + 
r
->
x
 +Ñ->
y
*•c->
°ride_ö_byãs
,

4258 
r
->
w
,Ñ->
h
, 
•c
->
°ride_ö_byãs
,

4259 
•c
->
h_ovîßm∂e
);

4261 i‡(
•c
->
v_ovîßm∂e
 > 1)

4262 
	`°bâ__v_¥efûãr
(
•c
->
pixñs
 + 
r
->
x
 +Ñ->
y
*•c->
°ride_ö_byãs
,

4263 
r
->
w
,Ñ->
h
, 
•c
->
°ride_ö_byãs
,

4264 
•c
->
v_ovîßm∂e
);

4266 
bc
->
x0
 = (
°bâ_öt16
Ë
r
->
x
;

4267 
bc
->
y0
 = (
°bâ_öt16
Ë
r
->
y
;

4268 
bc
->
x1
 = (
°bâ_öt16
Ë(
r
->
x
 +Ñ->
w
);

4269 
bc
->
y1
 = (
°bâ_öt16
Ë(
r
->
y
 +Ñ->
h
);

4270 
bc
->
xadv™˚
 = 
sˇÀ
 * 
adv™˚
;

4271 
bc
->
xoff
 = (Ë
x0
 * 
ªcù_h
 + 
sub_x
;

4272 
bc
->
yoff
 = (Ë
y0
 * 
ªcù_v
 + 
sub_y
;

4273 
bc
->
xoff2
 = (
x0
 + 
r
->
w
Ë* 
ªcù_h
 + 
sub_x
;

4274 
bc
->
yoff2
 = (
y0
 + 
r
->
h
Ë* 
ªcù_v
 + 
sub_y
;

4276 i‡(
glyph
 == 0)

4277 
missög_glyph
 = 
j
;

4278 } i‡(
•c
->
skù_missög
) {

4279 
ªtu∫_vÆue
 = 0;

4280 } i‡(
r
->
was_∑cked
 &&Ñ->
w
 =0 &&Ñ->
h
 =0 && 
missög_glyph
 >= 0) {

4281 
ønges
[
i
].
ch¨d©a_f‹_ønge
[
j
] =Ñ™ges[i].ch¨d©a_f‹_ønge[
missög_glyph
];

4283 
ªtu∫_vÆue
 = 0;

4286 ++
k
;

4291 
•c
->
h_ovîßm∂e
 = 
ﬁd_h_ovî
;

4292 
•c
->
v_ovîßm∂e
 = 
ﬁd_v_ovî
;

4294  
ªtu∫_vÆue
;

4295 
	}
}

4297 
STBTT_DEF
 
	$°bâ_PackF⁄tR™gesPackRe˘s
(
°bâ_∑ck_c⁄ãxt
 *
•c
, 
°bΩ_ª˘
 *
ª˘s
, 
num_ª˘s
)

4299 
	`°bΩ_∑ck_ª˘s
((
°bΩ_c⁄ãxt
 *Ë
•c
->
∑ck_öfo
, 
ª˘s
, 
num_ª˘s
);

4300 
	}
}

4302 
STBTT_DEF
 
	$°bâ_PackF⁄tR™ges
(
°bâ_∑ck_c⁄ãxt
 *
•c
, c⁄° *
f⁄td©a
, 
f⁄t_ödex
, 
°bâ_∑ck_ønge
 *
ønges
, 
num_ønges
)

4304 
°bâ_f⁄töfo
 
öfo
;

4305 
i
,
j
,
n
, 
ªtu∫_vÆue
 = 1;

4307 
°bΩ_ª˘
 *
ª˘s
;

4310 
i
=0; i < 
num_ønges
; ++i)

4311 
j
=0; j < 
ønges
[
i
].
num_ch¨s
; ++j)

4312 
ønges
[
i
].
ch¨d©a_f‹_ønge
[
j
].
x0
 =

4313 
ønges
[
i
].
ch¨d©a_f‹_ønge
[
j
].
y0
 =

4314 
ønges
[
i
].
ch¨d©a_f‹_ønge
[
j
].
x1
 =

4315 
ønges
[
i
].
ch¨d©a_f‹_ønge
[
j
].
y1
 = 0;

4317 
n
 = 0;

4318 
i
=0; i < 
num_ønges
; ++i)

4319 
n
 +
ønges
[
i
].
num_ch¨s
;

4321 
ª˘s
 = (
°bΩ_ª˘
 *Ë
	`STBTT_mÆloc
((*ª˘sË* 
n
, 
•c
->
u£r_Æloˇt‹_c⁄ãxt
);

4322 i‡(
ª˘s
 =
NULL
)

4325 
öfo
.
u£rd©a
 = 
•c
->
u£r_Æloˇt‹_c⁄ãxt
;

4326 
	`°bâ_InôF⁄t
(&
öfo
, 
f⁄td©a
, 
	`°bâ_GëF⁄tOff£tF‹Index
(f⁄td©a,
f⁄t_ödex
));

4328 
n
 = 
	`°bâ_PackF⁄tR™gesG©hîRe˘s
(
•c
, &
öfo
, 
ønges
, 
num_ønges
, 
ª˘s
);

4330 
	`°bâ_PackF⁄tR™gesPackRe˘s
(
•c
, 
ª˘s
, 
n
);

4332 
ªtu∫_vÆue
 = 
	`°bâ_PackF⁄tR™gesRídîI¡oRe˘s
(
•c
, &
öfo
, 
ønges
, 
num_ønges
, 
ª˘s
);

4334 
	`STBTT_‰ì
(
ª˘s
, 
•c
->
u£r_Æloˇt‹_c⁄ãxt
);

4335  
ªtu∫_vÆue
;

4336 
	}
}

4338 
STBTT_DEF
 
	$°bâ_PackF⁄tR™ge
(
°bâ_∑ck_c⁄ãxt
 *
•c
, c⁄° *
f⁄td©a
, 
f⁄t_ödex
, 
f⁄t_size
,

4339 
fú°_unicode_codïoöt_ö_ønge
, 
num_ch¨s_ö_ønge
, 
°bâ_∑ckedch¨
 *
ch¨d©a_f‹_ønge
)

4341 
°bâ_∑ck_ønge
 
ønge
;

4342 
ønge
.
fú°_unicode_codïoöt_ö_ønge
 = first_unicode_codepoint_in_range;

4343 
ønge
.
¨øy_of_unicode_codïoöts
 = 
NULL
;

4344 
ønge
.
num_ch¨s
 = 
num_ch¨s_ö_ønge
;

4345 
ønge
.
ch¨d©a_f‹_ønge
 = chardata_for_range;

4346 
ønge
.
f⁄t_size
 = font_size;

4347  
	`°bâ_PackF⁄tR™ges
(
•c
, 
f⁄td©a
, 
f⁄t_ödex
, &
ønge
, 1);

4348 
	}
}

4350 
STBTT_DEF
 
	$°bâ_GëSˇÀdF⁄tVMërics
(c⁄° *
f⁄td©a
, 
ödex
, 
size
, *
as˚¡
, *
des˚¡
, *
löeG≠
)

4352 
i_as˚¡
, 
i_des˚¡
, 
i_löeG≠
;

4353 
sˇÀ
;

4354 
°bâ_f⁄töfo
 
öfo
;

4355 
	`°bâ_InôF⁄t
(&
öfo
, 
f⁄td©a
, 
	`°bâ_GëF⁄tOff£tF‹Index
(f⁄td©a, 
ödex
));

4356 
sˇÀ
 = 
size
 > 0 ? 
	`°bâ_SˇÀF‹PixñHeight
(&
öfo
, sizeË: 
	`°bâ_SˇÀF‹M≠pögEmToPixñs
(&info, -size);

4357 
	`°bâ_GëF⁄tVMërics
(&
öfo
, &
i_as˚¡
, &
i_des˚¡
, &
i_löeG≠
);

4358 *
as˚¡
 = (Ë
i_as˚¡
 * 
sˇÀ
;

4359 *
des˚¡
 = (Ë
i_des˚¡
 * 
sˇÀ
;

4360 *
löeG≠
 = (Ë
i_löeG≠
 * 
sˇÀ
;

4361 
	}
}

4363 
STBTT_DEF
 
	$°bâ_GëPackedQuad
(c⁄° 
°bâ_∑ckedch¨
 *
ch¨d©a
, 
pw
, 
ph
, 
ch¨_ödex
, *
xpos
, *
ypos
, 
°bâ_Æig√d_quad
 *
q
, 
Æign_to_öãgî
)

4365 
ùw
 = 1.0‡/ 
pw
, 
ùh
 = 1.0‡/ 
ph
;

4366 c⁄° 
°bâ_∑ckedch¨
 *
b
 = 
ch¨d©a
 + 
ch¨_ödex
;

4368 i‡(
Æign_to_öãgî
) {

4369 
x
 = (Ë
	`STBTT_iÊo‹
((*
xpos
 + 
b
->
xoff
) + 0.5f);

4370 
y
 = (Ë
	`STBTT_iÊo‹
((*
ypos
 + 
b
->
yoff
) + 0.5f);

4371 
q
->
x0
 = 
x
;

4372 
q
->
y0
 = 
y
;

4373 
q
->
x1
 = 
x
 + 
b
->
xoff2
 - b->
xoff
;

4374 
q
->
y1
 = 
y
 + 
b
->
yoff2
 - b->
yoff
;

4376 
q
->
x0
 = *
xpos
 + 
b
->
xoff
;

4377 
q
->
y0
 = *
ypos
 + 
b
->
yoff
;

4378 
q
->
x1
 = *
xpos
 + 
b
->
xoff2
;

4379 
q
->
y1
 = *
ypos
 + 
b
->
yoff2
;

4382 
q
->
s0
 = 
b
->
x0
 * 
ùw
;

4383 
q
->
t0
 = 
b
->
y0
 * 
ùh
;

4384 
q
->
s1
 = 
b
->
x1
 * 
ùw
;

4385 
q
->
t1
 = 
b
->
y1
 * 
ùh
;

4387 *
xpos
 +
b
->
xadv™˚
;

4388 
	}
}

4395 
	#STBTT_mö
(
a
,
b
Ë(◊Ë< (bË? (aË: (b))

	)

4396 
	#STBTT_max
(
a
,
b
Ë(◊Ë< (bË? (bË: (a))

	)

4398 
	$°bâ__øy_öãr£˘_bezõr
(
‹ig
[2], 
øy
[2], 
q0
[2], 
q1
[2], 
q2
[2], 
hôs
[2][2])

4400 
q0≥Ω
 = 
q0
[1]*
øy
[0] - q0[0]*ray[1];

4401 
q1≥Ω
 = 
q1
[1]*
øy
[0] - q1[0]*ray[1];

4402 
q2≥Ω
 = 
q2
[1]*
øy
[0] - q2[0]*ray[1];

4403 
r›îp
 = 
‹ig
[1]*
øy
[0] - orig[0]*ray[1];

4405 
a
 = 
q0≥Ω
 - 2*
q1≥Ω
 + 
q2≥Ω
;

4406 
b
 = 
q1≥Ω
 - 
q0≥Ω
;

4407 
c
 = 
q0≥Ω
 - 
r›îp
;

4409 
s0
 = 0., 
s1
 = 0.;

4410 
num_s
 = 0;

4412 i‡(
a
 != 0.0) {

4413 
dis¸
 = 
b
*b - 
a
*
c
;

4414 i‡(
dis¸
 > 0.0) {

4415 
r˝«
 = -1 / 
a
;

4416 
d
 = (Ë
	`STBTT_sqπ
(
dis¸
);

4417 
s0
 = (
b
+
d
Ë* 
r˝«
;

4418 
s1
 = (
b
-
d
Ë* 
r˝«
;

4419 i‡(
s0
 >= 0.0 && s0 <= 1.0)

4420 
num_s
 = 1;

4421 i‡(
d
 > 0.0 && 
s1
 >= 0.0 && s1 <= 1.0) {

4422 i‡(
num_s
 =0Ë
s0
 = 
s1
;

4423 ++
num_s
;

4429 
s0
 = 
c
 / (-2 * 
b
);

4430 i‡(
s0
 >= 0.0 && s0 <= 1.0)

4431 
num_s
 = 1;

4434 i‡(
num_s
 == 0)

4437 
r˝_Àn2
 = 1 / (
øy
[0]*ray[0] +Ñay[1]*ray[1]);

4438 
øyn_x
 = 
øy
[0] * 
r˝_Àn2
, 
øyn_y
 =Ñay[1] *Ñcp_len2;

4440 
q0d
 = 
q0
[0]*
øyn_x
 + q0[1]*
øyn_y
;

4441 
q1d
 = 
q1
[0]*
øyn_x
 + q1[1]*
øyn_y
;

4442 
q2d
 = 
q2
[0]*
øyn_x
 + q2[1]*
øyn_y
;

4443 
rod
 = 
‹ig
[0]*
øyn_x
 + orig[1]*
øyn_y
;

4445 
q10d
 = 
q1d
 - 
q0d
;

4446 
q20d
 = 
q2d
 - 
q0d
;

4447 
q0rd
 = 
q0d
 - 
rod
;

4449 
hôs
[0][0] = 
q0rd
 + 
s0
*(2.0‡- 2.0f*s0)*
q10d
 + s0*s0*
q20d
;

4450 
hôs
[0][1] = 
a
*
s0
+
b
;

4452 i‡(
num_s
 > 1) {

4453 
hôs
[1][0] = 
q0rd
 + 
s1
*(2.0‡- 2.0f*s1)*
q10d
 + s1*s1*
q20d
;

4454 
hôs
[1][1] = 
a
*
s1
+
b
;

4460 
	}
}

4462 
	$equÆ
(*
a
, *
b
)

4464  (
a
[0] =
b
[0] &&á[1] == b[1]);

4465 
	}
}

4467 
	$°bâ__compuã_¸ossögs_x
(
x
, 
y
, 
nvîts
, 
°bâ_vîãx
 *
vîts
)

4469 
i
;

4470 
‹ig
[2], 
øy
[2] = { 1, 0 };

4471 
y_‰ac
;

4472 
wödög
 = 0;

4475 
y_‰ac
 = (Ë
	`STBTT_fmod
(
y
, 1.0f);

4476 i‡(
y_‰ac
 < 0.01f)

4477 
y
 += 0.01f;

4478 i‡(
y_‰ac
 > 0.99f)

4479 
y
 -= 0.01f;

4481 
‹ig
[0] = 
x
;

4482 
‹ig
[1] = 
y
;

4485 
i
=0; i < 
nvîts
; ++i) {

4486 i‡(
vîts
[
i
].
ty≥
 =
STBTT_vlöe
) {

4487 
x0
 = (Ë
vîts
[
i
-1].
x
, 
y0
 = (Ëvîts[i-1].
y
;

4488 
x1
 = (Ë
vîts
[
i
 ].
x
, 
y1
 = (Ëvîts[ò].
y
;

4489 i‡(
y
 > 
	`STBTT_mö
(
y0
,
y1
Ë&& y < 
	`STBTT_max
(y0,y1Ë&& 
x
 > STBTT_mö(
x0
,
x1
)) {

4490 
x_öãr
 = (
y
 - 
y0
Ë/ (
y1
 - y0Ë* (
x1
-
x0
) + x0;

4491 i‡(
x_öãr
 < 
x
)

4492 
wödög
 +(
y0
 < 
y1
) ? 1 : -1;

4495 i‡(
vîts
[
i
].
ty≥
 =
STBTT_vcurve
) {

4496 
x0
 = (Ë
vîts
[
i
-1].
x
 , 
y0
 = (Ëvîts[i-1].
y
 ;

4497 
x1
 = (Ë
vîts
[
i
 ].
cx
, 
y1
 = (Ëvîts[ò].
cy
;

4498 
x2
 = (Ë
vîts
[
i
 ].
x
 , 
y2
 = (Ëvîts[ò].
y
 ;

4499 
ax
 = 
	`STBTT_mö
(
x0
,STBTT_mö(
x1
,
x2
)), 
ay
 = STBTT_mö(
y0
,STBTT_mö(
y1
,
y2
));

4500 
by
 = 
	`STBTT_max
(
y0
,STBTT_max(
y1
,
y2
));

4501 i‡(
y
 > 
ay
 && y < 
by
 && 
x
 > 
ax
) {

4502 
q0
[2],
q1
[2],
q2
[2];

4503 
hôs
[2][2];

4504 
q0
[0] = ()
x0
;

4505 
q0
[1] = ()
y0
;

4506 
q1
[0] = ()
x1
;

4507 
q1
[1] = ()
y1
;

4508 
q2
[0] = ()
x2
;

4509 
q2
[1] = ()
y2
;

4510 i‡(
	`equÆ
(
q0
,
q1
Ë||ÉquÆ(q1,
q2
)) {

4511 
x0
 = ()
vîts
[
i
-1].
x
;

4512 
y0
 = ()
vîts
[
i
-1].
y
;

4513 
x1
 = ()
vîts
[
i
 ].
x
;

4514 
y1
 = ()
vîts
[
i
 ].
y
;

4515 i‡(
y
 > 
	`STBTT_mö
(
y0
,
y1
Ë&& y < 
	`STBTT_max
(y0,y1Ë&& 
x
 > STBTT_mö(
x0
,
x1
)) {

4516 
x_öãr
 = (
y
 - 
y0
Ë/ (
y1
 - y0Ë* (
x1
-
x0
) + x0;

4517 i‡(
x_öãr
 < 
x
)

4518 
wödög
 +(
y0
 < 
y1
) ? 1 : -1;

4521 
num_hôs
 = 
	`°bâ__øy_öãr£˘_bezõr
(
‹ig
, 
øy
, 
q0
, 
q1
, 
q2
, 
hôs
);

4522 i‡(
num_hôs
 >= 1)

4523 i‡(
hôs
[0][0] < 0)

4524 
wödög
 +(
hôs
[0][1] < 0 ? -1 : 1);

4525 i‡(
num_hôs
 >= 2)

4526 i‡(
hôs
[1][0] < 0)

4527 
wödög
 +(
hôs
[1][1] < 0 ? -1 : 1);

4532  
wödög
;

4533 
	}
}

4535 
	$°bâ__cubîoŸ
–
x
 )

4537 i‡(
x
<0)

4538  -(Ë
	`STBTT_pow
(-
x
,1.0f/3.0f);

4540  (Ë
	`STBTT_pow
–
x
,1.0f/3.0f);

4541 
	}
}

4544 
	$°bâ__sﬁve_cubic
(
a
, 
b
, 
c
, * 
r
)

4546 
s
 = -
a
 / 3;

4547 
p
 = 
b
 - 
a
*a / 3;

4548 
q
 = 
a
 * (2*a*®- 9*
b
Ë/ 27 + 
c
;

4549 
p3
 = 
p
*p*p;

4550 
d
 = 
q
*q + 4*
p3
 / 27;

4551 i‡(
d
 >= 0) {

4552 
z
 = (Ë
	`STBTT_sqπ
(
d
);

4553 
u
 = (-
q
 + 
z
) / 2;

4554 
v
 = (-
q
 - 
z
) / 2;

4555 
u
 = 
	`°bâ__cubîoŸ
(u);

4556 
v
 = 
	`°bâ__cubîoŸ
(v);

4557 
r
[0] = 
s
 + 
u
 + 
v
;

4560 
u
 = (Ë
	`STBTT_sqπ
(-
p
/3);

4561 
v
 = (Ë
	`STBTT_acos
(-
	`STBTT_sqπ
(-27/
p3
Ë* 
q
 / 2) / 3;

4562 
m
 = (Ë
	`STBTT_cos
(
v
);

4563 
n
 = (Ë
	`STBTT_cos
(
v
-3.141592/2)*1.732050808f;

4564 
r
[0] = 
s
 + 
u
 * 2 * 
m
;

4565 
r
[1] = 
s
 - 
u
 * (
m
 + 
n
);

4566 
r
[2] = 
s
 - 
u
 * (
m
 - 
n
);

4573 
	}
}

4575 
STBTT_DEF
 * 
	$°bâ_GëGlyphSDF
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
sˇÀ
, 
glyph
, 
∑ddög
, 
⁄edge_vÆue
, 
pixñ_di°_sˇÀ
, *
width
, *
height
, *
xoff
, *
yoff
)

4577 
sˇÀ_x
 = 
sˇÀ
, 
sˇÀ_y
 = scale;

4578 
ix0
,
iy0
,
ix1
,
iy1
;

4579 
w
,
h
;

4580 *
d©a
;

4582 i‡(
sˇÀ
 =0Ë 
NULL
;

4584 
	`°bâ_GëGlyphBôm≠BoxSubpixñ
(
öfo
, 
glyph
, 
sˇÀ
, sˇÀ, 0.0f,0.0f, &
ix0
,&
iy0
,&
ix1
,&
iy1
);

4587 i‡(
ix0
 =
ix1
 || 
iy0
 =
iy1
)

4588  
NULL
;

4590 
ix0
 -
∑ddög
;

4591 
iy0
 -
∑ddög
;

4592 
ix1
 +
∑ddög
;

4593 
iy1
 +
∑ddög
;

4595 
w
 = (
ix1
 - 
ix0
);

4596 
h
 = (
iy1
 - 
iy0
);

4598 i‡(
width
 ) *width = 
w
;

4599 i‡(
height
Ë*heighà
h
;

4600 i‡(
xoff
 ) *xof‡
ix0
;

4601 i‡(
yoff
 ) *yof‡
iy0
;

4604 
sˇÀ_y
 = -scale_y;

4607 
x
,
y
,
i
,
j
;

4608 *
¥ecompuã
;

4609 
°bâ_vîãx
 *
vîts
;

4610 
num_vîts
 = 
	`°bâ_GëGlyphSh≠e
(
öfo
, 
glyph
, &
vîts
);

4611 
d©a
 = (*Ë
	`STBTT_mÆloc
(
w
 * 
h
, 
öfo
->
u£rd©a
);

4612 
¥ecompuã
 = (*Ë
	`STBTT_mÆloc
(
num_vîts
 * (), 
öfo
->
u£rd©a
);

4614 
i
=0,
j
=
num_vîts
-1; i <Çum_verts; j=i++) {

4615 i‡(
vîts
[
i
].
ty≥
 =
STBTT_vlöe
) {

4616 
x0
 = 
vîts
[
i
].
x
*
sˇÀ_x
, 
y0
 = vîts[i].
y
*
sˇÀ_y
;

4617 
x1
 = 
vîts
[
j
].
x
*
sˇÀ_x
, 
y1
 = vîts[j].
y
*
sˇÀ_y
;

4618 
di°
 = (Ë
	`STBTT_sqπ
((
x1
-
x0
)*(x1-x0Ë+ (
y1
-
y0
)*(y1-y0));

4619 
¥ecompuã
[
i
] = (
di°
 == 0) ? 0.0f : 1.0f / dist;

4620 } i‡(
vîts
[
i
].
ty≥
 =
STBTT_vcurve
) {

4621 
x2
 = 
vîts
[
j
].
x
 *
sˇÀ_x
, 
y2
 = vîts[j].
y
 *
sˇÀ_y
;

4622 
x1
 = 
vîts
[
i
].
cx
*
sˇÀ_x
, 
y1
 = vîts[i].
cy
*
sˇÀ_y
;

4623 
x0
 = 
vîts
[
i
].
x
 *
sˇÀ_x
, 
y0
 = vîts[i].
y
 *
sˇÀ_y
;

4624 
bx
 = 
x0
 - 2*
x1
 + 
x2
, 
by
 = 
y0
 - 2*
y1
 + 
y2
;

4625 
Àn2
 = 
bx
*bx + 
by
*by;

4626 i‡(
Àn2
 != 0.0f)

4627 
¥ecompuã
[
i
] = 1.0‡/ (
bx
*bx + 
by
*by);

4629 
¥ecompuã
[
i
] = 0.0f;

4631 
¥ecompuã
[
i
] = 0.0f;

4634 
y
=
iy0
; y < 
iy1
; ++y) {

4635 
x
=
ix0
; x < 
ix1
; ++x) {

4636 
vÆ
;

4637 
mö_di°
 = 999999.0f;

4638 
sx
 = (Ë
x
 + 0.5f;

4639 
sy
 = (Ë
y
 + 0.5f;

4640 
x_g•a˚
 = (
sx
 / 
sˇÀ_x
);

4641 
y_g•a˚
 = (
sy
 / 
sˇÀ_y
);

4643 
wödög
 = 
	`°bâ__compuã_¸ossögs_x
(
x_g•a˚
, 
y_g•a˚
, 
num_vîts
, 
vîts
);

4645 
i
=0; i < 
num_vîts
; ++i) {

4646 
x0
 = 
vîts
[
i
].
x
*
sˇÀ_x
, 
y0
 = vîts[i].
y
*
sˇÀ_y
;

4648 i‡(
vîts
[
i
].
ty≥
 =
STBTT_vlöe
 && 
¥ecompuã
[i] != 0.0f) {

4649 
x1
 = 
vîts
[
i
-1].
x
*
sˇÀ_x
, 
y1
 = vîts[i-1].
y
*
sˇÀ_y
;

4651 
di°
,
di°2
 = (
x0
-
sx
)*(x0-sxË+ (
y0
-
sy
)*(y0-sy);

4652 i‡(
di°2
 < 
mö_di°
*min_dist)

4653 
mö_di°
 = (Ë
	`STBTT_sqπ
(
di°2
);

4658 
di°
 = (Ë
	`STBTT_Ábs
((
x1
-
x0
)*(
y0
-
sy
Ë- (
y1
-y0)*(x0-
sx
)Ë* 
¥ecompuã
[
i
];

4659 
	`STBTT_as£π
(
i
 != 0);

4660 i‡(
di°
 < 
mö_di°
) {

4664 
dx
 = 
x1
-
x0
, 
dy
 = 
y1
-
y0
;

4665 
px
 = 
x0
-
sx
, 
py
 = 
y0
-
sy
;

4668 
t
 = -(
px
*
dx
 + 
py
*
dy
) / (dx*dx + dy*dy);

4669 i‡(
t
 >= 0.0f &&Å <= 1.0f)

4670 
mö_di°
 = 
di°
;

4672 } i‡(
vîts
[
i
].
ty≥
 =
STBTT_vcurve
) {

4673 
x2
 = 
vîts
[
i
-1].
x
 *
sˇÀ_x
, 
y2
 = vîts[i-1].
y
 *
sˇÀ_y
;

4674 
x1
 = 
vîts
[
i
 ].
cx
*
sˇÀ_x
, 
y1
 = vîts[ò].
cy
*
sˇÀ_y
;

4675 
box_x0
 = 
	`STBTT_mö
(STBTT_mö(
x0
,
x1
),
x2
);

4676 
box_y0
 = 
	`STBTT_mö
(STBTT_mö(
y0
,
y1
),
y2
);

4677 
box_x1
 = 
	`STBTT_max
(STBTT_max(
x0
,
x1
),
x2
);

4678 
box_y1
 = 
	`STBTT_max
(STBTT_max(
y0
,
y1
),
y2
);

4680 i‡(
sx
 > 
box_x0
-
mö_di°
 && sx < 
box_x1
+mö_di° && 
sy
 > 
box_y0
-mö_di° && sy < 
box_y1
+min_dist) {

4681 
num
=0;

4682 
ax
 = 
x1
-
x0
, 
ay
 = 
y1
-
y0
;

4683 
bx
 = 
x0
 - 2*
x1
 + 
x2
, 
by
 = 
y0
 - 2*
y1
 + 
y2
;

4684 
mx
 = 
x0
 - 
sx
, 
my
 = 
y0
 - 
sy
;

4685 
ªs
[3] = {0.f,0.f,0.f};

4686 
px
,
py
,
t
,
ô
,
di°2
;

4687 
a_öv
 = 
¥ecompuã
[
i
];

4688 i‡(
a_öv
 == 0.0) {

4689 
a
 = 3*(
ax
*
bx
 + 
ay
*
by
);

4690 
b
 = 2*(
ax
*ax + 
ay
*ayË+ (
mx
*
bx
+
my
*
by
);

4691 
c
 = 
mx
*
ax
+
my
*
ay
;

4692 i‡(
a
 == 0.0) {

4693 i‡(
b
 != 0.0) {

4694 
ªs
[
num
++] = -
c
/
b
;

4697 
dis¸imö™t
 = 
b
*b - 4*
a
*
c
;

4698 i‡(
dis¸imö™t
 < 0)

4699 
num
 = 0;

4701 
roŸ
 = (Ë
	`STBTT_sqπ
(
dis¸imö™t
);

4702 
ªs
[0] = (-
b
 - 
roŸ
)/(2*
a
);

4703 
ªs
[1] = (-
b
 + 
roŸ
)/(2*
a
);

4704 
num
 = 2;

4708 
b
 = 3*(
ax
*
bx
 + 
ay
*
by
Ë* 
a_öv
;

4709 
c
 = (2*(
ax
*ax + 
ay
*ayË+ (
mx
*
bx
+
my
*
by
)Ë* 
a_öv
;

4710 
d
 = (
mx
*
ax
+
my
*
ay
Ë* 
a_öv
;

4711 
num
 = 
	`°bâ__sﬁve_cubic
(
b
, 
c
, 
d
, 
ªs
);

4713 
di°2
 = (
x0
-
sx
)*(x0-sxË+ (
y0
-
sy
)*(y0-sy);

4714 i‡(
di°2
 < 
mö_di°
*min_dist)

4715 
mö_di°
 = (Ë
	`STBTT_sqπ
(
di°2
);

4717 i‡(
num
 >1 && 
ªs
[0] >= 0.0f &&Ñes[0] <= 1.0f) {

4718 
t
 = 
ªs
[0], 
ô
 = 1.0f -Å;

4719 
px
 = 
ô
*ô*
x0
 + 2*
t
*ô*
x1
 +Å*t*
x2
;

4720 
py
 = 
ô
*ô*
y0
 + 2*
t
*ô*
y1
 +Å*t*
y2
;

4721 
di°2
 = (
px
-
sx
)*’x-sxË+ (
py
-
sy
)*(py-sy);

4722 i‡(
di°2
 < 
mö_di°
 * min_dist)

4723 
mö_di°
 = (Ë
	`STBTT_sqπ
(
di°2
);

4725 i‡(
num
 >2 && 
ªs
[1] >= 0.0f &&Ñes[1] <= 1.0f) {

4726 
t
 = 
ªs
[1], 
ô
 = 1.0f -Å;

4727 
px
 = 
ô
*ô*
x0
 + 2*
t
*ô*
x1
 +Å*t*
x2
;

4728 
py
 = 
ô
*ô*
y0
 + 2*
t
*ô*
y1
 +Å*t*
y2
;

4729 
di°2
 = (
px
-
sx
)*’x-sxË+ (
py
-
sy
)*(py-sy);

4730 i‡(
di°2
 < 
mö_di°
 * min_dist)

4731 
mö_di°
 = (Ë
	`STBTT_sqπ
(
di°2
);

4733 i‡(
num
 >3 && 
ªs
[2] >= 0.0f &&Ñes[2] <= 1.0f) {

4734 
t
 = 
ªs
[2], 
ô
 = 1.0f -Å;

4735 
px
 = 
ô
*ô*
x0
 + 2*
t
*ô*
x1
 +Å*t*
x2
;

4736 
py
 = 
ô
*ô*
y0
 + 2*
t
*ô*
y1
 +Å*t*
y2
;

4737 
di°2
 = (
px
-
sx
)*’x-sxË+ (
py
-
sy
)*(py-sy);

4738 i‡(
di°2
 < 
mö_di°
 * min_dist)

4739 
mö_di°
 = (Ë
	`STBTT_sqπ
(
di°2
);

4744 i‡(
wödög
 == 0)

4745 
mö_di°
 = -min_dist;

4746 
vÆ
 = 
⁄edge_vÆue
 + 
pixñ_di°_sˇÀ
 * 
mö_di°
;

4747 i‡(
vÆ
 < 0)

4748 
vÆ
 = 0;

4749 i‡(
vÆ
 > 255)

4750 
vÆ
 = 255;

4751 
d©a
[(
y
-
iy0
)*
w
+(
x
-
ix0
)] = (Ë
vÆ
;

4754 
	`STBTT_‰ì
(
¥ecompuã
, 
öfo
->
u£rd©a
);

4755 
	`STBTT_‰ì
(
vîts
, 
öfo
->
u£rd©a
);

4757  
d©a
;

4758 
	}
}

4760 
STBTT_DEF
 * 
	$°bâ_GëCodïoötSDF
(c⁄° 
°bâ_f⁄töfo
 *
öfo
, 
sˇÀ
, 
codïoöt
, 
∑ddög
, 
⁄edge_vÆue
, 
pixñ_di°_sˇÀ
, *
width
, *
height
, *
xoff
, *
yoff
)

4762  
	`°bâ_GëGlyphSDF
(
öfo
, 
sˇÀ
, 
	`°bâ_FödGlyphIndex
(öfo, 
codïoöt
), 
∑ddög
, 
⁄edge_vÆue
, 
pixñ_di°_sˇÀ
, 
width
, 
height
, 
xoff
, 
yoff
);

4763 
	}
}

4765 
STBTT_DEF
 
	$°bâ_FªeSDF
(*
bôm≠
, *
u£rd©a
)

4767 
	`STBTT_‰ì
(
bôm≠
, 
u£rd©a
);

4768 
	}
}

4776 
°bâ_öt32
 
	$°bâ__Com∑ªUTF8toUTF16_bigídün_¥efix
(
°bâ_uöt8
 *
s1
, 
°bâ_öt32
 
Àn1
, stbâ_uöt8 *
s2
, stbâ_öt32 
Àn2
)

4778 
°bâ_öt32
 
i
=0;

4781 
Àn2
) {

4782 
°bâ_uöt16
 
ch
 = 
s2
[0]*256 + s2[1];

4783 i‡(
ch
 < 0x80) {

4784 i‡(
i
 >
Àn1
)  -1;

4785 i‡(
s1
[
i
++] !
ch
)  -1;

4786 } i‡(
ch
 < 0x800) {

4787 i‡(
i
+1 >
Àn1
)  -1;

4788 i‡(
s1
[
i
++] !0xc0 + (
ch
 >> 6))  -1;

4789 i‡(
s1
[
i
++] !0x80 + (
ch
 & 0x3f))  -1;

4790 } i‡(
ch
 >= 0xd800 && ch < 0xdc00) {

4791 
°bâ_uöt32
 
c
;

4792 
°bâ_uöt16
 
ch2
 = 
s2
[2]*256 + s2[3];

4793 i‡(
i
+3 >
Àn1
)  -1;

4794 
c
 = ((
ch
 - 0xd800Ë<< 10Ë+ (
ch2
 - 0xdc00) + 0x10000;

4795 i‡(
s1
[
i
++] !0xf0 + (
c
 >> 18))  -1;

4796 i‡(
s1
[
i
++] !0x80 + ((
c
 >> 12) & 0x3f))  -1;

4797 i‡(
s1
[
i
++] !0x80 + ((
c
 >> 6) & 0x3f))  -1;

4798 i‡(
s1
[
i
++] !0x80 + ((
c
 ) & 0x3f))  -1;

4799 
s2
 += 2;

4800 
Àn2
 -= 2;

4801 } i‡(
ch
 >= 0xdc00 && ch < 0xe000) {

4804 i‡(
i
+2 >
Àn1
)  -1;

4805 i‡(
s1
[
i
++] !0xe0 + (
ch
 >> 12))  -1;

4806 i‡(
s1
[
i
++] !0x80 + ((
ch
 >> 6) & 0x3f))  -1;

4807 i‡(
s1
[
i
++] !0x80 + ((
ch
 ) & 0x3f))  -1;

4809 
s2
 += 2;

4810 
Àn2
 -= 2;

4812  
i
;

4813 
	}
}

4815 
	$°bâ_Com∑ªUTF8toUTF16_bigídün_öã∫Æ
(*
s1
, 
Àn1
, *
s2
, 
Àn2
)

4817  
Àn1
 =
	`°bâ__Com∑ªUTF8toUTF16_bigídün_¥efix
((
°bâ_uöt8
*Ë
s1
,Üí1, (°bâ_uöt8*Ë
s2
, 
Àn2
);

4818 
	}
}

4822 
STBTT_DEF
 c⁄° *
	$°bâ_GëF⁄tNameSåög
(c⁄° 
°bâ_f⁄töfo
 *
f⁄t
, *
Àngth
, 
∂©f‹mID
, 
ícodögID
, 
œnguageID
, 
«meID
)

4824 
°bâ_öt32
 
i
,
cou¡
,
°rögOff£t
;

4825 
°bâ_uöt8
 *
fc
 = 
f⁄t
->
d©a
;

4826 
°bâ_uöt32
 
off£t
 = 
f⁄t
->
f⁄t°¨t
;

4827 
°bâ_uöt32
 
nm
 = 
	`°bâ__föd_èbÀ
(
fc
, 
off£t
, "name");

4828 i‡(!
nm
Ë 
NULL
;

4830 
cou¡
 = 
	`âUSHORT
(
fc
+
nm
+2);

4831 
°rögOff£t
 = 
nm
 + 
	`âUSHORT
(
fc
+nm+4);

4832 
i
=0; i < 
cou¡
; ++i) {

4833 
°bâ_uöt32
 
loc
 = 
nm
 + 6 + 12 * 
i
;

4834 i‡(
∂©f‹mID
 =
	`âUSHORT
(
fc
+
loc
+0Ë&& 
ícodögID
 ==ÅtUSHORT(fc+loc+2)

4835 && 
œnguageID
 =
	`âUSHORT
(
fc
+
loc
+4Ë&& 
«meID
 ==ÅtUSHORT(fc+loc+6)) {

4836 *
Àngth
 = 
	`âUSHORT
(
fc
+
loc
+8);

4837  (c⁄° *Ë(
fc
+
°rögOff£t
+
	`âUSHORT
(fc+
loc
+10));

4840  
NULL
;

4841 
	}
}

4843 
	$°bâ__m©ch∑ú
(
°bâ_uöt8
 *
fc
, 
°bâ_uöt32
 
nm
, stbâ_uöt8 *
«me
, 
°bâ_öt32
 
∆í
, stbâ_öt32 
èrgë_id
, stbâ_öt32 
√xt_id
)

4845 
°bâ_öt32
 
i
;

4846 
°bâ_öt32
 
cou¡
 = 
	`âUSHORT
(
fc
+
nm
+2);

4847 
°bâ_öt32
 
°rögOff£t
 = 
nm
 + 
	`âUSHORT
(
fc
+nm+4);

4849 
i
=0; i < 
cou¡
; ++i) {

4850 
°bâ_uöt32
 
loc
 = 
nm
 + 6 + 12 * 
i
;

4851 
°bâ_öt32
 
id
 = 
	`âUSHORT
(
fc
+
loc
+6);

4852 i‡(
id
 =
èrgë_id
) {

4854 
°bâ_öt32
 
∂©f‹m
 = 
	`âUSHORT
(
fc
+
loc
+0), 
ícodög
 =ÅtUSHORT(fc+loc+2), 
œnguage
 =ÅtUSHORT(fc+loc+4);

4857 i‡(
∂©f‹m
 =0 || (∂©f‹m =3 && 
ícodög
 == 1) || (platform == 3 &&Éncoding == 10)) {

4858 
°bâ_öt32
 
¶í
 = 
	`âUSHORT
(
fc
+
loc
+8);

4859 
°bâ_öt32
 
off
 = 
	`âUSHORT
(
fc
+
loc
+10);

4862 
°bâ_öt32
 
m©chÀn
 = 
	`°bâ__Com∑ªUTF8toUTF16_bigídün_¥efix
(
«me
, 
∆í
, 
fc
+
°rögOff£t
+
off
,
¶í
);

4863 i‡(
m©chÀn
 >= 0) {

4865 i‡(
i
+1 < 
cou¡
 && 
	`âUSHORT
(
fc
+
loc
+12+6Ë=
√xt_id
 &&ÅtUSHORT(fc+loc+12Ë=
∂©f‹m
 &&ÅtUSHORT(fc+loc+12+2Ë=
ícodög
 &&ÅtUSHORT(fc+loc+12+4Ë=
œnguage
) {

4866 
¶í
 = 
	`âUSHORT
(
fc
+
loc
+12+8);

4867 
off
 = 
	`âUSHORT
(
fc
+
loc
+12+10);

4868 i‡(
¶í
 == 0) {

4869 i‡(
m©chÀn
 =
∆í
)

4871 } i‡(
m©chÀn
 < 
∆í
 && 
«me
[matchlen] == ' ') {

4872 ++
m©chÀn
;

4873 i‡(
	`°bâ_Com∑ªUTF8toUTF16_bigídün_öã∫Æ
((*Ë(
«me
+
m©chÀn
), 
∆í
-m©chÀn, (*)(
fc
+
°rögOff£t
+
off
),
¶í
))

4878 i‡(
m©chÀn
 =
∆í
)

4888 
	}
}

4890 
	$°bâ__m©ches
(
°bâ_uöt8
 *
fc
, 
°bâ_uöt32
 
off£t
, stbâ_uöt8 *
«me
, 
°bâ_öt32
 
Êags
)

4892 
°bâ_öt32
 
∆í
 = (°bâ_öt32Ë
	`STBTT_°æí
((*Ë
«me
);

4893 
°bâ_uöt32
 
nm
,
hd
;

4894 i‡(!
	`°bâ__isf⁄t
(
fc
+
off£t
))  0;

4897 i‡(
Êags
) {

4898 
hd
 = 
	`°bâ__föd_èbÀ
(
fc
, 
off£t
, "head");

4899 i‡((
	`âUSHORT
(
fc
+
hd
+44Ë& 7Ë!(
Êags
 & 7))  0;

4902 
nm
 = 
	`°bâ__föd_èbÀ
(
fc
, 
off£t
, "name");

4903 i‡(!
nm
)  0;

4905 i‡(
Êags
) {

4907 i‡(
	`°bâ__m©ch∑ú
(
fc
, 
nm
, 
«me
, 
∆í
, 16, -1))  1;

4908 i‡(
	`°bâ__m©ch∑ú
(
fc
, 
nm
, 
«me
, 
∆í
, 1, -1))  1;

4909 i‡(
	`°bâ__m©ch∑ú
(
fc
, 
nm
, 
«me
, 
∆í
, 3, -1))  1;

4911 i‡(
	`°bâ__m©ch∑ú
(
fc
, 
nm
, 
«me
, 
∆í
, 16, 17))  1;

4912 i‡(
	`°bâ__m©ch∑ú
(
fc
, 
nm
, 
«me
, 
∆í
, 1, 2))  1;

4913 i‡(
	`°bâ__m©ch∑ú
(
fc
, 
nm
, 
«me
, 
∆í
, 3, -1))  1;

4917 
	}
}

4919 
	$°bâ_FödM©chögF⁄t_öã∫Æ
(*
f⁄t_cﬁÀ˘i⁄
, *
«me_utf8
, 
°bâ_öt32
 
Êags
)

4921 
°bâ_öt32
 
i
;

4922 
i
=0;;++i) {

4923 
°bâ_öt32
 
off
 = 
	`°bâ_GëF⁄tOff£tF‹Index
(
f⁄t_cﬁÀ˘i⁄
, 
i
);

4924 i‡(
off
 < 0)  off;

4925 i‡(
	`°bâ__m©ches
((
°bâ_uöt8
 *Ë
f⁄t_cﬁÀ˘i⁄
, 
off
, (°bâ_uöt8*Ë
«me_utf8
, 
Êags
))

4926  
off
;

4928 
	}
}

4930 #i‡
deföed
(
__GNUC__
Ë|| deföed(
__˛™g__
)

4931 #¥agm®
GCC
 
dügno°ic
 
push


4932 #¥agm®
GCC
 
dügno°ic
 
ign‹ed
 "-Wcast-qual"

4935 
STBTT_DEF
 
	$°bâ_BakeF⁄tBôm≠
(c⁄° *
d©a
, 
off£t
,

4936 
pixñ_height
, *
pixñs
, 
pw
, 
ph
,

4937 
fú°_ch¨
, 
num_ch¨s
, 
°bâ_bakedch¨
 *
ch¨d©a
)

4939  
	`°bâ_BakeF⁄tBôm≠_öã∫Æ
((*Ë
d©a
, 
off£t
, 
pixñ_height
, 
pixñs
, 
pw
, 
ph
, 
fú°_ch¨
, 
num_ch¨s
, 
ch¨d©a
);

4940 
	}
}

4942 
STBTT_DEF
 
	$°bâ_GëF⁄tOff£tF‹Index
(c⁄° *
d©a
, 
ödex
)

4944  
	`°bâ_GëF⁄tOff£tF‹Index_öã∫Æ
((*Ë
d©a
, 
ödex
);

4945 
	}
}

4947 
STBTT_DEF
 
	$°bâ_GëNumbîOfF⁄ts
(c⁄° *
d©a
)

4949  
	`°bâ_GëNumbîOfF⁄ts_öã∫Æ
((*Ë
d©a
);

4950 
	}
}

4952 
STBTT_DEF
 
	$°bâ_InôF⁄t
(
°bâ_f⁄töfo
 *
öfo
, c⁄° *
d©a
, 
off£t
)

4954  
	`°bâ_InôF⁄t_öã∫Æ
(
öfo
, (*Ë
d©a
, 
off£t
);

4955 
	}
}

4957 
STBTT_DEF
 
	$°bâ_FödM©chögF⁄t
(c⁄° *
f⁄td©a
, c⁄° *
«me
, 
Êags
)

4959  
	`°bâ_FödM©chögF⁄t_öã∫Æ
((*Ë
f⁄td©a
, (*Ë
«me
, 
Êags
);

4960 
	}
}

4962 
STBTT_DEF
 
	$°bâ_Com∑ªUTF8toUTF16_bigídün
(c⁄° *
s1
, 
Àn1
, c⁄° *
s2
, 
Àn2
)

4964  
	`°bâ_Com∑ªUTF8toUTF16_bigídün_öã∫Æ
((*Ë
s1
, 
Àn1
, (*Ë
s2
, 
Àn2
);

4965 
	}
}

4967 #i‡
deföed
(
__GNUC__
Ë|| deföed(
__˛™g__
)

4968 #¥agm®
GCC
 
dügno°ic
 
p›


	@math.h

1 
	~<m©h.h
>

3 
	#Abs
(
a
Ë(◊Ë> 0 ? (aË: -◊))

	)

4 
	#Mod
(
a
, 
m
Ë((◊Ë% (m)Ë>0 ? (◊Ë% (m)Ë: ((◊Ë% (m)Ë+ (m)))

	)

6 
	$DegToRad
(
degªes
Ë{  degªe†* (
PI32
/180.0f); 
	}
}

7 
	$RadToDeg
(
ødüns
Ë{ Ñadün†* (180/
PI32
); 
	}
}

8 
	$InR™ge
(
vÆ
, 
mö
, 
max
Ë{  (vÆ > möË&& (vÆ < max); 
	}
}

9 
	$InR™geMöInc
(
vÆ
, 
mö
, 
max
Ë{  (vÆ >möË&& (vÆ < max); 
	}
}

10 
	$InR™geMaxInc
(
vÆ
, 
mö
, 
max
Ë{  (vÆ > möË&& (vÆ <max); 
	}
}

11 
	$InR™geMöMaxInc
(
vÆ
, 
mö
, 
max
Ë{  (vÆ >möË&& (vÆ <max); 
	}
}

14 
	$Cœmp
(
Mö
, 
VÆue
, 
Max
) {

15 
Resu…
 = 
VÆue
;

17 if(
Resu…
 < 
Mö
) Result = Min;

18 if(
Resu…
 > 
Max
) Result = Max;

20 (
Resu…
);

21 
	}
}

24 
	sVec2u
 {

27 
u32
 
	mx
;

28 
u32
 
	my
;

30 
u32
 
	mñem
[2];

34 
	sVec2
 {

37 
	mx
;

38 
	my
;

40 
	mñem
[2];

44 
	sVec3
 {

47 
	mx
;

48 
	my
;

49 
	mz
;

51 
	mñem
[3];

55 
	sVec4
 {

58 
	mx
;

59 
	my
;

60 
	mz
;

61 
	mw
;

64 
Vec3
 
	mxyz
;

65 
	mz
;

67 
	mñem
[4];

71 
	sQu©
 {

74 
	mx
, 
	my
, 
	mz
, 
	mw
;

77 
Vec3
 
	mxyz
;

78 
	mz
;

80 
	mñem
[4];

85 
	sM©4
 {

86 
	mñem
[4][4];

89 
	sTønsf‹m
 {

90 
Vec3
 
	mposôi⁄
;

91 
Qu©
 
	mrŸ©i⁄
;

92 
Vec3
 
	msˇÀ
;

96 
Vec2
 
	$V2
(
x
, 
y
Ë{  
Vec2
 { x, y }; 
	}
}

97 
Vec2
 
	$V2I
(Ë{  
Vec2
 { 1.0f, 1.0‡}; 
	}
}

98 
Vec2
 
	$V2Z
(Ë{  
Vec2
 { 0.0f, 0.0‡}; 
	}
}

100 
Vec3
 
	$V3
(
x
, 
y
, 
z
Ë{  
Vec3
 { x, y, z }; 
	}
}

101 
Vec3
 
	$V3I
(Ë{  
Vec3
 { 1.0f, 1.0f, 1.0‡}; 
	}
}

102 
Vec3
 
	$V3Z
(Ë{  
Vec3
 { 0.0f, 0.0f, 0.0‡}; 
	}
}

103 
Vec3
 
	$V3Up
(Ë{  
Vec3
 { 0.0f, 1.0f, 0.0‡}; 
	}
}

104 
Vec3
 
	$V3Right
(Ë{  
Vec3
 { 1.0f, 0.0f, 0.0‡}; 
	}
}

105 
Vec3
 
	$V3F‹w¨d
(Ë{  
Vec3
 { 0.0f, 0.0f, 1.0‡}; 
	}
}

107 
Vec4
 
	$V4
(
x
, 
y
, 
z
, 
w
Ë{  
Vec4
 { x, y, z, w }; 
	}
}

108 
Vec4
 
	$V4FromV3
(
Vec3
 
xyz
, 
w
Ë{  
Vec4
 { xyz.
x
, xyz.
y
, xyz.
z
, w }; 
	}
}

109 
Vec4
 
	$V4I
(Ë{  
Vec4
 { 1.0f, 1.0f, 1.0f, 1.0‡}; 
	}
}

110 
Vec4
 
	$V4Z
(Ë{  
Vec4
 { 0.0f, 0.0f, 0.0f, 0.0‡}; 
	}
}

112 
Qu©
 
	$MakeQu©
(
x
, 
y
, 
z
, 
w
Ë{  
Qu©
 { x, y, z, w}; 
	}
}

113 
Qu©
 
	$MakeQu©FromV3
(
Vec3
 
vec
Ë{  
Qu©
 { vec.
x
, vec.
y
, vec.
z
, 1 }; 
	}
}

114 
Qu©
 
	$MakeQu©FromV4
(
Vec4
 
vec
Ë{  
Qu©
 { vec.
x
, vec.
y
, vec.
z
, vec.
w
 }; 
	}
}

115 
Qu©
 
	$Qu©I
(Ë{  
Qu©
 { 0.0f, 0.0f, 0.0f, 1.0‡}; 
	}
}

117 
	#BLACK
 
	`V3
(0.0f, 0.0f, 0.0f)

	)

118 
	#WHITE
 
	`V3
(1.0f, 1.0f, 1.0f)

	)

119 
	#JET
 
	`V3
(0.2f, 0.2f, 0.2f)

	)

120 
	#GREY
 
	`V3
(0.5f, 0.5f, 0.5f)

	)

121 
	#SILVER
 
	`V3
(0.75f, 0.75f, 0.75f)

	)

123 
	#BLUE
 
	`V3
(0.0f, 0.0f, 1.0f)

	)

124 
	#CYAN
 
	`V3
(0.0f, 1.0f, 1.0f)

	)

125 
	#TEAL
 
	`V3
(0.0f, 0.5f, 0.5f)

	)

127 
	#RED
 
	`V3
(1.0f, 0.0f, 0.0f)

	)

128 
	#MAROON
 
	`V3
(0.5f, 0.0f, 0.0f)

	)

129 
	#CRIMSON
 
	`V3
(0.8f, 0.1f, 0.2f)

	)

131 
	#LIME
 
	`V3
(0.0f, 1.0f, 0.0f)

	)

132 
	#GREEN
 
	`V3
(0.0f, 0.5f, 0.0f)

	)

134 
	#OLIVE
 
	`V3
(0.5f, 0.5f, 0.0f)

	)

135 
	#YELLOW
 
	`V3
(1.0f, 1.0f, 0.0f)

	)

136 
	#ORANGE
 
	`V3
(1.0f, 0.6f, 0.0f)

	)

138 
	#MAGENTA
 
	`V3
(1.0f, 0.0f, 1.0f)

	)

139 
	#PURPLE
 
	`V3
(0.5f, 0.0f, 0.5f)

	)

141 
Tønsf‹m
 
	$Tønsf‹mI
(Ë{  
Tønsf‹m
 { 
	`V3Z
(), 
	`Qu©I
(), 
	`V3I
(Ë}; 
	}
}

143 
Vec2
 
	$V2Add
(
Vec2
 
À·
, Vec2 
right
) {

144  
Vec2
 { 
À·
.
x
 + 
right
.x,Üe·.
y
 +Ñight.y };

145 
	}
}

146 
Vec2
 
	$V2Sub
(
Vec2
 
À·
, Vec2 
right
) {

147  
Vec2
 { 
À·
.
x
 - 
right
.x,Üe·.
y
 -Ñight.y };

148 
	}
}

149 
Vec2
 
	$V2Mul
(
Vec2
 
À·
, Vec2 
right
) {

150  
Vec2
 { 
À·
.
x
 * 
right
.x,Üe·.
y
 *Ñight.y };

151 
	}
}

152 
Vec2
 
	$V2Div
(
Vec2
 
À·
, Vec2 
right
) {

153  
Vec2
 { 
À·
.
x
/
right
.x,Üe·.
y
/right.y };

154 
	}
}

155 
Vec2
 
	$V2AddF
(
Vec2
 
À·
, 
sˇœr
) {

156  
Vec2
 { 
À·
.
x
 + 
sˇœr
,Üe·.
y
 + scalar };

157 
	}
}

158 
Vec2
 
	$V2SubF
(
Vec2
 
À·
, 
sˇœr
) {

159  
Vec2
 { 
À·
.
x
 - 
sˇœr
,Üe·.
y
 - scalar };

160 
	}
}

161 
Vec2
 
	$V2MulF
(
Vec2
 
À·
, 
sˇœr
) {

162  
Vec2
 { 
À·
.
x
*
sˇœr
,Üe·.
y
*scalar };

163 
	}
}

164 
Vec2
 
	$V2DivF
(
Vec2
 
À·
, 
sˇœr
) {

165  
Vec2
 { 
À·
.
x
/
sˇœr
,Üe·.
y
/scalar };

166 
	}
}

167 
	$V2DŸ
(
Vec2
 
À·
, Vec2 
right
) {

168  
À·
.
x
*
right
.x +Üe·.
y
*right.y;

169 
	}
}

171 
Vec3
 
	$V3Add
(
Vec3
 
À·
, Vec3 
right
) {

172  
Vec3
 { 
À·
.
x
 + 
right
.x,Üe·.
y
 +Ñight.y,Üe·.
z
 +Ñight.z };

173 
	}
}

174 
Vec3
 
	$V3Sub
(
Vec3
 
À·
, Vec3 
right
) {

175  
Vec3
 { 
À·
.
x
 - 
right
.x,Üe·.
y
 -Ñight.y,Üe·.
z
 -Ñight.z };

176 
	}
}

177 
Vec3
 
	$V3Mul
(
Vec3
 
À·
, Vec3 
right
) {

178  
Vec3
 { 
À·
.
x
 * 
right
.x,Üe·.
y
 *Ñight.y,Üe·.
z
 *Ñight.z };

179 
	}
}

180 
Vec3
 
	$V3Div
(
Vec3
 
À·
, Vec3 
right
) {

181  
Vec3
 { 
À·
.
x
 / 
right
.x,Üe·.
y
 /Ñight.y,Üe·.
z
 /Ñight.z };

182 
	}
}

183 
Vec3
 
	$V3AddF
(
Vec3
 
À·
, 
sˇœr
) {

184  
Vec3
 { 
À·
.
x
 + 
sˇœr
,Üe·.
y
 + sˇœr,Üe·.
z
 + scalar };

185 
	}
}

186 
Vec3
 
	$V3SubF
(
Vec3
 
À·
, 
sˇœr
) {

187  
Vec3
 { 
À·
.
x
 - 
sˇœr
,Üe·.
y
 - sˇœr,Üe·.
z
 - scalar };

188 
	}
}

189 
Vec3
 
	$V3MulF
(
Vec3
 
À·
, 
sˇœr
) {

190  
Vec3
 { 
À·
.
x
*
sˇœr
,Üe·.
y
*sˇœr,Üe·.
z
*scalar };

191 
	}
}

192 
Vec3
 
	$V3DivF
(
Vec3
 
À·
, 
sˇœr
) {

193  
Vec3
 { 
À·
.
x
/
sˇœr
,Üe·.
y
/sˇœr,Üe·.
z
/scalar };

194 
	}
}

195 
boﬁ
 
	$Vec3EquÆs
(
Vec3
 
À·
, Vec3 
right
) {

196  (
À·
.
x
 =
right
.xË&& (À·.
y
 =right.yË&& (À·.
z
 ==Ñight.z);

197 
	}
}

198 
	$V3MagSqu¨ed
(
Vec3
 
vec
) {

199  (
vec
.
x
*vec.xË+ (vec.
y
*vec.yË+ (vec.
z
*vec.z);

200 
	}
}

201 
Vec3
 
	$V3Neg
(
Vec3
 
vec
Ë{  
	`V3Sub
(
	`V3Z
(), vec); 
	}
}

203 
	$V3Mag
(
Vec3
 
vec
) {

204  
	`sqπf
(
	`V3MagSqu¨ed
(
vec
));

205 
	}
}

206 
Vec3
 
	$V3N‹m
(
Vec3
 
vec
) {

207 
Vec3
 
ªsu…
 = {};

208 
mag
 = 
	`V3Mag
(
vec
);

209 if(
mag
) {

210 
ªsu…
.
x
 = 
vec
.x * (1.0‡/ 
mag
);

211 
ªsu…
.
y
 = 
vec
.y * (1.0‡/ 
mag
);

212 
ªsu…
.
z
 = 
vec
.z * (1.0‡/ 
mag
);

214  
ªsu…
;

215 
	}
}

216 
Vec3
 
	$V3Cross
(
Vec3
 
À·
, Vec3 
right
) {

217  
Vec3
 { (
À·
.
y
*
right
.
z
) - (left.z*right.y),

218 (
À·
.
z
*
right
.
x
) - (left.x*right.z),

219 (
À·
.
x
*
right
.
y
) - (left.y*right.x) };

220 
	}
}

221 
	$V3DŸ
(
Vec3
 
À·
, Vec3 
right
) {

222  
À·
.
x
*
right
.x +Üe·.
y
*right.y +Üe·.
z
*right.z;

223 
	}
}

225 
M©4
 
	$M4I
() {

226  
M©4
 { 1.0f, 0.0f, 0.0f, 0.0f,

230 
	}
}

232 
M©4
 
	$M4Tøn•o£
(
M©4
 
m©
) {

233 
M©4
 
ªsu…
 = 
	`M4I
();

234 
u8
 
cﬁ
=0; col<4; col++)

235 
u8
 
row
=0;Ñow<4;Ñow++)

236 
ªsu…
.
ñem
[
cﬁ
][
row
] = 
m©
.elem[row][col];

237  
ªsu…
;

238 
	}
}

240 
M©4
 
	$M4Mul
(
M©4
 
À·
, M©4 
right
) {

241 
M©4
 
ªsu…
 = 
	`M4I
();

242 
u8
 
cﬁ
 = 0; col < 4; col++) {

243 
u8
 
row
 = 0;Ñow < 4;Ñow++) {

244 
sum
 = 0;

245 
u8
 
k
 = 0; k < 4; k++Ë
sum
 +
À·
.
ñem
[k][
row
] * 
right
.ñem[
cﬁ
][k];

246 
ªsu…
.
ñem
[
cﬁ
][
row
] = 
sum
;

249  
ªsu…
;

250 
	}
}

252 
M©4
 
	$M4MulF
(
M©4
 
m©
, 
sˇœr
) {

253 
M©4
 
ªsu…
 = 
	`M4I
();

254 
u8
 
cﬁ
=0; col<4; col++)

255 
u8
 
row
=0;Ñow<4;Ñow++)

256 
ªsu…
.
ñem
[
cﬁ
][
row
] = 
m©
.ñem[cﬁ][row] * 
sˇœr
;

257  
ªsu…
;

258 
	}
}

260 
Vec4
 
	$M4MulV
(
M©4
 
m©
, 
Vec4
 
vec
) {

261 
Vec4
 
ªsu…
 = {};

262 
u8
 
row
=0;Ñow<4;Ñow++) {

263 
sum
 = 0;

264 
u8
 
cﬁ
=0; cﬁ<4; cﬁ++Ë
sum
 +
m©
.
ñem
[cﬁ][
row
] * 
vec
.elem[col];

265 
ªsu…
.
ñem
[
row
] = 
sum
;

267  
ªsu…
;

268 
	}
}

270 
M©4
 
	$M4Oπhogøphic
(
À·
, 
right
, 
bŸtom
,

271 
t›
, 
Nór
, 
F¨
) {

272 
M©4
 
ªsu…
 = 
	`M4I
();

274 
ªsu…
.
ñem
[0][0] = 2.0‡/ (
right
-
À·
);

275 
ªsu…
.
ñem
[1][1] = 2.0‡/ (
t›
-
bŸtom
);

276 
ªsu…
.
ñem
[2][2] = 2.0‡/ (
Nór
-
F¨
);

277 
ªsu…
.
ñem
[3][3] = 1.0f;

279 
ªsu…
.
ñem
[3][0] = (
À·
+
right
) / (left-right);

280 
ªsu…
.
ñem
[3][1] = (
bŸtom
+
t›
) / (bottom-top);

281 
ªsu…
.
ñem
[3][2] = (
F¨
+
Nór
) / (Near-Far);

283  
ªsu…
;

284 
	}
}

286 
M©4
 
	$M4Pî•e˘ive
(
fov
, 
a•e˘_øtio
, 
Nór
, 
F¨
) {

287 
M©4
 
ªsu…
 ={};

288 
cŸ
 = 1.0‡/ 
	`ènf
(
fov
 * (
PI32
/360.0f));

289 
ªsu…
.
ñem
[0][0] = 
cŸ
 / 
a•e˘_øtio
;

290 
ªsu…
.
ñem
[1][1] = 
cŸ
;

291 
ªsu…
.
ñem
[2][3] = -1.0f;

292 
ªsu…
.
ñem
[2][2] = (
Nór
+
F¨
) / (Near-Far);

293 
ªsu…
.
ñem
[3][2] = (2.0f*
Nór
*
F¨
) / (Near-Far);

294 
ªsu…
.
ñem
[3][3] = 0.0f;

295  
ªsu…
;

296 
	}
}

298 
M©4
 
	$M4Tøn¶©e
(
Vec3
 
å™¶©i⁄
) {

299 
M©4
 
ªsu…
 = 
	`M4I
();

300 
ªsu…
.
ñem
[3][0] = 
å™¶©i⁄
.
x
;

301 
ªsu…
.
ñem
[3][1] = 
å™¶©i⁄
.
y
;

302 
ªsu…
.
ñem
[3][2] = 
å™¶©i⁄
.
z
;

303  
ªsu…
;

304 
	}
}

306 
M©4
 
	$M4RŸ©e
(
Vec3
 
axis
, 
™gÀ
) {

307 
M©4
 
ªsu…
 = 
	`M4I
();

308 
axis
 = 
	`V3N‹m
(axis);

309 
sö
 = 
	`söf
(
	`DegToRad
(
™gÀ
));

310 
cos
 = 
	`cosf
(
	`DegToRad
(
™gÀ
));

311 
⁄e_möus_cos
 = 1.0‡- 
cos
;

313 
ªsu…
.
ñem
[0][0] = (
axis
.
x
*axis.x*
⁄e_möus_cos
Ë+ 
cos
;

314 
ªsu…
.
ñem
[0][1] = (
axis
.
x
*axis.
y
*
⁄e_möus_cos
Ë+ (axis.
z
*
sö
);

315 
ªsu…
.
ñem
[0][2] = (
axis
.
x
*axis.
z
*
⁄e_möus_cos
Ë- (axis.
y
*
sö
);

317 
ªsu…
.
ñem
[1][0] = (
axis
.
y
*axis.
x
*
⁄e_möus_cos
Ë- (axis.
z
*
sö
);

318 
ªsu…
.
ñem
[1][1] = (
axis
.
y
*axis.y*
⁄e_möus_cos
Ë+ 
cos
;

319 
ªsu…
.
ñem
[1][2] = (
axis
.
y
*axis.
z
*
⁄e_möus_cos
Ë+ (axis.
x
*
sö
);

321 
ªsu…
.
ñem
[2][0] = (
axis
.
z
*axis.
x
*
⁄e_möus_cos
Ë+ (axis.
y
*
sö
);

322 
ªsu…
.
ñem
[2][1] = (
axis
.
z
*axis.
y
*
⁄e_möus_cos
Ë- (axis.
x
*
sö
);

323 
ªsu…
.
ñem
[2][2] = (
axis
.
z
*axis.z*
⁄e_möus_cos
Ë+ 
cos
;

325  
ªsu…
;

326 
	}
}

328 
M©4
 
	$M4SˇÀ
(
Vec3
 
sˇÀ
) {

329 
M©4
 
ªsu…
 = 
	`M4I
();

330 
ªsu…
.
ñem
[0][0] = 
sˇÀ
.
x
;

331 
ªsu…
.
ñem
[1][1] = 
sˇÀ
.
y
;

332 
ªsu…
.
ñem
[2][2] = 
sˇÀ
.
z
;

333  
ªsu…
;

334 
	}
}

336 
M©4
 
	$M4LookAt
(
Vec3
 
pos
, Vec3 
èrgë
, Vec3 
Up
) {

337 
M©4
 
ªsu…
 = 
	`M4I
();

339 
Vec3
 
F
 = 
	`V3N‹m
(
	`V3Sub
(
èrgë
, 
pos
));

340 
Vec3
 
S
 = 
	`V3N‹m
(
	`V3Cross
(
F
, 
Up
));

341 
Vec3
 
U
 = 
	`V3Cross
(
S
, 
F
);

343 
ªsu…
.
ñem
[0][0] = 
S
.
x
;

344 
ªsu…
.
ñem
[0][1] = 
U
.
x
;

345 
ªsu…
.
ñem
[0][2] = -
F
.
x
;

346 
ªsu…
.
ñem
[0][3] = 0.0f;

348 
ªsu…
.
ñem
[1][0] = 
S
.
y
;

349 
ªsu…
.
ñem
[1][1] = 
U
.
y
;

350 
ªsu…
.
ñem
[1][2] = -
F
.
y
;

351 
ªsu…
.
ñem
[1][3] = 0.0f;

353 
ªsu…
.
ñem
[2][0] = 
S
.
z
;

354 
ªsu…
.
ñem
[2][1] = 
U
.
z
;

355 
ªsu…
.
ñem
[2][2] = -
F
.
z
;

356 
ªsu…
.
ñem
[2][3] = 0.0f;

358 
ªsu…
.
ñem
[3][0] = -
	`V3DŸ
(
S
, 
pos
);

359 
ªsu…
.
ñem
[3][1] = -
	`V3DŸ
(
U
, 
pos
);

360 
ªsu…
.
ñem
[3][2] = 
	`V3DŸ
(
F
, 
pos
);

361 
ªsu…
.
ñem
[3][3] = 1.0f;

363  
ªsu…
;

364 
	}
}

366 
Qu©
 
	$Qu©Add
(
Qu©
 
À·
, Qu© 
right
) {

367  
Qu©
 { 
À·
.
x
+
right
.x,Üe·.
y
+right.y,Üe·.
z
+right.z,Üe·.
w
+right.w };

368 
	}
}

369 
Qu©
 
	$Qu©Sub
(
Qu©
 
À·
, Qu© 
right
) {

370  
Qu©
 { 
À·
.
x
-
right
.x,Üe·.
y
-right.y,Üe·.
z
-right.z,Üe·.
w
-right.w };

371 
	}
}

374 
Qu©
 
	$Qu©Mul
(
Qu©
 
À·
, Qu© 
right
) {

375 
Qu©
 
ªsu…
 = {};

376 
ªsu…
.
x
 = (
À·
.x*
right
.
w
Ë+ (À·.
y
*right.
z
) - (left.z*right.y) + (left.w*right.x);

377 
ªsu…
.
y
 = (-
À·
.
x
*
right
.
z
Ë+ (À·.y*right.
w
) + (left.z*right.x) + (left.w*right.y);

378 
ªsu…
.
z
 = (
À·
.
x
*
right
.
y
Ë- (À·.y*right.xË+ (À·.z*right.
w
) + (left.w*right.z);

379 
ªsu…
.
w
 = (-
À·
.
x
*
right
.xË- (À·.
y
*right.yË- (À·.
z
*right.z) + (left.w*right.w);

380  
ªsu…
;

381 
	}
}

382 
Qu©
 
	$Qu©MulF
(
Qu©
 
qu©
, 
sˇœr
) {

383  
Qu©
 { 
qu©
.
x
*
sˇœr
, qu©.
y
*sˇœr, qu©.
z
*sˇœr, qu©.
w
*scalar };

384 
	}
}

385 
Qu©
 
	$Qu©DivF
(
Qu©
 
qu©
, 
sˇœr
) {

386  
Qu©
 { 
qu©
.
x
/
sˇœr
, qu©.
y
/sˇœr, qu©.
z
/sˇœr, qu©.
w
/scalar };

387 
	}
}

388 
	$Qu©DŸ
(
Qu©
 
À·
, Qu© 
right
) {

389  (
À·
.
x
*
right
.xË+ (À·.
y
*right.yË+ (À·.
z
*right.zË+ (À·.
w
*right.w);

390 
	}
}

391 
Qu©
 
	$Qu©Invî£
(
Qu©
 
qu©
) {

392 
Qu©
 
ªsu…
 = { -
qu©
.
x
, -qu©.
y
, -qu©.
z
, qu©.
w
 };

393 
ªsu…
 = 
	`Qu©DivF
‘esu…, 
	`Qu©DŸ
(
qu©
, quat));

394  
ªsu…
;

395 
	}
}

396 
Qu©
 
	$Qu©N‹m
(
Qu©
 
qu©
) {

397 
Qu©
 
ªsu…
 = {};

398 
mag
 = 
	`sqπf
(
	`Qu©DŸ
(
qu©
, quat));

399 
ªsu…
 = 
	`Qu©DivF
(
qu©
, 
mag
);

400  
ªsu…
;

401 
	}
}

403 
M©4
 
	$M4FromQu©
(
Qu©
 
qu©
) {

404 
M©4
 
ªsu…
 = 
	`M4I
();

405 
Qu©
 
qu©_n‹m
 = 
	`Qu©N‹m
(
qu©
);

406 
xx
, 
yy
, 
zz
, 
xy
, 
xz
, 
yz
, 
wx
, 
wy
, 
wz
;

407 
xx
 = 
qu©_n‹m
.
x
 * quat_norm.x;

408 
yy
 = 
qu©_n‹m
.
y
 * quat_norm.y;

409 
zz
 = 
qu©_n‹m
.
z
 * quat_norm.z;

410 
xy
 = 
qu©_n‹m
.
x
 * qu©_n‹m.
y
;

411 
xz
 = 
qu©_n‹m
.
x
 * qu©_n‹m.
z
;

412 
yz
 = 
qu©_n‹m
.
y
 * qu©_n‹m.
z
;

413 
wx
 = 
qu©_n‹m
.
w
 * qu©_n‹m.
x
;

414 
wy
 = 
qu©_n‹m
.
w
 * qu©_n‹m.
y
;

415 
wz
 = 
qu©_n‹m
.
w
 * qu©_n‹m.
z
;

417 
ªsu…
.
ñem
[0][0] = 1.0‡- 2.0f*(
yy
+
zz
);

418 
ªsu…
.
ñem
[0][1] = 2.0‡* (
xy
+
wz
);

419 
ªsu…
.
ñem
[0][2] = 2.0‡* (
xz
-
wy
);

420 
ªsu…
.
ñem
[0][3] = 0.0f;

422 
ªsu…
.
ñem
[1][0] = 2.0‡* (
xy
-
wz
);

423 
ªsu…
.
ñem
[1][1] = 1.0‡- 2.0f*(
xx
+
zz
);

424 
ªsu…
.
ñem
[1][2] = 2.0‡* (
yz
+
wx
);

425 
ªsu…
.
ñem
[1][3] = 0.0f;

427 
ªsu…
.
ñem
[2][0] = 2.0‡* (
xz
+
wy
);

428 
ªsu…
.
ñem
[2][1] = 2.0‡* (
yz
-
wx
);

429 
ªsu…
.
ñem
[2][2] = 1.0‡- 2.0f*(
xx
+
yy
);

430 
ªsu…
.
ñem
[2][3] = 0.0f;

432 
ªsu…
.
ñem
[3][0] = 0.0f;

433 
ªsu…
.
ñem
[3][1] = 0.0f;

434 
ªsu…
.
ñem
[3][2] = 0.0f;

435 
ªsu…
.
ñem
[3][3] = 1.0f;

437  
ªsu…
;

438 
	}
}

440 
Qu©
 
	$Qu©FromAxisAngÀ
(
Vec3
 
axis
, 
™gÀ
) {

441 
Qu©
 
ªsu…
 = {};

442 
Vec3
 
axis_n‹m
 = 
	`V3N‹m
(
axis
);

443 
sö
 = 
	`söf
(
™gÀ
/2.0f);

444 
ªsu…
.
xyz
 = 
	`V3MulF
(
axis_n‹m
, 
sö
);

445 
ªsu…
.
w
 = 
	`cosf
(
™gÀ
/2.0f);

446  
ªsu…
;

447 
	}
}

449 
Qu©
 
	$Qu©FromEuÀr
(
pôch
 , 
yaw
, 
rﬁl
) {

450 
Qu©
 
ªsu…
 = {};

452 
x0
 = 
	`cosf
(
pôch
*0.5f);

453 
x1
 = 
	`söf
(
pôch
*0.5f);

454 
y0
 = 
	`cosf
(
yaw
*0.5f);

455 
y1
 = 
	`söf
(
yaw
*0.5f);

456 
z0
 = 
	`cosf
(
rﬁl
*0.5f);

457 
z1
 = 
	`söf
(
rﬁl
*0.5f);

459 
ªsu…
.
x
 = 
x1
*
y0
*
z0
 - 
x0
*
y1
*
z1
;

460 
ªsu…
.
y
 = 
x0
*
y1
*
z0
 + 
x1
*
y0
*
z1
;

461 
ªsu…
.
z
 = 
x0
*
y0
*
z1
 - 
x1
*
y1
*
z0
;

462 
ªsu…
.
w
 = 
x0
*
y0
*
z0
 + 
x1
*
y1
*
z1
;

464  
ªsu…
;

465 
	}
};

467 
Vec3
 
	$EuÀrFromQu©
(
Qu©
 
qu©
) {

468 
Vec3
 
ªsu…
 = {};

471 
x0
 = 2.0f*(
qu©
.
w
*qu©.
x
 + qu©.
y
*qu©.
z
);

472 
x1
 = 1.0‡- 2.0f*(
qu©
.
x
*qu©.x + qu©.
y
*quat.y);

473 
ªsu…
.
x
 = 
	`©™2f
(
x0
, 
x1
);

476 
y0
 = 2.0f*(
qu©
.
w
*qu©.
y
 - qu©.
z
*qu©.
x
);

477 
y0
 = y0 > 1.0f ? 1.0f : y0;

478 
y0
 = y0 < -1.0f ? -1.0f : y0;

479 
ªsu…
.
y
 = 
	`asöf
(
y0
);

482 
z0
 = 2.0f*(
qu©
.
w
*qu©.
z
 + qu©.
x
*qu©.
y
);

483 
z1
 = 1.0‡- 2.0f*(
qu©
.
y
*qu©.y + qu©.
z
*quat.z);

484 
ªsu…
.
z
 = 
	`©™2f
(
z0
, 
z1
);

486  
ªsu…
;

487 
	}
}

489 
	$AxisAngÀFromQu©
(
Qu©
 
q
, 
Vec3
* 
outAxis
, * 
outAngÀ
) {

490 i‡(
	`Ábs
(
q
.
w
) > 1.0f)

492 
	`Qu©N‹m
(
q
);

493 
Àngth
 = 
	`sqπf
(
q
.
x
*q.x + q.
y
*q.y + q.
z
*q.z + q.
w
*q.w);

494 i‡(
Àngth
 == 0.0f)Üength = 1.0f;

495 
ûígth
 = 1.0f/
Àngth
;

497 
q
.
w
 = q.
x
*
ûígth
;

498 
q
.
y
 = q.y*
ûígth
;

499 
q
.
z
 = q.z*
ûígth
;

500 
q
.
w
 = q.w*
ûígth
;

503 
Vec3
 
ªsAxis
 = { 0.0f, 0.0f, 0.0f };

504 
ªsAngÀ
 = 2.0f*
	`acosf
(
q
.
w
);

505 
dí
 = 
	`sqπf
(1.0‡- 
q
.
w
*q.w);

507 i‡(
dí
 > 0.0001f)

509 
ªsAxis
.
x
 = 
q
.x/
dí
;

510 
ªsAxis
.
y
 = 
q
.y/
dí
;

511 
ªsAxis
.
z
 = 
q
.z/
dí
;

517 
ªsAxis
.
x
 = 1.0f;

520 *
outAxis
 = 
ªsAxis
;

521 *
outAngÀ
 = 
ªsAngÀ
;

522 
	}
}

525 
Qu©
 
	$Qu©FromDúe˘i⁄Ch™ge
(
Vec3
 
‰om
, Vec3 
to
) {

526 
Qu©
 
ªsu…
 = {};

527 
cos
 = 
	`V3DŸ
(
‰om
, 
to
);

528 i‡(
	`Abs
(
cos
 - (-1.0f)) < 0.000001f) {

529 
ªsu…
 = 
	`Qu©FromAxisAngÀ
(
	`V3
(0.0f, 1.0f, 0.0f), 
	`DegToRad
(180.0f));

531 i‡(
	`Abs
(
cos
 - (1.0f)) < 0.00001f) {

532 
ªsu…
 = 
	`Qu©I
();

534 
™gÀ
 = 
	`acosf
(
cos
);

535 
Vec3
 
axis
 = 
	`V3Cross
(
‰om
, 
to
);

536 
axis
 = 
	`V3N‹m
(axis);

537 
ªsu…
 = 
	`Qu©FromAxisAngÀ
(
axis
, 
™gÀ
);

538  
ªsu…
;

539 
	}
}

541 
Vec3
 
	$RŸ©eVecByQu©
(
Vec3
 
vec
, 
Qu©
 
qu©
) {

542 
Vec3
 
ªsu…
 = {};

544 
num12
 = 
qu©
.
x
 + quat.x;

545 
num2
 = 
qu©
.
y
 + quat.y;

546 
num
 = 
qu©
.
z
 + quat.z;

547 
num11
 = 
qu©
.
w
 * 
num12
;

548 
num10
 = 
qu©
.
w
 * 
num2
;

549 
num9
 = 
qu©
.
w
 * 
num
;

550 
num8
 = 
qu©
.
x
 * 
num12
;

551 
num7
 = 
qu©
.
x
 * 
num2
;

552 
num6
 = 
qu©
.
x
 * 
num
;

553 
num5
 = 
qu©
.
y
 * 
num2
;

554 
num4
 = 
qu©
.
y
 * 
num
;

555 
num3
 = 
qu©
.
z
 * 
num
;

556 
num15
 = ((
vec
.
x
 * ((1.0‡- 
num5
Ë- 
num3
)Ë+ (vec.
y
 * (
num7
 - 
num9
))Ë+ (vec.
z
 * (
num6
 + 
num10
));

557 
num14
 = ((
vec
.
x
 * (
num7
 + 
num9
)Ë+ (vec.
y
 * ((1.0‡- 
num8
Ë- 
num3
))Ë+ (vec.
z
 * (
num4
 - 
num11
));

558 
num13
 = ((
vec
.
x
 * (
num6
 - 
num10
)Ë+ (vec.
y
 * (
num4
 + 
num11
))Ë+ (vec.
z
 * ((1.0‡- 
num8
Ë- 
num5
));

560 
ªsu…
.
x
 = 
num15
;

561 
ªsu…
.
y
 = 
num14
;

562 
ªsu…
.
z
 = 
num13
;

563  
ªsu…
;

564 
	}
}

570 
Vec3
 
	$GëF‹w¨dVe˘‹
(
Qu©
 
qu©
Ë{  
	`V3N‹m
(
	`RŸ©eVecByQu©
(
	`V3F‹w¨d
(), qu©)); 
	}
}

571 
Vec3
 
	$GëRightVe˘‹
(
Qu©
 
qu©
Ë{  
	`V3N‹m
(
	`RŸ©eVecByQu©
(
	`V3Right
(), qu©)); 
	}
}

572 
Vec3
 
	$GëUpVe˘‹
(
Qu©
 
qu©
Ë{  
	`V3N‹m
(
	`RŸ©eVecByQu©
(
	`V3Up
(), qu©)); 
	}
}

574 
M©4
 
	$MakeTønsf‹mM©rix
(
Tønsf‹m
 
å™sf‹m
) {

575 
M©4
 
ªsu…
 = 
	`M4I
();

576 
M©4
 
å™¶©i⁄
 = 
	`M4Tøn¶©e
(
å™sf‹m
.
posôi⁄
);

577 
M©4
 
rŸ©i⁄
 = 
	`M4FromQu©
(
å™sf‹m
.rotation);

578 
M©4
 
sˇÀ
 = 
	`M4SˇÀ
(
å™sf‹m
.scale);

581 
ªsu…
 = 
	`M4Mul
(M4Mul(
å™¶©i⁄
, 
rŸ©i⁄
), 
sˇÀ
);

584  
ªsu…
;

585 
	}
}

	@memory_management.h

1 
	#ZîoSåu˘
(
vÆ
Ë
	`ZîoMem
(&(vÆ), (vÆ))

	)

2 
	#ZîoAºay
(
¨øy
, 
cou¡
Ë
	`ZîoMem
◊ºay, cou¡*(◊ºay)[0]))

	)

4 
	$ZîoMem
(* 
±r
, 
u64
 
size
) {

5 
u8
* 
mem
 = (u8*)
±r
;

6 
size
--Ë*
mem
++ = 0;

7 
	}
}

9 
	$C›yMem
(* 
to
, * 
‰om
, 
u64
 
Àn
) {

10 
u8
* 
§c
 = (u8*)
‰om
;

11 
u8
* 
d°
 = (u8*)
to
;

12 
Àn
--Ë*
d°
++ = *
§c
++;

13 
	}
}

15 
boﬁ
 
	$Com∑ªMem
(* 
À·
, * 
right
, 
u64
 
Àn
) {

16 
u8
* 
l
 = (u8*)
À·
;

17 
u8
* 
r
 = (u8*)
right
;

18 
Àn
--Ëif(*
l
++ !*
r
++Ë 
Ál£
;

19  
åue
;

20 
	}
}

22 
	#PushSize
(
±r_¨ía
, 
size
Ë
	`PushSize_
(’å_¨ía), (size), 
Ál£
)

	)

23 
	#PushSizeCÀ¨
(
±r_¨ía
, 
size
Ë
	`PushSize_
(’å_¨ía), (size), 
åue
)

	)

24 
	#PushSåu˘
(
±r_¨ía
, 
ty≥
Ë—y≥*)
	`PushSize_
(’å_¨ía), —y≥), 
Ál£
)

	)

25 
	#PushSåu˘CÀ¨
(
±r_¨ía
, 
ty≥
Ë—y≥*)
	`PushSize_
(’å_¨ía), —y≥), 
åue
)

	)

26 
	#PushAºay
(
±r_¨ía
, 
ty≥
, 
cou¡
Ë—y≥*)
	`PushSize_
(’å_¨ía), —y≥)*(cou¡), 
Ál£
)

	)

27 
	#PushAºayCÀ¨
(
±r_¨ía
, 
ty≥
, 
cou¡
Ë—y≥*)
	`PushSize_
(’å_¨ía), —y≥)*(cou¡), 
åue
)

	)

28 
	#BoŸ°øpPushSåu˘
(
ty≥
, 
membî
, 
mö_size
Ë—y≥*)
	`BoŸ°øpPushSize_
(—y≥), 
	`off£tof
—y≥, membî), mö_size)

	)

30 
	sMem‹yAª«
 {

31 
Pœtf‹mMem‹yBlock
* 
	mcuºít_block
;

32 
u64
 
	mmö_block_size
;

33 
u32
 
	mãmp_cou¡
;

36 
	sTemp‹¨yMem‹y
 {

37 
Mem‹yAª«
* 
	m¨ía
;

38 
Pœtf‹mMem‹yBlock
* 
	mblock
;

39 
u64
 
	mu£d
;

43 
	$PushSize_
(
Mem‹yAª«
* 
¨ía
, 
u64
 
size
, 
boﬁ
 
˛ór
) {

44 * 
ªsu…
 = 0;

46 
u32
 
Æig√d_size
 = ((
size
 + 7) & (-8));

47 if(!
¨ía
->
cuºít_block
 || (◊ª«->cuºít_block->
u£d
 + 
Æig√d_size
Ë>áª«->cuºít_block->
size
)) {

48 if(!
¨ía
->
mö_block_size
)árena->min_block_size = 1024*1024;

50 
u64
 
block_size
 = 
	`Max
(
Æig√d_size
, 
¨ía
->
mö_block_size
);

51 
Pœtf‹mMem‹yBlock
* 
√w_block
 = 
∂©f‹m_≠i
.
	`Æloˇã_mem‹y
(
block_size
);

52 
√w_block
->
¥ev
 = 
¨ía
->
cuºít_block
;

53 
¨ía
->
cuºít_block
 = 
√w_block
;

56 
	`As£π
((
¨ía
->
cuºít_block
->
u£d
 + 
Æig√d_size
Ë<¨ía->cuºít_block->
size
);

58 
ªsu…
 = 
¨ía
->
cuºít_block
->
bp
 +áª«->cuºít_block->
u£d
;

59 
¨ía
->
cuºít_block
->
u£d
 +
Æig√d_size
;

61 if(
˛ór
) {

62 
	`ZîoMem
(
ªsu…
, 
Æig√d_size
);

65  
ªsu…
;

66 
	}
}

68 
Temp‹¨yMem‹y


69 
	$BegöTemp‹¨yMem‹y
(
Mem‹yAª«
* 
¨ía
) {

70 
Temp‹¨yMem‹y
 
ªsu…
 = {};

72 
ªsu…
.
¨ía
 =árena;

73 
ªsu…
.
block
 = 
¨ía
->
cuºít_block
;

74 
ªsu…
.
u£d
 = 
¨ía
->
cuºít_block
 ?árena->current_block->used : 0;

76 
¨ía
->
ãmp_cou¡
++;

78  
ªsu…
;

79 
	}
}

82 
	$FªeLa°Block
(
Mem‹yAª«
* 
¨ía
) {

83 
Pœtf‹mMem‹yBlock
* 
‰ì_block
 = 
¨ía
->
cuºít_block
;

84 
¨ía
->
cuºít_block
 = 
‰ì_block
->
¥ev
;

85 
∂©f‹m_≠i
.
	`dóŒoˇã_mem‹y
(
‰ì_block
);

86 
	}
}

89 
	$EndTemp‹¨yMem‹y
(
Temp‹¨yMem‹y
* 
ãmp_mem
) {

90 
Mem‹yAª«
* 
¨ía
 = 
ãmp_mem
->arena;

92 
¨ía
->
cuºít_block
 !
ãmp_mem
->
block
) {

93 
	`FªeLa°Block
(
¨ía
);

96 if(
¨ía
->
cuºít_block
) {

97 
	`As£π
(
¨ía
->
cuºít_block
->
u£d
 >
ãmp_mem
->used);

98 
¨ía
->
cuºít_block
->
u£d
 = 
ãmp_mem
->used;

101 
	`As£π
(
¨ía
->
ãmp_cou¡
 > 0);

102 
¨ía
->
ãmp_cou¡
--;

103 
	}
}

106 
	$CÀ¨Mem‹yAª«
(
Mem‹yAª«
* 
¨ía
) {

107 
¨ía
->
cuºít_block
) {

108 
boﬁ
 
œ°_block
 = 
¨ía
->
cuºít_block
->
¥ev
 == 0;

109 
	`FªeLa°Block
(
¨ía
);

110 if(
œ°_block
) ;

112 
	}
}

115 
	$CheckAª«
(
Mem‹yAª«
* 
¨ía
) {

116 
	`As£π
(
¨ía
->
ãmp_cou¡
 == 0);

117 
	}
}

120 
	$BoŸ°øpPushSize_
(
u64
 
°ru˘_size
, u64 
off£t_to_¨ía
, u64 
mö_block_size
) {

121 
Mem‹yAª«
 
boŸ°øp
 = {};

122 
boŸ°øp
.
mö_block_size
 = min_block_size;

123 * 
°ru˘uª
 = 
	`PushSize_
(&
boŸ°øp
, 
°ru˘_size
, 
Ál£
);

124 *(
Mem‹yAª«
*)((
u8
*)
°ru˘uª
 + 
off£t_to_¨ía
Ë
boŸ°øp
;

126  
°ru˘uª
;

127 
	}
}

129 
u32


130 
	$SåögLígth
(* 
°rög
) {

131 
u32
 
i
=0;

132 
°rög
[
i
] != 0) i++;

133  
i
;

134 
	}
}

136 
boﬁ


137 
	$SåögCom∑ª
(* 
À·
, * 
right
) {

138 
u32
 
À·_Àn
 = 
	`SåögLígth
(
À·
);

139 
u32
 
right_Àn
 = 
	`SåögLígth
(
right
);

140 if(
À·_Àn
 !
right_Àn
Ë 
Ál£
;

141 
u32
 
i
=0; 
À·
[i] != 0; i++)

142 if(
À·
[
i
] !
right
[i]Ë 
Ál£
;

143  
åue
;

144 
	}
}

	@mesh_renderer.cpp

1 
	#MAX_MESH_PIPELINES
 100

	)

3 
	sLightInfo
 {

4 
Vec3
 
	mposôi⁄
;

5 
	mambõn˚
;

8 
	sMesh
 {

9 
VîãxBuf„r
* 
	mvîãx_buf„rs
[2];

10 
IndexBuf„r
* 
	mödex_buf„r
;

11 
u8
 
	mt›ﬁogy
;

12 
u32
 
	mvîti˚s_cou¡
;

13 
u32
 
	mödi˚s_cou¡
;

16 
	sMeshInfo
 {

17 
M©4
 
	mmodñ
;

18 
Vec4
 
	mcﬁ‹
;

21 
	sMeshPùñöe
 {

22 
Mesh
 
	mmesh
;

23 
MeshInfo
* 
	möfo
;

26 
	sMeshRídîî
 {

27 
MeshPùñöe
 
	mpùñöes
[
MAX_MESH_PIPELINES
];

28 
u32
 
	mcou¡
;

30 
LightInfo
 
	mlight
;

31 
C⁄°™tsBuf„r
* 
	mˇmîa_c⁄°™ts
;

32 
C⁄°™tsBuf„r
* 
	mmesh_c⁄°™ts
;

33 
C⁄°™tsBuf„r
* 
	mlight_c⁄°™ts
;

34 
VîãxShadî
* 
	mvs
;

35 
PixñShadî
* 
	mps
;

39 
	$PushMeshPùñöe
(
MeshPùñöe
 
pùñöe
, 
MeshRídîî
* 
mesh_ªndîî
) {

40 
	`As£π
(
mesh_ªndîî
->
cou¡
 < 
MAX_MESH_PIPELINES
);

41 
mesh_ªndîî
->
pùñöes
[mesh_ªndîî->
cou¡
++] = 
pùñöe
;

42 
	}
}

45 
	$InôMeshShadî
(
MeshRídîî
* 
mesh_ªndîî
, 
Rídîî
* 
ªndîî
) {

46 
VERTEX_BUFFER
 
vb
[] = { 
VERTEX_BUFFER_POSITION
, 
VERTEX_BUFFER_NORMAL
 };

47 
mesh_ªndîî
->
vs
 = 
	`U∂ﬂdVîãxShadî
(
MeshShadî
, (MeshShadî), "vsf", 
vb
, 
	`AºayCou¡
(vb), 
ªndîî
);

49 
mesh_ªndîî
->
ps
 = 
	`U∂ﬂdPixñShadî
(
MeshShadî
, (MeshShadî), "psf", 
ªndîî
);

50 
mesh_ªndîî
->
ˇmîa_c⁄°™ts
 = 
	`U∂ﬂdC⁄°™tsBuf„r
((
M©4
), 
ªndîî
);

51 
mesh_ªndîî
->
light_c⁄°™ts
 = 
	`U∂ﬂdC⁄°™tsBuf„r
((
LightInfo
), 
ªndîî
);

52 
mesh_ªndîî
->
mesh_c⁄°™ts
 = 
	`U∂ﬂdC⁄°™tsBuf„r
((
MeshInfo
), 
ªndîî
);

53 
	}
}

55 
MeshRídîî
*

56 
	$InôMeshRídîî
(
Rídîî
* 
ªndîî
, 
Mem‹yAª«
* 
¨ía
) {

57 
MeshRídîî
* 
ªsu…
 = 
	`PushSåu˘
(
¨ía
, MeshRenderer);

59 
	`InôMeshShadî
(
ªsu…
, 
ªndîî
);

61  
ªsu…
;

62 
	}
}

65 
	$MeshRídîîFøme
(
MeshRídîî
* 
mesh_ªndîî
, 
Camîa
* 
ˇmîa
, 
Rídîî
* 
ªndîî
) {

67 #ifde‡
INTERNAL


68 if(
execuèbÀ_ªlﬂded
Ë
	`InôMeshShadî
(
mesh_ªndîî
, 
ªndîî
);

71 if(
mesh_ªndîî
->
cou¡
 == 0) ;

73 
M©4
* 
vp
 = 
	`PushSåu˘
(
ªndîî
->
‰ame_¨ía
, Mat4);

74 *
vp
 = 
	`MakeVõwPî•e˘ive
(
ˇmîa
);

76 
SëRídîT¨gë
* 
£t_ªndî_èrgë
 = 
	`PushRídîComm™d
(
ªndîî
, SetRenderTarget);

78 
SëBÀndSèã
* 
£t_bÀnd_°©e
 = 
	`PushRídîComm™d
(
ªndîî
, SetBlendState);

79 
£t_bÀnd_°©e
->
ty≥
 = 
BLEND_STATE_Reguœr
;

81 
SëVîãxShadî
* 
£t_vîãx_shadî
 = 
	`PushRídîComm™d
(
ªndîî
, SetVertexShader);

82 
£t_vîãx_shadî
->
vîãx
 = 
mesh_ªndîî
->
vs
;

84 
SëPixñShadî
* 
£t_pixñ_shadî
 = 
	`PushRídîComm™d
(
ªndîî
, SetPixelShader);

85 
£t_pixñ_shadî
->
pixñ
 = 
mesh_ªndîî
->
ps
;

87 
SëC⁄°™tsBuf„r
* 
£t_ˇmîa_c⁄°™ts
 = 
	`PushRídîComm™d
(
ªndîî
, SetConstantsBuffer);

88 
£t_ˇmîa_c⁄°™ts
->
vîãx_shadî
 = 
åue
;

89 
£t_ˇmîa_c⁄°™ts
->
c⁄°™ts
 = 
mesh_ªndîî
->
ˇmîa_c⁄°™ts
;

90 
£t_ˇmîa_c⁄°™ts
->
¶Ÿ
 = 1;

92 
SëC⁄°™tsBuf„r
* 
£t_light_c⁄°™ts
 = 
	`PushRídîComm™d
(
ªndîî
, SetConstantsBuffer);

93 
£t_light_c⁄°™ts
->
vîãx_shadî
 = 
Ál£
;

94 
£t_light_c⁄°™ts
->
c⁄°™ts
 = 
mesh_ªndîî
->
light_c⁄°™ts
;

95 
£t_light_c⁄°™ts
->
¶Ÿ
 = 1;

97 
SëC⁄°™tsBuf„r
* 
£t_mesh_c⁄°™ts
 = 
	`PushRídîComm™d
(
ªndîî
, SetConstantsBuffer);

98 
£t_mesh_c⁄°™ts
->
vîãx_shadî
 = 
åue
;

99 
£t_mesh_c⁄°™ts
->
c⁄°™ts
 = 
mesh_ªndîî
->
mesh_c⁄°™ts
;

100 
£t_mesh_c⁄°™ts
->
¶Ÿ
 = 2;

102 
PushRídîBuf„rD©a
* 
push_ˇmîa_c⁄°™ts
 = 
	`PushRídîComm™d
(
ªndîî
, PushRenderBufferData);

103 
push_ˇmîa_c⁄°™ts
->
buf„r
 = 
mesh_ªndîî
->
ˇmîa_c⁄°™ts
->buffer;

104 
push_ˇmîa_c⁄°™ts
->
size
 = (
M©4
);

105 
push_ˇmîa_c⁄°™ts
->
d©a
 = 
vp
;

107 
PushRídîBuf„rD©a
* 
push_light_c⁄°™ts
 = 
	`PushRídîComm™d
(
ªndîî
, PushRenderBufferData);

108 
push_light_c⁄°™ts
->
buf„r
 = 
mesh_ªndîî
->
light_c⁄°™ts
->buffer;

109 
push_light_c⁄°™ts
->
size
 = (
LightInfo
);

110 
push_light_c⁄°™ts
->
d©a
 = &
mesh_ªndîî
->
light
;

112 
u32
 
i
=0; i<
mesh_ªndîî
->
cou¡
; i++) {

113 
MeshPùñöe
* 
mesh_pùñöe
 = 
mesh_ªndîî
->
pùñöes
 + 
i
;

115 
SëPrimôiveT›ﬁogy
* 
£t_t›ﬁogy
 = 
	`PushRídîComm™d
(
ªndîî
, SetPrimitiveTopology);

116 
£t_t›ﬁogy
->
ty≥
 = 
mesh_pùñöe
->
mesh
.
t›ﬁogy
;

119 
SëVîãxBuf„r
* 
£t_vîãx_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
, SetVertexBuffer);

120 
£t_vîãx_buf„r
->
vîãx

mesh_pùñöe
->
mesh
.
vîãx_buf„rs
[0];

121 
£t_vîãx_buf„r
->
vîti˚s_cou¡
 = 
mesh_pùñöe
->
mesh
.vertices_count;

122 
£t_vîãx_buf„r
->
off£t
 = 0;

123 
£t_vîãx_buf„r
->
°ride
 = ()*3;

124 
£t_vîãx_buf„r
->
¶Ÿ
 = 0;

126 
SëVîãxBuf„r
* 
£t_vîãx_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
, SetVertexBuffer);

127 
£t_vîãx_buf„r
->
vîãx

mesh_pùñöe
->
mesh
.
vîãx_buf„rs
[1];

128 
£t_vîãx_buf„r
->
vîti˚s_cou¡
 = 
mesh_pùñöe
->
mesh
.vertices_count;

129 
£t_vîãx_buf„r
->
off£t
 = 0;

130 
£t_vîãx_buf„r
->
°ride
 = ()*3;

131 
£t_vîãx_buf„r
->
¶Ÿ
 = 1;

134 
PushRídîBuf„rD©a
* 
push_mesh_öfo
 = 
	`PushRídîComm™d
(
ªndîî
, PushRenderBufferData);

135 
push_mesh_öfo
->
buf„r
 = 
mesh_ªndîî
->
mesh_c⁄°™ts
->buffer;

136 
push_mesh_öfo
->
size
 = (
MeshInfo
);

137 
push_mesh_öfo
->
d©a
 = 
mesh_pùñöe
->
öfo
;

139 if(
mesh_pùñöe
->
mesh
.
ödex_buf„r
) {

140 
SëIndexBuf„r
* 
£t_ödex_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
, SetIndexBuffer);

141 
£t_ödex_buf„r
->
ödex
 = 
mesh_pùñöe
->
mesh
.
ödex_buf„r
;

143 
DøwIndexed
* 
døw_ödi˚s
 = 
	`PushRídîComm™d
(
ªndîî
, DrawIndexed);

144 
døw_ödi˚s
->
ödi˚s_cou¡
 = 
mesh_pùñöe
->
mesh
.indices_count;

147 
DøwVîti˚s
* 
døw_vîti˚s
 = 
	`PushRídîComm™d
(
ªndîî
, DrawVertices);

148 
døw_vîti˚s
->
vîti˚s_cou¡
 = 
mesh_pùñöe
->
mesh
.vertices_count;

152 
mesh_ªndîî
->
cou¡
 = 0;

153 
	}
}

	@platform_api.h

1 
	sPœtf‹mMem‹yBlock
 {

2 
u64
 
	msize
;

3 
u64
 
	mu£d
;

4 
u8
* 
	mbp
;

6 
Pœtf‹mMem‹yBlock
* 
	m¥ev
;

9 
	sPœtf‹mFûeH™dÀ
 {

10 
boﬁ
 
	mÁûed
;

11 * 
	mh™dÀ
;

14 
	sPœtf‹mFûeInfo
 {

15 
u64
 
	msize
;

16 * 
	m«me
;

19 
	eWIN32_BUTTON
 {

20 
	mWIN32_BUTTON_A
,

21 
	mWIN32_BUTTON_B
,

22 
	mWIN32_BUTTON_C
,

23 
	mWIN32_BUTTON_D
,

24 
	mWIN32_BUTTON_E
,

25 
	mWIN32_BUTTON_F
,

26 
	mWIN32_BUTTON_G
,

27 
	mWIN32_BUTTON_H
,

28 
	mWIN32_BUTTON_I
,

29 
	mWIN32_BUTTON_J
,

30 
	mWIN32_BUTTON_L
,

31 
	mWIN32_BUTTON_M
,

32 
	mWIN32_BUTTON_N
,

33 
	mWIN32_BUTTON_O
,

34 
	mWIN32_BUTTON_P
,

35 
	mWIN32_BUTTON_Q
,

36 
	mWIN32_BUTTON_R
,

37 
	mWIN32_BUTTON_S
,

38 
	mWIN32_BUTTON_T
,

39 
	mWIN32_BUTTON_U
,

40 
	mWIN32_BUTTON_V
,

41 
	mWIN32_BUTTON_W
,

42 
	mWIN32_BUTTON_X
,

43 
	mWIN32_BUTTON_Y
,

44 
	mWIN32_BUTTON_Z
,

46 
	mWIN32_BUTTON_TAB
,

47 
	mWIN32_BUTTON_SHIFT
,

48 
	mWIN32_BUTTON_CTRL
,

49 
	mWIN32_BUTTON_SPACE
,

50 
	mWIN32_BUTTON_ALT
,

52 
	mWIN32_BUTTON_UP
,

53 
	mWIN32_BUTTON_DOWN
,

54 
	mWIN32_BUTTON_LEFT
,

55 
	mWIN32_BUTTON_RIGHT
,

57 
	mWIN32_BUTTON_0
,

58 
	mWIN32_BUTTON_1
,

59 
	mWIN32_BUTTON_2
,

60 
	mWIN32_BUTTON_3
,

61 
	mWIN32_BUTTON_4
,

62 
	mWIN32_BUTTON_5
,

63 
	mWIN32_BUTTON_6
,

64 
	mWIN32_BUTTON_7
,

65 
	mWIN32_BUTTON_8
,

66 
	mWIN32_BUTTON_9
,

68 
	mWIN32_BUTTON_F0
,

69 
	mWIN32_BUTTON_F1
,

70 
	mWIN32_BUTTON_F2
,

71 
	mWIN32_BUTTON_F3
,

72 
	mWIN32_BUTTON_F4
,

73 
	mWIN32_BUTTON_F5
,

74 
	mWIN32_BUTTON_F6
,

75 
	mWIN32_BUTTON_F7
,

76 
	mWIN32_BUTTON_F8
,

77 
	mWIN32_BUTTON_F9
,

78 
	mWIN32_BUTTON_F10
,

79 
	mWIN32_BUTTON_F11
,

80 
	mWIN32_BUTTON_F12
,

82 
	mWIN32_BUTTON_ENTER
,

83 
	mWIN32_BUTTON_ESC
,

85 
	mWIN32_BUTTON_LEFT_MOUSE
,

86 
	mWIN32_BUTTON_RIGHT_MOUSE
,

87 
	mWIN32_BUTTON_MIDDLE_MOUSE
,

89 
	mWIN32_BUTTON_TOTAL


92 
	eWIN32_AXIS
 {

93 
	mWIN32_AXIS_MOUSE
,

94 
	mWIN32_AXIS_MOUSE_DEL
,

95 
	mWIN32_AXIS_TOTAL


98 
	sWödowDimísi⁄s
 { 
u32
 
	mwidth
; u32 
	mheight
; };

99 
	sBuâ⁄
 { 
boﬁ
 
	m¥es£d
, 
	mhñd
; };

100 
	sAxis
 { 
	mx
, 
	my
; };

102 
	sI≈ut
 {

103 
Buâ⁄
 
	mbuâ⁄s
[
WIN32_BUTTON_TOTAL
];

104 
Axis
 
	maxes
[
WIN32_AXIS_TOTAL
];

107 
	sWö32Wödow
 {

108 
WödowDimísi⁄s
 
	mdim
;

109 
HWND
 
	mh™dÀ
;

112 
	#PLATFORM_OPEN_FILE
(
«me
Ë
Pœtf‹mFûeH™dÀ
 
	`«me
(
Pœtf‹mFûeInfo
* 
öfo
)

	)

113 
PLATFORM_OPEN_FILE
(
	tPœtf‹mO≥nFûe
);

115 
	#PLATFORM_CLOSE_FILE
(
«me
Ë
	`«me
(
Pœtf‹mFûeH™dÀ
* 
fûe_h™dÀ
)

	)

116 
PLATFORM_CLOSE_FILE
(
	tPœtf‹mClo£Fûe
);

118 
	#PLATFORM_READ_FILE
(
«me
Ë
	`«me
(
Pœtf‹mFûeH™dÀ
* 
wö32_h™dÀ
, 
u32
 
size
, *
d°
)

	)

119 
PLATFORM_READ_FILE
(
	tPœtf‹mRódFûe
);

121 
	#PLATFORM_ALLOCATE_MEMORY
(
«me
Ë
Pœtf‹mMem‹yBlock
* 
	`«me
(
u64
 
size
)

	)

122 
PLATFORM_ALLOCATE_MEMORY
(
	tPœtf‹mAŒoˇãMem‹y
);

124 
	#PLATFORM_DEALLOCATE_MEMORY
(
«me
Ë
	`«me
(
Pœtf‹mMem‹yBlock
* 
block
)

	)

125 
PLATFORM_DEALLOCATE_MEMORY
(
	tPœtf‹mDóŒoˇãMem‹y
);

127 
	sPœtf‹mAPI
 {

128 
Pœtf‹mO≥nFûe
* 
	m›í_fûe
;

129 
Pœtf‹mClo£Fûe
* 
	m˛o£_fûe
;

130 
Pœtf‹mRódFûe
* 
	mªad_fûe
;

131 
Pœtf‹mAŒoˇãMem‹y
* 
	mÆloˇã_mem‹y
;

132 
Pœtf‹mDóŒoˇãMem‹y
* 
	mdóŒoˇã_mem‹y
;

134 
Pœtf‹mAPI
 
∂©f‹m_≠i
;

	@post_process_renderer.cpp

1 
	ePOST_PROCESS_TYPE
 {

2 
	mPOST_PROCESS_TYPE_C›y
,

3 
	mPOST_PROCESS_TYPE_Edge
,

4 
	mPOST_PROCESS_TYPE_TOTAL
,

7 
	sPo°Pro˚ssPùñöe
 {

8 
u8
 
	mty≥
;

9 
ID3D11ShadîResour˚Võw
* 
	mö
;

10 
ID3D11RídîT¨gëVõw
* 
	mout
;

13 
	sPo°Pro˚ssRídîî
 {

14 
VîãxShadî
* 
	mfuŒ_s¸ìn_quad_shadî
;

15 
PixñShadî
* 
	mps
[
POST_PROCESS_TYPE_TOTAL
];

17 
C⁄°™tsBuf„r
* 
	mªsﬁuti⁄_c⁄°™ts
;

18 
Po°Pro˚ssPùñöe
 
	mpùñöe
;

22 
	$InôPo°Pro˚ssShadîs
(
Po°Pro˚ssRídîî
* 
µ_ªndîî
, 
Rídîî
* 
ªndîî
) {

23 
µ_ªndîî
->
fuŒ_s¸ìn_quad_shadî
 = 
	`U∂ﬂdVîãxShadî
(
FuŒS¸ìnQuadShadî
, (FullScreenQuadShader), "vsf",

24 0, 0, 
ªndîî
);

25 
µ_ªndîî
->
ps
[
POST_PROCESS_TYPE_C›y
] = 
	`U∂ﬂdPixñShadî
(
Po°Pro˚ssShadî
, (PostProcessShader)

26 , "ps_c›y", 
ªndîî
);

27 
µ_ªndîî
->
ps
[
POST_PROCESS_TYPE_Edge
] = 
	`U∂ﬂdPixñShadî
(
Po°Pro˚ssShadî
, (PostProcessShader),

28 "ps_edge", 
ªndîî
);

29 
	}
};

31 
Po°Pro˚ssRídîî
*

32 
	$InôPo°Pro˚ssRídîî
(
Rídîî
* 
ªndîî
, 
Mem‹yAª«
* 
¨ía
) {

33 
Po°Pro˚ssRídîî
* 
ªsu…
 = 
	`PushSåu˘
(
¨ía
, PostProcessRenderer);

35 
	`InôPo°Pro˚ssShadîs
(
ªsu…
, 
ªndîî
);

37 
ªsu…
->
ªsﬁuti⁄_c⁄°™ts
 = 
	`U∂ﬂdC⁄°™tsBuf„r
((
Vec2
), 
ªndîî
);

38  
ªsu…
;

39 
	}
};

42 
	$PushPo°Pro˚ssPùñöe
(
Po°Pro˚ssPùñöe
* 
pùñöe
, 
Po°Pro˚ssRídîî
* 
µ_ªndîî
, 
Rídîî
* 
ªndîî
) {

43 
µ_ªndîî
->
pùñöe
 = *pipeline;

44 
	}
}

47 
	$Po°Pro˚ssRídîîFøme
(
Po°Pro˚ssRídîî
* 
µ_ªndîî
, 
Rídîî
* 
ªndîî
) {

48 #i‡
INTERNAL


49 if(
execuèbÀ_ªlﬂded
Ë
	`InôPo°Pro˚ssShadîs
(
µ_ªndîî
, 
ªndîî
);

51 
Po°Pro˚ssPùñöe
 
pùñöe
 = 
µ_ªndîî
->pipeline;

53 
SëRa°îizîSèã
* 
§s
 = 
	`PushRídîComm™d
(
ªndîî
, SetRasterizerState);

54 
§s
->
ty≥
 = 
RASTERIZER_STATE_DoubÀSided
;

56 
SëVîãxShadî
* 
svs
 = 
	`PushRídîComm™d
(
ªndîî
, SetVertexShader);

57 
svs
->
vîãx
 = 
µ_ªndîî
->
fuŒ_s¸ìn_quad_shadî
;

59 
SëPixñShadî
* 
•s
 = 
	`PushRídîComm™d
(
ªndîî
, SetPixelShader);

60 
•s
->
pixñ
 = 
µ_ªndîî
->
ps
[
pùñöe
.
ty≥
];

62 if(
pùñöe
.
ty≥
 =
POST_PROCESS_TYPE_Edge
) {

63 
PushRídîBuf„rD©a
* 
push_ªsﬁuti⁄
 = 
	`PushRídîComm™d
(
ªndîî
, PushRenderBufferData);

64 
Vec2
* 
ªsﬁuti⁄
 = 
	`PushSåu˘
(
ªndîî
->
‰ame_¨ía
, Vec2);

65 
ªsﬁuti⁄
->
x
 = ()
ªndîî
->
wödow_dim
.
width
;

66 
ªsﬁuti⁄
->
y
 = ()
ªndîî
->
wödow_dim
.
height
;

67 
push_ªsﬁuti⁄
->
buf„r
 = 
µ_ªndîî
->
ªsﬁuti⁄_c⁄°™ts
->buffer;

68 
push_ªsﬁuti⁄
->
d©a
 = 
ªsﬁuti⁄
;

69 
push_ªsﬁuti⁄
->
size
 = (
Vec2
);

71 
SëBÀndSèã
* 
£t_bÀnd_°©e
 = 
	`PushRídîComm™d
(
ªndîî
, SetBlendState);

72 
£t_bÀnd_°©e
->
ty≥
 = 
BLEND_STATE_NoBÀnd
;

74 
SëC⁄°™tsBuf„r
* 
scb
 = 
	`PushRídîComm™d
(
ªndîî
, SetConstantsBuffer);

75 
scb
->
vîãx_shadî
 = 
Ál£
;

76 
scb
->
c⁄°™ts
 = 
µ_ªndîî
->
ªsﬁuti⁄_c⁄°™ts
;

77 
scb
->
¶Ÿ
 = 0;

80 
SëBÀndSèã
* 
£t_bÀnd_°©e
 = 
	`PushRídîComm™d
(
ªndîî
, SetBlendState);

81 
£t_bÀnd_°©e
->
ty≥
 = 
BLEND_STATE_Reguœr
;

84 
RídîT¨gë
* 
π
 = 
	`PushSåu˘
(
ªndîî
->
‰ame_¨ía
, RenderTarget);

85 
π
->
võw
 = 
pùñöe
.
out
;

86 
SëRídîT¨gë
* 
§t
 = 
	`PushRídîComm™d
(
ªndîî
, SetRenderTarget);

87 
§t
->
ªndî_èrgë
 = 
π
;

89 
CÀ¨RídîT¨gë
* 
¸t
 = 
	`PushRídîComm™d
(
ªndîî
, ClearRenderTarget);

90 
¸t
->
ªndî_èrgë
 = 
π
;

91 *(
Vec4
*)
¸t
->
cﬁ‹
 = 
	`V4FromV3
(
RED
, 1.0f);

93 
CÀ¨Dïth
* 
cd
 = 
	`PushRídîComm™d
(
ªndîî
, ClearDepth);

94 
cd
->
vÆue
 = 1.0f;

96 
SëSam∂îSèã
* 
£t_ßm∂î_°©e
 = 
	`PushRídîComm™d
(
ªndîî
, SetSamplerState);

97 
£t_ßm∂î_°©e
->
ty≥
 = 
SAMPLER_STATE_DeÁu…
;

98 
£t_ßm∂î_°©e
->
¶Ÿ
 = 0;

100 
TextuªBuf„r
* 
tb
 = 
	`PushSåu˘
(
ªndîî
->
‰ame_¨ía
, TextureBuffer);

101 
tb
->
võw
 = 
pùñöe
.
ö
;

102 
SëTextuªBuf„r
* 
°b
 = 
	`PushRídîComm™d
(
ªndîî
, SetTextureBuffer);

103 
°b
->
ãxtuª
 = 
tb
;

104 
°b
->
¶Ÿ
 = 0;

106 
SëPrimôiveT›ﬁogy
* 
£t_t›ﬁogy
 = 
	`PushRídîComm™d
(
ªndîî
, SetPrimitiveTopology);

107 
£t_t›ﬁogy
->
ty≥
 = 
PRIMITIVE_TOPOLOGY_TrüngÀLi°
;

109 
DøwVîti˚s
* 
dv
 = 
	`PushRídîComm™d
(
ªndîî
, DrawVertices);

110 
dv
->
vîti˚s_cou¡
 = 3;

112 
SëTextuªBuf„r
* 
°b2
 = 
	`PushRídîComm™d
(
ªndîî
, SetTextureBuffer);

113 
°b2
->
ãxtuª
 = 0;

114 
°b2
->
¶Ÿ
 = 0;

116 
	}
}

	@quad_renderer.cpp

1 
	#MAX_QUADS
 10000

	)

2 
	#MAX_TEXTURED_QUADS
 10000

	)

4 
	sRídîQuad
 {

5 
Quad
 
	mquad
;

6 
Vec4
 
	mcﬁ‹
;

9 
	sTextuªdQuad
 {

10 
Quad
 
	mquad
;

11 
TextuªBuf„r
* 
	mãxtuª
;

14 
	sQuadRídîî
 {

15 
RídîQuad
 
	mquads
[
MAX_QUADS
];

16 
u32
 
	mquad_cou¡î
;

17 
C⁄°™tsBuf„r
* 
	mˇmîa_c⁄°™ts
;

19 
VîãxShadî
* 
	mquad_vs
;

20 
PixñShadî
* 
	mquad_ps
;

21 
Såu˘uªdBuf„r
* 
	mquad_buf„r
;

23 
Vec3
 
	mposôi⁄s
[
MAX_TEXTURED_QUADS
*4];

24 
Vec2
 
	mãxco‹ds
[
MAX_TEXTURED_QUADS
*4];

25 
TextuªBuf„r
* 
	mãxtuªs
[
MAX_TEXTURED_QUADS
];

26 
u8
 
	mbÀnd_°©es
[
MAX_TEXTURED_QUADS
];

27 
u32
 
	mãxtuªd_quad_cou¡î
;

29 
VîãxShadî
* 
	mãxtuªd_quad_vs
;

30 
PixñShadî
* 
	mãxtuªd_quad_ps
;

31 
VîãxBuf„r
* 
	mãxtuªd_quad_vîãx_buf„rs
[2];

34 
QuadRídîî
*

35 
	$InôQuadRídîî
(
Rídîî
* 
ªndîî
, 
Mem‹yAª«
* 
¨ía
) {

36 
QuadRídîî
* 
ªsu…
 = 
	`PushSåu˘
(
¨ía
, QuadRenderer);

38 
VERTEX_BUFFER
 
vîãx_buf„rs
[] = { 
VERTEX_BUFFER_POSITION
, 
VERTEX_BUFFER_TEXCOORD
 };

40 
ªsu…
->
ãxtuªd_quad_vs
 = 
	`U∂ﬂdVîãxShadî
(
TextuªdQuadShadî
, (TexturedQuadShader),

41 "vsf", 
vîãx_buf„rs
, 
	`AºayCou¡
(vîãx_buf„rs), 
ªndîî
);

43 
ªsu…
->
ãxtuªd_quad_ps
 = 
	`U∂ﬂdPixñShadî
(
TextuªdQuadShadî
, (TexturedQuadShader),

44 "psf", 
ªndîî
);

46 
ªsu…
->
quad_vs
 = 
	`U∂ﬂdVîãxShadî
(
QuadShadî
, (QuadShadî), "vsf", 0, 0, 
ªndîî
);

47 
ªsu…
->
quad_ps
 = 
	`U∂ﬂdPixñShadî
(
QuadShadî
, (QuadShadî), "psf", 
ªndîî
);

49 
ªsu…
->
quad_buf„r
 = 
	`U∂ﬂdSåu˘uªdBuf„r
((
RídîQuad
), 
MAX_QUADS
, 
ªndîî
);

51 
ªsu…
->
ˇmîa_c⁄°™ts
 = 
	`U∂ﬂdC⁄°™tsBuf„r
((
M©4
), 
ªndîî
);

53 
ªsu…
->
ãxtuªd_quad_vîãx_buf„rs
[0] = 
	`U∂ﬂdVîãxBuf„r
(0, 
MAX_TEXTURED_QUADS
*4, 3, 
åue
, 
ªndîî
);

54 
ªsu…
->
ãxtuªd_quad_vîãx_buf„rs
[1] = 
	`U∂ﬂdVîãxBuf„r
(0, 
MAX_TEXTURED_QUADS
*4, 2, 
åue
, 
ªndîî
);

56  
ªsu…
;

57 
	}
}

60 
	$PushRídîQuad
(
Quad
* 
quad
, 
Vec4
 
cﬁ‹
, 
QuadRídîî
* 
quad_ªndîî
) {

61 
	`As£π
(
quad_ªndîî
->
quad_cou¡î
 <
MAX_QUADS
);

62 
RídîQuad
 
ªndî_quad
 = { *
quad
, 
cﬁ‹
 };

63 
quad_ªndîî
->
quads
[quad_ªndîî->
quad_cou¡î
++] = 
ªndî_quad
;

64 
	}
}

67 
	$PushTextuªdQuad
(
Quad
* 
quad
, 
TextuªBuf„r
* 
ãxtuª_buf„r
, 
QuadRídîî
* 
quad_ªndîî
) {

68 
	`As£π
(
quad_ªndîî
->
ãxtuªd_quad_cou¡î
 <
MAX_TEXTURED_QUADS
);

69 
Vec2
* 
ãxco‹ds
 = 
quad_ªndîî
->texcoords;

70 
Vec3
* 
posôi⁄s
 = 
quad_ªndîî
->positions;

71 
u32
 
ãxtuªd_quad_cou¡î
 = 
quad_ªndîî
->textured_quad_counter;

73 
posôi⁄s
[
ãxtuªd_quad_cou¡î
*4] = 
quad
->
bl
;

74 
ãxco‹ds
[
ãxtuªd_quad_cou¡î
*4] = 
	`V2
(0.0f, 1.0f);

76 
posôi⁄s
[
ãxtuªd_quad_cou¡î
*4 + 1] = 
quad
->
br
;

77 
ãxco‹ds
[
ãxtuªd_quad_cou¡î
*4 + 1] = 
	`V2
(1.0f, 1.0f);

79 
posôi⁄s
[
ãxtuªd_quad_cou¡î
*4 + 2] = 
quad
->
é
;

80 
ãxco‹ds
[
ãxtuªd_quad_cou¡î
*4 + 2] = 
	`V2
(0.0f, 0.0f);

82 
posôi⁄s
[
ãxtuªd_quad_cou¡î
*4 + 3] = 
quad
->
å
;

83 
ãxco‹ds
[
ãxtuªd_quad_cou¡î
*4 + 3] = 
	`V2
(1.0f, 0.0f);

85 
quad_ªndîî
->
ãxtuªs
[quad_ªndîî->
ãxtuªd_quad_cou¡î
] = 
ãxtuª_buf„r
;

86 
quad_ªndîî
->
bÀnd_°©es
[quad_ªndîî->
ãxtuªd_quad_cou¡î
++] = 0;

87 
	}
}

90 
	$PushP¨ti˛eQuad
(
Quad
* 
quad
, 
TextuªBuf„r
* 
ãxtuª_buf„r
, 
QuadRídîî
* 
quad_ªndîî
) {

91 
	`As£π
(
quad_ªndîî
->
ãxtuªd_quad_cou¡î
 <
MAX_TEXTURED_QUADS
);

92 
Vec2
* 
ãxco‹ds
 = 
quad_ªndîî
->texcoords;

93 
Vec3
* 
posôi⁄s
 = 
quad_ªndîî
->positions;

94 
u32
 
ãxtuªd_quad_cou¡î
 = 
quad_ªndîî
->textured_quad_counter;

96 
posôi⁄s
[
ãxtuªd_quad_cou¡î
*4] = 
quad
->
bl
;

97 
ãxco‹ds
[
ãxtuªd_quad_cou¡î
*4] = 
	`V2
(0.0f, 1.0f);

99 
posôi⁄s
[
ãxtuªd_quad_cou¡î
*4 + 1] = 
quad
->
br
;

100 
ãxco‹ds
[
ãxtuªd_quad_cou¡î
*4 + 1] = 
	`V2
(1.0f, 1.0f);

102 
posôi⁄s
[
ãxtuªd_quad_cou¡î
*4 + 2] = 
quad
->
é
;

103 
ãxco‹ds
[
ãxtuªd_quad_cou¡î
*4 + 2] = 
	`V2
(0.0f, 0.0f);

105 
posôi⁄s
[
ãxtuªd_quad_cou¡î
*4 + 3] = 
quad
->
å
;

106 
ãxco‹ds
[
ãxtuªd_quad_cou¡î
*4 + 3] = 
	`V2
(1.0f, 0.0f);

108 
quad_ªndîî
->
ãxtuªs
[quad_ªndîî->
ãxtuªd_quad_cou¡î
++] = 
ãxtuª_buf„r
;

109 
quad_ªndîî
->
bÀnd_°©es
[quad_ªndîî->
ãxtuªd_quad_cou¡î
++] = 
BLEND_STATE_Reguœr
;

110 
	}
}

113 
	$PushRídîLöe
(
Löe
* 
löe
, 
Vec4
 
cﬁ‹
, 
thick√ss
, 
Camîa
* 
ˇmîa
, 
QuadRídîî
* 
quad_ªndîî
) {

114 
Vec3
 
löe_unô_ve˘‹
 = 
	`V3N‹m
(
	`V3Sub
(
löe
->
íd
,Üöe->
°¨t
));

115 
Vec3
 
ˇmîa_f‹w¨d
 = 
	`GëF‹w¨dVe˘‹
(
ˇmîa
->
rŸ©i⁄
);

116 
Vec3
 
≥Ω
 = 
	`V3Cross
(
ˇmîa_f‹w¨d
, 
löe_unô_ve˘‹
);

118 
Quad
 
quad
 = 
	`MakeQuadFromLöe
(
löe
, 
thick√ss
, 
≥Ω
);

120 
	`PushRídîQuad
(&
quad
, 
cﬁ‹
, 
quad_ªndîî
);

121 
	}
}

124 
	$QuadRídîîFøme
(
QuadRídîî
* 
quad_ªndîî
, 
Camîa
* 
ˇm
, 
Rídîî
* 
ªndîî
) {

125 if(!
quad_ªndîî
->
quad_cou¡î
 && !quad_ªndîî->
ãxtuªd_quad_cou¡î
) ;

127 
M©4
* 
vp
 = 
	`PushSåu˘
(
ªndîî
->
‰ame_¨ía
, Mat4);

128 *
vp
 = 
	`MakeVõwPî•e˘ive
(
ˇm
);

130 
PushRídîBuf„rD©a
* 
push_ˇmîa_c⁄°™ts
 = 
	`PushRídîComm™d
(
ªndîî
, PushRenderBufferData);

131 
push_ˇmîa_c⁄°™ts
->
buf„r
 = 
quad_ªndîî
->
ˇmîa_c⁄°™ts
->buffer;

132 
push_ˇmîa_c⁄°™ts
->
d©a
 = 
vp
;

133 
push_ˇmîa_c⁄°™ts
->
size
 = (
M©4
);

135 
SëC⁄°™tsBuf„r
* 
£t_ˇmîa_c⁄°™ts
 = 
	`PushRídîComm™d
(
ªndîî
, SetConstantsBuffer);

136 
£t_ˇmîa_c⁄°™ts
->
c⁄°™ts
 = 
quad_ªndîî
->
ˇmîa_c⁄°™ts
;

137 
£t_ˇmîa_c⁄°™ts
->
¶Ÿ
 = (
u8
)1;

138 
£t_ˇmîa_c⁄°™ts
->
vîãx_shadî
 = 
åue
;

140 if(
quad_ªndîî
->
ãxtuªd_quad_cou¡î
) {

141 
SëPrimôiveT›ﬁogy
* 
£t_t›ﬁogy
 = 
	`PushRídîComm™d
(
ªndîî
, SetPrimitiveTopology);

142 
£t_t›ﬁogy
->
ty≥
 = (
u8
)
PRIMITIVE_TOPOLOGY_TrüngÀSåù
;

144 
SëVîãxShadî
* 
£t_vîãx_shadî
 = 
	`PushRídîComm™d
(
ªndîî
, SetVertexShader);

145 
£t_vîãx_shadî
->
vîãx
 = 
quad_ªndîî
->
ãxtuªd_quad_vs
;

147 
SëPixñShadî
* 
£t_pixñ_shadî
 = 
	`PushRídîComm™d
(
ªndîî
, SetPixelShader);

148 
£t_pixñ_shadî
->
pixñ
 = 
quad_ªndîî
->
ãxtuªd_quad_ps
;

150 
PushRídîBuf„rD©a
* 
push_pos_vîts
 = 
	`PushRídîComm™d
(
ªndîî
, PushRenderBufferData);

151 
push_pos_vîts
->
buf„r
 = 
quad_ªndîî
->
ãxtuªd_quad_vîãx_buf„rs
[0]->buffer;

152 
push_pos_vîts
->
d©a
 = 
quad_ªndîî
->
posôi⁄s
;

153 
push_pos_vîts
->
size
 = ()*3 * 
quad_ªndîî
->
ãxtuªd_quad_cou¡î
*4;

155 
PushRídîBuf„rD©a
* 
push_ãx_vîts
 = 
	`PushRídîComm™d
(
ªndîî
, PushRenderBufferData);

156 
push_ãx_vîts
->
buf„r
 = 
quad_ªndîî
->
ãxtuªd_quad_vîãx_buf„rs
[1]->buffer;

157 
push_ãx_vîts
->
d©a
 = 
quad_ªndîî
->
ãxco‹ds
;

158 
push_ãx_vîts
->
size
 = ()*2 * 
quad_ªndîî
->
ãxtuªd_quad_cou¡î
*4;

160 
SëVîãxBuf„r
* 
£t_posôi⁄_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
, SetVertexBuffer);

161 
£t_posôi⁄_buf„r
->
vîãx
 = 
quad_ªndîî
->
ãxtuªd_quad_vîãx_buf„rs
[0];

162 
£t_posôi⁄_buf„r
->
¶Ÿ
 = 0;

163 
£t_posôi⁄_buf„r
->
°ride
 = ()*3;

164 
£t_posôi⁄_buf„r
->
off£t
 = 0;

166 
SëVîãxBuf„r
* 
£t_ãxco‹d_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
, SetVertexBuffer);

167 
£t_ãxco‹d_buf„r
->
vîãx
 = 
quad_ªndîî
->
ãxtuªd_quad_vîãx_buf„rs
[1];

168 
£t_ãxco‹d_buf„r
->
¶Ÿ
 = 1;

169 
£t_ãxco‹d_buf„r
->
°ride
 = ()*2;

170 
£t_ãxco‹d_buf„r
->
off£t
 = 0;

172 
u32
 
i
=0; i<
quad_ªndîî
->
ãxtuªd_quad_cou¡î
; i++) {

173 
SëTextuªBuf„r
* 
£t_ãxtuª_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
, SetTextureBuffer);

174 
£t_ãxtuª_buf„r
->
ãxtuª
 = 
quad_ªndîî
->
ãxtuªs
[
i
];

175 
£t_ãxtuª_buf„r
->
¶Ÿ
 = 0;

177 
SëBÀndSèã
* 
£t_bÀnd_°©e
 = 
	`PushRídîComm™d
(
ªndîî
, SetBlendState);

178 
£t_bÀnd_°©e
->
ty≥
 = 
quad_ªndîî
->
bÀnd_°©es
[
i
];

180 
DøwVîti˚s
* 
døw_vîts
 = 
	`PushRídîComm™d
(
ªndîî
, DrawVertices);

181 
døw_vîts
->
vîti˚s_cou¡
 = 4 * 
quad_ªndîî
->
ãxtuªd_quad_cou¡î
;

185 if(
quad_ªndîî
->
quad_cou¡î
) {

186 
SëPrimôiveT›ﬁogy
* 
£t_t›ﬁogy
 = 
	`PushRídîComm™d
(
ªndîî
, SetPrimitiveTopology);

187 
£t_t›ﬁogy
->
ty≥
 = (
u8
)
PRIMITIVE_TOPOLOGY_TrüngÀLi°
;

189 
PushRídîBuf„rD©a
* 
push_quad_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
, PushRenderBufferData);

190 
push_quad_buf„r
->
buf„r
 = 
quad_ªndîî
->
quad_buf„r
->buffer;

191 
push_quad_buf„r
->
d©a
 = 
quad_ªndîî
->
quads
;

192 
push_quad_buf„r
->
size
 = (
RídîQuad
Ë* 
quad_ªndîî
->
quad_cou¡î
;

194 
SëSåu˘uªdBuf„r
* 
£t_quad_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
, SetStructuredBuffer);

195 
£t_quad_buf„r
->
vîãx_shadî
 = 
åue
;

196 
£t_quad_buf„r
->
°ru˘uªd
 = 
quad_ªndîî
->
quad_buf„r
;

197 
£t_quad_buf„r
->
¶Ÿ
 = 0;

199 
SëVîãxShadî
* 
£t_vîãx_shadî
 = 
	`PushRídîComm™d
(
ªndîî
, SetVertexShader);

200 
£t_vîãx_shadî
->
vîãx
 = 
quad_ªndîî
->
quad_vs
;

202 
SëPixñShadî
* 
£t_pixñ_shadî
 = 
	`PushRídîComm™d
(
ªndîî
, SetPixelShader);

203 
£t_pixñ_shadî
->
pixñ
 = 
quad_ªndîî
->
quad_ps
;

205 
DøwVîti˚s
* 
døw_vîts
 = 
	`PushRídîComm™d
(
ªndîî
, DrawVertices);

206 
døw_vîts
->
vîti˚s_cou¡
 = 6 * 
quad_ªndîî
->
quad_cou¡î
;

209 
quad_ªndîî
->
quad_cou¡î
 = 0;

210 
quad_ªndîî
->
ãxtuªd_quad_cou¡î
 = 0;

211 
	}
}

	@renderer.cpp

1 
	~"ªndîî.h
"

4 
	$PushRídîD©a
(
ID3D11Buf„r
* 
buf„r
, * 
d©a
, 
u32
 
size
, 
ID3D11Devi˚C⁄ãxt
* 
c⁄ãxt
) {

5 
D3D11_MAPPED_SUBRESOURCE
 
m§
 = {};

7 
c⁄ãxt
->
	`M≠
(
buf„r
, 0, 
D3D11_MAP_WRITE_DISCARD
, 0, &
m§
);

8 
	`C›yMem
(
m§
.
pD©a
, 
d©a
, 
size
);

9 
c⁄ãxt
->
	`Unm≠
(
buf„r
, 0);

11 
d©a
 = 
nuŒ±r
;

12 
	}
}

15 
	$PushComm™dBuf„r
(
Rídîî
* 
ªndîî
, 
u32
 
size
) {

16 * 
ªsu…
 = 0;

18 
u8
* 
comm™d_buf„r_íd
 = 
ªndîî
->
comm™d_buf„r_ba£
 +Ñídîî->
comm™d_buf„r_size
;

20 if((
ªndîî
->
comm™d_buf„r_curs‹
 + 
size
Ë<
comm™d_buf„r_íd
) {

21 
ªsu…
 = 
ªndîî
->
comm™d_buf„r_curs‹
;

22 
ªndîî
->
comm™d_buf„r_curs‹
 +
size
;

24 
	`As£π
(
Ál£
);

26  
ªsu…
;

27 
	}
}

29 
	#PushRídîComm™d
(
ªndîî
, 
ty≥
Ë—y≥ *)
	`PushRídîComm™d_
‘ídîî, —y≥), 
RENDER_COMMAND_
##ty≥)

	)

32 
	$PushRídîComm™d_
(
Rídîî
* 
ªndîî
, 
u32
 
size
, 
RENDER_COMMAND
 
ty≥
 ) {

33 * 
ªsu…
 = 0;

35 
u32
 
a˘uÆ_size
 = 
size
 + (
RídîComm™dHódî
);

36 * 
±r
 = 
	`PushComm™dBuf„r
(
ªndîî
, 
a˘uÆ_size
);

38 
RídîComm™dHódî
* 
hódî
 = (RídîComm™dHódî*)
±r
;

39 
hódî
->
ty≥
 = (
u8
)type;

40 
ªsu…
 = (
u8
*)
±r
 + (
RídîComm™dHódî
);

42  
ªsu…
;

43 
	}
}

46 
	$ExecuãRídîComm™ds
(
Rídîî
* 
ªndîî
) {

47 
u8
* 
curs‹
 = 
ªndîî
->
comm™d_buf„r_ba£
;

48 
curs‹
 < 
ªndîî
->
comm™d_buf„r_curs‹
) {

49 
RídîComm™dHódî
* 
hódî
 = (RídîComm™dHódî*)
curs‹
;

50 
curs‹
 +(
RídîComm™dHódî
);

51 * 
d©a
 = (
u8
*)
hódî
 + (
RídîComm™dHódî
);

53 
hódî
->
ty≥
) {

55 
RENDER_COMMAND_CÀ¨RídîT¨gë
: {

56 
curs‹
 +(
CÀ¨RídîT¨gë
);

57 
CÀ¨RídîT¨gë
* 
comm™d
 = (CÀ¨RídîT¨gë*)
d©a
;

59 if(
comm™d
->
ªndî_èrgë
)

60 
ªndîî
->
c⁄ãxt
->
	`CÀ¨RídîT¨gëVõw
(
comm™d
->
ªndî_èrgë
->
võw
, comm™d->
cﬁ‹
);

62 
ªndîî
->
c⁄ãxt
->
	`CÀ¨RídîT¨gëVõw
‘ídîî->
ªadabÀ_ªndî_èrgë
.
ªndî_èrgë
, 
comm™d
->
cﬁ‹
);

66 
RENDER_COMMAND_CÀ¨Dïth
: {

67 
curs‹
 +(
CÀ¨Dïth
);

68 
CÀ¨Dïth
* 
comm™d
 = (CÀ¨Dïth*)
d©a
;

70 
ªndîî
->
c⁄ãxt
->
	`CÀ¨DïthSãncûVõw
‘ídîî->
dïth_°ícû
.
võw
, 
D3D11_CLEAR_DEPTH
,

71 
comm™d
->
vÆue
, 0);

74 
RENDER_COMMAND_CÀ¨Sãncû
: {

75 
curs‹
 +(
CÀ¨Sãncû
);

76 
CÀ¨Sãncû
* 
comm™d
 = (CÀ¨Sãncû*)
d©a
;

79 
ªndîî
->
c⁄ãxt
->
	`CÀ¨DïthSãncûVõw
‘ídîî->
dïth_°ícû
.
võw
, 
D3D11_CLEAR_STENCIL
, 0, 
comm™d
->
vÆue
);

82 
RENDER_COMMAND_SëRídîT¨gë
: {

83 
curs‹
 +(
SëRídîT¨gë
);

84 
SëRídîT¨gë
* 
comm™d
 = (SëRídîT¨gë*)
d©a
;

86 if(
comm™d
->
ªndî_èrgë
)

87 
ªndîî
->
c⁄ãxt
->
	`OMSëRídîT¨gës
(1, &
comm™d
->
ªndî_èrgë
->
võw
,Ñídîî->
dïth_°ícû
.view);

89 
ªndîî
->
c⁄ãxt
->
	`OMSëRídîT¨gës
(1, &ªndîî->
ªadabÀ_ªndî_èrgë
.
ªndî_èrgë
,Ñídîî->
dïth_°ícû
.
võw
);

92 
RENDER_COMMAND_SëDïthSãncûSèã
: {

93 
curs‹
 +(
SëDïthSãncûSèã
);

94 
SëDïthSãncûSèã
* 
comm™d
 = (SëDïthSãncûSèã*)
d©a
;

96 
ªndîî
->
c⁄ãxt
->
	`OMSëDïthSãncûSèã
‘ídîî->
deÁu…_dïth_°ícû_°©e
, 0);

100 
RENDER_COMMAND_SëBÀndSèã
: {

101 
curs‹
 +(
SëBÀndSèã
);

102 
SëBÀndSèã
* 
comm™d
 = (SëBÀndSèã*)
d©a
;

104 
ªndîî
->
c⁄ãxt
->
	`OMSëBÀndSèã
‘ídîî->
bÀnd_°©es
[
comm™d
->
ty≥
], 0, 0xffffffff);

107 
RENDER_COMMAND_SëRa°îizîSèã
: {

108 
curs‹
 +(
SëRa°îizîSèã
);

109 
SëRa°îizîSèã
* 
comm™d
 = (SëRa°îizîSèã*)
d©a
;

111 
ªndîî
->
c⁄ãxt
->
	`RSSëSèã
‘ídîî->
ø°îizî_°©es
[
comm™d
->
ty≥
]);

114 
RENDER_COMMAND_SëSam∂îSèã
: {

115 
curs‹
 +(
SëSam∂îSèã
);

116 
SëSam∂îSèã
* 
comm™d
 = (SëSam∂îSèã*)
d©a
;

118 
ªndîî
->
c⁄ãxt
->
	`PSSëSam∂îs
(
comm™d
->
¶Ÿ
, 1, &ªndîî->
ßm∂îs
[comm™d->
ty≥
]);

121 
RENDER_COMMAND_SëVõwp‹t
: {

122 
curs‹
 +(
SëVõwp‹t
);

123 
SëVõwp‹t
* 
comm™d
 = (SëVõwp‹t*)
d©a
;

125 
D3D11_VIEWPORT
 
vp
 = {};

126 
vp
.
T›Le·X
 = 
comm™d
->
t›À·
.
x
;

127 
vp
.
T›Le·Y
 = 
comm™d
->
t›À·
.
y
;

128 
vp
.
Width
 = 
comm™d
->
dim
.
x
;

129 
vp
.
Height
 = 
comm™d
->
dim
.
y
;

131 
ªndîî
->
c⁄ãxt
->
	`RSSëVõwp‹ts
(1, &
vp
);

133 
D3D11_RECT
 
ª˘
 = {};

134 
ª˘
.
right
 = 
vp
.
Width
;

135 
ª˘
.
bŸtom
 = 
vp
.
Height
;

137 
ªndîî
->
c⁄ãxt
->
	`RSSëSciss‹Re˘s
(1, &
ª˘
);

141 
RENDER_COMMAND_SëPrimôiveT›ﬁogy
: {

142 
curs‹
 +(
SëPrimôiveT›ﬁogy
);

143 
SëPrimôiveT›ﬁogy
* 
comm™d
 = (SëPrimôiveT›ﬁogy*)
d©a
;

145 
D3D_PRIMITIVE_TOPOLOGY
 
t›ﬁogy
;

146 if(
comm™d
->
ty≥
 =
PRIMITIVE_TOPOLOGY_TrüngÀLi°
)

147 
t›ﬁogy
 = 
D3D_PRIMITIVE_TOPOLOGY_TRIANGLELIST
;

148 if(
comm™d
->
ty≥
 =
PRIMITIVE_TOPOLOGY_TrüngÀSåù
)

149 
t›ﬁogy
 = 
D3D_PRIMITIVE_TOPOLOGY_TRIANGLESTRIP
;

151 
ªndîî
->
c⁄ãxt
->
	`IASëPrimôiveT›ﬁogy
(
t›ﬁogy
);

154 
RENDER_COMMAND_SëVîãxShadî
: {

155 
curs‹
 +(
SëVîãxShadî
);

156 
SëVîãxShadî
* 
comm™d
 = (SëVîãxShadî*)
d©a
;

158 
ªndîî
->
c⁄ãxt
->
	`IASëI≈utLayout
(
comm™d
->
vîãx
->
û
);

159 
ªndîî
->
c⁄ãxt
->
	`VSSëShadî
(
comm™d
->
vîãx
->
shadî
, 0, 0);

162 
RENDER_COMMAND_SëPixñShadî
: {

163 
curs‹
 +(
SëPixñShadî
);

164 
SëPixñShadî
* 
comm™d
 = (SëPixñShadî*)
d©a
;

166 
ªndîî
->
c⁄ãxt
->
	`PSSëShadî
(
comm™d
->
pixñ
->
shadî
, 0, 0);

169 
RENDER_COMMAND_SëVîãxBuf„r
: {

170 
curs‹
 +(
SëVîãxBuf„r
);

171 
SëVîãxBuf„r
* 
comm™d
 = (SëVîãxBuf„r*)
d©a
;

173 
ªndîî
->
c⁄ãxt
->
	`IASëVîãxBuf„rs
(
comm™d
->
¶Ÿ
, 1, &comm™d->
vîãx
->
buf„r
, &comm™d->
°ride
, &comm™d->
off£t
);

176 
RENDER_COMMAND_SëIndexBuf„r
: {

177 
curs‹
 +(
SëIndexBuf„r
);

178 
SëIndexBuf„r
* 
comm™d
 = (SëIndexBuf„r*)
d©a
;

180 
ªndîî
->
c⁄ãxt
->
	`IASëIndexBuf„r
(
comm™d
->
ödex
->
buf„r
, 
DXGI_FORMAT_R32_UINT
, comm™d->
off£t
);

183 
RENDER_COMMAND_SëSåu˘uªdBuf„r
: {

184 
curs‹
 +(
SëSåu˘uªdBuf„r
);

185 
SëSåu˘uªdBuf„r
* 
comm™d
 = (SëSåu˘uªdBuf„r*)
d©a
;

187 if(
comm™d
->
vîãx_shadî
)

188 
ªndîî
->
c⁄ãxt
->
	`VSSëShadîResour˚s
(
comm™d
->
¶Ÿ
, 1, &comm™d->
°ru˘uªd
->
võw
);

190 
ªndîî
->
c⁄ãxt
->
	`PSSëShadîResour˚s
(
comm™d
->
¶Ÿ
, 1, &comm™d->
°ru˘uªd
->
võw
);

193 
RENDER_COMMAND_SëTextuªBuf„r
: {

194 
curs‹
 +(
SëTextuªBuf„r
);

195 
SëTextuªBuf„r
* 
comm™d
 = (SëTextuªBuf„r*)
d©a
;

197 if(
comm™d
->
ãxtuª
)

198 
ªndîî
->
c⁄ãxt
->
	`PSSëShadîResour˚s
(
comm™d
->
¶Ÿ
, 1, &comm™d->
ãxtuª
->
võw
);

200 
ID3D11ShadîResour˚Võw
* 
§v
[1] = { 0 };

201 
ªndîî
->
c⁄ãxt
->
	`PSSëShadîResour˚s
(
comm™d
->
¶Ÿ
, 1, 
§v
);

205 
RENDER_COMMAND_SëC⁄°™tsBuf„r
: {

206 
curs‹
 +(
SëC⁄°™tsBuf„r
);

207 
SëC⁄°™tsBuf„r
* 
comm™d
 = (SëC⁄°™tsBuf„r*)
d©a
;

209 if(
comm™d
->
vîãx_shadî
)

210 
ªndîî
->
c⁄ãxt
->
	`VSSëC⁄°™tBuf„rs
(
comm™d
->
¶Ÿ
, 1, &comm™d->
c⁄°™ts
->
buf„r
);

212 
ªndîî
->
c⁄ãxt
->
	`PSSëC⁄°™tBuf„rs
(
comm™d
->
¶Ÿ
, 1, &comm™d->
c⁄°™ts
->
buf„r
);

215 
RENDER_COMMAND_PushRídîBuf„rD©a
: {

216 
curs‹
 +(
PushRídîBuf„rD©a
);

217 
PushRídîBuf„rD©a
* 
comm™d
 = (PushRídîBuf„rD©a*)
d©a
;

219 
	`PushRídîD©a
((
ID3D11Buf„r
*)
comm™d
->
buf„r
, comm™d->
d©a
, comm™d->
size
, 
ªndîî
->
c⁄ãxt
);

222 
RENDER_COMMAND_FªeRídîResour˚
: {

223 
curs‹
 +(
FªeRídîResour˚
);

224 
FªeRídîResour˚
* 
comm™d
 = (FªeRídîResour˚*)
d©a
;

226 
ID3D11Resour˚
* 
ªsour˚
 = (ID3D11Resour˚*)
comm™d
->
buf„r
;

227 
ªsour˚
->
	`Rñó£
();

230 
RENDER_COMMAND_DøwVîti˚s
: {

231 
curs‹
 +(
DøwVîti˚s
);

232 
DøwVîti˚s
* 
comm™d
 = (DøwVîti˚s*)
d©a
;

234 
ªndîî
->
c⁄ãxt
->
	`Døw
(
comm™d
->
vîti˚s_cou¡
, comm™d->
off£t
);

237 
RENDER_COMMAND_DøwIndexed
: {

238 
curs‹
 +(
DøwIndexed
);

239 
DøwIndexed
* 
comm™d
 = (DøwIndexed*)
d©a
;

241 
ªndîî
->
c⁄ãxt
->
	`DøwIndexed
(
comm™d
->
ödi˚s_cou¡
, comm™d->
off£t
, 0);

244 
RENDER_COMMAND_DøwIn°™˚d
: {

245 
curs‹
 +(
DøwIn°™˚d
);

246 
DøwIn°™˚d
* 
comm™d
 = (DøwIn°™˚d*)
d©a
;

248 
ªndîî
->
c⁄ãxt
->
	`DøwIn°™˚d
(
comm™d
->
vîti˚s_cou¡
, comm™d->
ö°™˚_cou¡
, comm™d->
off£t
, 0);

252 
	}
}

254 
RódabÀRídîT¨gë


255 
	$Cª©eRódabÀRídîT¨gë
(
Rídîî
* 
ªndîî
) {

256 
HRESULT
 
hr
 = {};

257 
RódabÀRídîT¨gë
 
ªsu…
 = {};

258 
ID3D11Textuª2D
* 
ãxtuª
 = 
NULL
;

259 
ID3D11RídîT¨gëVõw
* 
ªndî_èrgë
 = 
NULL
;

260 
ID3D11ShadîResour˚Võw
* 
shadî_ªsour˚
 = 
NULL
;

262 
DXGI_FORMAT
 
f‹m©
 = 
DXGI_FORMAT_R8G8B8A8_UNORM
;

264 
D3D11_TEXTURE2D_DESC
 
buf„r_desc
 = {};

265 
buf„r_desc
.
AºaySize
 = 1;

266 
buf„r_desc
.
BödFœgs
 = 
D3D11_BIND_RENDER_TARGET
 | 
D3D11_BIND_SHADER_RESOURCE
;

267 
buf„r_desc
.
CPUAc˚ssFœgs
 = 0;

268 
buf„r_desc
.
F‹m©
 = 
f‹m©
;

269 
buf„r_desc
.
Width
 = 
ªndîî
->
wödow_dim
.
width
;

270 
buf„r_desc
.
Height
 = 
ªndîî
->
wödow_dim
.
height
;

271 
buf„r_desc
.
MùLevñs
 = 1;

272 
buf„r_desc
.
MiscFœgs
 = 0;

273 
buf„r_desc
.
Sam∂eDesc
.
Cou¡
 = 
ªndîî
->
mßa_ßm∂e_cou¡
;

274 
buf„r_desc
.
Sam∂eDesc
.
QuÆôy
 = 
ªndîî
->
mßa_quÆôy_Àvñ
;

275 
buf„r_desc
.
Ußge
 = 
D3D11_USAGE_DEFAULT
;

276 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eTextuª2D
(&
buf„r_desc
, 0, &
ãxtuª
);

278 
D3D11_RENDER_TARGET_VIEW_DESC
 
ªndî_èrgë_võw_desc
;

279 
ªndî_èrgë_võw_desc
.
F‹m©
 = 
f‹m©
;

280 
ªndî_èrgë_võw_desc
.
VõwDimísi⁄
 = 
D3D11_RTV_DIMENSION_TEXTURE2D
;

281 
ªndî_èrgë_võw_desc
.
Textuª2D
.
MùSli˚
 = 0;

282 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eRídîT¨gëVõw
(
ãxtuª
, 0, &
ªndî_èrgë
);

284 
	`As£πHR
(
hr
);

286 
D3D11_SHADER_RESOURCE_VIEW_DESC
 
shadî_ªsour˚_võw_desc
;

287 
shadî_ªsour˚_võw_desc
.
F‹m©
 = 
f‹m©
;

288 
shadî_ªsour˚_võw_desc
.
VõwDimísi⁄
 = 
D3D11_SRV_DIMENSION_TEXTURE2D
;

289 
shadî_ªsour˚_võw_desc
.
Textuª2D
.
Mo°DëaûedMù
 = 0;

290 
shadî_ªsour˚_võw_desc
.
Textuª2D
.
MùLevñs
 = 1;

291 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eShadîResour˚Võw
(
ãxtuª
, &
shadî_ªsour˚_võw_desc
, &
shadî_ªsour˚
);

293 
	`As£πHR
(
hr
);

295 
ªsu…
.
ãxtuª
 =Åexture;

296 
ªsu…
.
ªndî_èrgë
 =Ñender_target;

297 
ªsu…
.
shadî_ªsour˚
 = shader_resource;

299  
ªsu…
;

300 
	}
}

303 
	$RídîîBegöFøme
(
Rídîî
* 
ªndîî
, 
WödowDimísi⁄s
 
wd
, 
Mem‹yAª«
* 
‰ame_¨ía
) {

304 
ªndîî
->
‰ame_¨ía
 = frame_arena;

305 
ªndîî
->
comm™d_buf„r_curs‹
 =

306 
ªndîî
->
comm™d_buf„r_ba£
 = (
u8
*)
	`PushSize
‘ídîî->
‰ame_¨ía
,Ñídîî->
comm™d_buf„r_size
);

308 if(
ªndîî
->
wödow_dim
.
width
 !
wd
.width ||

309 
ªndîî
->
wödow_dim
.
height
 !
wd
.height) {

311 
ªndîî
->
wödow_dim
 = 
wd
;

313 
ªndîî
->
backbuf„r
.
ãxtuª
->
	`Rñó£
();

314 
ªndîî
->
backbuf„r
.
võw
->
	`Rñó£
();

315 
ªndîî
->
dïth_°ícû
.
ãxtuª
->
	`Rñó£
();

316 
ªndîî
->
dïth_°ícû
.
võw
->
	`Rñó£
();

318 
ªndîî
->
sw≠chaö
->
	`ResizeBuf„rs
(0, 
wd
.
width
, wd.
height
, 
DXGI_FORMAT_R8G8B8A8_UNORM
, 0);

320 
ID3D11Textuª2D
* 
backbuf„r
;

321 
ID3D11RídîT¨gëVõw
* 
πv
;

322 
ªndîî
->
sw≠chaö
->
	`GëBuf„r
(0, 
	`IID_PPV_ARGS
(&
backbuf„r
));

323 
ªndîî
->
devi˚
->
	`Cª©eRídîT¨gëVõw
((
ID3D11Resour˚
*)
backbuf„r
, 
NULL
, &
πv
);

325 
D3D11_TEXTURE2D_DESC
 
dïth_desc
 = {};

326 
dïth_desc
.
Width
 = 
wd
.
width
;

327 
dïth_desc
.
Height
 = 
wd
.
height
;

328 
dïth_desc
.
MùLevñs
 = 1;

329 
dïth_desc
.
AºaySize
 = 1;

330 
dïth_desc
.
F‹m©
 = 
DXGI_FORMAT_D32_FLOAT
;

331 
dïth_desc
.
Sam∂eDesc
 = { 1, 0 };

332 
dïth_desc
.
Ußge
 = 
D3D11_USAGE_DEFAULT
;

333 
dïth_desc
.
BödFœgs
 = 
D3D11_BIND_DEPTH_STENCIL
;

336 
ID3D11Textuª2D
* 
dïth
;

337 
ID3D11DïthSãncûVõw
* 
dsv
;

338 
ªndîî
->
devi˚
->
	`Cª©eTextuª2D
(&
dïth_desc
, 
NULL
, &
dïth
);

339 
ªndîî
->
devi˚
->
	`Cª©eDïthSãncûVõw
((
ID3D11Resour˚
*)
dïth
, 
NULL
, &
dsv
);

341 
ªndîî
->
backbuf„r
.
ãxtuª
 = backbuffer;

342 
ªndîî
->
backbuf„r
.
võw
 = 
πv
;

343 
ªndîî
->
dïth_°ícû
.
ãxtuª
 = 
dïth
;

344 
ªndîî
->
dïth_°ícû
.
võw
 = 
dsv
;

346 
ªndîî
->
ªadabÀ_ªndî_èrgë
.
ãxtuª
->
	`Rñó£
();

347 
ªndîî
->
ªadabÀ_ªndî_èrgë
.
ªndî_èrgë
->
	`Rñó£
();

348 
ªndîî
->
ªadabÀ_ªndî_èrgë
.
shadî_ªsour˚
->
	`Rñó£
();

350 
ªndîî
->
ªadabÀ_ªndî_èrgë
 = 
	`Cª©eRódabÀRídîT¨gë
(renderer);

353 
SëTextuªBuf„r
* 
°b
 = 
	`PushRídîComm™d
(
ªndîî
, SetTextureBuffer);

354 
°b
->
ãxtuª
 = 0;

355 
°b
->
¶Ÿ
 = 0;

357 
SëRídîT¨gë
* 
£t_ªndî_èrgë
 = 
	`PushRídîComm™d
(
ªndîî
, SetRenderTarget);

358 
£t_ªndî_èrgë
->
ªndî_èrgë
 = 0;

360 
CÀ¨RídîT¨gë
* 
˛ór_ªndî_èrgë
 = 
	`PushRídîComm™d
(
ªndîî
, ClearRenderTarget);

361 
˛ór_ªndî_èrgë
->
ªndî_èrgë
 = &
ªndîî
->
backbuf„r
;

362 *(
Vec4
*)
˛ór_ªndî_èrgë
->
cﬁ‹
 = { 0.1f, 0.1f, 0.1f, 1.0f };

364 
CÀ¨RídîT¨gë
* 
˛ór_ªndî_èrgë1
 = 
	`PushRídîComm™d
(
ªndîî
, ClearRenderTarget);

365 
˛ór_ªndî_èrgë1
->
ªndî_èrgë
 = 0;

366 *(
Vec4
*)
˛ór_ªndî_èrgë1
->
cﬁ‹
 = { 0.1f, 0.1f, 0.1f, 1.0f };

368 
CÀ¨Dïth
* 
˛ór_dïth
 = 
	`PushRídîComm™d
(
ªndîî
, ClearDepth);

369 
˛ór_dïth
->
vÆue
 = 1.0f;

371 
SëDïthSãncûSèã
* 
£t_dïth_°ícû_°©e
 = 
	`PushRídîComm™d
(
ªndîî
, SetDepthStencilState);

372 
£t_dïth_°ícû_°©e
->
ty≥
 = 0;

374 
SëBÀndSèã
* 
£t_bÀnd_°©e
 = 
	`PushRídîComm™d
(
ªndîî
, SetBlendState);

375 
£t_bÀnd_°©e
->
ty≥
 = 
BLEND_STATE_Reguœr
;

377 
SëRa°îizîSèã
* 
£t_ø°îizî_°©e
 = 
	`PushRídîComm™d
(
ªndîî
, SetRasterizerState);

378 
£t_ø°îizî_°©e
->
ty≥
 = 
RASTERIZER_STATE_DeÁu…
;

380 
SëSam∂îSèã
* 
£t_ßm∂î_°©e
 = 
	`PushRídîComm™d
(
ªndîî
, SetSamplerState);

381 
£t_ßm∂î_°©e
->
ty≥
 = 
SAMPLER_STATE_DeÁu…
;

382 
£t_ßm∂î_°©e
->
¶Ÿ
 = 0;

384 
SëVõwp‹t
* 
£t_võwp‹t
 = 
	`PushRídîComm™d
(
ªndîî
, SetViewport);

385 
£t_võwp‹t
->
t›À·
 = 
	`V2Z
();

386 
£t_võwp‹t
->
dim
 = 
	`V2
(()
wd
.
width
, ()wd.
height
);

388 
SëPrimôiveT›ﬁogy
* 
£t_t›ﬁogy
 = 
	`PushRídîComm™d
(
ªndîî
, SetPrimitiveTopology);

389 
£t_t›ﬁogy
->
ty≥
 = 
PRIMITIVE_TOPOLOGY_TrüngÀLi°
;

391 
	}
}

394 
	$RídîîEndFøme
(
Rídîî
* 
ªndîî
) {

395 
	`ExecuãRídîComm™ds
(
ªndîî
);

396 
ªndîî
->
sw≠chaö
->
	`Pª£¡
(0, 0);

397 
	}
}

400 
	$MakeD3DI≈utEÀmítDesc
(
VERTEX_BUFFER
* 
vb_ty≥
, 
D3D11_INPUT_ELEMENT_DESC
* 
d3d_û_desc
, 
u8
 
cou¡
) {

401 
u32
 
i
 = 0; i < 
cou¡
; i++) {

402 
DXGI_FORMAT
 
f‹m©
;

403 i‡(
vb_ty≥
[
i
] =
VERTEX_BUFFER_POSITION
Ë
f‹m©
 = 
DXGI_FORMAT_R32G32B32_FLOAT
;

404 i‡(
vb_ty≥
[
i
] =
VERTEX_BUFFER_NORMAL
Ë
f‹m©
 = 
DXGI_FORMAT_R32G32B32_FLOAT
;

405 i‡(
vb_ty≥
[
i
] =
VERTEX_BUFFER_COLOR
Ë
f‹m©
 = 
DXGI_FORMAT_R32G32B32_FLOAT
;

407 i‡(
vb_ty≥
[
i
] =
VERTEX_BUFFER_TEXCOORD
Ë
f‹m©
 = 
DXGI_FORMAT_R32G32_FLOAT
;

408 
	`As£π
(
Ál£
);

410 
d3d_û_desc
[
i
] = { 
vîãx_buf„r_«mes
[
vb_ty≥
[i]], 0, 
f‹m©
, i, 0, 
D3D11_INPUT_PER_VERTEX_DATA
, 0 };

412 
	}
}

414 
C⁄°™tsBuf„r
*

415 
	$U∂ﬂdC⁄°™tsBuf„r
(
u32
 
size
, 
Rídîî
* 
ªndîî
) {

416 
HRESULT
 
hr
 = {};

417 
C⁄°™tsBuf„r
* 
cb
 = 
	`PushSåu˘
(
ªndîî
->
≥rm™ít_¨ía
, ConstantsBuffer);

418 
ID3D11Buf„r
* 
buf„r
 = 0;

420 
size
 += (16 - (size % 16));

421 
D3D11_BUFFER_DESC
 
cb_desc
 = {};

422 
cb_desc
.
ByãWidth
 = 
size
;

423 
cb_desc
.
Ußge
 = 
D3D11_USAGE_DYNAMIC
;

424 
cb_desc
.
BödFœgs
 = 
D3D11_BIND_CONSTANT_BUFFER
;

425 
cb_desc
.
CPUAc˚ssFœgs
 = 
D3D11_CPU_ACCESS_WRITE
;

426 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eBuf„r
(&
cb_desc
, 
nuŒ±r
, &
buf„r
);

428 
	`As£πHR
(
hr
);

430 
cb
->
buf„r
 = buffer;

431  
cb
;

432 
	}
}

434 
Såu˘uªdBuf„r
*

435 
	$U∂ﬂdSåu˘uªdBuf„r
(
u32
 
°ru˘_size
, u32 
cou¡
, 
Rídîî
* 
ªndîî
) {

436 
HRESULT
 
hr
 = {};

437 
Såu˘uªdBuf„r
* 
sb
 = 
	`PushSåu˘
(
ªndîî
->
≥rm™ít_¨ía
, StructuredBuffer);

439 
ID3D11Buf„r
* 
buf„r
 = 0;

440 
ID3D11ShadîResour˚Võw
* 
võw
 = 0;

442 
D3D11_BUFFER_DESC
 
buf„r_desc
 = {};

443 
buf„r_desc
.
ByãWidth
 = 
°ru˘_size
 * 
cou¡
;

444 
buf„r_desc
.
Ußge
 = 
D3D11_USAGE_DYNAMIC
;

445 
buf„r_desc
.
BödFœgs
 = 
D3D11_BIND_SHADER_RESOURCE
;

446 
buf„r_desc
.
CPUAc˚ssFœgs
 = 
D3D11_CPU_ACCESS_WRITE
;

447 
buf„r_desc
.
MiscFœgs
 = 
D3D11_RESOURCE_MISC_BUFFER_STRUCTURED
;

448 
buf„r_desc
.
Såu˘uªByãSåide
 = 
°ru˘_size
;

450 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eBuf„r
(&
buf„r_desc
, 
NULL
, &
buf„r
);

451 
	`As£πHR
(
hr
);

453 
D3D11_SHADER_RESOURCE_VIEW_DESC
 
võw_desc
 = {};

454 
võw_desc
.
F‹m©
 = 
DXGI_FORMAT_UNKNOWN
;

455 
võw_desc
.
VõwDimísi⁄
 = 
D3D11_SRV_DIMENSION_BUFFER
;

456 
võw_desc
.
Buf„r
.
EÀmítOff£t
 = 0;

457 
võw_desc
.
Buf„r
.
EÀmítWidth
 = 
cou¡
;

459 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eShadîResour˚Võw
(
buf„r
, &
võw_desc
, &
võw
);

460 
	`As£πHR
(
hr
);

462 
sb
->
buf„r
 = buffer;

463 
sb
->
võw
 = view;

465  
sb
;

466 
	}
};

468 
boﬁ


469 
	$CompûeShadî
(* 
shadî_code
, 
u32
 
shadî_Àngth
, * 
íåy
, ** 
shadî
, 
ID3DBlob
** 
blob
,

470 
boﬁ
 
vîãx_shadî
, 
Rídîî
* 
ªndîî
) {

471 
HRESULT
 
hr
;

472 
ID3DBlob
* 
îr‹
;

474 if(
vîãx_shadî
)

475 
hr
 = 
	`D3DCompûe
(
shadî_code
, 
shadî_Àngth
, 
nuŒ±r
,ÇuŒ±r,ÇuŒ±r, 
íåy
, "vs_5_0",

476 0, 0, 
blob
, &
îr‹
);

478 
hr
 = 
	`D3DCompûe
(
shadî_code
, 
shadî_Àngth
, 
nuŒ±r
,ÇuŒ±r,ÇuŒ±r, 
íåy
, "ps_5_0",

479 0, 0, 
blob
, &
îr‹
);

481 i‡(
hr
) {

482 * 
msg
 = (*)
îr‹
->
	`GëBuf„rPoöãr
();

483 
	`OuçutDebugSåögA
(
msg
);

484  
Ál£
;

487 if(
vîãx_shadî
)

488 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eVîãxShadî
(
blob
[0]->
	`GëBuf„rPoöãr
(), blob[0]->
	`GëBuf„rSize
(),

489 
nuŒ±r
, (
ID3D11VîãxShadî
**)
shadî
);

491 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©ePixñShadî
(
blob
[0]->
	`GëBuf„rPoöãr
(), blob[0]->
	`GëBuf„rSize
(),

492 
nuŒ±r
, (
ID3D11PixñShadî
**)
shadî
);

494 if(
hr
Ë 
Ál£
;

496  
åue
;

497 
	}
};

499 
PixñShadî
*

500 
	$U∂ﬂdPixñShadî
(* 
code
, 
u32
 
Àngth
, * 
íåy
, 
Rídîî
* 
ªndîî
) {

501 
PixñShadî
* 
ps
 = 
	`PushSåu˘
(
ªndîî
->
≥rm™ít_¨ía
, PixelShader);

502 
ID3D11PixñShadî
* 
shadî
;

503 
ID3DBlob
* 
blob
;

505 
	`As£π
(
	`CompûeShadî
(
code
, 
Àngth
, 
íåy
, (**)&
shadî
, &
blob
, 
Ál£
, 
ªndîî
));

507 
ps
->
shadî
 = shader;

508  
ps
;

509 
	}
}

511 
VîãxShadî
*

512 
	$U∂ﬂdVîãxShadî
(* 
code
, 
u32
 
Àngth
, * 
íåy
, 
VERTEX_BUFFER
* 
vîãx_buf„rs
, 
u8
 
cou¡
, 
Rídîî
* 
ªndîî
) {

513 
HRESULT
 
hr
 = {};

515 
VîãxShadî
* 
vs
 = 
	`PushSåu˘
(
ªndîî
->
≥rm™ít_¨ía
, VertexShader);

516 
ID3D11VîãxShadî
* 
shadî
 = 0;

517 
ID3D11I≈utLayout
* 
û
 = 0;

518 
ID3DBlob
* 
blob
 = 0;

520 
	`As£π
(
	`CompûeShadî
(
code
, 
Àngth
, 
íåy
, (**)&
shadî
, &
blob
, 
åue
, 
ªndîî
));

522 if(
vîãx_buf„rs
) {

523 
D3D11_INPUT_ELEMENT_DESC
* 
õ_desc
 = 
	`PushAºay
(
ªndîî
->
‰ame_¨ía
, D3D11_INPUT_ELEMENT_DESC, 
cou¡
);

524 
	`MakeD3DI≈utEÀmítDesc
(
vîãx_buf„rs
, 
õ_desc
, 
cou¡
);

526 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eI≈utLayout
(
õ_desc
, 
cou¡
, 
blob
->
	`GëBuf„rPoöãr
(), blob->
	`GëBuf„rSize
(), &
û
);

527 
	`As£πHR
(
hr
);

530 
vs
->
shadî
 = shader;

531 
vs
->
û
 = il;

533  
vs
;

534 
	}
}

536 
TextuªBuf„r
*

537 
	$U∂ﬂdTextuª
(* 
d©a
, 
u32
 
width
, u32 
height
, 
u8
 
num_comp⁄íts
, 
boﬁ
 
dy«mic
, boﬁ 
ãmp
, 
Rídîî
* 
ªndîî
) {

538 
TextuªBuf„r
* 
ãxtuª_buf„r
 = 0;

539 if(!
ãmp
Ë
ãxtuª_buf„r
 = 
	`PushSåu˘
(
ªndîî
->
≥rm™ít_¨ía
, 
TextuªBuf„r
);

540 
ãxtuª_buf„r
 = 
	`PushSåu˘
(
ªndîî
->
‰ame_¨ía
, 
TextuªBuf„r
);

542 
HRESULT
 
hr
 = {};

543 
ID3D11ShadîResour˚Võw
* 
võw
;

545 
D3D11_TEXTURE2D_DESC
 
desc
 = {};

546 
desc
.
Width
 = 
width
;

547 
desc
.
Height
 = 
height
;

548 
desc
.
MùLevñs
 = 1;

549 
desc
.
AºaySize
 = 1;

550 
DXGI_FORMAT
 
f‹m©
;

552 if(
num_comp⁄íts
 =4Ë
f‹m©
 = 
DXGI_FORMAT_R8G8B8A8_UNORM
;

553 if(
num_comp⁄íts
 =1Ë
f‹m©
 = 
DXGI_FORMAT_R8_UNORM
;

554 
	`As£π
(
Ál£
);

556 
D3D11_USAGE
 
ußge_Êag
 = 
D3D11_USAGE_IMMUTABLE
;

557 
u32
 
˝u_ac˚ss_Êags
 = 0;

558 if(
dy«mic
) {

559 
ußge_Êag
 = 
D3D11_USAGE_DYNAMIC
;

560 
˝u_ac˚ss_Êags
 |
D3D11_CPU_ACCESS_WRITE
;

563 
desc
.
F‹m©
 = 
f‹m©
;

564 
desc
.
Sam∂eDesc
.
Cou¡
 = 
ªndîî
->
mßa_ßm∂e_cou¡
;

565 
desc
.
Sam∂eDesc
.
QuÆôy
 = 
ªndîî
->
mßa_quÆôy_Àvñ
;

566 
desc
.
Ußge
 = 
ußge_Êag
;

567 
desc
.
BödFœgs
 = 
D3D11_BIND_SHADER_RESOURCE
;

568 
desc
.
CPUAc˚ssFœgs
 = 
˝u_ac˚ss_Êags
;

570 
D3D11_SUBRESOURCE_DATA
 
§
 = {};

571 
§
.
pSysMem
 = 
d©a
;

572 
§
.
SysMemPôch
 = 
width
 * 
num_comp⁄íts
;

574 
ID3D11Textuª2D
* 
buf„r
;

575 if(
d©a
Ë
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eTextuª2D
(&
desc
, &
§
, &
buf„r
);

576 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eTextuª2D
(&
desc
, 0, &
buf„r
);

579 
D3D11_SHADER_RESOURCE_VIEW_DESC
 
võw_desc
 = {};

580 
võw_desc
.
F‹m©
 = 
desc
.Format;

581 
võw_desc
.
VõwDimísi⁄
 = 
D3D11_SRV_DIMENSION_TEXTURE2D
;

582 
võw_desc
.
Textuª2D
.
Mo°DëaûedMù
 = 0;

583 
võw_desc
.
Textuª2D
.
MùLevñs
 = (
u32
)-1;

585 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eShadîResour˚Võw
(
buf„r
, &
võw_desc
, &
võw
);

586 
	`As£πHR
(
hr
);

588 
ãxtuª_buf„r
->
buf„r
 = buffer;

589 
ãxtuª_buf„r
->
võw
 = view;

590  
ãxtuª_buf„r
;

591 
	}
}

593 
IndexBuf„r
*

594 
	$U∂ﬂdIndexBuf„r
(* 
d©a
, 
u32
 
cou¡
, 
Rídîî
* 
ªndîî
) {

595 
IndexBuf„r
* 
ödex_buf„r
 = 
	`PushSåu˘
(
ªndîî
->
≥rm™ít_¨ía
, IndexBuffer);

597 
ID3D11Buf„r
* 
buf„r
;

598 
D3D11_BUFFER_DESC
 
desc
 = {};

599 
desc
.
ByãWidth
 = (
u32
Ë* 
cou¡
;

600 
desc
.
Ußge
 = 
D3D11_USAGE_IMMUTABLE
;

601 
desc
.
BödFœgs
 = 
D3D11_BIND_INDEX_BUFFER
;

602 
D3D11_SUBRESOURCE_DATA
 
§
 = {};

603 
§
.
pSysMem
 = 
d©a
;

604 
ªndîî
->
devi˚
->
	`Cª©eBuf„r
(&
desc
, &
§
, &
buf„r
);

606 
ödex_buf„r
->
buf„r
 = buffer;

607  
ödex_buf„r
;

608 
	}
}

610 
VîãxBuf„r
*

611 
	$U∂ﬂdVîãxBuf„r
(* 
öôül_d©a
, 
u32
 
num_vîti˚s
, 
u8
 
num_comp⁄íts
, 
boﬁ
 
dy«mic
, 
Rídîî
* 
ªndîî
) {

612 
HRESULT
 
hr
;

613 
VîãxBuf„r
* 
vb
 = 
	`PushSåu˘
(
ªndîî
->
≥rm™ít_¨ía
, VertexBuffer);

615 
ID3D11Buf„r
* 
buf„r
;

616 
D3D11_BUFFER_DESC
 
desc
 = {};

618 
u32
 
comp⁄ít_width
 = ();

620 
D3D11_USAGE
 
ußge_Êag
 = 
D3D11_USAGE_IMMUTABLE
;

621 
u32
 
˝u_ac˚ss_Êags
 = 0;

622 if(
dy«mic
) {

623 
ußge_Êag
 = 
D3D11_USAGE_DYNAMIC
;

624 
˝u_ac˚ss_Êags
 |
D3D11_CPU_ACCESS_WRITE
;

627 
desc
.
ByãWidth
 = 
num_comp⁄íts
 * 
comp⁄ít_width
 * 
num_vîti˚s
;

628 
desc
.
Ußge
 = 
ußge_Êag
;

629 
desc
.
BödFœgs
 = 
D3D11_BIND_VERTEX_BUFFER
;

630 
desc
.
CPUAc˚ssFœgs
 = 
˝u_ac˚ss_Êags
;

632 if(
öôül_d©a
) {

633 
D3D11_SUBRESOURCE_DATA
 
§
 = {};

634 
§
.
pSysMem
 = 
öôül_d©a
;

635 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eBuf„r
(&
desc
, &
§
, &
buf„r
);

637 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eBuf„r
(&
desc
, 0, &
buf„r
);

638 
	`As£πHR
(
hr
);

640 
vb
->
buf„r
 = buffer;

642  
vb
;

643 
	}
}

645 
Rídîî
*

646 
	$InôRídîî
(
Wö32Wödow
* 
wödow
, 
Mem‹yAª«
* 
∑ª¡_¨ía
, Mem‹yAª«* 
‰ame_¨ía
) {

647 
Rídîî
* 
ªndîî
;

648 
ªndîî
 = 
	`PushSåu˘
(
∑ª¡_¨ía
, 
Rídîî
);

649 
ªndîî
->
≥rm™ít_¨ía
 = 
∑ª¡_¨ía
;

650 
ªndîî
->
‰ame_¨ía
 = frame_arena;

651 
ªndîî
->
comm™d_buf„r_size
 = 
	`Megabyãs
(2);

653 
ªndîî
->
wödow_dim
 = 
wödow
->
dim
;

655 
HRESULT
 
hr
 = {};

656 
u32
 
mßa_quÆôy_Àvñ
 = 0;

657 
u32
 
mßa_ßm∂e_cou¡
 = 1;

659 
u32
 
Êags
 = 0;

660 
IDXGIFa˘‹y4
* 
dxgi_Á˘‹y
;

661 
hr
 = 
	`Cª©eDXGIFa˘‹y2
(
Êags
, 
IID_IDXGIFa˘‹y4
, (**)&
dxgi_Á˘‹y
);

662 
	`As£πHR
(
hr
);

664 
Êags
 = 0;

665 
Êags
 = 
DXGI_MWA_NO_WINDOW_CHANGES
 | 
DXGI_MWA_NO_ALT_ENTER
;

666 
dxgi_Á˘‹y
->
	`MakeWödowAssocüti⁄
(
wödow
->
h™dÀ
, 
Êags
);

668 
IDXGIAd≠ãr1
* 
ad≠ãrs
[4] = { 
NULL
 };

669 
u32
 
ad≠ãr_cou¡
 = 0;

671 (
ad≠ãr_cou¡
 < 
	`AºayCou¡
(
ad≠ãrs
) -1) &&

672 (
dxgi_Á˘‹y
->
	`EnumAd≠ãrs1
(
ad≠ãr_cou¡
, &
ad≠ãrs
[adapter_count])

673 !
DXGI_ERROR_NOT_FOUND
)Ë
ad≠ãr_cou¡
++;

675 
u32
 
ad≠ãr_to_u£
 = 0;

676 
u64
 
video_mem‹y_avaûabÀ
 = 0;

677 
u32
 
i
 = 0; i < 
ad≠ãr_cou¡
; i++) {

678 
DXGI_ADAPTER_DESC1
 
desc
 = { 
NULL
 };

679 
ad≠ãrs
[
i
]->
	`GëDesc1
(&
desc
);

680 i‡(
desc
.
DediˇãdVideoMem‹y
 > 
video_mem‹y_avaûabÀ
) {

681 
video_mem‹y_avaûabÀ
 = 
desc
.
DediˇãdVideoMem‹y
;

682 
ad≠ãr_to_u£
 = 
i
;

686 
D3D_FEATURE_LEVEL
 
èrgë_„©uª_Àvñs
[] = {

687 
D3D_FEATURE_LEVEL_11_1
,

688 
D3D_FEATURE_LEVEL_11_1


690 
D3D_FEATURE_LEVEL
 
out_„©uª_Àvñs
 = 
D3D_FEATURE_LEVEL_9_1
;

692 
Êags
 = 0;

693 
Êags
 |
D3D11_CREATE_DEVICE_DEBUG
;

694 
hr
 = 
	`D3D11Cª©eDevi˚
((
IDXGIAd≠ãr
*)
ad≠ãrs
[
ad≠ãr_to_u£
], 
D3D_DRIVER_TYPE_UNKNOWN
, 
NULL
,

695 
Êags
, 
èrgë_„©uª_Àvñs
, 
	`AºayCou¡
—¨gë_„©uª_Àvñs), 
D3D11_SDK_VERSION
,

696 &
ªndîî
->
devi˚
, &
out_„©uª_Àvñs
, &ªndîî->
c⁄ãxt
);

698 
	`As£πHR
(
hr
);

699 
hr
 = 
ªndîî
->
devi˚
->
	`CheckMu…ißm∂eQuÆôyLevñs
(
DXGI_FORMAT_R8G8B8A8_UNORM
,

700 
mßa_ßm∂e_cou¡
, &
mßa_quÆôy_Àvñ
);

701 
mßa_quÆôy_Àvñ
--;

703 
ªndîî
->
mßa_ßm∂e_cou¡
 = msaa_sample_count;

704 
ªndîî
->
mßa_quÆôy_Àvñ
 = msaa_quality_level;

706 
DXGI_SWAP_CHAIN_DESC1
 
sw≠chaö_desc
;

707 
sw≠chaö_desc
.
Width
 = 0;

708 
sw≠chaö_desc
.
Height
 = 0;

709 
sw≠chaö_desc
.
F‹m©
 = 
DXGI_FORMAT_R8G8B8A8_UNORM
;

710 
sw≠chaö_desc
.
Sãªo
 = 0;

712 
sw≠chaö_desc
.
Sam∂eDesc
.
Cou¡
 = 
mßa_ßm∂e_cou¡
;

713 
sw≠chaö_desc
.
Sam∂eDesc
.
QuÆôy
 = 
mßa_quÆôy_Àvñ
;

714 
sw≠chaö_desc
.
Buf„rUßge
 = 
DXGI_USAGE_RENDER_TARGET_OUTPUT
;

716 
sw≠chaö_desc
.
Buf„rCou¡
 = 2;

717 
sw≠chaö_desc
.
Sˇlög
 = 
DXGI_SCALING_STRETCH
;

718 
sw≠chaö_desc
.
Sw≠Ef„˘
 = 
DXGI_SWAP_EFFECT_FLIP_DISCARD
;

719 
sw≠chaö_desc
.
AÕhaMode
 = 
DXGI_ALPHA_MODE_UNSPECIFIED
;

720 
sw≠chaö_desc
.
Fœgs
 = 
DXGI_SWAP_CHAIN_FLAG_ALLOW_MODE_SWITCH
;

722 
hr
 = 
dxgi_Á˘‹y
->
	`Cª©eSw≠ChaöF‹Hwnd
((
IUnknown
*)
ªndîî
->
devi˚
, 
wödow
->
h™dÀ
, &
sw≠chaö_desc
, 
NULL
, NULL, &ªndîî->
sw≠chaö
);

724 
	`As£πHR
(
hr
);

727 
hr
 = 
ªndîî
->
sw≠chaö
->
	`QuîyI¡îÁ˚
(
	`IID_PPV_ARGS
(&renderer->swapchain));

728 
	`As£πHR
(
hr
);

731 
ID3D11Textuª2D
* 
πv_ãx
;

732 
ID3D11RídîT¨gëVõw
* 
πv
;

733 
hr
 = 
ªndîî
->
sw≠chaö
->
	`GëBuf„r
(0, 
	`IID_PPV_ARGS
(&
πv_ãx
));

734 
D3D11_TEXTURE2D_DESC
 
πv_ãx_desc
 = {};

735 
πv_ãx
->
	`GëDesc
(&
πv_ãx_desc
);

737 
D3D11_RENDER_TARGET_VIEW_DESC
 
πv_desc
 = {};

738 
πv_desc
.
F‹m©
 = 
DXGI_FORMAT_R8G8B8A8_UNORM
;

739 
πv_desc
.
VõwDimísi⁄
 = 
D3D11_RTV_DIMENSION_TEXTURE2D
;

741 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eRídîT¨gëVõw
((
ID3D11Resour˚
*)
πv_ãx
, &
πv_desc
, &
πv
);

742 
	`As£πHR
(
hr
);

744 
ªndîî
->
ªadabÀ_ªndî_èrgë
 = 
	`Cª©eRódabÀRídîT¨gë
(renderer);

746 
ID3D11Textuª2D
* 
dsv_ãx
;

747 
ID3D11DïthSãncûVõw
* 
dsv
;

748 
D3D11_TEXTURE2D_DESC
 
dsv_ãx_desc
;

749 
πv_ãx
->
	`GëDesc
(&
dsv_ãx_desc
);

750 
dsv_ãx_desc
.
MùLevñs
 = 1;

751 
dsv_ãx_desc
.
AºaySize
 = 1;

752 
dsv_ãx_desc
.
F‹m©
 = 
DXGI_FORMAT_D32_FLOAT
;

753 
dsv_ãx_desc
.
Ußge
 = 
D3D11_USAGE_DEFAULT
;

754 
dsv_ãx_desc
.
BödFœgs
 = 
D3D11_BIND_DEPTH_STENCIL
;

755 
dsv_ãx_desc
.
Sam∂eDesc
.
Cou¡
 = 
mßa_ßm∂e_cou¡
;

756 
dsv_ãx_desc
.
Sam∂eDesc
.
QuÆôy
 = 
mßa_quÆôy_Àvñ
;

758 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eTextuª2D
(&
dsv_ãx_desc
, 
NULL
, &
dsv_ãx
);

759 
	`As£πHR
(
hr
);

761 
D3D11_DEPTH_STENCIL_VIEW_DESC
 
dsv_desc
 = {};

762 
dsv_desc
.
F‹m©
 = 
DXGI_FORMAT_D32_FLOAT
;

763 
dsv_desc
.
VõwDimísi⁄
 = 
D3D11_DSV_DIMENSION_TEXTURE2D
;

764 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eDïthSãncûVõw
((
ID3D11Resour˚
*)
dsv_ãx
, &
dsv_desc
, &
dsv
);

765 
	`As£πHR
(
hr
);

767 
ªndîî
->
backbuf„r
.
ãxtuª
 = 
πv_ãx
;

768 
ªndîî
->
backbuf„r
.
võw
 = 
πv
;

769 
ªndîî
->
dïth_°ícû
.
ãxtuª
 = 
dsv_ãx
;

770 
ªndîî
->
dïth_°ícû
.
võw
 = 
dsv
;

776 
D3D11_BLEND_DESC
 
bs_desc
 = {};

777 
bs_desc
.
RídîT¨gë
[0].
RídîT¨gëWrôeMask
 = 
D3D11_COLOR_WRITE_ENABLE_ALL
;

778 
bs_desc
.
RídîT¨gë
[0].
BÀndE«bÀ
 = 
Ál£
;

780 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eBÀndSèã
(&
bs_desc
, &ªndîî->
bÀnd_°©es
[
BLEND_STATE_NoBÀnd
]);

781 
	`As£πHR
(
hr
);

784 
D3D11_BLEND_DESC
 
bs_desc
 = {};

785 
bs_desc
.
RídîT¨gë
[0].
RídîT¨gëWrôeMask
 = 
D3D11_COLOR_WRITE_ENABLE_ALL
;

786 
bs_desc
.
RídîT¨gë
[0].
BÀndE«bÀ
 = 
åue
;

787 
bs_desc
.
RídîT¨gë
[0].
SrcBÀnd
 = 
D3D11_BLEND_SRC_ALPHA
;

788 
bs_desc
.
RídîT¨gë
[0].
De°BÀnd
 = 
D3D11_BLEND_INV_SRC_ALPHA
;

789 
bs_desc
.
RídîT¨gë
[0].
BÀndOp
 = 
D3D11_BLEND_OP_ADD
;

790 
bs_desc
.
RídîT¨gë
[0].
SrcBÀndAÕha
 = 
D3D11_BLEND_ONE
;

791 
bs_desc
.
RídîT¨gë
[0].
De°BÀndAÕha
 = 
D3D11_BLEND_ONE
;

792 
bs_desc
.
RídîT¨gë
[0].
BÀndOpAÕha
 = 
D3D11_BLEND_OP_ADD
;

794 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eBÀndSèã
(&
bs_desc
, &ªndîî->
bÀnd_°©es
[
BLEND_STATE_Reguœr
]);

795 
	`As£πHR
(
hr
);

798 
D3D11_BLEND_DESC
 
bs_desc
 = {};

799 
bs_desc
.
RídîT¨gë
[0].
RídîT¨gëWrôeMask
 = 
D3D11_COLOR_WRITE_ENABLE_ALL
;

800 
bs_desc
.
RídîT¨gë
[0].
BÀndE«bÀ
 = 
åue
;

801 
bs_desc
.
RídîT¨gë
[0].
SrcBÀnd
 = 
D3D11_BLEND_ONE
;

802 
bs_desc
.
RídîT¨gë
[0].
De°BÀnd
 = 
D3D11_BLEND_INV_SRC_ALPHA
;

803 
bs_desc
.
RídîT¨gë
[0].
BÀndOp
 = 
D3D11_BLEND_OP_ADD
;

804 
bs_desc
.
RídîT¨gë
[0].
SrcBÀndAÕha
 = 
D3D11_BLEND_ONE
;

805 
bs_desc
.
RídîT¨gë
[0].
De°BÀndAÕha
 = 
D3D11_BLEND_ONE
;

806 
bs_desc
.
RídîT¨gë
[0].
BÀndOpAÕha
 = 
D3D11_BLEND_OP_ADD
;

808 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eBÀndSèã
(&
bs_desc
, &ªndîî->
bÀnd_°©es
[
BLEND_STATE_PªMulAÕha
]);

809 
	`As£πHR
(
hr
);

812 
ID3D11DïthSãncûSèã
* 
dss
;

813 
D3D11_DEPTH_STENCIL_DESC
 
dss_desc
 = {};

814 
dss_desc
.
DïthE«bÀ
 = 
åue
;

815 
dss_desc
.
DïthWrôeMask
 = 
D3D11_DEPTH_WRITE_MASK_ALL
;

816 
dss_desc
.
DïthFunc
 = 
D3D11_COMPARISON_LESS_EQUAL
;

817 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eDïthSãncûSèã
(&
dss_desc
, &
dss
);

818 
ªndîî
->
deÁu…_dïth_°ícû_°©e
 = 
dss
;

819 
	`As£πHR
(
hr
);

823 
ID3D11Ra°îizîSèã
* 
rs
;

824 
D3D11_RASTERIZER_DESC
 
rs_desc
;

825 
rs_desc
.
FûlMode
 = 
D3D11_FILL_SOLID
;

826 
rs_desc
.
CuŒMode
 = 
D3D11_CULL_BACK
;

827 
rs_desc
.
Fr⁄tCou¡îClockwi£
 = 
åue
;

828 
rs_desc
.
Mu…ißm∂eE«bÀ
 = 
åue
;

829 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eRa°îizîSèã
(&
rs_desc
, &
rs
);

830 
ªndîî
->
ø°îizî_°©es
[
RASTERIZER_STATE_DeÁu…
] = 
rs
;

831 
	`As£πHR
(
hr
);

834 
rs_desc
.
FûlMode
 = 
D3D11_FILL_WIREFRAME
;

835 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eRa°îizîSèã
(&
rs_desc
, &
rs
);

836 
ªndîî
->
ø°îizî_°©es
[
RASTERIZER_STATE_Wúe‰ame
] = 
rs
;

837 
	`As£πHR
(
hr
);

839 
rs_desc
 = {};

840 
rs_desc
.
FûlMode
 = 
D3D11_FILL_SOLID
;

841 
rs_desc
.
CuŒMode
 = 
D3D11_CULL_NONE
;

842 
rs_desc
.
Fr⁄tCou¡îClockwi£
 = 
åue
;

843 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eRa°îizîSèã
(&
rs_desc
, &
rs
);

844 
ªndîî
->
ø°îizî_°©es
[
RASTERIZER_STATE_DoubÀSided
] = 
rs
;

845 
	`As£πHR
(
hr
);

848 
ID3D11Sam∂îSèã
* 
ss
;

849 
D3D11_SAMPLER_DESC
 
desc
 = {};

850 
desc
.
Fûãr
 = 
D3D11_FILTER_MIN_MAG_MIP_POINT
;

851 
desc
.
AddªssU
 = 
D3D11_TEXTURE_ADDRESS_CLAMP
;

852 
desc
.
AddªssV
 = 
D3D11_TEXTURE_ADDRESS_CLAMP
;

853 
desc
.
AddªssW
 = 
D3D11_TEXTURE_ADDRESS_CLAMP
;

854 
desc
.
Com∑ris⁄Func
 = 
D3D11_COMPARISON_ALWAYS
;

855 
desc
.
MaxLOD
 = 
D3D11_FLOAT32_MAX
;

856 
hr
 = 
ªndîî
->
devi˚
->
	`Cª©eSam∂îSèã
(&
desc
, &
ss
);

857 
	`As£πHR
(
hr
);

858 
ªndîî
->
ßm∂îs
[
SAMPLER_STATE_DeÁu…
] = 
ss
;

862  
ªndîî
;

863 
	}
}

	@renderer.h

1 
	eBLEND_STATE
 {

2 
	mBLEND_STATE_NoBÀnd
,

3 
	mBLEND_STATE_Reguœr
,

4 
	mBLEND_STATE_PªMulAÕha
,

6 
	mBLEND_STATE_TOTAL


9 
	eRASTERIZER_STATE
 {

10 
	mRASTERIZER_STATE_DeÁu…
,

11 
	mRASTERIZER_STATE_Wúe‰ame
,

12 
	mRASTERIZER_STATE_DoubÀSided
,

14 
	mRASTERIZER_STATE_TOTAL


17 
	eSAMPLER_STATE
 {

18 
	mSAMPLER_STATE_DeÁu…
,

20 
	mSAMPLER_STATE_TOTAL


23 
	eSTRUCTURED_BINDING_SLOT
 {

24 
	mSTRUCTURED_BINDING_SLOT_Føme


27 
	eCONSTANTS_BINDING_SLOT
 {

28 
	mCONSTANTS_BINDING_SLOT_Føme
,

29 
	mCONSTANTS_BINDING_SLOT_Camîa
,

30 
	mCONSTANTS_BINDING_SLOT_Obje˘


33 
	eTEXTURE_BINDING_SLOT
 {

34 
	mTEXTURE_BINDING_SLOT_ALBEDO
,

35 
	mTEXTURE_BINDING_SLOT_NORMAL


38 
	ePRIMITITVE_TOPOLOGY
 {

39 
	mPRIMITIVE_TOPOLOGY_TrüngÀLi°
,

40 
	mPRIMITIVE_TOPOLOGY_TrüngÀSåù


43 
	sRídîT¨gë
 {

44 
ID3D11Textuª2D
* 
	mãxtuª
;

45 
ID3D11RídîT¨gëVõw
* 
	mvõw
;

48 
	sRódabÀRídîT¨gë
 {

49 
ID3D11Textuª2D
* 
	mãxtuª
;

50 
ID3D11RídîT¨gëVõw
* 
	mªndî_èrgë
;

51 
ID3D11ShadîResour˚Võw
* 
	mshadî_ªsour˚
;

54 
	sDïthSãncû
 {

55 
ID3D11Textuª2D
* 
	mãxtuª
;

56 
ID3D11DïthSãncûVõw
* 
	mvõw
;

59 
	sIndexBuf„r
 { 
ID3D11Buf„r
* 
	mbuf„r
; };

60 
	sC⁄°™tsBuf„r
 { 
ID3D11Buf„r
* 
	mbuf„r
; };

61 
	sVîãxBuf„r
 { 
ID3D11Buf„r
* 
	mbuf„r
; };

63 
	sSåu˘uªdBuf„r
 {

64 
ID3D11Buf„r
* 
	mbuf„r
;

65 
ID3D11ShadîResour˚Võw
* 
	mvõw
;

68 
	sTextuªBuf„r
 {

69 
ID3D11Textuª2D
* 
	mbuf„r
;

70 
ID3D11ShadîResour˚Võw
* 
	mvõw
;

73 
	sVîãxShadî
 {

74 
ID3D11VîãxShadî
* 
	mshadî
;

75 
ID3D11I≈utLayout
* 
	mû
;

78 
	sPixñShadî
 {

79 
ID3D11PixñShadî
* 
	mshadî
;

82 
	sSëVîãxBuf„r
 {

83 
VîãxBuf„r
* 
	mvîãx
;

84 
u32
 
	mvîti˚s_cou¡
;

85 
u32
 
	moff£t
;

86 
u32
 
	m°ride
;

87 
u8
 
	m¶Ÿ
;

90 
	sSëSåu˘uªdBuf„r
 {

91 
boﬁ
 
	mvîãx_shadî
;

92 
Såu˘uªdBuf„r
* 
	m°ru˘uªd
;

93 
u8
 
	m¶Ÿ
;

96 
	sSëTextuªBuf„r
 {

97 
TextuªBuf„r
* 
	mãxtuª
;

98 
u8
 
	m¶Ÿ
;

101 
	sSëC⁄°™tsBuf„r
 {

102 
boﬁ
 
	mvîãx_shadî
;

103 
C⁄°™tsBuf„r
* 
	mc⁄°™ts
;

104 
u8
 
	m¶Ÿ
;

107 
	sSëIndexBuf„r
 {

108 
IndexBuf„r
* 
	mödex
;

109 
u32
 
	moff£t
;

112 
	sSëSam∂îSèã
 {

113 
u8
 
	mty≥
;

114 
u8
 
	m¶Ÿ
;

117 
	sFªeRídîResour˚
 {

118 * 
	mbuf„r
;

121 
	sSëBÀndSèã
 { 
u8
 
	mty≥
; } ;

122 
	sSëRa°îizîSèã
 { 
u8
 
	mty≥
; } ;

123 
	sSëPrimôiveT›ﬁogy
 { 
u8
 
	mty≥
; } ;

124 
	sSëVîãxShadî
 { 
VîãxShadî
* 
	mvîãx
; } ;

125 
	sSëPixñShadî
 { 
PixñShadî
* 
	mpixñ
; } ;

127 
	sSëVõwp‹t
 {

128 
Vec2
 
	mt›À·
;

129 
Vec2
 
	mdim
;

132 
	sSëRídîT¨gë
{

133 
RídîT¨gë
* 
	mªndî_èrgë
;

136 
	sSëDïthSãncûSèã
 {

137 
u8
 
	mty≥
;

140 
	sPushRídîBuf„rD©a
 {

141 * 
	mbuf„r
;

142 * 
	md©a
;

143 
u32
 
	msize
;

144 
u32
 
	mpôch
;

147 
	sDøwIndexed
 {

148 
u32
 
	mödi˚s_cou¡
;

149 
u32
 
	moff£t
;

152 
	sDøwVîti˚s
 {

153 
u32
 
	mvîti˚s_cou¡
;

154 
u32
 
	moff£t
;

157 
	sDøwIn°™˚d
 {

158 
u32
 
	mvîti˚s_cou¡
;

159 
u32
 
	mö°™˚_cou¡
;

160 
u32
 
	moff£t
;

163 
	sCÀ¨RídîT¨gë
 {

164 
RídîT¨gë
* 
	mªndî_èrgë
;

165 
	mcﬁ‹
[4];

168 
	sCÀ¨Dïth
 {

169 
	mvÆue
;

172 
	sCÀ¨Sãncû
 {

173 
DïthSãncû
* 
	mdïth_°ícû
;

174 
u8
 
	mvÆue
;

177 
	eRENDER_COMMAND
 {

178 
	mRENDER_COMMAND_CÀ¨RídîT¨gë
,

179 
	mRENDER_COMMAND_CÀ¨Dïth
,

180 
	mRENDER_COMMAND_CÀ¨Sãncû
,

182 
	mRENDER_COMMAND_SëRídîT¨gë
,

183 
	mRENDER_COMMAND_SëBÀndSèã
,

184 
	mRENDER_COMMAND_SëDïthSãncûSèã
,

185 
	mRENDER_COMMAND_SëRa°îizîSèã
,

186 
	mRENDER_COMMAND_SëPrimôiveT›ﬁogy
,

187 
	mRENDER_COMMAND_SëSam∂îSèã
,

188 
	mRENDER_COMMAND_SëVõwp‹t
,

189 
	mRENDER_COMMAND_SëT›ﬁogy
,

191 
	mRENDER_COMMAND_SëVîãxShadî
,

192 
	mRENDER_COMMAND_SëPixñShadî
,

194 
	mRENDER_COMMAND_SëVîãxBuf„r
,

195 
	mRENDER_COMMAND_SëIndexBuf„r
,

196 
	mRENDER_COMMAND_SëSåu˘uªdBuf„r
,

197 
	mRENDER_COMMAND_SëC⁄°™tsBuf„r
,

198 
	mRENDER_COMMAND_SëTextuªBuf„r
,

200 
	mRENDER_COMMAND_DøwVîti˚s
,

201 
	mRENDER_COMMAND_DøwIndexed
,

202 
	mRENDER_COMMAND_DøwIn°™˚d
,

204 
	mRENDER_COMMAND_PushRídîBuf„rD©a
,

205 
	mRENDER_COMMAND_FªeRídîResour˚


208 
	sRídîComm™dHódî
 { 
u8
 
	mty≥
; };

211 
	sRídîî
 {

212 
Mem‹yAª«
* 
	m≥rm™ít_¨ía
;

213 
Mem‹yAª«
* 
	m‰ame_¨ía
;

215 
WödowDimísi⁄s
 
	mwödow_dim
;

217 
ID3D11Devi˚
* 
	mdevi˚
;

218 
ID3D11Devi˚C⁄ãxt
* 
	mc⁄ãxt
;

219 
IDXGISw≠Chaö1
* 
	msw≠chaö
;

220 
u32
 
	mmßa_ßm∂e_cou¡
;

221 
u32
 
	mmßa_quÆôy_Àvñ
;

223 
RídîT¨gë
 
	mbackbuf„r
;

224 
RódabÀRídîT¨gë
 
	mªadabÀ_ªndî_èrgë
;

226 
DïthSãncû
 
	mdïth_°ícû
;

227 
ID3D11Sam∂îSèã
* 
	mßm∂îs
[
SAMPLER_STATE_TOTAL
];

229 
ID3D11DïthSãncûSèã
* 
	mdeÁu…_dïth_°ícû_°©e
;

231 
ID3D11BÀndSèã
* 
	mbÀnd_°©es
[
BLEND_STATE_TOTAL
];

232 
ID3D11Ra°îizîSèã
* 
	mø°îizî_°©es
[
RASTERIZER_STATE_TOTAL
];

234 
u32
 
	mcomm™d_buf„r_size
;

235 
u8
* 
	mcomm™d_buf„r_ba£
;

236 
u8
* 
	mcomm™d_buf„r_curs‹
;

	@shader_code.h

2 
	gTextuªdQuadShadî
[] = 
R
"FOO(

4 
	svs
 {

5 
Êﬂt3
 
posôi⁄
 : 
POSITION
;

6 
Êﬂt2
 
	mãxco‹d
 : 
TEXCOORD
;

9 
	sps
 {

10 
Êﬂt4
 
	mpixñ_pos
 : 
SV_POSITION
;

11 
Êﬂt2
 
	mãxco‹d
 : 
TEXCOORD
;

14 
cbuf„r
 
	gˇmîa
 : (
b1
) {

15 
Êﬂt4x4
 
võw_¥oj
;

16 
	}
};

18 
ps
 
	$vsf
(
vs
 
öput
) {

19 
ps
 
ªsu…
;

21 
ªsu…
.
pixñ_pos
 = 
	`mul
(
võw_¥oj
, 
	`Êﬂt4
(
öput
.
posôi⁄
, 1.0));

22 
ªsu…
.
ãxco‹d
 = 
öput
.texcoord;

24  
ªsu…
;

25 
	}
}

27 
Textuª2D
 
	gdiffu£_ãxtuª
 : (
t0
);

28 
Sam∂îSèã
 
	gdeÁu…_ßm∂î
 : (
s0
);

30 
Êﬂt4
 
	$psf
(
ps
 
öput
Ë: 
SV_TARGET
 {

31 
Êﬂt3
 
diffu£_cﬁ‹
 = 
diffu£_ãxtuª
.
	`Sam∂e
(
deÁu…_ßm∂î
, 
öput
.
ãxco‹d
).
xyz
;

32  
	`Êﬂt4
(
diffu£_cﬁ‹
, 1.0f);

33 
	}
}

34 )
	gFOO
";

36 
	gQuadShadî
[] = 
R
"FOO(

38 
	sQuad
 {

39 
Êﬂt3
 
é
;

40 
Êﬂt3
 
	må
;

41 
Êﬂt3
 
	mbl
;

42 
Êﬂt3
 
	mbr
;

43 
Êﬂt4
 
	mcﬁ‹
;

46 
	sps
 {

47 
Êﬂt4
 
	mpixñ_pos
 : 
SV_POSITION
;

48 
Êﬂt4
 
	mcﬁ‹
 : 
COLOR
;

51 
cbuf„r
 
	gˇmîa
 : (
b1
) {

52 
Êﬂt4x4
 
võw_¥oj
;

53 
	}
};

55 
	gSåu˘uªdBuf„r
<
	gQuad
> 
	gquad_li°
 : (
t0
);

57 
ps
 
	$vsf
(
ö
 
uöt
 
vît_id
 : 
SV_VîãxID
) {

58 
ps
 
ªsu…
;

59 
ödex
 = 
vît_id
 / 6;

60 
vît_cou¡
 = 
vît_id
 % 6;

62 
Quad
 
quad
 = 
quad_li°
[
ödex
];

64 
Êﬂt3
 
c‹√r
;

65 if(
vît_cou¡
 == 0)

66 
c‹√r
 = 
quad
.
é
;

67 if(
vît_cou¡
 == 1)

68 
c‹√r
 = 
quad
.
bl
;

69 if(
vît_cou¡
 == 2)

70 
c‹√r
 = 
quad
.
br
;

72 if(
vît_cou¡
 == 3)

73 
c‹√r
 = 
quad
.
br
;

74 if(
vît_cou¡
 == 4)

75 
c‹√r
 = 
quad
.
å
;

76 if(
vît_cou¡
 == 5)

77 
c‹√r
 = 
quad
.
é
;

79 
Êﬂt4
 
pos
 = 
	`Êﬂt4
(
c‹√r
, 1.0);

80 
ªsu…
.
pixñ_pos
 = 
	`mul
(
võw_¥oj
, 
pos
);

82 
ªsu…
.
cﬁ‹
 = 
quad
.color;

83  
ªsu…
;

84 
	}
}

86 
Êﬂt4
 
	$psf
(
ps
 
öput
Ë: 
SV_TARGET
 {

87  
öput
.
cﬁ‹
;

88 
	}
}

89 )
	gFOO
";

91 
	gCùS∑˚TextuªdShadî
[] = 
R
"FOO(

93 
	svs
 {

94 
Êﬂt3
 
posôi⁄
: 
POSITION
;

95 
Êﬂt2
 
	mãxco‹d
: 
TEXCOORD
;

98 
	sps
 {

99 
Êﬂt4
 
	mpixñ_pos
: 
SV_POSITION
;

100 
Êﬂt2
 
	mãxco‹d
: 
TEXCOORD
;

103 
ps
 
	$vsf
(
vs
 
öput
) {

104 
ps
 
ªsu…
;

106 
ªsu…
.
posôi⁄
 = 
	`Êﬂt4
(
öput
.position, 1.0f);

107 
ªsu…
.
ãxco‹d
 = 
öput
.texcoord;

109  
ªsu…
;

110 
	}
};

112 )
	gFOO
";

115 
	gS¸ìnS∑˚Shadî
[] = 
R
"FOO(

117 
	svs
 {

118 
Êﬂt3
 
posôi⁄
 : 
POSITION
;

119 
Êﬂt2
 
	mãxco‹d
 : 
TEXCOORD
;

122 
cbuf„r
 
	gs¸ìn
 : (
b0
) {

123 
width
;

124 
height
;

125 
	}
};

127 
	sps
 {

128 
Êﬂt4
 
	mpixñ_pos
: 
SV_POSITION
;

129 
Êﬂt2
 
	mãxco‹d
: 
TEXCOORD
;

132 
ps
 
	$vsf
(
vs
 
öput
) {

133 
ps
 
ªsu…
;

135 
x_n‹m
 = 
öput
.
posôi⁄
.
x
/
width
;

136 
y_n‹m
 = 
öput
.
posôi⁄
.
y
/
height
;

142 
ªsu…
.
pixñ_pos
 = 
	`Êﬂt4
(
x_n‹m
, 
y_n‹m
, 
öput
.
posôi⁄
.
z
, 1);

143 
ªsu…
.
ãxco‹d
 = 
öput
.texcoord;

145  
ªsu…
;

146 
	}
};

148 )
	gFOO
";

150 
	gTextShadî
[] = 
R
"FOO(

153 
	sGlyph
 {

154 
Êﬂt2
 
pos0
;

155 
Êﬂt2
 
	mpos1
;

156 
Êﬂt2
 
	muv0
;

157 
Êﬂt2
 
	muv1
;

158 
Êﬂt3
 
	mcﬁ‹
;

161 
	gSåu˘uªdBuf„r
<
	gGlyph
> 
	gglyph
 : (
t0
);

163 
	sps
 {

164 
Êﬂt4
 
	mpixñ_pos
 : 
SV_POSITION
;

165 
Êﬂt2
 
	mãxco‹d
 : 
TEXCOORD
;

166 
Êﬂt3
 
	mcﬁ‹
 : 
COLOR
;

169 
	$m≠
(
vÆue
, 
mö1
, 
max1
, 
mö2
, 
max2
) {

172 
≥rc
 = (
vÆue
 - 
mö1
Ë/ (
max1
 - min1);

175 
föÆ
 = 
≥rc
 * (
max2
 - 
mö2
) + min2;

176  
föÆ
;

177 
	}
}

179 
ps
 
	$vsf
(
ö
 
uöt
 
vît_id
 : 
SV_VîãxID
) {

180 
ps
 
ouçut
;

184 
ödex
 = 
vît_id
/6;

186 
pos0x
 = 
glyph
[
ödex
].
pos0
.
x
;

187 
pos0y
 = 
glyph
[
ödex
].
pos0
.
y
;

188 
xoff
 = 
glyph
[
ödex
].
pos1
.
x
 - 
pos0x
;

189 
yoff
 = 
glyph
[
ödex
].
pos1
.
y
 - 
pos0y
;

190 
Êﬂt2
 
uv0
 = 
glyph
[
ödex
].uv0;

191 
Êﬂt2
 
uv1
 = 
glyph
[
ödex
].uv1;

192 
zvÆ
 = 1.0f;

194 
Êﬂt2
 
t›_À·
 = 
	`Êﬂt2
(
pos0x
, 
pos0y
);

195 
Êﬂt2
 
t›_right
 = 
	`Êﬂt2
(
pos0x
+
xoff
, 
pos0y
);

196 
Êﬂt2
 
bŸtom_right
 = 
	`Êﬂt2
(
pos0x
+
xoff
, 
pos0y
+
yoff
);

197 
Êﬂt2
 
bŸtom_À·
 = 
	`Êﬂt2
(
pos0x
, 
pos0y
+
yoff
);

199 
t›_À·
 = 
	`Êﬂt2
–
	`m≠
 (t›_À·.
x
 , 0 , 1 , -1 , 1Ë, m≠ (t›_À·.
y
 , 0 , 1 , 1 , -1));

200 
t›_right
 = 
	`Êﬂt2
–
	`m≠
 (t›_right.
x
 , 0 , 1 , -1 , 1Ë, m≠ (t›_right.
y
 , 0 , 1 , 1 , -1));

201 
bŸtom_right
 = 
	`Êﬂt2
–
	`m≠
 (bŸtom_right.
x
 , 0 , 1 , -1 , 1Ë, m≠ (bŸtom_right.
y
 , 0 , 1 , 1 , -1));

202 
bŸtom_À·
 = 
	`Êﬂt2
–
	`m≠
 (bŸtom_À·.
x
 , 0 , 1 , -1 , 1Ë, m≠ (bŸtom_À·.
y
 , 0 , 1 , 1 , -1));

204 
vît_cou¡
 = 
vît_id
 % 6;

206 if(
vît_cou¡
 == 0) {

207 
ouçut
.
pixñ_pos
 = 
	`Êﬂt4
(
t›_À·
, 
zvÆ
, zval);

208 
ouçut
.
ãxco‹d
 = 
uv0
;

210 if(
vît_cou¡
 == 1) {

211 
ouçut
.
pixñ_pos
 = 
	`Êﬂt4
(
bŸtom_À·
, 
zvÆ
, zval);

212 
ouçut
.
ãxco‹d
 = 
	`Êﬂt2
(
uv0
.
x
, 
uv1
.
y
);

214 if(
vît_cou¡
 == 2) {

215 
ouçut
.
pixñ_pos
 = 
	`Êﬂt4
(
bŸtom_right
, 
zvÆ
, zval);

216 
ouçut
.
ãxco‹d
 = 
uv1
;

218 if(
vît_cou¡
 == 3) {

219 
ouçut
.
pixñ_pos
 = 
	`Êﬂt4
(
bŸtom_right
, 
zvÆ
, zval);

220 
ouçut
.
ãxco‹d
 = 
uv1
;

222 if(
vît_cou¡
 == 4) {

223 
ouçut
.
pixñ_pos
 = 
	`Êﬂt4
(
t›_right
, 
zvÆ
, zval);

224 
ouçut
.
ãxco‹d
 = 
	`Êﬂt2
(
uv1
.
x
, 
uv0
.
y
);

226 if(
vît_cou¡
 == 5) {

227 
ouçut
.
pixñ_pos
 = 
	`Êﬂt4
(
t›_À·
, 
zvÆ
, zval);

228 
ouçut
.
ãxco‹d
 = 
uv0
;

231 
ouçut
.
cﬁ‹
 = 
glyph
[
ödex
].color;

232  
ouçut
;

233 
	}
}

234 )
	gFOO
";

237 
	gM⁄ochromeShadî
[] = 
R
"FOO(

239 
	sps
 {

240 
Êﬂt4
 
pixñ_pos
 : 
SV_POSITION
;

241 
Êﬂt2
 
	mãxco‹d
 : 
TEXCOORD
;

244 
Textuª2D
 
	gdiffu£_ãxtuª
 : (
t0
);

245 
Sam∂îSèã
 
	gdeÁu…_ßm∂î
 : (
s0
);

247 
Êﬂt4
 
	$psf
(
ps
 
öput
Ë: 
SV_T¨gë
 {

248 
Êﬂt4
 
diffu£_cﬁ‹
 = 
diffu£_ãxtuª
.
	`Sam∂e
(
deÁu…_ßm∂î
, 
öput
.
ãxco‹d
).
x
;

249  
diffu£_cﬁ‹
;

250 
	}
}

252 )
	gFOO
";

254 
	gMeshShadî
[] = 
R
"FOO(

256 
	sMeshInfo
 {

257 
Êﬂt4x4
 
modñ
;

258 
Êﬂt4
 
	mcﬁ‹
;

261 
	svs
 {

262 
Êﬂt3
 
	mposôi⁄
 : 
POSITION
;

263 
Êﬂt3
 
	mn‹mÆ
 : 
NORMAL
;

266 
cbuf„r
 
	gˇmîa
 : (
b1
) {

267 
Êﬂt4x4
 
võw_¥oj
;

268 
	}
};

270 
cbuf„r
 
	gmesh
 : (
b2
) {

271 
Êﬂt4x4
 
modñ
;

272 
Êﬂt4
 
cﬁ‹
;

273 
	}
};

275 
	sps
 {

276 
Êﬂt4
 
	mpixñ_pos
 : 
SV_POSITION
;

277 
Êﬂt3
 
	mvîãx_pos
 : 
POSITION
;

278 
Êﬂt3
 
	mn‹mÆ
 : 
NORMAL
;

279 
Êﬂt4
 
	mcﬁ‹
 : 
COLOR
;

282 
cbuf„r
 
	glight
 : (
b1
) {

283 
Êﬂt3
 
light_posôi⁄
;

284 
light_ambõn˚
;

285 
	}
};

287 
ps
 
	$vsf
(
vs
 
öput
, 
ö
 
uöt
 
ö°™˚_id
 : 
SV_In°™˚ID
) {

288 
ps
 
ouçut
;

290 
Êﬂt4
 
w‹ld_pos
 = 
	`mul
(
modñ
, 
	`Êﬂt4
(
öput
.
posôi⁄
, 1.0f));

291 
ouçut
.
pixñ_pos
 = 
	`mul
(
võw_¥oj
, 
w‹ld_pos
);

292 
ouçut
.
vîãx_pos
 = 
w‹ld_pos
.
xyz
;

293 
ouçut
.
n‹mÆ
 = 
	`mul
(
modñ
, 
	`Êﬂt4
(
öput
.n‹mÆ, 0.0)).
xyz
;

294 
ouçut
.
cﬁ‹
 = color;

296  
ouçut
;

297 
	}
}

299 
Êﬂt4
 
	$psf
(
ps
 
öput
Ë: 
SV_T¨gë
 {

300 
Êﬂt3
 
light_dú
 = 
	`n‹mÆize
(
öput
.
vîãx_pos
 - 
light_posôi⁄
);

302 
cos
 = 
	`max
(0.0, 
	`dŸ
(
öput
.
n‹mÆ
, 
light_dú
));

304 
Êﬂt3
 
diffu£_cﬁ‹
 = 
cos
 * 
öput
.
cﬁ‹
.
rgb
;

305 
Êﬂt3
 
ambõ¡_cﬁ‹
 = 
öput
.
cﬁ‹
.
rbg
 * 
light_ambõn˚
;

307 
Êﬂt3
 
föÆ_cﬁ‹
 = 
ambõ¡_cﬁ‹
 + 
diffu£_cﬁ‹
;

309  
	`Êﬂt4
(
föÆ_cﬁ‹
, 
öput
.
cﬁ‹
.
a
);

310 
	}
};

311 )
	gFOO
";

313 
	gFuŒS¸ìnQuadShadî
[] = 
R
"FOO(

315 
	sps
 {

316 
Êﬂt4
 
pixñ_pos
 : 
SV_POSITION
;

317 
Êﬂt2
 
	mãxco‹d
 : 
TEXCOORD
;

320 
ps
 
	$vsf
(
ö
 
uöt
 
vît_id
 : 
SV_VîãxID
) {

321 
ps
 
ªsu…
;

323 
ªsu…
.
ãxco‹d
 = 
	`Êﬂt2
((
vît_id
 << 1) & 2, vert_id & 2);

324 
ªsu…
.
pixñ_pos
 = 
	`Êﬂt4
‘esu….
ãxco‹d
 * 
	`Êﬂt2
(2.0f, -2.0f) + float2(-1.0f, 1.0f), 0.0f, 1.0f);

326  
ªsu…
;

327 
	}
}

328 )
	gFOO
";

330 
	gC›yShadî
[] = 
R
"FOO(

332 
	sps
 {

333 
Êﬂt4
 
pixñ_pos
 : 
SV_POSITION
;

334 
Êﬂt2
 
	mãxco‹d
 : 
TEXCOORD
;

337 
Textuª2D
 
	gãx
: (
t0
);

338 
Sam∂îSèã
 
	gãx_ßm∂î
 : (
s0
);

341 )
	gFOO
";

343 
	gPo°Pro˚ssShadî
[] = 
R
"FOO(

345 
	sps
 {

346 
Êﬂt4
 
pixñ_pos
 : 
SV_POSITION
;

347 
Êﬂt2
 
	mãxco‹d
 : 
TEXCOORD
;

350 
	#MAX_SAMPLES
 16

	)

352 
cbuf„r
 
	gimage
 : (
b0
) {

353 
width
;

354 
height
;

355 
	}
};

357 
Textuª2D
 
	gãx
: (
t0
);

358 
Sam∂îSèã
 
	gãx_ßm∂î
 : (
s0
);

360 
Êﬂt4
 
	$ps_c›y
(
ps
 
öput
Ë: 
SV_T¨gë
 {

361  
	`Êﬂt4
(
ãx
.
	`Sam∂e
(
ãx_ßm∂î
, 
öput
.
ãxco‹d
).
xyz
, 1.0);

362 
	}
};

364 
Êﬂt4
 
	$ps_edge
(
ps
 
öput
Ë: 
SV_T¨gë
 {

365 
Êﬂt2
 
uv
 = 
öput
.
ãxco‹d
;

367 
Êﬂt4
 
x_acc
 = 0;

368 
Êﬂt4
 
y_acc
 = 0;

369 
Êﬂt2
 
ãxñ
 = 
	`Êﬂt2
(1/
width
, 1/
height
);

371 
x_acc
 +
ãx
.
	`Sam∂e
(
ãx_ßm∂î
, 
uv
 + 
	`Êﬂt2
(-
ãxñ
.
x
, -ãxñ.
y
)) * -1.0;

372 
x_acc
 +
ãx
.
	`Sam∂e
(
ãx_ßm∂î
, 
uv
 + 
	`Êﬂt2
(-
ãxñ
.
x
, 0)) * -2.0;

373 
x_acc
 +
ãx
.
	`Sam∂e
(
ãx_ßm∂î
, 
uv
 + 
	`Êﬂt2
(-
ãxñ
.
x
,Åexñ.
y
)) * -1.0;

375 
x_acc
 +
ãx
.
	`Sam∂e
(
ãx_ßm∂î
, 
uv
 + 
	`Êﬂt2
–
ãxñ
.
x
, -ãxñ.
y
)) * 1.0;

376 
x_acc
 +
ãx
.
	`Sam∂e
(
ãx_ßm∂î
, 
uv
 + 
	`Êﬂt2
–
ãxñ
.
x
, 0)) * 2.0;

377 
x_acc
 +
ãx
.
	`Sam∂e
(
ãx_ßm∂î
, 
uv
 + 
	`Êﬂt2
–
ãxñ
.
x
,Åexñ.
y
)) * 1.0;

379 
y_acc
 +
ãx
.
	`Sam∂e
(
ãx_ßm∂î
, 
uv
 + 
	`Êﬂt2
(-
ãxñ
.
x
, -ãxñ.
y
)) * -1.0;

380 
y_acc
 +
ãx
.
	`Sam∂e
(
ãx_ßm∂î
, 
uv
 + 
	`Êﬂt2
–0, -
ãxñ
.
y
)) * -2.0;

381 
y_acc
 +
ãx
.
	`Sam∂e
(
ãx_ßm∂î
, 
uv
 + 
	`Êﬂt2
–
ãxñ
.
x
, -ãxñ.
y
)) * -1.0;

383 
y_acc
 +
ãx
.
	`Sam∂e
(
ãx_ßm∂î
, 
uv
 + 
	`Êﬂt2
(-
ãxñ
.
x
,Åexñ.
y
)) * 1.0;

384 
y_acc
 +
ãx
.
	`Sam∂e
(
ãx_ßm∂î
, 
uv
 + 
	`Êﬂt2
–0, 
ãxñ
.
y
)) * 2.0;

385 
y_acc
 +
ãx
.
	`Sam∂e
(
ãx_ßm∂î
, 
uv
 + 
	`Êﬂt2
–
ãxñ
.
x
,Åexñ.
y
)) * 1.0;

387  
	`sqπ
(
x_acc
*x_ac¯+ 
y_acc
*y_acc);

388 
	}
};

390 )
	gFOO
";

392 
	gUIShadî
[] = 
R
"FOO(

394 
	sUIBuf„r
 {

395 
Êﬂt2
 
p0
;

396 
Êﬂt2
 
	mp1
;

397 
Êﬂt4
 
	mcﬁ‹
[4];

400 
	gSåu˘uªdBuf„r
<
	gUIBuf„r
> 
	gui_buf„r_li°
 : (
t0
);

402 
	sps
 {

403 
Êﬂt4
 
	mpixñ_pos
: 
SV_POSITION
;

404 
Êﬂt4
 
	mcﬁ‹
: 
COLOR
;

407 
ps
 
	$vsf
(
ö
 
uöt
 
vît_id
: 
SV_VîãxID
, i¿uöà
ö°™˚_id
: 
SV_In°™˚ID
) {

408 
ps
 
ªsu…
;

410 
Êﬂt2
 
vîti˚s
[] = {

417 
UIBuf„r
 
ui
 = 
ui_buf„r_li°
[
ö°™˚_id
];

419 
Êﬂt2
 
hÆf_size
 = (
ui
.
p1
 - ui.
p0
)/2;

420 
Êﬂt2
 
˚¡î
 = (
ui
.
p1
 + ui.
p0
)/2;

421 
Êﬂt2
 
pos
 = 
vîti˚s
[
vît_id
] * 
hÆf_size
 + 
˚¡î
;

423 
ªsu…
.
pixñ_pos
 = 
	`Êﬂt4
(2*
pos
.
x
 - 1, 1 - 2*pos.
y
, 0, 1);

424 
ªsu…
.
cﬁ‹
 = 
ui
.cﬁ‹[
vît_id
];

426  
ªsu…
;

427 
	}
};

429 
Êﬂt4
 
	$psf
(
ps
 
öput
Ë: 
SV_T¨gë
 {

430  
öput
.
cﬁ‹
;

431 
	}
}

433 )
	gFOO
";

	@shapes.cpp

1 
	sQuad
 {

4 
Vec3
 
	mé
;

5 
Vec3
 
	må
;

6 
Vec3
 
	mbl
;

7 
Vec3
 
	mbr
;

10 
Vec3
 
	mmax
;

11 
Vec3
 
	mmö
;

16 
	sLöe
 {

17 
Vec3
 
	m°¨t
;

18 
Vec3
 
	míd
;

23 
	$Gíî©eFœtShadedN‹mÆs
(
Vec3
* 
vîti˚s
, 
u32
 
cou¡
, Vec3* 
out_n‹mÆs
 ) {

24 
	`As£π
(
cou¡
 % 3 == 0);

25 
u32
 
i
=0; i<
cou¡
; i+=3) {

26 
Vec3
 
a
 = 
vîti˚s
[
i
];

27 
Vec3
 
b
 = 
vîti˚s
[
i
+1];

28 
Vec3
 
c
 = 
vîti˚s
[
i
+2];

29 
Vec3
 
¸oss
 = 
	`V3N‹m
(
	`V3Cross
(
	`V3Sub
(
b
, 
a
), V3Sub(
c
,á)));

30 
out_n‹mÆs
[
i
] = 
¸oss
;

31 
out_n‹mÆs
[
i
+1] = 
¸oss
;

32 
out_n‹mÆs
[
i
+2] = 
¸oss
;

34 
	}
};

36 
Quad


37 
	$MakeQuadFromLöe
(
Löe
* 
löe
, 
thick√ss
, 
Vec3
 
n‹mÆ
) {

38 
Quad
 
ªsu…
 = {};

40 
ªsu…
.
é
 = 
	`V3Add
(
löe
->
°¨t
, 
	`V3MulF
(
n‹mÆ
, 
thick√ss
));

41 
ªsu…
.
bl
 = 
	`V3Add
(
löe
->
°¨t
, 
	`V3MulF
(
n‹mÆ
, -
thick√ss
));

42 
ªsu…
.
å
 = 
	`V3Add
(
löe
->
íd
, 
	`V3MulF
(
n‹mÆ
, 
thick√ss
));

43 
ªsu…
.
br
 = 
	`V3Add
(
löe
->
íd
, 
	`V3MulF
(
n‹mÆ
, -
thick√ss
));

44  
ªsu…
;

45 
	}
}

50 
	$Gíî©eTëøhedr⁄
(
Vec3
* 
out_vîti˚s
) {

51 
a
 = 1.0f / 3.0f;

52 
b
 = 
	`sqπf
(8.0f / 9.0f);

53 
c
 = 
	`sqπf
(2.0f / 9.0f);

54 
d
 = 
	`sqπf
(2.0f / 3.0f);

56 
Vec3
 
vîti˚s
[4] = { 
	`V3
(0.0, 0.0, 1.0f),

57 
	`V3
(-
c
, 
d
, -
a
),

58 
	`V3
(-
c
, -
d
, -d),

59 
	`V3
(
b
, 0, -
a
) };

61 
out_vîti˚s
[0] = 
vîti˚s
[0];

62 
out_vîti˚s
[1] = 
vîti˚s
[1];

63 
out_vîti˚s
[2] = 
vîti˚s
[2];

64 
out_vîti˚s
[3] = 
vîti˚s
[0];

65 
out_vîti˚s
[4] = 
vîti˚s
[2];

66 
out_vîti˚s
[5] = 
vîti˚s
[3];

67 
out_vîti˚s
[6] = 
vîti˚s
[0];

68 
out_vîti˚s
[7] = 
vîti˚s
[3];

69 
out_vîti˚s
[8] = 
vîti˚s
[1];

70 
out_vîti˚s
[9] = 
vîti˚s
[3];

71 
out_vîti˚s
[10] = 
vîti˚s
[2];

72 
out_vîti˚s
[11] = 
vîti˚s
[1];

73 
	}
}

75 
boﬁ


76 
	$IsPoötInQuad
(
Vec2
 
mö
, Vec2 
max
, Vec2 
poöt
) {

77 
boﬁ
 
ªsu…
 = 0;

79 if(
poöt
.
x
 <
max
.x &&

80 
poöt
.
x
 >
mö
.x &&

81 
poöt
.
y
 <
max
.y &&

82 
poöt
.
y
 >
mö
.yË
ªsu…
 = 
åue
;

84  
ªsu…
;

85 
	}
}

	@simulation.cpp

1 
E¡ôy
*

2 
	$AŒocE¡ôy
(
E¡ôyBlob
* 
blob
) {

3 
E¡ôy
* 
ªsu…
 = 
blob
->
fú°_‰ì
;

5 if(
ªsu…
) {

6 
blob
->
fú°_‰ì
 = blob->fú°_‰ì->
√xt
;

7 
	`ZîoMem
(
ªsu…
, (
E¡ôy
));

9 
ªsu…
 = 
	`PushSåu˘
(
blob
->
≥rm™ít_¨ía
, 
E¡ôy
);

11 
ªsu…
->
√xt
 = 
blob
->
ítôõs
;

12 if(
blob
->
ítôõs
Ëblob->ítôõs->
¥ev
 = 
ªsu…
;

13 
blob
->
ítôõs
 = 
ªsu…
;

15 
blob
->
ítôy_cou¡
++;

16  
ªsu…
;

17 
	}
}

20 
	$Rñó£E¡ôy
(
E¡ôy
* 
ítôy
, 
E¡ôyBlob
* 
blob
) {

21 if(
ítôy
->
¥ev
 &&É¡ôy->
√xt
) {

22 
ítôy
->
¥ev
->
√xt
 =Éntity->next;

23 
ítôy
->
√xt
->
¥ev
 =Éntity->prev;

25 if(
ítôy
->
¥ev
 && !ítôy->
√xt
)Éntity->prev->next = 0;

26 if(!
ítôy
->
¥ev
 &&É¡ôy->
√xt
)Éntity->next->prev = 0;

28 
blob
->
ítôy_cou¡
--;

29 
ítôy
->
√xt
 = 
blob
->
fú°_‰ì
;

30 
blob
->
fú°_‰ì
 = 
ítôy
;

31 
	}
}

34 
	$Upd©eTønsf‹m
(
Tønsf‹m
* 
öout
, Tønsf‹m 
v¨
) {

35 
öout
->
posôi⁄
 = 
	`V3Add
(
v¨
.position, inout->position);

36 
öout
->
rŸ©i⁄
 = 
	`Qu©Mul
(
v¨
.rotation, inout->rotation);

37 
öout
->
sˇÀ
 = 
	`V3Mul
(
v¨
.scale, inout->scale);

38 
	}
}

40 
BoundögBox


41 
	$Upd©eBoundögBox
(
BoundögBox
* 
box
, 
Tønsf‹m
* 
å™sf‹m
) {

42 
BoundögBox
 
obb
 = {};

43 
BoundögBox
 
ªsu…
 = {};

45 
obb
.
mö
 = 
	`V3Mul
(
å™sf‹m
->
sˇÀ
, 
box
->min);

46 
obb
.
max
 = 
	`V3Mul
(
å™sf‹m
->
sˇÀ
, 
box
->max);

48 
M©4
 
rŸ_m©rix
 = 
	`M4FromQu©
(
å™sf‹m
->
rŸ©i⁄
);

49 
Vec4
 
mö
 = 
	`M4MulV
(
rŸ_m©rix
, 
	`V4FromV3
(
obb
.min, 1.0f));

50 
Vec4
 
max
 = 
	`M4MulV
(
rŸ_m©rix
, 
	`V4FromV3
(
obb
.max, 1.0f));

51 
obb
.
mö
 = 
	`V3
(mö.
x
, mö.
y
, mö.
z
);

52 
obb
.
max
 = 
	`V3
(max.
x
, max.
y
, max.
z
);

54 
obb
.
mö
 = 
	`V3Add
(obb.mö, 
å™sf‹m
->
posôi⁄
);

55 
obb
.
max
 = 
	`V3Add
(obb.max, 
å™sf‹m
->
posôi⁄
);

57 
ªsu…
.
mö
.
x
 = 
obb
.mö.x < obb.
max
.x ? obb.min.x : obb.max.x;

58 
ªsu…
.
mö
.
y
 = 
obb
.mö.y < obb.
max
.y ? obb.min.y : obb.max.y;

59 
ªsu…
.
mö
.
z
 = 
obb
.mö.z < obb.
max
.z ? obb.min.z : obb.max.z;

61 
ªsu…
.
max
.
x
 = 
obb
.max.x > obb.
mö
.x ? obb.max.x : obb.min.x;

62 
ªsu…
.
max
.
y
 = 
obb
.max.y > obb.
mö
.y ? obb.max.y : obb.min.y;

63 
ªsu…
.
max
.
z
 = 
obb
.max.z > obb.
mö
.z ? obb.max.z : obb.min.z;

65 
ªsu…
.
size
.
x
 = 
	`Abs
(‘esu….
max
.x -Ñesu….
mö
.x)/2);

66 
ªsu…
.
size
.
y
 = 
	`Abs
(‘esu….
max
.y -Ñesu….
mö
.y)/2);

67 
ªsu…
.
size
.
z
 = 
	`Abs
(‘esu….
max
.z -Ñesu….
mö
.z)/2);

69  
ªsu…
;

70 
	}
}

72 
boﬁ


73 
	$BoundögBoxI¡î£˘
(
BoundögBox
* 
À·
, BoundögBox* 
right
) {

74 
boﬁ
 
x1
 = 
À·
->
mö
.
x
 <
right
->
max
.x;

75 
boﬁ
 
x2
 = 
À·
->
max
.
x
 >
right
->
mö
.x;

76 
boﬁ
 
y1
 = 
À·
->
mö
.
y
 <
right
->
max
.y;

77 
boﬁ
 
y2
 = 
À·
->
max
.
y
 >
right
->
mö
.y;

78 
boﬁ
 
z1
 = 
À·
->
mö
.
z
 <
right
->
max
.z;

79 
boﬁ
 
z2
 = 
À·
->
max
.
z
 >
right
->
mö
.z;

80  
x1
 && 
x2
 && 
y1
 && 
y2
 && 
z1
 && 
z2
;

81 
	}
}

83 
BoundögBox


84 
	$GëBoundögBoxFromMeshD©a
(
MeshD©a
* 
mesh_d©a
) {

85 
BoundögBox
 
ªsu…
 = {};

87 
u8
 
i
=0;

88 
i
=0; i<
mesh_d©a
->
vb_d©a_cou¡
; i++)

89 if(
mesh_d©a
->
vb_d©a
[
i
].
ty≥
 =
VERTEX_BUFFER_POSITION
) ;

91 
Vec3
 
max
 = 
	`V3
(-
FLT_MAX
, -FLT_MAX, -FLT_MAX);

92 
Vec3
 
mö
 = 
	`V3
–
FLT_MAX
, FLT_MAX, FLT_MAX);

94 
Vec3
* 
d©a
 = (Vec3*)
mesh_d©a
->
vb_d©a
[
i
].data;

95 
u32
 
j
=0; j<
mesh_d©a
->
vîti˚s_cou¡
; j++) {

96 if(
d©a
[
j
].
x
 < 
mö
.x) min.x = data[j].x;

97 if(
d©a
[
j
].
y
 < 
mö
.y) min.y = data[j].y;

98 if(
d©a
[
j
].
z
 < 
mö
.z) min.z = data[j].z;

100 if(
d©a
[
j
].
x
 > 
max
.x) max.x = data[j].x;

101 if(
d©a
[
j
].
y
 > 
max
.y) max.y = data[j].y;

102 if(
d©a
[
j
].
z
 > 
max
.z) max.z = data[j].z;

105 
ªsu…
.
mö
 = min;

106 
ªsu…
.
max
 = max;

108 
ªsu…
.
size
.
x
 = (ªsu….
mö
.x +Ñesu….
max
.x)/2;

109 
ªsu…
.
size
.
y
 = (ªsu….
mö
.y +Ñesu….
max
.y)/2;

110 
ªsu…
.
size
.
z
 = (ªsu….
mö
.z +Ñesu….
max
.z)/2;

112  
ªsu…
;

113 
	}
};

115 
E¡ôy
*

116 
	$S∑wnP¨ti˛eSy°em
(
P¨ti˛eSy°em
* 
∑πi˛e_sy°em
, 
GameSèã
* 
game_°©e
) {

117 
E¡ôy
* 
ªsu…
 = 
	`AŒocE¡ôy
(&
game_°©e
->
ítôy_blob
);

118 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_HasP¨ti˛eSy°em
;

120 
ªsu…
->
∑πi˛e_sy°em
 = *particle_system;

121  
ªsu…
;

122 
	}
}

124 
E¡ôy
*

125 
	$S∑wnE¡ôyS∑w√r
(
S∑w√rInfo
* 
öfo
, 
GameSèã
* 
game_°©e
) {

126 
E¡ôy
* 
ªsu…
 = 
	`AŒocE¡ôy
(&
game_°©e
->
ítôy_blob
);

128 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_E¡ôyS∑w√r
;

130 
ªsu…
->
•aw√r_öfo
 = *
öfo
;

132  
ªsu…
;

133 
	}
}

135 
E¡ôy
*

136 
	$S∑wnMöe
(
Tønsf‹m
 
å™sf‹m
, 
GameSèã
* 
game_°©e
) {

137 
E¡ôy
* 
ªsu…
 = 
	`AŒocE¡ôy
(&
game_°©e
->
ítôy_blob
);

139 
P¨ti˛eSy°em
 
∑πi˛es
 = {};

140 
∑πi˛es
.
ãxtuªs
[0] = 
	`GëTextuªAs£tInfo
("löes_1", 
game_°©e
->
as£ts
)->
buf„r
;

141 
∑πi˛es
.
ãxtuªs
[1] = 
	`GëTextuªAs£tInfo
("löes_2", 
game_°©e
->
as£ts
)->
buf„r
;

142 
∑πi˛es
.
ãxtuªs
[2] = 
	`GëTextuªAs£tInfo
("löes_3", 
game_°©e
->
as£ts
)->
buf„r
;

143 
∑πi˛es
.
ãxtuªs
[3] = 
	`GëTextuªAs£tInfo
("löes_4", 
game_°©e
->
as£ts
)->
buf„r
;

144 
∑πi˛es
.
ãxtuªs
[4] = 
	`GëTextuªAs£tInfo
("löes_5", 
game_°©e
->
as£ts
)->
buf„r
;

145 
∑πi˛es
.
ãxtuªs
[5] = 
	`GëTextuªAs£tInfo
("löes_6", 
game_°©e
->
as£ts
)->
buf„r
;

146 
∑πi˛es
.
ãxtuªs
[6] = 
	`GëTextuªAs£tInfo
("löes_7", 
game_°©e
->
as£ts
)->
buf„r
;

147 
∑πi˛es
.
ãxtuªs
[7] = 
	`GëTextuªAs£tInfo
("löes_8", 
game_°©e
->
as£ts
)->
buf„r
;

148 
∑πi˛es
.
ãxtuªs
[8] = 
	`GëTextuªAs£tInfo
("löes_9", 
game_°©e
->
as£ts
)->
buf„r
;

149 
∑πi˛es
.
ãxtuªs
[9] = 
	`GëTextuªAs£tInfo
("löes_10", 
game_°©e
->
as£ts
)->
buf„r
;

151 
∑πi˛es
.
ãxtuª_cou¡
 = 10;

152 
∑πi˛es
.
∑πi˛e_cou¡
 = 10;

153 
∑πi˛es
.
li„_time
 = 1000.0f;

154 
∑πi˛es
.
öôül_size
 = 
	`V3
(1.0f, 1.0f, 1.0f);

155 
∑πi˛es
.
föÆ_size
 = 
	`V3Z
();

157 
MeshAs£tInfo
* 
mesh_as£t
 = 
	`GëMeshAs£tInfo
("Sèr", 
game_°©e
->
as£ts
);

159 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_Mesh
;

160 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_SpöInPœ˚
;

161 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_BoundögBox
;

162 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_Sim∂eCha£
;

163 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_DólsCﬁlisi⁄Damage
;

164 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_TakesCﬁlisi⁄Damage
;

165 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_HasHó…h
;

166 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_S∑wnsP¨ti˛eSy°em
;

168 
ªsu…
->
ãam
 = 
TEAM_ENEMY
;

169 
ªsu…
->
ª•⁄£
 = 
RESPONSE_HOSTILE
;

170 
ªsu…
->
hó…h
 = 10;

171 
ªsu…
->
©èck_damage
 = 10;

173 
ªsu…
->
bb_mesh_•a˚
 = 
	`GëBoundögBoxFromMeshD©a
(
mesh_as£t
->
d©a
);

175 
ªsu…
->
å™sf‹m
 = 
	`Tønsf‹mI
();

176 
ªsu…
->
å™sf‹m
.
sˇÀ
 = 
	`V3
(20.0f, 20.0f, 20.0f);

177 
ªsu…
->
∑πi˛e_sy°em
 = 
∑πi˛es
;

179 
	`Upd©eTønsf‹m
(&
ªsu…
->
å™sf‹m
,Åransform);

180 
ªsu…
->
bb_obje˘_•a˚
 = 
	`Upd©eBoundögBox
(&ªsu…->
bb_mesh_•a˚
, &ªsu…->
å™sf‹m
);

182 
ªsu…
->
mesh_pùñöe
.
mesh
 = *
mesh_as£t
->mesh;

183 
ªsu…
->
•ö_axis
 = 
AXIS_Z
;

184 
ªsu…
->
•ö_amou¡
 = 1.0f;

186 
ªsu…
->
•ìd
 = 1.0f;

187 
ªsu…
->
ac˚Àøti⁄
 = 1.0f;

189  
ªsu…
;

190 
	}
}

192 
E¡ôy
*

193 
	$S∑wnPœyî
(
Tønsf‹m
 
å™sf‹m
, 
GameSèã
* 
game_°©e
) {

194 
E¡ôy
* 
ªsu…
 = 
	`AŒocE¡ôy
(&
game_°©e
->
ítôy_blob
);

196 
MeshAs£tInfo
* 
mesh_as£t
 = 
	`GëMeshAs£tInfo
("lc_1", 
game_°©e
->
as£ts
);

198 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_Mesh
;

199 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_PœyîC⁄åﬁÀd
;

200 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_BoundögBox
;

201 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_HasHó…h
;

202 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_TakesCﬁlisi⁄Damage
;

203 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_DólsCﬁlisi⁄Damage
;

204 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_MovabÀ
;

206 
ªsu…
->
ãam
 = 
TEAM_PLAYER
;

207 
ªsu…
->
ª•⁄£
 = 
RESPONSE_HOSTILE
;

208 
ªsu…
->
hó…h
 = 100.0f;

209 
ªsu…
->
©èck_damage
 = 10.0f;

211 
ªsu…
->
bb_mesh_•a˚
 = 
	`GëBoundögBoxFromMeshD©a
(
mesh_as£t
->
d©a
);

212 
ªsu…
->
å™sf‹m
 = 
	`Tønsf‹mI
();

213 
ªsu…
->
å™sf‹m
.
sˇÀ
 = 
	`V3
(1.0f, 1.0f, 1.0f);

215 
	`Upd©eTønsf‹m
(&
ªsu…
->
å™sf‹m
,Åransform);

216 
ªsu…
->
bb_obje˘_•a˚
 = 
	`Upd©eBoundögBox
(&ªsu…->
bb_mesh_•a˚
, &ªsu…->
å™sf‹m
);

218 
ªsu…
->
mesh_pùñöe
.
mesh
 = *
mesh_as£t
->mesh;

220  
ªsu…
;

221 
	}
}

223 
E¡ôy
*

224 
	$S∑wnLevñBound¨y
(
BoundögBox
 
box
, 
GameSèã
* 
game_°©e
) {

225 
E¡ôy
* 
ªsu…
 = 
	`AŒocE¡ôy
(&
game_°©e
->
ítôy_blob
);

227 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_BoundögBox
;

228 
ªsu…
->
¥›îtõs
 |
ENTITY_PROPERTY_LevñBound¨y
;

230 
ªsu…
->
ãam
 = 
TEAM_NONE
;

231 
ªsu…
->
ª•⁄£
 = 
RESPONSE_NONE
;

233 
ªsu…
->
å™sf‹m
 = 
	`Tønsf‹mI
();

234 
ªsu…
->
bb_mesh_•a˚
 = 
box
;

235 
ªsu…
->
bb_obje˘_•a˚
 = 
box
;

236 
ªsu…
->
bb_‹õ¡©i⁄
 = 
BOUNDING_BOX_ORIENTATION_INVERSE
;

238  
ªsu…
;

239 
	}
}

242 
	$ResﬁveCﬁlisi⁄
(
E¡ôy
* 
a
, E¡ôy* 
b
) {

243 if(
a
->
¥›îtõs
 & 
ENTITY_PROPERTY_LevñBound¨y
) {

244 
b
->
å™sf‹m
.
posôi⁄
.
x
 = 
	`Cœmp
(
a
->
bb_obje˘_•a˚
.
mö
.x + b->bb_obje˘_•a˚.
size
.x, b->å™sf‹m.posôi⁄.x,á->bb_obje˘_•a˚.
max
.x - b->bb_object_space.size.x);

245 
b
->
å™sf‹m
.
posôi⁄
.
y
 = 
	`Cœmp
(
a
->
bb_obje˘_•a˚
.
mö
.y + b->bb_obje˘_•a˚.
size
.y, b->å™sf‹m.posôi⁄.y,á->bb_obje˘_•a˚.
max
.y - b->bb_object_space.size.y);

247 if(
b
->
¥›îtõs
 & 
ENTITY_PROPERTY_LevñBound¨y
) {

248 
a
->
å™sf‹m
.
posôi⁄
.
x
 = 
	`Cœmp
(
b
->
bb_obje˘_•a˚
.
mö
.x +á->bb_obje˘_•a˚.
size
.x,á->å™sf‹m.posôi⁄.x, b->bb_obje˘_•a˚.
max
.x -á->bb_object_space.size.x);

249 
a
->
å™sf‹m
.
posôi⁄
.
y
 = 
	`Cœmp
(
b
->
bb_obje˘_•a˚
.
mö
.y +á->bb_obje˘_•a˚.
size
.y,á->å™sf‹m.posôi⁄.y, b->bb_obje˘_•a˚.
max
.y -á->bb_object_space.size.y);

251 
	}
}

254 
	$ResﬁveDamageExch™ge
(
E¡ôy
* 
a
, E¡ôy* 
b
) {

255 if(
a
->
¥›îtõs
 & 
ENTITY_PROPERTY_DólsCﬁlisi⁄Damage
 &&

256 
b
->
¥›îtõs
 & 
ENTITY_PROPERTY_TakesCﬁlisi⁄Damage
) {

257 
b
->
hó…h
 -
a
->
©èck_damage
 - b->
damage_ªdu˘i⁄
*a->attack_damage;

260 if(
b
->
¥›îtõs
 & 
ENTITY_PROPERTY_DólsCﬁlisi⁄Damage
 &&

261 
a
->
¥›îtõs
 & 
ENTITY_PROPERTY_TakesCﬁlisi⁄Damage
) {

262 
a
->
hó…h
 -
b
->
©èck_damage
 -á->
damage_ªdu˘i⁄
*b->attack_damage;

264 
	}
}

267 
	$Upd©eE¡ôõs
(
GameSèã
* 
game_°©e
, 
I≈ut
* 
öput
) {

268 
	#DEBUG_BOUNDING_BOX


	)

269 
E¡ôyBlob
* 
blob
 = &
game_°©e
->
ítôy_blob
;

270 
E¡ôy
* 
ítôy
 = 
blob
->
ítôõs
;

272 
E¡ôy
** 
ítôõs_wôh_bb
 = 
	`PushAºayCÀ¨
(
blob
->
‰ame_¨ía
, E¡ôy*, blob->
ítôy_cou¡
);

273 
E¡ôy
** 
ítôõs_to_ªÀa£
 = 
	`PushAºayCÀ¨
(
blob
->
‰ame_¨ía
, E¡ôy*, blob->
ítôy_cou¡
);

275 
S∑wnInfo
* 
ítôõs_to_•awn
 = 0;

276 
u32
 
ªÀa£_cou¡
 = 0;

277 
u32
 
bb_cou¡
 = 0;

279 
	sE¡ôyTóm
 {

280 
E¡ôy
** 
ítôõs
;

281 
u32
 
cou¡
;

284 
E¡ôyTóm
 
ítôõs_⁄_ãam
[
TEAM_TOTAL
] = {};

285 
u8
 
i
=0; i<
TEAM_TOTAL
; i++) {

286 
ítôõs_⁄_ãam
[
i
].
ítôõs
 = 
	`PushAºayCÀ¨
(
blob
->
‰ame_¨ía
, 
E¡ôy
*, blob->
ítôy_cou¡
);

289 
ítôy
) {

290 if(
ítôy
->
¥›îtõs
 & 
ENTITY_PROPERTY_BoundögBox
) {

291 
ítôõs_wôh_bb
[
bb_cou¡
++] = 
ítôy
;

293 
u8
 
ãam
 = 
ítôy
->team;

294 
u32
 
cou¡
 = 
ítôõs_⁄_ãam
[
ãam
].count;

295 
ítôõs_⁄_ãam
[
ãam
].
ítôõs
[
cou¡
] = 
ítôy
;

296 
ítôõs_⁄_ãam
[
ãam
].
cou¡
++;

298 
ítôy
 =É¡ôy->
√xt
;

301 
u32
 
i
=0; i<
bb_cou¡
; i++) {

302 
u32
 
j
=
i
+1; j<
bb_cou¡
; j++) {

303 
E¡ôy
* 
a
 = 
ítôõs_wôh_bb
[
i
];

304 
E¡ôy
* 
b
 = 
ítôõs_wôh_bb
[
j
];

306 if(
	`BoundögBoxI¡î£˘
(&
a
->
bb_obje˘_•a˚
, &
b
->bb_object_space)) {

307 if((
a
->
ãam
 !
b
->ãamË&& (◊->
ª•⁄£
 =
RESPONSE_HOSTILE
) || (b->response == RESPONSE_HOSTILE)))

308 
	`ResﬁveDamageExch™ge
(
a
, 
b
);

309 
	`ResﬁveCﬁlisi⁄
(
a
, 
b
);

314 
ítôy
 = 
blob
->
ítôõs
;

315 
ítôy
) {

316 if(!
game_°©e
->
dev_mode
 & 
DEV_MODE_PAUSED
) {

317 if(
ítôy
->
¥›îtõs
 & 
ENTITY_PROPERTY_SpöInPœ˚
) {

318 
Qu©
 
•ö
;

319 if(
ítôy
->
•ö_axis
 =
AXIS_X
)

320 
•ö
 = 
	`Qu©MulF
(
	`Qu©FromEuÀr
(0.1f, 0.0f, 0.0f), 
ítôy
->
•ö_amou¡
);

321 if(
ítôy
->
•ö_axis
 =
AXIS_Y
)

322 
•ö
 = 
	`Qu©MulF
(
	`Qu©FromEuÀr
(0.0f, 0.1f, 0.0f), 
ítôy
->
•ö_amou¡
);

323 if(
ítôy
->
•ö_axis
 =
AXIS_Z
)

324 
•ö
 = 
	`Qu©MulF
(
	`Qu©FromEuÀr
(0.0f, 0.0f, 0.1f), 
ítôy
->
•ö_amou¡
);

326 
ítôy
->
å™sf‹m
.
rŸ©i⁄
 = 
	`Qu©Mul
(
•ö
,Éntity->transform.rotation);

329 if(
ítôy
->
¥›îtõs
 & 
ENTITY_PROPERTY_Sim∂eCha£
) {

330 
Vec3
 
˛o£°_èrgë
 = 
	`V3Z
();

331 
˛o£°_di°™˚
 = 
FLT_MAX
;

333 
u32
 
i
=0; i<
TEAM_TOTAL
; i++) {

334 if(
ítôy
->
ãam
 =
i
) ;

336 
u32
 
j
=0; j<
ítôõs_⁄_ãam
[
i
].
cou¡
; j++) {

337 
E¡ôy
* 
Ÿhî
 = 
ítôõs_⁄_ãam
[
i
].
ítôõs
[
j
];

339 if(
Ÿhî
->
ãam
 !
ítôy
->ãam && othî->
ª•⁄£
 =
RESPONSE_HOSTILE
) {

340 
di°™˚
 = 
	`V3Mag
(
	`V3Sub
(
ítôy
->
å™sf‹m
.
posôi⁄
, 
Ÿhî
->transform.position));

341 if(
di°™˚
 < 
˛o£°_di°™˚
) {

342 
˛o£°_di°™˚
 = 
di°™˚
;

343 
˛o£°_èrgë
 = 
Ÿhî
->
å™sf‹m
.
posôi⁄
;

350 
Vec3
 
dú
 = 
	`V3N‹m
(
	`V3Sub
(
˛o£°_èrgë
, 
ítôy
->
å™sf‹m
.
posôi⁄
));

351 
ítôy
->
å™sf‹m
.
posôi⁄
 = 
	`V3Add
(entity->transform.position,

352 
	`V3MulF
(
dú
, 
ítôy
->
•ìd
*ítôy->
ac˚Àøti⁄
));

355 if(
ítôy
->
¥›îtõs
 & 
ENTITY_PROPERTY_PœyîC⁄åﬁÀd
) {

356 
boﬁ
 
up
 = 
öput
->
buâ⁄s
[
WIN32_BUTTON_W
].
hñd
;

357 
boﬁ
 
down
 = 
öput
->
buâ⁄s
[
WIN32_BUTTON_S
].
hñd
;

358 
boﬁ
 
À·
 = 
öput
->
buâ⁄s
[
WIN32_BUTTON_A
].
hñd
;

359 
boﬁ
 
right
 = 
öput
->
buâ⁄s
[
WIN32_BUTTON_D
].
hñd
;

361 
sˇÀ_Á˘‹
 = 
	`V3Mag
(
ítôy
->
å™sf‹m
.
sˇÀ
) * 1000.0f;

362 if(
up
Ë
ítôy
->
å™sf‹m
.
posôi⁄
.
y
 +0.2‡* 
sˇÀ_Á˘‹
;

363 if(
down
Ë
ítôy
->
å™sf‹m
.
posôi⁄
.
y
 -0.2‡* 
sˇÀ_Á˘‹
;

364 if(
À·
Ë
ítôy
->
å™sf‹m
.
posôi⁄
.
x
 -0.2‡* 
sˇÀ_Á˘‹
;

365 if(
right
Ë
ítôy
->
å™sf‹m
.
posôi⁄
.
x
 +0.2‡* 
sˇÀ_Á˘‹
;

369 if(
ítôy
->
¥›îtõs
 & 
ENTITY_PROPERTY_E¡ôyS∑w√r
) {

370 
S∑w√rInfo
* 
öfo
 = &
ítôy
->
•aw√r_öfo
;

371 if(
öfo
->
•awn_id
 >öfo->
•awn_cou¡
) {

372 
ítôõs_to_ªÀa£
[
ªÀa£_cou¡
++] = 
ítôy
;

375 if(
öfo
->
cuºít_dñè
 >öfo->
dñè_times
[öfo->
•awn_id
]) {

377 
S∑wnInfo
* 
œ°
 = 
ítôõs_to_•awn
;

378 if(!
ítôõs_to_•awn
Ë
œ°
 =É¡ôõs_to_•aw¿
	`PushSåu˘CÀ¨
(
game_°©e
->
‰ame_¨ía
, 
S∑wnInfo
);

380 
S∑wnInfo
* 
œ°_node
 = 
ítôõs_to_•awn
;

381 
œ°_node
->
√xt
)Üast_node =Üast_node->next;

383 
œ°
 = 
œ°_node
->
√xt
 = 
	`PushSåu˘CÀ¨
(
game_°©e
->
‰ame_¨ía
, 
S∑wnInfo
);

385 
œ°
->
ty≥
 = 
öfo
->
ítôy_ty≥s
[öfo->
•awn_id
];

386 
œ°
->
å™sf‹m
 = 
öfo
->
å™sf‹ms
[öfo->
•awn_id
];

387 
öfo
->
cuºít_dñè
 = 0;

388 
öfo
->
•awn_id
++;

391 
öfo
->
cuºít_dñè
 +
game_°©e
->
timî
.
‰ame_time
;

394 if(
ítôy
->
¥›îtõs
 & 
ENTITY_PROPERTY_Mesh
) {

395 
ítôy
->
mesh_pùñöe
.
öfo
 = 
	`PushSåu˘CÀ¨
(
blob
->
‰ame_¨ía
, 
MeshInfo
);

396 
ítôy
->
mesh_pùñöe
.
öfo
->
modñ
 = 
	`MakeTønsf‹mM©rix
”¡ôy->
å™sf‹m
);

397 
ítôy
->
mesh_pùñöe
.
öfo
->
cﬁ‹
 = 
	`V4FromV3
(
WHITE
, 1.0f);

398 
	`PushMeshPùñöe
(
ítôy
->
mesh_pùñöe
, 
game_°©e
->
mesh_ªndîî
);

401 if(
ítôy
->
¥›îtõs
 & 
ENTITY_PROPERTY_TextuªdQuad
) {

402 
	`PushTextuªdQuad
(&
ítôy
->
ãxtuªd_quad
.
quad
,

403 
ítôy
->
ãxtuªd_quad
.
ãxtuª
, 
game_°©e
->
quad_ªndîî
);

406 if(
ítôy
->
¥›îtõs
 & 
ENTITY_PROPERTY_HasHó…h
) {

407 if(
ítôy
->
hó…h
 <= 0) {

408 
ítôõs_to_ªÀa£
[
ªÀa£_cou¡
++] = 
ítôy
;

410 if(
ítôy
->
¥›îtõs
 & 
ENTITY_PROPERTY_S∑wnsP¨ti˛eSy°em
) {

412 
S∑wnInfo
* 
œ°
 = 
ítôõs_to_•awn
;

413 if(!
ítôõs_to_•awn
Ë
œ°
 =É¡ôõs_to_•aw¿
	`PushSåu˘CÀ¨
(
game_°©e
->
‰ame_¨ía
, 
S∑wnInfo
);

415 
S∑wnInfo
* 
œ°_node
 = 
ítôõs_to_•awn
;

416 
œ°_node
->
√xt
)Üast_node =Üast_node->next;

418 
œ°
 = 
œ°_node
->
√xt
 = 
	`PushSåu˘CÀ¨
(
game_°©e
->
‰ame_¨ía
, 
S∑wnInfo
);

420 
œ°
->
ty≥
 = 
ENTITY_FAB_PARTICLE_SYSTEM
;

421 
œ°
->
∑πi˛e_sy°em
 = 
ítôy
->particle_system;

422 
œ°
->
∑πi˛e_sy°em
.
•awn_posôi⁄
 = 
ítôy
->
å™sf‹m
.
posôi⁄
;

429 if(
ítôy
->
¥›îtõs
 & 
ENTITY_PROPERTY_HasP¨ti˛eSy°em
) {

430 
P¨ti˛eSy°em
* 
∑πi˛es
 = &
ítôy
->
∑πi˛e_sy°em
;

431 if(
∑πi˛es
->
cuºít_time
 >∑πi˛es->
li„_time
) {

432 
ítôõs_to_ªÀa£
[
ªÀa£_cou¡
++] = 
ítôy
;

435 if(!
∑πi˛es
->
öô
) {

436 
∑πi˛es
->
öô
 = 
åue
;

437 
u8
 
i
=0; i<
∑πi˛es
->
∑πi˛e_cou¡
; i++) {

438 
Vec3
 
øndom_dú
 = 
	`V3N‹m
(
	`V3
(
	`ønd
(),Ñand(), 0));

439 
øndom_di•_1
 = 
	`ønd
() % (50+1 + 50) - 50;

440 
øndom_di•_2
 = 
	`ønd
() % (50+1 + 50) - 50;

441 
Vec3
 
øndom_di•
 = 
	`V3
(
øndom_di•_1
, 
øndom_di•_2
, 
∑πi˛es
->
•awn_posôi⁄
.
z
);

442 
∑πi˛es
->
föÆ_posôi⁄s
[
i
] = 
	`V3Add
(
	`V3Mul
(
øndom_dú
, 
øndom_di•
),

443 
∑πi˛es
->
•awn_posôi⁄
);

447 
u8
 
i
=0; i<
∑πi˛es
->
∑πi˛e_cou¡
; i++) {

448 
t
 = 
∑πi˛es
->
cuºít_time
;

449 
d
 = 
∑πi˛es
->
li„_time
;

451 
bx
 = 
∑πi˛es
->
•awn_posôi⁄
.
x
;

452 
cx
 = 
∑πi˛es
->
föÆ_posôi⁄s
[
i
].
x
 - 
bx
;

454 
by
 = 
∑πi˛es
->
•awn_posôi⁄
.
y
;

455 
cy
 = 
∑πi˛es
->
föÆ_posôi⁄s
[
i
].
y
 - 
by
;

457 
bz
 = 
∑πi˛es
->
•awn_posôi⁄
.
z
;

458 
cz
 = 
∑πi˛es
->
föÆ_posôi⁄s
[
i
].
z
 - 
bz
;

460 
∑πi˛es
->
cuºít_posôi⁄s
[
i
].
x
 = 
	`Ea£SöeOut
(
t
, 
bx
, 
cx
, 
d
);

461 
∑πi˛es
->
cuºít_posôi⁄s
[
i
].
y
 = 
	`Ea£SöeOut
(
t
, 
by
, 
cy
, 
d
);

462 
∑πi˛es
->
cuºít_posôi⁄s
[
i
].
z
 = 
	`Ea£SöeOut
(
t
, 
bz
, 
cz
, 
d
);

464 
Vec3
 
dú
 = 
	`V3N‹m
(
	`V3Sub
(
∑πi˛es
->
cuºít_posôi⁄s
[
i
],Ö¨ti˛es->
•awn_posôi⁄
));

465 
Àngth
 = 5.0f;

466 
thick√ss
 = 5.0f;

467 
Löe
 
löe
 = {};

468 
löe
.
°¨t
 = 
∑πi˛es
->
cuºít_posôi⁄s
[
i
];

469 
löe
.
íd
 = 
	`V3Add
÷öe.
°¨t
, 
	`V3MulF
(
dú
, 
Àngth
));

471 
Vec3
 
löe_unô_ve˘‹
 = 
	`V3N‹m
(
	`V3Sub
(
löe
.
íd
,Üöe.
°¨t
));

472 
Vec3
 
ˇmîa_f‹w¨d
 = 
	`GëF‹w¨dVe˘‹
(
game_°©e
->
ˇmîa
->
rŸ©i⁄
);

473 
Vec3
 
≥Ω
 = 
	`V3Cross
(
ˇmîa_f‹w¨d
, 
löe_unô_ve˘‹
);

475 
Quad
 
quad
 = 
	`MakeQuadFromLöe
(&
löe
, 
thick√ss
, 
≥Ω
);

476 
	`PushP¨ti˛eQuad
(&
quad
, 
∑πi˛es
->
ãxtuªs
[
i
], 
game_°©e
->
quad_ªndîî
);

479 
∑πi˛es
->
cuºít_time
 +
game_°©e
->
timî
.
‰ame_time
;

484 if(
ítôy
->
¥›îtõs
 & 
ENTITY_PROPERTY_BoundögBox
) {

485 
ítôy
->
bb_obje˘_•a˚
 = 
	`Upd©eBoundögBox
(&ítôy->
bb_mesh_•a˚
, &ítôy->
å™sf‹m
);

486 #ifde‡
DEBUG_BOUNDING_BOX


487 
Vec3
 
mö
 = 
ítôy
->
bb_obje˘_•a˚
.min;

488 
Vec3
 
max
 = 
ítôy
->
bb_obje˘_•a˚
.max;

489 
Löe
 
l1
 = { 
	`V3
(
mö
.
x
, mö.
y
, mö.
z
), V3(mö.x, 
max
.y, min.z) };

490 
Löe
 
l2
 = { 
	`V3
(
mö
.
x
, mö.
y
, 
max
.
z
), V3(min.x, max.y, max.z) };

491 
Löe
 
l3
 = { 
	`V3
(
max
.
x
, 
mö
.
y
, mö.
z
), V3(max.x, max.y, min.z) };

492 
Löe
 
l4
 = { 
	`V3
(
max
.
x
, 
mö
.
y
, max.
z
), V3(max.x, max.y, max.z) };

493 
Löe
 
l5
 = { 
	`V3
(
mö
.
x
, mö.
y
, mö.
z
), V3(
max
.x, min.y, min.z) };

494 
Löe
 
l6
 = { 
	`V3
(
mö
.
x
, mö.
y
, 
max
.
z
), V3(max.x, min.y, max.z) };

495 
Löe
 
l7
 = { 
	`V3
(
mö
.
x
, 
max
.
y
, mö.
z
), V3(max.x, max.y, min.z) };

496 
Löe
 
l8
 = { 
	`V3
(
mö
.
x
, 
max
.
y
, max.
z
), V3(max.x, max.y, max.z) };

497 
Löe
 
l9
 = { 
	`V3
(
mö
.
x
, mö.
y
, mö.
z
), V3(mö.x, mö.y, 
max
.z) };

498 
Löe
 
l10
 = { 
	`V3
(
mö
.
x
, 
max
.
y
, mö.
z
), V3(min.x, max.y, max.z) };

499 
Löe
 
l11
 = { 
	`V3
(
max
.
x
, 
mö
.
y
, mö.
z
), V3(max.x, min.y, max.z) };

500 
Löe
 
l12
 = { 
	`V3
(
max
.
x
, max.
y
, 
mö
.
z
), V3(max.x, max.y, max.z) };

501 
	`PushRídîLöe
(&
l1
, 
	`V4FromV3
(
YELLOW
, 1.0f), 2.0f, 
game_°©e
->
ˇmîa
, game_°©e->
quad_ªndîî
);

502 
	`PushRídîLöe
(&
l2
, 
	`V4FromV3
(
BLUE
, 1.0f), 2.0f, 
game_°©e
->
ˇmîa
, game_°©e->
quad_ªndîî
);

503 
	`PushRídîLöe
(&
l3
, 
	`V4FromV3
(
RED
, 1.0f), 2.0f, 
game_°©e
->
ˇmîa
, game_°©e->
quad_ªndîî
);

504 
	`PushRídîLöe
(&
l4
, 
	`V4FromV3
(
GREEN
, 1.0f), 2.0f, 
game_°©e
->
ˇmîa
, game_°©e->
quad_ªndîî
);

505 
	`PushRídîLöe
(&
l5
, 
	`V4FromV3
(
MAGENTA
, 1.0f), 2.0f, 
game_°©e
->
ˇmîa
, game_°©e->
quad_ªndîî
);

506 
	`PushRídîLöe
(&
l6
, 
	`V4FromV3
(
PURPLE
, 1.0f), 2.0f, 
game_°©e
->
ˇmîa
, game_°©e->
quad_ªndîî
);

507 
	`PushRídîLöe
(&
l7
, 
	`V4FromV3
(
TEAL
, 1.0f), 2.0f, 
game_°©e
->
ˇmîa
, game_°©e->
quad_ªndîî
);

508 
	`PushRídîLöe
(&
l8
, 
	`V4FromV3
(
GREY
, 1.0f), 2.0f, 
game_°©e
->
ˇmîa
, game_°©e->
quad_ªndîî
);

509 
	`PushRídîLöe
(&
l9
, 
	`V4FromV3
(
WHITE
, 1.0f), 2.0f, 
game_°©e
->
ˇmîa
, game_°©e->
quad_ªndîî
);

510 
	`PushRídîLöe
(&
l10
, 
	`V4FromV3
(
MAROON
, 1.0f), 2.0f, 
game_°©e
->
ˇmîa
, game_°©e->
quad_ªndîî
);

511 
	`PushRídîLöe
(&
l11
, 
	`V4FromV3
(
OLIVE
, 1.0f), 2.0f, 
game_°©e
->
ˇmîa
, game_°©e->
quad_ªndîî
);

512 
	`PushRídîLöe
(&
l12
, 
	`V4FromV3
(
CYAN
, 1.0f), 2.0f, 
game_°©e
->
ˇmîa
, game_°©e->
quad_ªndîî
);

515 
ítôy
 =É¡ôy->
√xt
;

518 
u32
 
i
=0; i<
ªÀa£_cou¡
; i++Ë
	`Rñó£E¡ôy
(
ítôõs_to_ªÀa£
[i], 
blob
);

519 
S∑wnInfo
* 
œ°
 = 
ítôõs_to_•awn
;

520 
œ°
) {

521 if(
œ°
->
ty≥
 =
ENTITY_FAB_MINE
)

522 
	`S∑wnMöe
(
œ°
->
å™sf‹m
, 
game_°©e
);

523 
œ°
 =Üa°->
√xt
;

525 
	}
}

	@simulation.h

1 
	eENTITIY_PROPERTY
 {

2 
	mENTITY_PROPERTY_Mesh
 = 1<<0,

3 
	mENTITY_PROPERTY_TextuªdQuad
 = 1<<1,

4 
	mENTITY_PROPERTY_SpöInPœ˚
 = 1<<2,

5 
	mENTITY_PROPERTY_PœyîC⁄åﬁÀd
 = 1<<3,

6 
	mENTITY_PROPERTY_BoundögBox
 = 1<<4,

7 
	mENTITY_PROPERTY_MovabÀ
 = 1<<5,

8 
	mENTITY_PROPERTY_Sim∂eCha£
 = 1<<6,

9 
	mENTITY_PROPERTY_HasHó…h
 = 1<<7,

10 
	mENTITY_PROPERTY_DólsCﬁlisi⁄Damage
 = 1<<8,

11 
	mENTITY_PROPERTY_TakesCﬁlisi⁄Damage
 = 1<<9,

12 
	mENTITY_PROPERTY_LevñBound¨y
 = 1<<10,

13 
	mENTITY_PROPERTY_E¡ôyS∑w√r
 = 1<<11,

14 
	mENTITY_PROPERTY_S∑wnsP¨ti˛eSy°em
 = 1<<12,

15 
	mENTITY_PROPERTY_HasP¨ti˛eSy°em
 = 1<<13,

16 
	mENTITY_PROPERTY_TOTAL


18 
	eDEV_MODE
 {

19 
	mDEV_MODE_PAUSED
 = 0x1,

22 
	eAXIS
 { 
	mAXIS_X
, 
	mAXIS_Y
, 
	mAXIS_Z
 };

23 
	eTEAM
 { 
	mTEAM_NONE
, 
	mTEAM_PLAYER
, 
	mTEAM_ENEMY
, 
	mTEAM_TOTAL
 };

24 
	eRESPONSE
 { 
	mRESPONSE_NONE
, 
	mRESPONSE_DEFENSIVE
, 
	mRESPONSE_HOSTILE
 };

25 
	eBOUNDING_BOX_ORIENTATION
 { 
	mBOUNDING_BOX_ORIENTATION_NORMAL
, 
	mBOUNDING_BOX_ORIENTATION_INVERSE
 };

26 
	eENTITY_FAB
 { 
	mENTITY_FAB_MINE
, 
	mENTITY_FAB_PARTICLE_SYSTEM
, 
	mENTITY_FAB_TOTAL
 };

28 
	sBoundögBox
 {

29 
Vec3
 
	mmö
;

30 
Vec3
 
	mmax
;

31 
Vec3
 
	msize
;

34 
	#MAX_SPAWNS
 20

	)

35 
	sS∑w√rInfo
 {

36 
Tønsf‹m
 
	må™sf‹ms
[
MAX_SPAWNS
];

37 
u8
 
	mítôy_ty≥s
[
MAX_SPAWNS
];

38 
	mdñè_times
[
MAX_SPAWNS
];

39 
u8
 
	m•awn_cou¡
;

41 
u8
 
	m•awn_id
;

42 
	mcuºít_dñè
;

45 
	#MAX_PARTICLES
 10

	)

46 
	sP¨ti˛eSy°em
 {

47 
TextuªBuf„r
* 
	mãxtuªs
[
MAX_PARTICLES
];

48 
u32
 
	mãxtuª_cou¡
;

50 
u32
 
	m∑πi˛e_cou¡
;

52 
	mli„_time
;

54 
Vec3
 
	möôül_size
;

55 
Vec3
 
	mföÆ_size
;

57 
Vec3
 
	mcuºít_posôi⁄s
[
MAX_PARTICLES
];

58 
Vec3
 
	mföÆ_posôi⁄s
[
MAX_PARTICLES
];

59 
Vec3
 
	m•awn_posôi⁄
;

60 
	mcuºít_time
;

61 
boﬁ
 
	möô
;

64 
	sS∑wnInfo
 {

65 
u8
 
	mty≥
;

66 
Tønsf‹m
 
	må™sf‹m
;

67 
P¨ti˛eSy°em
 
	m∑πi˛e_sy°em
;

68 
S∑wnInfo
* 
	m√xt
;

71 
	sE¡ôy
 {

72 
E¡ôy
* 
	m√xt
;

73 
E¡ôy
* 
	m¥ev
;

75 
u64
 
	m¥›îtõs
;

77 
u8
 
	mãam
;

78 
u8
 
	mª•⁄£
;

80 
Tønsf‹m
 
	må™sf‹m
;

81 
MeshPùñöe
 
	mmesh_pùñöe
;

82 
TextuªdQuad
 
	mãxtuªd_quad
;

84 
u8
 
	m•ö_axis
;

85 
	m•ö_amou¡
;

87 
BoundögBox
 
	mbb_mesh_•a˚
;

88 
BoundögBox
 
	mbb_obje˘_•a˚
;

89 
u8
 
	mbb_‹õ¡©i⁄
;

91 
Vec3
 
	mcha£_èrgë
;

92 
	m•ìd
;

93 
	mac˚Àøti⁄
;

95 
i32
 
	mhó…h
;

96 
u32
 
	m©èck_damage
;

97 
u32
 
	mdamage_ªdu˘i⁄
;

99 
S∑w√rInfo
 
	m•aw√r_öfo
;

101 
P¨ti˛eSy°em
 
	m∑πi˛e_sy°em
;

104 
	#MAX_ENTITIES
 200

	)

105 
	sE¡ôyBlob
 {

106 
Mem‹yAª«
* 
	m≥rm™ít_¨ía
;

107 
Mem‹yAª«
* 
	m‰ame_¨ía
;

109 
E¡ôy
* 
	mítôõs
;

110 
E¡ôy
* 
	mfú°_‰ì
;

111 
u32
 
	mítôy_cou¡
;

	@tetra.cpp

1 
	#MAX_TETRA
 10

	)

3 
	sTëø
 {

4 
Tønsf‹m
 
	må™sf‹m
[
MAX_TETRA
];

5 
Vec4
 
	mcﬁ‹
[
MAX_TETRA
];

6 
u32
 
	mcou¡
;

8 
MeshInfo
 
	möfo
[
MAX_TETRA
];

9 
RídîBuf„rGroup
* 
	mvîãx_buf„rs
;

12 
Tëø
*

13 
	$InôTëø
(
Rídîî
* 
ªndîî
, 
Mem‹yAª«
* 
¨ía
) {

14 
Tëø
* 
ªsu…
 = 
	`PushSåu˘
(
¨ía
, Tetra);

16 
Vec3
* 
vîti˚s
 = 
	`PushAºay
(&
ªndîî
->
å™sõ¡
, Vec3, 12);

17 
Vec3
* 
n‹mÆs
 = 
	`PushAºay
(&
ªndîî
->
å™sõ¡
, Vec3, 12);

19 
	`Gíî©eTëøhedr⁄
(
vîti˚s
);

20 
	`Gíî©eFœtShadedN‹mÆs
(
vîti˚s
, 12, 
n‹mÆs
);

22 
VîãxBuf„rD©a
 
vbd
[] = { { 
vîti˚s
, 
VERTEX_BUFFER_POSITION
 },

23 
n‹mÆs
, 
VERTEX_BUFFER_NORMAL
 };

25 
MeshD©a
 
mesh_d©a
 = {};

26 
mesh_d©a
.
vb_d©a
 = 
vbd
;

27 
mesh_d©a
.
vb_d©a_cou¡
 = 
	`AºayCou¡
(
vbd
);

28 
mesh_d©a
.
vîti˚s_cou¡
 = 12;

30 
ªsu…
->
vîãx_buf„rs
 = 
	`U∂ﬂdMesh
(&
mesh_d©a
, 
nuŒ±r
, 
ªndîî
);

31  
ªsu…
;

32 
	}
}

35 
	$•aw¡ëø
(
ãåa
*Åëø, 
å™sf‹m
Åønsf‹m, 
vec4
 
cﬁ‹
) {

36 
ãåa
->
å™sf‹m
[ãåa->
cou¡
] =Åransform;

37 
ãåa
->
cﬁ‹
[ãåa->
cou¡
] = color;

38 
ãåa
->
cou¡
++;

39 
	}
}

42 
	$gíî©ëëøöfo
(
ãåa
*Åetra) {

43 
u32
 
i
=0; i<
ãåa
->
cou¡
; i++) {

44 
ãåa
->
öfo
[
i
].
modñ
 = 
	`makëønsf‹mm©rix
—ëø->
å™sf‹m
[i]);

45 
ãåa
->
öfo
[
i
].
cﬁ‹
 =Åetra->color[i];

47 
	}
}

50 
	$Upd©eTëø
(
Tëø
* 
ãåa
) {

51 
u32
 
i
=0;

52 
i
=0; i<
ãåa
->
cou¡
; i++) {

53 
ãåa
->
å™sf‹m
[
i
].
rŸ©i⁄
 = 
	`Qu©Mul
(
	`Qu©FromEuÀr
((i+1)*0.01, 0.0f, 0.0f),Åetra->transform[i].rotation);

55 
	}
};

58 
	$RídîTëø
(
Tëø
* 
ãåa
, 
MeshRídîî
* 
mesh_ªndîî
) {

59 
MeshPùñöe
 
mesh_pùñöe
 = {};

60 
mesh_pùñöe
.
vîãx_buf„rs
 = 
ãåa
->vertex_buffers;;

61 
mesh_pùñöe
.
ö°™˚_d©a
 = (*)
ãåa
->
öfo
;

62 
mesh_pùñöe
.
ö°™˚_cou¡
 = 
ãåa
->
cou¡
;

63 
	`PushMeshPùñöe
(
mesh_pùñöe
, 
mesh_ªndîî
);

64 
	}
}

	@timer.h

1 
	sTimî
 {

2 
	mªÆ_time
;

3 
	m‰ame_time
;

	@ui_renderer.cpp

1 
	#MAX_UI_ELEMENTS
 100

	)

2 
	#OVERLAY_FONT_SIZE
 30.0f

	)

3 
	#BUTTON_FONT_SIZE
 30.0f

	)

5 
	eUI_FAB
 {

6 
	mUI_FAB_Buâ⁄
,

7 
	mUI_FAB_Text
,

8 
	mUI_FAB_Ovîœy
,

11 
	sUID©a
 {

12 
Vec2
 
	mmö
;

13 
Vec2
 
	mmax
;

14 
Vec4
 
	mcﬁ‹s
[4];

17 
	eUI_FLAG
 {

18 
	mUI_FLAG_Hovî
 = 1<<1,

19 
	mUI_FLAG_Pªss
 = 1<<2,

20 
	mUI_FLAG_MovabÀ
 = 1<<3,

21 
	mUI_FLAG_Text
 = 1<<4,

24 
	sUIDimísi⁄
 {

25 
Vec2
 
	mmö
;

26 
Vec2
 
	mmax
;

29 
	sUIEÀmít
 {

30 
u64
 
	mÊags
;

31 
u32
 
	mid
;

33 
UIEÀmít
* 
	m√xt
;

34 
UIEÀmít
* 
	mchûd
;

36 
UIDimísi⁄
 
	mdimísi⁄
;

38 
Vec4
 
	m¥im¨y_cﬁ‹
[2];

39 
Vec4
 
	m£c⁄d¨y_cﬁ‹
[2];

40 
Vec4
 
	mãπüry_cﬁ‹
[2];

42 
boﬁ
 
	m¥es£d
;

44 ** 
	mãxt
;

45 
u8
 
	mf⁄t_size
;

46 
u8
 
	mãxt_cou¡
;

49 
	sUICachedD©a
 {

50 
UICachedD©a
* 
	m√xt
;

52 
u32
 
	mñemít_id
;

53 
UIDimísi⁄
 
	mdimísi⁄
;

54 
boﬁ
 
	m¥es£d
;

57 
	sUIRídîî
 {

58 
UID©a
* 
	md©a
;

59 
UIEÀmít
* 
	mñemíts
;

60 
u32
 
	mñemít_cou¡î
;

62 
UICachedD©a
* 
	mˇched_d©a
;

64 
Såu˘uªdBuf„r
* 
	msb
;

65 
VîãxShadî
* 
	mvs
;

66 
PixñShadî
* 
	mps
;

68 
Vec2
 
	ms¸ìn_ªsﬁuti⁄
;

70 
Mem‹yAª«
* 
	mˇche_¨ía
;

71 
Temp‹¨yMem‹y
 
	mˇche_¨ía_ãmp
;

73 
Mem‹yAª«
* 
	m‰ame_¨ía
;

74 
TextUI
* 
	mãxt_ui
;

77 
UIEÀmít
*

78 
	$AŒoˇãUIEÀmíts
(
UI_FAB
 
Áb
, 
UIRídîî
* 
ui_ªndîî
) {

79 
UIEÀmít
* 
ªsu…
 = 
	`PushSåu˘CÀ¨
(
ui_ªndîî
->
‰ame_¨ía
, UIElement);

80 
ªsu…
->
id
 = 
ui_ªndîî
->
ñemít_cou¡î
++;

82 
Áb
) {

83 
UI_FAB_Text
: {

84 
ªsu…
->
Êags
 |
UI_FLAG_Text
;

85 
ªsu…
->
√xt
 = 0;

86 
ªsu…
->
chûd
 = 0;

89 
UI_FAB_Buâ⁄
: {

90 
ªsu…
->
Êags
 |
UI_FLAG_Hovî
;

91 
ªsu…
->
Êags
 |
UI_FLAG_Pªss
;

93 
ªsu…
->
√xt
 = 0;

94 
ªsu…
->
chûd
 = 
	`AŒoˇãUIEÀmíts
(
UI_FAB_Text
, 
ui_ªndîî
);

97 
UI_FAB_Ovîœy
: {

98 
ªsu…
->
Êags
 |
UI_FLAG_MovabÀ
;

100 
ªsu…
->
√xt
 = 0;

101 
ªsu…
->
chûd
 = 
	`AŒoˇãUIEÀmíts
(
UI_FAB_Text
, 
ui_ªndîî
);

105  
ªsu…
;

106 
	}
}

109 
	$PushUIEÀmít
(
UIEÀmít
* 
ñemít
, 
UIRídîî
* 
ui_ªndîî
) {

110 
UIEÀmít
* 
node
 = 
ui_ªndîî
->
ñemíts
;

111 if(
node
) {

112 
node
->
√xt
)Çode =Çode->next;

113 
node
->
√xt
 = 
ñemít
;

115 
ui_ªndîî
->
ñemíts
 = 
ñemít
;

116 
	}
}

119 
	$CacheUID©a
(
UIEÀmít
* 
ñemít
, 
UIRídîî
* 
ui_ªndîî
) {

120 
UICachedD©a
* 
ˇched_d©a
 = 
	`PushSåu˘
(
ui_ªndîî
->
ˇche_¨ía
, UICachedData);

121 
ˇched_d©a
->
ñemít_id
 = 
ñemít
->
id
;

122 
ˇched_d©a
->
dimísi⁄
 = 
ñemít
->dimension;

123 
ˇched_d©a
->
¥es£d
 = 
ñemít
->pressed;

124 
ˇched_d©a
->
√xt
 = 0;

126 if(!
ui_ªndîî
->
ˇched_d©a
) ui_renderer->cached_data = cached_data;

128 
UICachedD©a
* 
node
 = 
ui_ªndîî
->
ˇched_d©a
;

129 
node
->
√xt
)Çode =Çode->next;

130 
node
->
√xt
 = 
ˇched_d©a
;

132 
	}
}

134 
UICachedD©a
*

135 
	$GëCachedEÀmítD©a
(
u32
 
id
, 
UIRídîî
* 
ui_ªndîî
) {

136 if(!
ui_ªndîî
->
ˇched_d©a
)  0;

137 
UICachedD©a
* 
node
 = 
ui_ªndîî
->
ˇched_d©a
;

138 
node
) {

139 if(
node
->
ñemít_id
 =
id
) Çode;

140 
node
 =Çode->
√xt
;

143 
	}
}

146 
	$PushUIOvîœy
(** 
ãxt
, 
u8
 
ãxt_cou¡
, 
Vec2
 
s•
, 
UIRídîî
* 
ui_ªndîî
) {

147 
UIEÀmít
* 
ovîœy
 = 
	`AŒoˇãUIEÀmíts
(
UI_FAB_Ovîœy
, 
ui_ªndîî
);

148 
UICachedD©a
* 
ˇched_d©a
 = 
	`GëCachedEÀmítD©a
(
ovîœy
->
id
, 
ui_ªndîî
);

149 if(
ˇched_d©a
Ë
s•
 = cached_d©a->
dimísi⁄
.
mö
;

151 
UIDimísi⁄
 
ãxt_dim
 = {};

152 
Vec2
 
ovîœy_size
 = 
	`V2
(0.1f, 0.1f);

153 
f⁄t_size
 = 
OVERLAY_FONT_SIZE
;

154 
Vec2
 
ãxt_loc_mö
;

156 
ãxt_loc_mö
.
x
 = 
s•
.x + 
ovîœy_size
.x*0.01f;

157 
ãxt_loc_mö
.
y
 = 
s•
.y + 
ovîœy_size
.y*0.01f;

159 
ãxt_dim
.
mö
 = 
	`V2
(0.01f, 0.01f);

160 
ãxt_dim
.
max
 = 
	`V2
(0.9f, 0.9f);

162 
ovîœy
->
dimísi⁄
.
mö
 = 
s•
;

163 
max_pixñ_width
 = 0;

164 
ss_f⁄t_height
 = 
f⁄t_size
/
ui_ªndîî
->
s¸ìn_ªsﬁuti⁄
.
y
;

165 
u8
 
i
=0; i<
ãxt_cou¡
; i++) {

166 
pixñ_width
 = 
	`GëPixñWidthF‹Text
(
ãxt
[
i
], 
f⁄t_size
, 
ui_ªndîî
->
ãxt_ui
);

167 
max_pixñ_width
 = 
	`Max
(max_pixñ_width, 
pixñ_width
);

169 
ss_height
 = 
ss_f⁄t_height
 * 
ãxt_cou¡
;

170 
ss_width
 = 
max_pixñ_width
/
ui_ªndîî
->
s¸ìn_ªsﬁuti⁄
.
x
;

172 
Vec2
 
ãxt_loc_max
;

173 
ãxt_loc_max
.
x
 = 
ãxt_loc_mö
.x + 
ss_width
;

174 
ãxt_loc_max
.
y
 = 
ãxt_loc_mö
.y + 
ss_height
;

176 
ovîœy
->
dimísi⁄
.
max
.
x
 = 
ãxt_loc_max
.x + 
ovîœy_size
.x*0.1f;

177 
ovîœy
->
dimísi⁄
.
max
.
y
 = 
ãxt_loc_max
.y + 
ovîœy_size
.y*0.1f;

179 
ovîœy
->
¥im¨y_cﬁ‹
[0] = 
	`V4FromV3
(
JET
, 0.8f);

180 
ovîœy
->
¥im¨y_cﬁ‹
[1] = 
	`V4FromV3
(
JET
, 0.6f);

181 
ovîœy
->
£c⁄d¨y_cﬁ‹
[0] = 
	`V4FromV3
(
JET
, 0.8f);

182 
ovîœy
->
£c⁄d¨y_cﬁ‹
[1] = 
	`V4FromV3
(
JET
, 0.6f);

183 
ovîœy
->
ãπüry_cﬁ‹
[0] = 
	`V4FromV3
(
JET
, 0.8f);

184 
ovîœy
->
ãπüry_cﬁ‹
[1] = 
	`V4FromV3
(
JET
, 0.6f);

186 
ovîœy
->
chûd
->
dimísi⁄
 = 
ãxt_dim
;

187 
ovîœy
->
chûd
->
ãxt
 =Åext;

188 
ovîœy
->
chûd
->
ãxt_cou¡
 =Åext_count;

189 
ovîœy
->
chûd
->
f⁄t_size

OVERLAY_FONT_SIZE
;

190 
ovîœy
->
chûd
->
¥im¨y_cﬁ‹
[0] = 
	`V4Z
();

191 
ovîœy
->
chûd
->
¥im¨y_cﬁ‹
[1] = 
	`V4Z
();

193 
	`PushUIEÀmít
(
ovîœy
, 
ui_ªndîî
);

194 
	}
}

196 
boﬁ


197 
	$PushUIBuâ⁄
(** 
ãxt
, 
Vec2
 
s•
, 
UIRídîî
* 
ui_ªndîî
) {

198 
	`As£π
(
	`InR™geMöMaxInc
(
s•
.
x
, 0, 1));

199 
	`As£π
(
	`InR™geMöMaxInc
(
s•
.
y
, 0, 1));

200 
boﬁ
 
¥es£d
 = 
Ál£
;

202 
UIEÀmít
* 
buâ⁄
 = 
	`AŒoˇãUIEÀmíts
(
UI_FAB_Buâ⁄
, 
ui_ªndîî
);

203 
UICachedD©a
* 
ˇched_d©a
 = 
	`GëCachedEÀmítD©a
(
buâ⁄
->
id
, 
ui_ªndîî
);

204 if(
ˇched_d©a
Ë
¥es£d
 = cached_data->pressed;

206 
UIDimísi⁄
 
ãxt_dim
 = {};

207 
Vec2
 
buâ⁄_size
 = 
	`V2
(0.1f, 0.1f);

208 
f⁄t_size
 = 
BUTTON_FONT_SIZE
;

209 
Vec2
 
ãxt_loc_mö
;

211 
ãxt_loc_mö
.
x
 = 
s•
.x + 
buâ⁄_size
.x*0.25f;

212 
ãxt_loc_mö
.
y
 = 
s•
.y + 
buâ⁄_size
.y*0.25f;

214 
ãxt_dim
.
mö
 = 
	`V2
(0.25f, 0.25f);

215 
ãxt_dim
.
max
 = 
	`V2
(0.75f, 0.75f);

217 
buâ⁄
->
dimísi⁄
.
mö
 = 
s•
;

218 
pixñ_width
 = 
	`GëPixñWidthF‹Text
(
ãxt
[0], 
f⁄t_size
, 
ui_ªndîî
->
ãxt_ui
);

219 
ss_f⁄t_height
 = 
f⁄t_size
/
ui_ªndîî
->
s¸ìn_ªsﬁuti⁄
.
y
;

220 
ss_width
 = 
pixñ_width
/
ui_ªndîî
->
s¸ìn_ªsﬁuti⁄
.
x
;

222 
Vec2
 
ãxt_loc_max
;

223 
ãxt_loc_max
.
x
 = 
ãxt_loc_mö
.x + 
ss_width
;

224 
ãxt_loc_max
.
y
 = 
ãxt_loc_mö
.y + 
ss_f⁄t_height
;

226 
buâ⁄
->
dimísi⁄
.
max
.
x
 = 
ãxt_loc_max
.x + 
buâ⁄_size
.x*0.25f;

227 
buâ⁄
->
dimísi⁄
.
max
.
y
 = 
ãxt_loc_max
.y + 
buâ⁄_size
.y*0.25f;

229 
buâ⁄
->
¥im¨y_cﬁ‹
[0] = 
	`V4FromV3
(
JET
, 1.0f);

230 
buâ⁄
->
¥im¨y_cﬁ‹
[1] = 
	`V4FromV3
(
JET
, 1.0f);

232 
buâ⁄
->
£c⁄d¨y_cﬁ‹
[0] = 
	`V4FromV3
(
BLACK
, 1.0f);

233 
buâ⁄
->
£c⁄d¨y_cﬁ‹
[1] = 
	`V4FromV3
(
JET
, 1.0f);

235 
buâ⁄
->
ãπüry_cﬁ‹
[0] = 
	`V4FromV3
(
JET
, 1.0f);

236 
buâ⁄
->
ãπüry_cﬁ‹
[1] = 
	`V4FromV3
(
BLACK
, 1.0f);

238 
buâ⁄
->
chûd
->
dimísi⁄
 = 
ãxt_dim
;

239 
buâ⁄
->
chûd
->
ãxt
 =Åext;

240 
buâ⁄
->
chûd
->
ãxt_cou¡
 = 1;

241 
buâ⁄
->
chûd
->
f⁄t_size
 = 
BUTTON_FONT_SIZE
;

242 
buâ⁄
->
chûd
->
¥im¨y_cﬁ‹
[0] = 
	`V4Z
();

243 
buâ⁄
->
chûd
->
¥im¨y_cﬁ‹
[1] = 
	`V4Z
();

245 
	`PushUIEÀmít
(
buâ⁄
, 
ui_ªndîî
);

247  
¥es£d
;

248 
	}
}

251 
	$UIO≥øãEÀmít
(
Vec2
 
mou£_pos
, Vec2 
mou£_dñ
, 
boﬁ
 
hñd
, 
UIEÀmít
* 
ñemít
, UIEÀmít* 
∑ª¡
, 
UID©a
* 
d©a
, 
UIRídîî
* 
ui_ªndîî
) {

252 if(
∑ª¡
) {

253 
Vec2
 
size
 = 
	`V2Sub
(
∑ª¡
->
dimísi⁄
.
max
,Ö¨ít->dimísi⁄.
mö
);

254 
d©a
->
mö
 = 
	`V2Add
(
∑ª¡
->
dimísi⁄
.mö, 
	`V2Mul
(
ñemít
->dimísi⁄.mö, 
size
));

255 
d©a
->
max
 = 
	`V2Sub
(
∑ª¡
->
dimísi⁄
.max, 
	`V2Mul
(
ñemít
->dimísi⁄.
mö
, 
size
));

258 
d©a
->
mö
 = 
ñemít
->
dimísi⁄
.min;

259 
d©a
->
max
 = 
ñemít
->
dimísi⁄
.max;

261 
d©a
->
cﬁ‹s
[0] = 
ñemít
->
¥im¨y_cﬁ‹
[0];

262 
d©a
->
cﬁ‹s
[1] = 
ñemít
->
¥im¨y_cﬁ‹
[1];

263 
d©a
->
cﬁ‹s
[2] = 
ñemít
->
¥im¨y_cﬁ‹
[0];

264 
d©a
->
cﬁ‹s
[3] = 
ñemít
->
¥im¨y_cﬁ‹
[1];

266 
boﬁ
 
öside_quad
 = 
	`IsPoötInQuad
(
d©a
->
mö
, d©a->
max
, 
mou£_pos
);

268 if(
ñemít
->
Êags
 & 
UI_FLAG_Hovî
) {

269 if(
öside_quad
) {

270 
d©a
->
cﬁ‹s
[0] = 
ñemít
->
£c⁄d¨y_cﬁ‹
[0];

271 
d©a
->
cﬁ‹s
[1] = 
ñemít
->
£c⁄d¨y_cﬁ‹
[1];

272 
d©a
->
cﬁ‹s
[2] = 
ñemít
->
£c⁄d¨y_cﬁ‹
[0];

273 
d©a
->
cﬁ‹s
[3] = 
ñemít
->
£c⁄d¨y_cﬁ‹
[1];

277 if(
ñemít
->
Êags
 & 
UI_FLAG_Pªss
) {

278 if(
öside_quad
 && 
hñd
) {

279 
d©a
->
cﬁ‹s
[0] = 
ñemít
->
ãπüry_cﬁ‹
[0];

280 
d©a
->
cﬁ‹s
[1] = 
ñemít
->
ãπüry_cﬁ‹
[1];

281 
d©a
->
cﬁ‹s
[2] = 
ñemít
->
ãπüry_cﬁ‹
[0];

282 
d©a
->
cﬁ‹s
[3] = 
ñemít
->
ãπüry_cﬁ‹
[1];

284 
ñemít
->
¥es£d
 = 
åue
;

286 
	`CacheUID©a
(
ñemít
, 
ui_ªndîî
);

289 if(
ñemít
->
Êags
 & 
UI_FLAG_MovabÀ
) {

290 if(
öside_quad
 && 
hñd
) {

291 
d©a
->
mö
 = 
	`V2Add
(
mou£_dñ
, data->min);

292 
d©a
->
max
 = 
	`V2Add
(
mou£_dñ
, data->max);

293 
ñemít
->
dimísi⁄
.
mö
 = 
d©a
->min;

294 
ñemít
->
dimísi⁄
.
max
 = 
d©a
->max;

296 
	`CacheUID©a
(
ñemít
, 
ui_ªndîî
);

299 if(
ñemít
->
Êags
 & 
UI_FLAG_Text
) {

300 
f⁄t_size_ss
 = 
ñemít
->
f⁄t_size
 / 
ui_ªndîî
->
s¸ìn_ªsﬁuti⁄
.
y
;

301 
u8
 
i
=0; i<
ñemít
->
ãxt_cou¡
; i++) {

302 
Vec2
 
loc
 = 
	`V2
(
d©a
->
mö
.
x
, d©a->mö.
y
 + 
f⁄t_size_ss
*
i
);

303 
	`PushTextS¸ìnS∑˚
(
ñemít
->
ãxt
[
i
],ÉÀmít->
f⁄t_size
, 
loc
, 
ui_ªndîî
->
ãxt_ui
);

307 
	}
}

310 
	$CompûeUIShadîs
(
UIRídîî
* 
ui_ªndîî
, 
Rídîî
* 
ªndîî
) {

311 
ui_ªndîî
->
vs
 = 
	`U∂ﬂdVîãxShadî
(
UIShadî
, (UIShadî), "vsf", 0, 0, 
ªndîî
);

312 
ui_ªndîî
->
ps
 = 
	`U∂ﬂdPixñShadî
(
UIShadî
, (UIShadî), "psf", 
ªndîî
);

313 
	}
}

315 
UIRídîî
*

316 
	$InôUIRídîî
(
Rídîî
* 
ªndîî
, 
WödowDimísi⁄s
 
wd
, 
TextUI
* 
ãxt_ui
, 
Mem‹yAª«
* 
¨ía
, Mem‹yAª«* 
‰ame_¨ía
) {

317 
UIRídîî
* 
ªsu…
 = 
	`PushSåu˘CÀ¨
(
¨ía
, UIRenderer);

318 
ªsu…
->
‰ame_¨ía
 = frame_arena;

319 
ªsu…
->
ˇche_¨ía
 = (
Mem‹yAª«
*)
	`BoŸ°øpPushSize_
((MemoryArena), 0, 0);

320 
ªsu…
->
ãxt_ui
 =Åext_ui;

321 
ªsu…
->
s¸ìn_ªsﬁuti⁄
 = 
	`V2
(()
wd
.
width
, ()wd.
height
);

323 
	`CompûeUIShadîs
(
ªsu…
, 
ªndîî
);

325 
ªsu…
->
sb
 = 
	`U∂ﬂdSåu˘uªdBuf„r
((
UID©a
), 
MAX_UI_ELEMENTS
, 
ªndîî
);

327 
ªsu…
->
ˇche_¨ía_ãmp
 = 
	`BegöTemp‹¨yMem‹y
‘esu…->
ˇche_¨ía
);

328  
ªsu…
;

329 
	}
}

332 
	$UIRídîEÀmíts
(
UIRídîî
* 
ui_ªndîî
, 
Rídîî
* 
ªndîî
) {

334 
SëRídîT¨gë
* 
£t_ªndî_èrgë
 = 
	`PushRídîComm™d
(
ªndîî
, SetRenderTarget);

335 
£t_ªndî_èrgë
->
ªndî_èrgë
 = &
ªndîî
->
backbuf„r
;

337 
SëBÀndSèã
* 
£t_bÀnd_°©e
 = 
	`PushRídîComm™d
(
ªndîî
, SetBlendState);

338 
£t_bÀnd_°©e
->
ty≥
 = 
BLEND_STATE_Reguœr
;

340 
SëRa°îizîSèã
* 
§s
 = 
	`PushRídîComm™d
(
ªndîî
, SetRasterizerState);

342 
SëPrimôiveT›ﬁogy
* 
£t_t›ﬁogy
 = 
	`PushRídîComm™d
(
ªndîî
, SetPrimitiveTopology);

343 
£t_t›ﬁogy
->
ty≥
 = 
PRIMITIVE_TOPOLOGY_TrüngÀSåù
;

345 
SëVîãxShadî
* 
£t_vîãx_shadî
 = 
	`PushRídîComm™d
(
ªndîî
, SetVertexShader);

346 
£t_vîãx_shadî
->
vîãx
 = 
ui_ªndîî
->
vs
;

348 
SëPixñShadî
* 
£t_pixñ_shadî
 = 
	`PushRídîComm™d
(
ªndîî
, SetPixelShader);

349 
£t_pixñ_shadî
->
pixñ
 = 
ui_ªndîî
->
ps
;

351 
SëSåu˘uªdBuf„r
* 
£t_ui_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
, SetStructuredBuffer);

352 
£t_ui_buf„r
->
vîãx_shadî
 = 
åue
;

353 
£t_ui_buf„r
->
°ru˘uªd
 = 
ui_ªndîî
->
sb
;

354 
£t_ui_buf„r
->
¶Ÿ
 = 0;

356 
PushRídîBuf„rD©a
* 
push_ui_buf„r
 = 
	`PushRídîComm™d
(
ªndîî
,PushRenderBufferData);

357 
push_ui_buf„r
->
buf„r
 = 
ui_ªndîî
->
sb
->buffer;

358 
push_ui_buf„r
->
size
 = 
ui_ªndîî
->
ñemít_cou¡î
 * (
UID©a
);

359 
push_ui_buf„r
->
d©a
 = 
ui_ªndîî
->data;

361 
DøwIn°™˚d
* 
døw_ö°™˚d
 = 
	`PushRídîComm™d
(
ªndîî
, DrawInstanced);

362 
døw_ö°™˚d
->
vîti˚s_cou¡
 = 4;

363 
døw_ö°™˚d
->
ö°™˚_cou¡
 = 
ui_ªndîî
->
ñemít_cou¡î
;

365 
	}
}

368 
	$UIGíî©eD©a
(
I≈ut
* 
öput
, 
UIRídîî
* 
ui_ªndîî
) {

369 
	`EndTemp‹¨yMem‹y
(&
ui_ªndîî
->
ˇche_¨ía_ãmp
);

370 
ui_ªndîî
->
ˇche_¨ía_ãmp
 = 
	`BegöTemp‹¨yMem‹y
(ui_ªndîî->
ˇche_¨ía
);

371 
ui_ªndîî
->
ˇched_d©a
 = 0;

373 
Vec2
 
mou£_pos
 = *(Vec2*)&
öput
->
axes
[
WIN32_AXIS_MOUSE
];

374 
Vec2
 
mou£_dñ
 = *(Vec2*)&
öput
->
axes
[
WIN32_AXIS_MOUSE_DEL
];

375 
boﬁ
 
hñd
 = 
öput
->
buâ⁄s
[
WIN32_BUTTON_LEFT_MOUSE
].held;

377 
ui_ªndîî
->
d©a
 = 
	`PushAºay
(ui_ªndîî->
‰ame_¨ía
, 
UID©a
, ui_ªndîî->
ñemít_cou¡î
);

379 
u32
 
node_cou¡
 = 0;

381 
UIEÀmít
* 
node
 = 
ui_ªndîî
->
ñemíts
;

382 
node
) {

383 
	`UIO≥øãEÀmít
(
mou£_pos
, 
mou£_dñ
, 
hñd
, 
node
, 0, 
ui_ªndîî
->
d©a
 + 
node_cou¡
++, ui_renderer);

385 
UIEÀmít
* 
chûd
 = 
node
->child;

386 
chûd
) {

387 
	`UIO≥øãEÀmít
(
mou£_pos
, 
mou£_dñ
, 
hñd
, 
chûd
, 
node
, 
ui_ªndîî
->
d©a
 + 
node_cou¡
++, ui_renderer);

388 
chûd
 = chûd->
√xt
;

391 
node
 =Çode->
√xt
;

393 
	}
}

396 
	$UIRídîîFøme
(
I≈ut
* 
öput
, 
UIRídîî
* 
ui_ªndîî
, 
Rídîî
* 
ªndîî
) {

398 
	`UIGíî©eD©a
(
öput
, 
ui_ªndîî
);

399 if(
ui_ªndîî
->
ñemít_cou¡î
)

400 
	`UIRídîEÀmíts
(
ui_ªndîî
, 
ªndîî
);

401 
ui_ªndîî
->
ñemít_cou¡î
 = 0;

402 
ui_ªndîî
->
d©a
 = 0;

403 
ui_ªndîî
->
ñemíts
 = 0;

404 
	}
}

	@win32.cpp

1 
	~<wödows.h
>

3 
	~"ba£_ty≥s.h
"

4 
	~"∂©f‹m_≠i.h
"

5 
	~"mem‹y_m™agemít.h
"

7 
	~"game_œyî.h
"

8 
	~"wö32.h
"

10 
	#STB_SPRINTF_IMPLEMENTATION


	)

11 
	~"ö˛ude/°b_•rötf.h
"

13 
Pœtf‹mAPI
 
	gwö32_≠i
;

14 
globÆ
 
boﬁ
 
	gg_ru¬ög
;

15 
globÆ
 
Wö32Sèã
 
	gg_wö32_°©e
;

16 
globÆ
 
Wö32Wödow
 
	gg_wö32_wödow
;

17 
globÆ
 
Wö32GameFun˘i⁄TabÀ
 
	gg_game_fun˘i⁄s
;

18 
globÆ
 
i64
 
	gGlobÆPîfCou¡Fªquícy
;

20 
FILETIME


21 
	$Wö32GëLa°WrôeTime
(* 
absfûï©h
) {

22 
FILETIME
 
ªsu…
 = {};

23 
WIN32_FILE_ATTRIBUTE_DATA
 
fûe_©åibuã
 = {};

24 
	`As£π
(
	`GëFûeAâribuãsExA
(
absfûï©h
, 
GëFûeExInfoSènd¨d
, &
fûe_©åibuã
));

25 
ªsu…
 = 
fûe_©åibuã
.
·La°WrôeTime
;

26  
ªsu…
;

27 
	}
}

29 
WödowDimísi⁄s


30 
	$Wö32GëWödowDimísi⁄s
(
HWND
 
wödow
) {

31 
WödowDimísi⁄s
 
wd
 = {};

32 
RECT
 
ª˘
;

33 
	`GëClõ¡Re˘
(
wödow
, &
ª˘
);

34 
wd
.
width
 = (
u32
)(
ª˘
.
right
 -Ñe˘.
À·
);

35 
wd
.
height
 = (
u32
)(
ª˘
.
bŸtom
 -Ñe˘.
t›
);

36  
wd
;

37 
	}
}

39 
LARGE_INTEGER


40 
	$Wö32GëWÆlClock
() {

41 
LARGE_INTEGER
 
Resu…
;

42 
	`QuîyPîf‹m™˚Cou¡î
(&
Resu…
);

43 (
Resu…
);

44 
	}
}

47 
	$Wö32GëSec⁄dsEœp£d
(
LARGE_INTEGER
 
Sèπ
, LARGE_INTEGER 
End
)

49 
Resu…
 = (()(
End
.
QuadP¨t
 - 
Sèπ
.QuadPart) /

50 ()
GlobÆPîfCou¡Fªquícy
);

51 (
Resu…
);

52 
	}
}

55 
	$Wö32MakeTempDLLAbsFûeP©h
(
Wö32Sèã
* 
°©e
, 
Wö32DLL
* 
code
, * 
d°
) {

56 
	`°b•_•rötf
(
d°
, "%s%d_%s", 
°©e
->
exe_absfﬁdî∑th
, 
code
->
å™sõ¡_dŒ_cou¡î
++, code->
å™sõ¡_dŒ_«me
);

57 if(
code
->
å™sõ¡_dŒ_cou¡î
 >= 1024) code->transient_dll_counter = 0;

58 
	}
}

61 
	$Wö32U∆ﬂdDLL
(
Wö32DLL
* 
code
) {

62 
	`FªeLibøry
(
code
->
dŒ
);

63 
code
->
vÆid
 = 
Ál£
;

64 
code
->
dŒ
 = 0;

65 
	`ZîoAºay
(
code
->
fun˘i⁄s
, code->
fun˘i⁄_cou¡
);

66 
	}
}

69 
	$Wö32LﬂdDLL
(
Wö32Sèã
* 
°©e
, 
Wö32DLL
* 
code
) {

70 
ãmp_dŒ_absfûï©h
[
MAX_PATH
] = {};

71 
WIN32_FILE_ATTRIBUTE_DATA
 
d©a
;

72 if(!
	`GëFûeAâribuãsExA
(
code
->
lock_absfûï©h
, 
GëFûeExInfoSènd¨d
, &
d©a
)) {

73 
code
->
œ°_wrôe_time
 = 
	`Wö32GëLa°WrôeTime
(code->
absfûï©h
);

74 
u32
 
åõs
=0;Åries<128;Åries++) {

75 
	`Wö32MakeTempDLLAbsFûeP©h
(
°©e
, 
code
, 
ãmp_dŒ_absfûï©h
);

76 if(
	`C›yFûe
(
code
->
absfûï©h
, 
ãmp_dŒ_absfûï©h
, 
FALSE
)) ;

79 
code
->
dŒ
 = 
	`LﬂdLibøryA
(
ãmp_dŒ_absfûï©h
);

80 if(
code
->
dŒ
) {

81 
code
->
vÆid
 = 
åue
;

82 
u8
 
i
=0; i<
code
->
fun˘i⁄_cou¡
; i++) {

83 * 
func
 = 
	`GëProcAddªss
(
code
->
dŒ
, code->
fun˘i⁄_«mes
[
i
]);

84 if(
func
Ë
code
->
fun˘i⁄s
[
i
] = func;

85 
code
->
vÆid
 = 
Ál£
;

90 if(!
code
->
vÆid
Ë
	`Wö32U∆ﬂdDLL
(code);

91 
	}
}

94 
	$Wö32RñﬂdDLL
(
Wö32Sèã
* 
°©e
, 
Wö32DLL
* 
code
) {

95 
	`Wö32U∆ﬂdDLL
(
code
);

96 
u32
 
åõs
=0;Åries<100;Åries++) {

97 if(!
code
->
vÆid
) {

98 
	`Wö32LﬂdDLL
(
°©e
, 
code
);

99 
	`SÀï
(100);

102 
	}
}

104 
boﬁ


105 
	$Wö32HasDLLCh™ged
(
Wö32DLL
* 
code
) {

106 
FILETIME
 
·
 = 
	`Wö32GëLa°WrôeTime
(
code
->
absfûï©h
);

107  
	`Com∑ªFûeTime
(&
·
, &
code
->
œ°_wrôe_time
);

108 
	}
}

110 
LRESULT
 
CALLBACK


111 
	$Wö32MaöWödowCÆlback
(
HWND
 
wödow
, 
UINT
 
msg
, 
WPARAM
 
w∑øm
, 
LPARAM
 
Õ¨am
) {

112 
LRESULT
 
ªsu…
 = 0;

113 
msg
) {

114 
WM_CLOSE
: { 
g_ru¬ög
 = 
Ál£
; } ;

115 
WM_DESTROY
: { 
g_ru¬ög
 = 
Ál£
; } ;

116 
WM_SIZE
: {

117 
g_wö32_wödow
.
dim
.
width
 = 
	`LOWORD
(
Õ¨am
);

118 
g_wö32_wödow
.
dim
.
height
 = 
	`HIWORD
(
Õ¨am
);

120 
WM_SETCURSOR
: {

121 if(
g_wö32_°©e
.
curs‹_íabÀd
)

122 
	`SëCurs‹
(
g_wö32_°©e
.
curs‹
);

124 
	`SëCurs‹
(0);

126 : { 
ªsu…
 = 
	`DefWödowProcA
(
wödow
, 
msg
, 
w∑øm
, 
Õ¨am
); } ;

128  
ªsu…
;

129 
	}
}

132 
	$Wö32PªPro˚ssBuâ⁄
(
Buâ⁄
* 
buâ⁄
) {

133 if(
buâ⁄
->
¥es£d
) {

134 
buâ⁄
->
hñd
 = 
åue
;

135 
buâ⁄
->
¥es£d
 = 
Ál£
;

137 
	}
}

140 
	$Wö32Pro˚ssBuâ⁄
(
Buâ⁄
* 
buâ⁄
, 
boﬁ
 
is_down
) {

141 if(
is_down
) {

142 if(!
buâ⁄
->
hñd
Ëbuâ⁄->
¥es£d
 = 
åue
;

145 
buâ⁄
->
¥es£d
 = 
Ál£
;

146 
buâ⁄
->
hñd
 = 
Ál£
;

148 
	}
}

150 
	$PLATFORM_ALLOCATE_MEMORY
(
wö32_Æloˇã_mem‹y
) {

151 
u64
 
∑ge_size
 = 4096;

152 
u64
 
tŸÆ_size
 = (
Wö32Mem‹yBlock
Ë+ 
size
;

153 
u64
 
off£t
 = (
Wö32Mem‹yBlock
);

155 
Wö32Mem‹yBlock
* 
block
 = (Wö32Mem‹yBlock*)
	`VútuÆAŒoc
(0, 
tŸÆ_size
, 
MEM_COMMIT
|
MEM_RESERVE
, 
PAGE_READWRITE
);

156 
	`As£π
(
block
);

157 
block
->block.
bp
 = (
u8
*)block + 
off£t
;

158 
	`As£π
(
block
->block.
u£d
 == 0);

159 
	`As£π
(
block
->block.
¥ev
 == 0);

161 
Wö32Mem‹yBlock
* 
£¡öñ
 = &
g_wö32_°©e
.
mem‹y_£¡öñ
;

163 
block
->block.
size
 = size;

164 
block
->
√xt
 = 
£¡öñ
;

165 
block
->
¥ev
 = 
£¡öñ
->prev;

167 
block
->
¥ev
->
√xt
 = block;

168 
block
->
√xt
->
¥ev
 = block;

170 
Pœtf‹mMem‹yBlock
* 
∂©_block
 = &
block
->block;

171  
∂©_block
;

172 
	}
}

174 
	$PLATFORM_DEALLOCATE_MEMORY
(
wö32_dóŒoˇã_mem‹y
) {

175 if(
block
) {

176 
Wö32Mem‹yBlock
* 
wö32_block
 = (Wö32Mem‹yBlock*)
block
;

177 
wö32_block
->
¥ev
->
√xt
 = win32_block->next;

178 
wö32_block
->
√xt
->
¥ev
 = win32_block->prev;

179 
boﬁ
 
ªsu…
 = 
	`VútuÆFªe
(
block
, 0, 
MEM_RELEASE
);

180 
	`As£π
(
ªsu…
);

182 
	}
}

184 
	$PLATFORM_OPEN_FILE
(
wö32_›í_fûe
) {

185 
Pœtf‹mFûeH™dÀ
 
ªsu…
 = {};

186 * 
fûíame
 = (*)
öfo
->
«me
;

188 
HANDLE
 
h™dÀ
 = 
	`Cª©eFûeA
(
fûíame
, 
GENERIC_READ
, 
FILE_SHARE_READ
, 0, 
OPEN_EXISTING
, 0, 0);

189 
LARGE_INTEGER
 
li
 = {};

190 
	`GëFûeSizeEx
(
h™dÀ
, &
li
);

191 
öfo
->
size
 = 
li
.
QuadP¨t
;

193 
ªsu…
.
Áûed
 = 
h™dÀ
 =
INVALID_HANDLE_VALUE
;

194 *(
HANDLE
*)&
ªsu…
.
h™dÀ
 = handle;

196  
ªsu…
;

197 
	}
}

199 
	$PLATFORM_CLOSE_FILE
(
wö32_˛o£_fûe
) {

200 
	`As£π
(!
fûe_h™dÀ
->
Áûed
);

201 
HANDLE
 
h™dÀ
 = *(HANDLE*)&
fûe_h™dÀ
->handle;

202 
	`Clo£H™dÀ
(
h™dÀ
);

203 
	}
}

205 
	$PLATFORM_READ_FILE
(
wö32_ªad_fûe
) {

206 
	`As£π
(!
wö32_h™dÀ
->
Áûed
);

207 
HANDLE
 
h™dÀ
 = *(HANDLE*)&
wö32_h™dÀ
->handle;

208 
	`As£π
(
	`RódFûe
(
h™dÀ
, 
d°
, 
size
, 0, 0));

209 
	}
}

212 
	$Wö32Pro˚ssBuâ⁄I≈ut
(
MSG
 
msg
, 
I≈ut
* 
öput
) {

213 
boﬁ
 
is_key_down
 = 
msg
.
mesßge
 =
WM_KEYDOWN
 ? 
åue
 : 
Ál£
;

214 
u32
 
VKCode
 = (u32)
msg
.
wP¨am
;

215 
boﬁ
 
is_down
 = ((
msg
.
lP¨am
 & (1UL << 31)) == 0);

217 if(
VKCode
 ='W'Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_W
], 
is_down
);

218 if(
VKCode
 ='A'Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_A
], 
is_down
);

219 if(
VKCode
 ='S'Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_S
], 
is_down
);

220 if(
VKCode
 ='D'Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_D
], 
is_down
);

221 if(
VKCode
 ='Q'Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_Q
], 
is_down
);

222 if(
VKCode
 ='E'Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_E
], 
is_down
);

224 if(
VKCode
 =
VK_SHIFT
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_SHIFT
], 
is_down
);

225 if(
VKCode
 =
VK_LMENU
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_ALT
], 
is_down
);

226 if(
VKCode
 =
VK_SPACE
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_SPACE
], 
is_down
);

227 if(
VKCode
 =
VK_CONTROL
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_CTRL
], 
is_down
);

229 if(
VKCode
 =
VK_UP
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_UP
], 
is_down
);

230 if(
VKCode
 =
VK_DOWN
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_DOWN
], 
is_down
);

231 if(
VKCode
 =
VK_LEFT
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_LEFT
], 
is_down
);

232 if(
VKCode
 =
VK_RIGHT
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_RIGHT
], 
is_down
);

234 if(
VKCode
 =
VK_F1
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_F1
], 
is_down
);

235 if(
VKCode
 =
VK_F2
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_F2
], 
is_down
);

236 if(
VKCode
 =
VK_F3
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_F3
], 
is_down
);

237 if(
VKCode
 =
VK_F4
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_F4
], 
is_down
);

238 if(
VKCode
 =
VK_F5
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_F5
], 
is_down
);

239 if(
VKCode
 =
VK_F6
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_F6
], 
is_down
);

240 if(
VKCode
 =
VK_F7
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_F7
], 
is_down
);

241 if(
VKCode
 =
VK_F8
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_F8
], 
is_down
);

242 if(
VKCode
 =
VK_F9
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_F9
], 
is_down
);

243 if(
VKCode
 =
VK_F10
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_F10
], 
is_down
);

244 if(
VKCode
 =
VK_F11
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_F11
], 
is_down
);

245 if(
VKCode
 =
VK_F12
Ë
	`Wö32Pro˚ssBuâ⁄
(&
öput
->
buâ⁄s
[
WIN32_BUTTON_F12
], 
is_down
);

246 
	}
}

249 
	$Wö32PªPro˚ssMou£Move
(
I≈ut
* 
öput
) {

250 
POINT
 
poöt
;

251 
	`GëCurs‹Pos
(&
poöt
);

252 
ﬁd_x_pos
 = 
öput
->
axes
[
WIN32_AXIS_MOUSE
].
x
;

253 
ﬁd_y_pos
 = 
öput
->
axes
[
WIN32_AXIS_MOUSE
].
y
;

255 
	`S¸ìnToClõ¡
(
g_wö32_wödow
.
h™dÀ
, &
poöt
);

257 
x
 = ()
poöt
.x/
g_wö32_wödow
.
dim
.
width
;

258 
y
 = ()
poöt
.y/
g_wö32_wödow
.
dim
.
height
;

260 if(
x
>1) x = 1; if(x<0) x = 0;

261 if(
y
>1) y = 1; if(y<0) y = 0;

263 
öput
->
axes
[
WIN32_AXIS_MOUSE_DEL
].
x
 = x - 
ﬁd_x_pos
;

264 
öput
->
axes
[
WIN32_AXIS_MOUSE_DEL
].
y
 = y - 
ﬁd_y_pos
;

266 
öput
->
axes
[
WIN32_AXIS_MOUSE
].
x
 = x;

267 
öput
->
axes
[
WIN32_AXIS_MOUSE
].
y
 = y;

269 
	}
}

271 
CALLBACK


272 
	$WöMaö
(
HINSTANCE
 
ö°™˚
, HINSTANCE 
¥ev_ö°™˚
, 
LPSTR
 
cmdlöe
, 
show_code
) {

273 
HRESULT
 
hr
 = {};

275 
WNDCLASS
 
wödow_˛ass
 = {};

277 
wödow_˛ass
.
°yÀ
 = 
CS_OWNDC
|
CS_HREDRAW
|
CS_VREDRAW
;

278 
wödow_˛ass
.
Õ‚WndProc
 = 
Wö32MaöWödowCÆlback
;

279 
wödow_˛ass
.
hIn°™˚
 = 
ö°™˚
;

280 
wödow_˛ass
.
ÕszMíuName
 = "Game_menu";

281 
wödow_˛ass
.
ÕszCœssName
 = "Game_class";

283 
g_wö32_°©e
.
curs‹
 = 
	`LﬂdCurs‹
(0, 
IDC_ARROW
);

284 
wödow_˛ass
.
hCurs‹
 = 
g_wö32_°©e
.
curs‹
;

286 
	`As£π
(
	`Regi°îCœssA
(&
wödow_˛ass
));

288 
HWND
 
wödow
 = 
	`Cª©eWödowExA
(0, 
wödow_˛ass
.
ÕszCœssName
, "Game",

289 
WS_OVERLAPPEDWINDOW
|
WS_VISIBLE
, 
CW_USEDEFAULT
, CW_USEDEFAULT,

290 1600, 900, 0, 0, 
ö°™˚
, 0);

291 
	`As£π
(
wödow
);

293 
g_wö32_°©e
.
deÁu…_wödow_h™dÀ
 = 
wödow
;

294 
	`GëModuÀFûeNameA
(0, 
g_wö32_°©e
.
exe_absfûï©h
, (g_win32_state.exe_absfilepath));

296 
u32
 
exe_fﬁdî_∑th_Àn
 = 0;

297 
u32
 
i
=0; 
g_wö32_°©e
.
exe_absfûï©h
[i] != 0; i++)

298 if(
g_wö32_°©e
.
exe_absfûï©h
[
i
] ='\\'Ë
exe_fﬁdî_∑th_Àn
 = i+1;

299 
	`C›yMem
(
g_wö32_°©e
.
exe_absfﬁdî∑th
, g_wö32_°©e.
exe_absfûï©h
, 
exe_fﬁdî_∑th_Àn
);

301 
ãmp_exe_absfûï©h
[
MAX_PATH
] = {};

302 
ﬁd_exe_absfûï©h
[
MAX_PATH
] = {};

303 
game_dŒ_absfûï©h
[
MAX_PATH
] = {};

304 
lock_absfûï©h
[
MAX_PATH
] = {};

305 
ªndîî_dŒ_absfûï©h
[
MAX_PATH
] = {};

307 * 
ãmp_exe_fûíame
 = "win32_entry_temp.exe";

308 * 
ﬁd_exe_fûíame
 = "win32_entry_old.exe";

309 * 
game_dŒ_fûíame
 = "game.dll";

310 * 
ªndîî_dŒ_fûíame
 = "win32_d3d11.dll";

311 * 
lock_fûíame
 = "lock.tmp";

313 
	`°b•_•rötf
(
ãmp_exe_absfûï©h
 , "%s%s" , 
g_wö32_°©e
.
exe_absfﬁdî∑th
 , 
ãmp_exe_fûíame
);

314 
	`°b•_•rötf
(
ﬁd_exe_absfûï©h
 , "%s%s" , 
g_wö32_°©e
.
exe_absfﬁdî∑th
 , 
ﬁd_exe_fûíame
);

315 
	`°b•_•rötf
(
game_dŒ_absfûï©h
 , "%s%s" , 
g_wö32_°©e
.
exe_absfﬁdî∑th
 , 
game_dŒ_fûíame
);

316 
	`°b•_•rötf
(
ªndîî_dŒ_absfûï©h
 , "%s%s" , 
g_wö32_°©e
.
exe_absfﬁdî∑th
 , 
ªndîî_dŒ_fûíame
);

317 
	`°b•_•rötf
(
lock_absfûï©h
 , "%s%s" , 
g_wö32_°©e
.
exe_absfﬁdî∑th
 , 
lock_fûíame
);

320 
g_ru¬ög
 = 
åue
;

321 
I≈ut
 
öput
 = {};

323 
Wö32Mem‹yBlock
* 
£¡öñ
 = &
g_wö32_°©e
.
mem‹y_£¡öñ
;

324 
£¡öñ
->
√xt
 = sentinel;

325 
£¡öñ
->
¥ev
 = sentinel;

327 
Wö32DLL
 
game_code
 = {};

328 
game_code
.
å™sõ¡_dŒ_«me
 = "game_temp.dll";

329 
game_code
.
absfûï©h
 = 
game_dŒ_absfûï©h
;

330 
game_code
.
lock_absfûï©h
 =Üock_absfilepath;

331 
game_code
.
fun˘i⁄_«mes
 = 
wö32_game_fun˘i⁄_«mes
;

332 
game_code
.
fun˘i⁄s
 = (**)&
g_game_fun˘i⁄s
;

333 
game_code
.
fun˘i⁄_cou¡
 = 
	`AºayCou¡
(
wö32_game_fun˘i⁄_«mes
);

335 
	`Wö32LﬂdDLL
(&
g_wö32_°©e
, &
game_code
);

337 
wö32_≠i
.
›í_fûe
 = 
wö32_›í_fûe
;

338 
wö32_≠i
.
˛o£_fûe
 = 
wö32_˛o£_fûe
;

339 
wö32_≠i
.
ªad_fûe
 = 
wö32_ªad_fûe
;

340 
wö32_≠i
.
Æloˇã_mem‹y
 = 
wö32_Æloˇã_mem‹y
;

341 
wö32_≠i
.
dóŒoˇã_mem‹y
 = 
wö32_dóŒoˇã_mem‹y
;

343 
GameLayî
 
game_œyî
 = {};

344 
game_œyî
.
∂©f‹m_≠i
 = 
wö32_≠i
;

346 
g_wö32_wödow
.
h™dÀ
 = 
wödow
;

347 
g_wö32_wödow
.
dim
 = 
	`Wö32GëWödowDimísi⁄s
(
wödow
);

349 
LARGE_INTEGER
 
PîfCou¡FªquícyResu…
;

350 
	`QuîyPîf‹m™˚Fªquícy
(&
PîfCou¡FªquícyResu…
);

351 
GlobÆPîfCou¡Fªquícy
 = 
PîfCou¡FªquícyResu…
.
QuadP¨t
;

353 
UINT
 
DesúedScheduÀrMS
 = 1;

354 
boﬁ
 
SÀïIsGønuœr
 = (
	`timeBegöPîiod
(
DesúedScheduÀrMS
Ë=
TIMERR_NOERROR
);

356 
M⁄ô‹Re‰eshHz
 = 144;

357 
GameUpd©eHz
 = 
M⁄ô‹Re‰eshHz
;

358 
T¨gëSec⁄dsPîFøme
 = 1.0f/()
GameUpd©eHz
;

360 
LARGE_INTEGER
 
La°Cou¡î
 = 
	`Wö32GëWÆlClock
();

361 
LARGE_INTEGER
 
AµBegöTimî
 = 
La°Cou¡î
;

362 
u64
 
La°Cy˛eCou¡
 = 
	`__rdtsc
();

364 
g_ru¬ög
) {

366 if(
game_œyî
.
debug_curs‹_ªque°
) {

367 if(!
g_wö32_°©e
.
curs‹_íabÀd
) {

368 
	`SëCurs‹
(
g_wö32_°©e
.
curs‹
);

369 
g_wö32_°©e
.
curs‹_íabÀd
 = 
åue
;

374 if(!
g_wö32_°©e
.
curs‹_˛ù_íabÀd
) {

375 
RECT
 
ª˘
;

376 
	`GëWödowRe˘
(
g_wö32_wödow
.
h™dÀ
, &
ª˘
);

377 
	`ClùCurs‹
(&
ª˘
);

378 
g_wö32_°©e
.
curs‹_˛ù_íabÀd
 = 
åue
;

383 
u8
 
i
=0; i<
WIN32_BUTTON_TOTAL
; i++Ë
	`Wö32PªPro˚ssBuâ⁄
(&
öput
.
buâ⁄s
[i]);

384 
	`Wö32PªPro˚ssMou£Move
(&
öput
);

386 
	`Wö32Pro˚ssBuâ⁄
(&
öput
.
buâ⁄s
[
WIN32_BUTTON_LEFT_MOUSE
], 
	`GëKeySèã
(
VK_LBUTTON
) & (1<<15));

387 
	`Wö32Pro˚ssBuâ⁄
(&
öput
.
buâ⁄s
[
WIN32_BUTTON_RIGHT_MOUSE
], 
	`GëKeySèã
(
VK_LBUTTON
) & (1<<15));

390 
MSG
 
msg
 = {};

391 
	`PìkMesßgeA
(&
msg
, 0, 0, 0, 
PM_REMOVE
)) {

392 
msg
.
mesßge
) {

393 
WM_QUIT
: { 
g_ru¬ög
 = 
Ál£
; } ;

394 
WM_SYSKEYDOWN
:

395 
WM_SYSKEYUP
:

396 
WM_KEYUP
:

397 
WM_KEYDOWN
:

398 
WM_LBUTTONDOWN
:

399 
WM_RBUTTONDOWN
: {

400 
	`Wö32Pro˚ssBuâ⁄I≈ut
(
msg
, &
öput
);

403 
	`Tøn¶©eMesßge
(&
msg
);

404 
	`Di•©chMesßge
(&
msg
);

409 
LARGE_INTEGER
 
W‹kCou¡î
 = 
	`Wö32GëWÆlClock
();

410 
W‹kSec⁄dsEœp£d
 = 
	`Wö32GëSec⁄dsEœp£d
(
La°Cou¡î
, 
W‹kCou¡î
);

412 
Sec⁄dsEœp£dF‹Føme
 = 
W‹kSec⁄dsEœp£d
;

413 if(
Sec⁄dsEœp£dF‹Føme
 < 
T¨gëSec⁄dsPîFøme
) {

414 if(
SÀïIsGønuœr
) {

415 
DWORD
 
SÀïMS
 = (DWORD)(1000.0‡* (
T¨gëSec⁄dsPîFøme
 -

416 
Sec⁄dsEœp£dF‹Føme
));

417 if(
SÀïMS
 > 0Ë
	`SÀï
(SleepMS);

420 
Te°Sec⁄dsEœp£dF‹Føme
 = 
	`Wö32GëSec⁄dsEœp£d
(
La°Cou¡î
,

421 
	`Wö32GëWÆlClock
());

423 
Sec⁄dsEœp£dF‹Føme
 < 
T¨gëSec⁄dsPîFøme
)

425 
Sec⁄dsEœp£dF‹Føme
 = 
	`Wö32GëSec⁄dsEœp£d
(
La°Cou¡î
,

426 
	`Wö32GëWÆlClock
());

430 
g_game_fun˘i⁄s
.
	`game_lo›
(&
game_œyî
, &
g_wö32_wödow
, &
öput
);

432 if(
	`Wö32HasDLLCh™ged
(&
game_code
)) {

433 
	`Wö32RñﬂdDLL
(&
g_wö32_°©e
, &
game_code
);

434 
game_œyî
.
execuèbÀ_ªlﬂded
 = 
åue
;

436 
game_œyî
.
execuèbÀ_ªlﬂded
 = 
Ál£
;

438 if(
game_œyî
.
quô_ªque°
Ë
g_ru¬ög
 = 
Ál£
;

440 
LARGE_INTEGER
 
EndCou¡î
 = 
	`Wö32GëWÆlClock
();

441 
LARGE_INTEGER
 
AµTimî
 = 
EndCou¡î
;

442 
TimîMS
 = 1000.0f*
	`Wö32GëSec⁄dsEœp£d
(
AµBegöTimî
, 
AµTimî
);

444 
MSPîFøme
 = 1000.0f*
	`Wö32GëSec⁄dsEœp£d
(
La°Cou¡î
, 
EndCou¡î
);

445 
La°Cou¡î
 = 
EndCou¡î
;

447 
u64
 
EndCy˛eCou¡
 = 
	`__rdtsc
();

448 
u64
 
Cy˛esEœp£d
 = 
EndCy˛eCou¡
 - 
La°Cy˛eCou¡
;

449 
La°Cy˛eCou¡
 = 
EndCy˛eCou¡
;

454 
game_œyî
.
ms_≥r_‰ame
 = 
MSPîFøme
;

455 
game_œyî
.
timî
 = 
TimîMS
;

461 
La°Cou¡î
 = 
EndCou¡î
;

464 
	}
}

	@win32.h

1 
	sWö32DLL
 {

2 
boﬁ
 
	mvÆid
;

3 
HMODULE
 
	mdŒ
;

4 
FILETIME
 
	mœ°_wrôe_time
;

5 
u32
 
	må™sõ¡_dŒ_cou¡î
;

7 * 
	mabsfûï©h
;

8 * 
	mlock_absfûï©h
;

9 * 
	må™sõ¡_dŒ_«me
;

10 ** 
	mfun˘i⁄s
;

11 ** 
	mfun˘i⁄_«mes
;

12 
u8
 
	mfun˘i⁄_cou¡
;

15 * 
	gwö32_game_fun˘i⁄_«mes
[] = {

19 
	sWö32GameFun˘i⁄TabÀ
 {

20 
GameLo›
* 
	mgame_lo›
;

23 
	sWö32Mem‹yBlock
 {

24 
Pœtf‹mMem‹yBlock
 
	mblock
;

26 
Wö32Mem‹yBlock
* 
	m¥ev
;

27 
Wö32Mem‹yBlock
* 
	m√xt
;

30 
	sWö32Sèã
 {

31 
Wö32Mem‹yBlock
 
	mmem‹y_£¡öñ
;

33 
	mexe_absfûï©h
[
MAX_PATH
];

34 
	mexe_absfﬁdî∑th
[
MAX_PATH
];

35 
HWND
 
	mdeÁu…_wödow_h™dÀ
;

36 
HCURSOR
 
	mcurs‹
;

38 
boﬁ
 
	mcurs‹_íabÀd
;

39 
boﬁ
 
	mcurs‹_˛ù_íabÀd
;

	@
1
.
0
36
522
asset_formats.h
asset_info.cpp
asset_info.h
asset_loading.cpp
base_types.h
camera.cpp
easings.h
file_formats.h
font_handling.cpp
font_handling.h
game.cpp
game.h
game_layer.h
game_mode.cpp
game_mode.h
include/stb_image.h
include/stb_rect_pack.h
include/stb_sprintf.h
include/stb_truetype.h
math.h
memory_management.h
mesh_renderer.cpp
platform_api.h
post_process_renderer.cpp
quad_renderer.cpp
renderer.cpp
renderer.h
shader_code.h
shapes.cpp
simulation.cpp
simulation.h
tetra.cpp
timer.h
ui_renderer.cpp
win32.cpp
win32.h
